{"version":3,"file":"index.js","sources":["../../src/preload/index.ts"],"sourcesContent":["import { contextBridge, ipcRenderer, IpcRendererEvent } from 'electron'\r\n\r\n// Settings interface\r\ninterface AppSettings {\r\n  output_path: string\r\n  buffer_seconds: number\r\n  video: {\r\n    width: number\r\n    height: number\r\n    fps: number\r\n    encoder: 'auto' | 'nvenc' | 'x264'\r\n    quality: number\r\n  }\r\n  audio: {\r\n    sample_rate: number\r\n    bitrate: number\r\n    system_audio_enabled: boolean\r\n    microphone_enabled: boolean\r\n  }\r\n  hotkey: {\r\n    save_clip: string\r\n  }\r\n  ui?: {\r\n    show_notifications: boolean\r\n    minimize_to_tray: boolean\r\n    start_with_windows: boolean\r\n  }\r\n  launcher?: {\r\n    autostart_backend: boolean\r\n    backend_mode: string\r\n    single_instance: boolean\r\n  }\r\n}\r\n\r\n// Expose protected methods to renderer process\r\ncontextBridge.exposeInMainWorld('electronAPI', {\r\n  // Settings\r\n  getSettings: () => ipcRenderer.invoke('settings:get'),\r\n  saveSettings: (settings: AppSettings) => ipcRenderer.invoke('settings:save', settings),\r\n  restartBackend: () => ipcRenderer.invoke('backend:restart'),\r\n  setStartup: (enabled: boolean) => ipcRenderer.invoke('settings:setStartup', enabled),\r\n\r\n  // System\r\n  getMonitors: () => ipcRenderer.invoke('system:getMonitors'),\r\n  getAudioDevices: (type: 'output' | 'input') => ipcRenderer.invoke('audio:getDevices', type),\r\n\r\n  // Clips\r\n  getClipsList: () => ipcRenderer.invoke('clips:getList'),\r\n  saveClipMetadata: (clipId: string, metadata: unknown) =>\r\n    ipcRenderer.invoke('clips:saveMetadata', clipId, metadata),\r\n  getClipMetadata: (clipId: string) => ipcRenderer.invoke('clips:getMetadata', clipId),\r\n  deleteClip: (clipId: string) => ipcRenderer.invoke('clips:delete', clipId),\r\n  generateThumbnail: (clipId: string, videoPath: string) =>\r\n    ipcRenderer.invoke('clips:generateThumbnail', clipId, videoPath),\r\n  getExistingThumbnails: () => ipcRenderer.invoke('clips:getExistingThumbnails'),\r\n  getVideoMetadata: (videoPath: string) => ipcRenderer.invoke('clips:getVideoMetadata', videoPath),\r\n\r\n  // Audio tracks\r\n  extractAudioTracks: (clipId: string, videoPath: string) =>\r\n    ipcRenderer.invoke('audio:extractTracks', clipId, videoPath),\r\n\r\n  // Video loading\r\n  getVideoFileUrl: (filename: string) => ipcRenderer.invoke('video:getFileUrl', filename),\r\n\r\n  // Export preview\r\n  showExportPreview: (filePath: string) => ipcRenderer.invoke('export:showPreview', filePath),\r\n\r\n  // Cleanup - permanent deletion of cache files (bypasses recycle bin)\r\n  cleanupOrphanedCache: () => ipcRenderer.invoke('cleanup:orphans'),\r\n  getCacheStats: () => ipcRenderer.invoke('cleanup:stats'),\r\n\r\n  // System\r\n  openClipsFolder: () => ipcRenderer.invoke('system:openFolder'),\r\n\r\n  // Dialogs\r\n  showSaveDialog: (options: Electron.SaveDialogOptions) =>\r\n    ipcRenderer.invoke('dialog:save', options),\r\n\r\n  // Dialog API\r\n  dialog: {\r\n    save: (options: Electron.SaveDialogOptions) => ipcRenderer.invoke('dialog:save', options),\r\n    openFolder: () => ipcRenderer.invoke('dialog:openFolder'),\r\n  },\r\n\r\n  editor: {\r\n    exportClip: (params: ExportParams) => ipcRenderer.invoke('editor:exportClip', params),\r\n    saveState: (clipId: string, state: unknown) => ipcRenderer.invoke('editor:saveState', clipId, state),\r\n    loadState: (clipId: string) => ipcRenderer.invoke('editor:loadState', clipId),\r\n  },\r\n\r\n  // Games database\n  getGamesDatabase: () => ipcRenderer.invoke('games:getDatabase'),\n\n  // Event listener\n  on: (channel: string, callback: (data: unknown) => void) => {\n    const listener = (_event: IpcRendererEvent, data: unknown) => callback(data)\n    ipcRenderer.on(channel, listener)\n    return () => {\n      ipcRenderer.removeListener(channel, listener)\n    }\n  },\n})\n\r\ninterface VideoMetadata {\r\n  duration: number\r\n  width: number\r\n  height: number\r\n  fps: number\r\n  bitrate: number\r\n  size: number\r\n  format: string\r\n  videoCodec: string\r\n  audioTracks: number\r\n}\r\n\r\n// Type for clip info (matches main process)\r\ninterface ClipInfo {\r\n  id: string\r\n  filename: string\r\n  path: string\r\n  size: number\r\n  createdAt: string\r\n  modifiedAt: string\r\n  metadata: unknown | null\r\n}\r\n\r\ninterface ExportParams {\r\n  clipPath: string\r\n  exportFilename: string\r\n  trimStart: number\r\n  trimEnd: number\r\n  audioTrack1: boolean\r\n  audioTrack2: boolean\r\n  audioTrack1Volume?: number\r\n  audioTrack2Volume?: number\r\n  targetSizeMB?: number | 'original'\r\n}\r\n\r\ninterface ExportResult {\r\n  success: boolean\r\n  error?: string\r\n}\r\n\r\ninterface AudioTrackUrls {\r\n  track1?: string\r\n  track2?: string\r\n  error?: string\r\n}\r\n\r\n// Editor state for persistence\r\ninterface EditorState {\r\n  trim: {\r\n    start: number\r\n    end: number\r\n  }\r\n  playheadPosition: number\r\n  audio: {\r\n    track1: {\r\n      enabled: boolean\r\n      muted: boolean\r\n      volume: number\r\n    }\r\n    track2: {\r\n      enabled: boolean\r\n      muted: boolean\r\n      volume: number\r\n    }\r\n  }\r\n  lastModified: string\r\n}\r\n\r\ninterface AudioDeviceInfo {\r\n  id: string\r\n  name: string\r\n  type: 'output' | 'input'\r\n  is_default: boolean\r\n}\r\n\r\ninterface MonitorInfo {\r\n  id: number\r\n  name: string\r\n  width: number\r\n  height: number\r\n  x: number\r\n  y: number\r\n  primary: boolean\r\n}\r\n\r\n// Type declarations for TypeScript\r\ndeclare global {\r\n  interface Window {\r\n    electronAPI: {\r\n      getSettings: () => Promise<AppSettings>\r\n      saveSettings: (settings: AppSettings) => Promise<{ success: boolean }>\r\n      setStartup: (enabled: boolean) => Promise<{ success: boolean }>\r\n      getClipsList: () => Promise<ClipInfo[]>\r\n      saveClipMetadata: (clipId: string, metadata: unknown) => Promise<boolean>\r\n      getClipMetadata: (clipId: string) => Promise<unknown | null>\r\n      generateThumbnail: (clipId: string, videoPath: string) => Promise<string>\r\n      getExistingThumbnails: () => Promise<{ [clipId: string]: string }>\r\n      getVideoMetadata: (videoPath: string) => Promise<VideoMetadata>\r\n      extractAudioTracks: (clipId: string, videoPath: string) => Promise<AudioTrackUrls>\r\n      getVideoFileUrl: (filename: string) => Promise<{ success: boolean; url?: string; path?: string; error?: string }>\r\n      cleanupOrphanedCache: () => Promise<{ deletedCount: number; errors: string[] }>\r\n      getCacheStats: () => Promise<{\r\n        thumbnailCount: number\r\n        thumbnailSize: number\r\n        audioCount: number\r\n        audioSize: number\r\n        totalSize: number\r\n        thumbnailSizeFormatted: string\r\n        audioSizeFormatted: string\r\n        totalSizeFormatted: string\r\n      } | null>\r\n      getMonitors: () => Promise<MonitorInfo[]>\r\n      getAudioDevices: (type: 'output' | 'input') => Promise<AudioDeviceInfo[]>\r\n      openClipsFolder: () => Promise<void>\r\n      showSaveDialog: (\r\n        options: Electron.SaveDialogOptions\r\n      ) => Promise<Electron.SaveDialogReturnValue>\r\n      dialog: {\r\n        save: (options: Electron.SaveDialogOptions) => Promise<Electron.SaveDialogReturnValue>\r\n        openFolder: () => Promise<Electron.OpenDialogReturnValue>\r\n      }\r\n      editor: {\r\n        exportClip: (params: ExportParams) => Promise<ExportResult>\r\n        saveState: (clipId: string, state: EditorState) => Promise<boolean>\r\n        loadState: (clipId: string) => Promise<EditorState | null>\r\n      }\r\n      on: (channel: string, callback: (data: unknown) => void) => (() => void) | undefined\r\n    }\r\n  }\r\n}\r\n"],"names":["contextBridge","ipcRenderer","settings","enabled","type","clipId","metadata","videoPath","filename","filePath","options","params","state","channel","callback","listener","_event","data"],"mappings":"yCAmCAA,EAAAA,cAAc,kBAAkB,cAAe,CAE7C,YAAa,IAAMC,EAAAA,YAAY,OAAO,cAAc,EACpD,aAAeC,GAA0BD,EAAAA,YAAY,OAAO,gBAAiBC,CAAQ,EACrF,eAAgB,IAAMD,EAAAA,YAAY,OAAO,iBAAiB,EAC1D,WAAaE,GAAqBF,EAAAA,YAAY,OAAO,sBAAuBE,CAAO,EAGnF,YAAa,IAAMF,EAAAA,YAAY,OAAO,oBAAoB,EAC1D,gBAAkBG,GAA6BH,EAAAA,YAAY,OAAO,mBAAoBG,CAAI,EAG1F,aAAc,IAAMH,EAAAA,YAAY,OAAO,eAAe,EACtD,iBAAkB,CAACI,EAAgBC,IACjCL,EAAAA,YAAY,OAAO,qBAAsBI,EAAQC,CAAQ,EAC3D,gBAAkBD,GAAmBJ,EAAAA,YAAY,OAAO,oBAAqBI,CAAM,EACnF,WAAaA,GAAmBJ,EAAAA,YAAY,OAAO,eAAgBI,CAAM,EACzE,kBAAmB,CAACA,EAAgBE,IAClCN,EAAAA,YAAY,OAAO,0BAA2BI,EAAQE,CAAS,EACjE,sBAAuB,IAAMN,EAAAA,YAAY,OAAO,6BAA6B,EAC7E,iBAAmBM,GAAsBN,EAAAA,YAAY,OAAO,yBAA0BM,CAAS,EAG/F,mBAAoB,CAACF,EAAgBE,IACnCN,EAAAA,YAAY,OAAO,sBAAuBI,EAAQE,CAAS,EAG7D,gBAAkBC,GAAqBP,EAAAA,YAAY,OAAO,mBAAoBO,CAAQ,EAGtF,kBAAoBC,GAAqBR,EAAAA,YAAY,OAAO,qBAAsBQ,CAAQ,EAG1F,qBAAsB,IAAMR,EAAAA,YAAY,OAAO,iBAAiB,EAChE,cAAe,IAAMA,EAAAA,YAAY,OAAO,eAAe,EAGvD,gBAAiB,IAAMA,EAAAA,YAAY,OAAO,mBAAmB,EAG7D,eAAiBS,GACfT,EAAAA,YAAY,OAAO,cAAeS,CAAO,EAG3C,OAAQ,CACN,KAAOA,GAAwCT,EAAAA,YAAY,OAAO,cAAeS,CAAO,EACxF,WAAY,IAAMT,cAAY,OAAO,mBAAmB,CAAA,EAG1D,OAAQ,CACN,WAAaU,GAAyBV,EAAAA,YAAY,OAAO,oBAAqBU,CAAM,EACpF,UAAW,CAACN,EAAgBO,IAAmBX,EAAAA,YAAY,OAAO,mBAAoBI,EAAQO,CAAK,EACnG,UAAYP,GAAmBJ,EAAAA,YAAY,OAAO,mBAAoBI,CAAM,CAAA,EAI9E,iBAAkB,IAAMJ,EAAAA,YAAY,OAAO,mBAAmB,EAG9D,GAAI,CAACY,EAAiBC,IAAsC,CAC1D,MAAMC,EAAW,CAACC,EAA0BC,IAAkBH,EAASG,CAAI,EAC3EhB,OAAAA,cAAY,GAAGY,EAASE,CAAQ,EACzB,IAAM,CACXd,cAAY,eAAeY,EAASE,CAAQ,CAC9C,CACF,CACF,CAAC"}