"use strict";const electron=require("electron"),require$$0$2=require("path"),promises=require("fs/promises"),require$$0$1=require("fs"),require$$2$2=require("util"),require$$2$1=require("events"),require$$0$3=require("child_process"),require$$1=require("os"),require$$2=require("stream");var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var utils$a={exports:{}},windows,hasRequiredWindows;function requireWindows(){if(hasRequiredWindows)return windows;hasRequiredWindows=1,windows=n,n.sync=i;var r=require$$0$1;function e(o,a){var s=a.pathExt!==void 0?a.pathExt:process.env.PATHEXT;if(!s||(s=s.split(";"),s.indexOf("")!==-1))return!0;for(var u=0;u<s.length;u++){var l=s[u].toLowerCase();if(l&&o.substr(-l.length).toLowerCase()===l)return!0}return!1}function t(o,a,s){return!o.isSymbolicLink()&&!o.isFile()?!1:e(a,s)}function n(o,a,s){r.stat(o,function(u,l){s(u,u?!1:t(l,o,a))})}function i(o,a){return t(r.statSync(o),o,a)}return windows}var mode,hasRequiredMode;function requireMode(){if(hasRequiredMode)return mode;hasRequiredMode=1,mode=e,e.sync=t;var r=require$$0$1;function e(o,a,s){r.stat(o,function(u,l){s(u,u?!1:n(l,a))})}function t(o,a){return n(r.statSync(o),a)}function n(o,a){return o.isFile()&&i(o,a)}function i(o,a){var s=o.mode,u=o.uid,l=o.gid,f=a.uid!==void 0?a.uid:process.getuid&&process.getuid(),d=a.gid!==void 0?a.gid:process.getgid&&process.getgid(),c=parseInt("100",8),A=parseInt("010",8),y=parseInt("001",8),w=c|A,S=s&y||s&A&&l===d||s&c&&u===f||s&w&&f===0;return S}return mode}var core;process.platform==="win32"||commonjsGlobal.TESTING_WINDOWS?core=requireWindows():core=requireMode();var isexe_1=isexe$1;isexe$1.sync=sync;function isexe$1(r,e,t){if(typeof e=="function"&&(t=e,e={}),!t){if(typeof Promise!="function")throw new TypeError("callback not provided");return new Promise(function(n,i){isexe$1(r,e||{},function(o,a){o?i(o):n(a)})})}core(r,e||{},function(n,i){n&&(n.code==="EACCES"||e&&e.ignoreErrors)&&(n=null,i=!1),t(n,i)})}function sync(r,e){try{return core.sync(r,e||{})}catch(t){if(e&&e.ignoreErrors||t.code==="EACCES")return!1;throw t}}var which_1=which$1;which$1.sync=whichSync;var isWindows$3=process.platform==="win32"||process.env.OSTYPE==="cygwin"||process.env.OSTYPE==="msys",path$4=require$$0$2,COLON=isWindows$3?";":":",isexe=isexe_1;function getNotFoundError(r){var e=new Error("not found: "+r);return e.code="ENOENT",e}function getPathInfo(r,e){var t=e.colon||COLON,n=e.path||process.env.PATH||"",i=[""];n=n.split(t);var o="";return isWindows$3&&(n.unshift(process.cwd()),o=e.pathExt||process.env.PATHEXT||".EXE;.CMD;.BAT;.COM",i=o.split(t),r.indexOf(".")!==-1&&i[0]!==""&&i.unshift("")),(r.match(/\//)||isWindows$3&&r.match(/\\/))&&(n=[""]),{env:n,ext:i,extExe:o}}function which$1(r,e,t){typeof e=="function"&&(t=e,e={});var n=getPathInfo(r,e),i=n.env,o=n.ext,a=n.extExe,s=[];(function u(l,f){if(l===f)return e.all&&s.length?t(null,s):t(getNotFoundError(r));var d=i[l];d.charAt(0)==='"'&&d.slice(-1)==='"'&&(d=d.slice(1,-1));var c=path$4.join(d,r);!d&&/^\.[\\\/]/.test(r)&&(c=r.slice(0,2)+c),function A(y,w){if(y===w)return u(l+1,f);var S=o[y];isexe(c+S,{pathExt:a},function(F,x){if(!F&&x)if(e.all)s.push(c+S);else return t(null,c+S);return A(y+1,w)})}(0,o.length)})(0,i.length)}function whichSync(r,e){e=e||{};for(var t=getPathInfo(r,e),n=t.env,i=t.ext,o=t.extExe,a=[],s=0,u=n.length;s<u;s++){var l=n[s];l.charAt(0)==='"'&&l.slice(-1)==='"'&&(l=l.slice(1,-1));var f=path$4.join(l,r);!l&&/^\.[\\\/]/.test(r)&&(f=r.slice(0,2)+f);for(var d=0,c=i.length;d<c;d++){var A=f+i[d],y;try{if(y=isexe.sync(A,{pathExt:o}),y)if(e.all)a.push(A);else return A}catch{}}}if(e.all&&a.length)return a;if(e.nothrow)return null;throw getNotFoundError(r)}require$$0$3.exec;var isWindows$2=require$$1.platform().match(/win(32|64)/),which=which_1,nlRegexp=/\r\n|\r|\n/g,streamRegexp=/^\[?(.*?)\]?$/,filterEscapeRegexp=/[,]/,whichCache={};function parseProgressLine(r){var e={};r=r.replace(/=\s+/g,"=").trim();for(var t=r.split(" "),n=0;n<t.length;n++){var i=t[n].split("=",2),o=i[0],a=i[1];if(typeof a>"u")return null;e[o]=a}return e}var utils$9=utils$a.exports={isWindows:isWindows$2,streamRegexp,copy:function(r,e){Object.keys(r).forEach(function(t){e[t]=r[t]})},args:function(){var r=[],e=function(){arguments.length===1&&Array.isArray(arguments[0])?r=r.concat(arguments[0]):r=r.concat([].slice.call(arguments))};return e.clear=function(){r=[]},e.get=function(){return r},e.find=function(t,n){var i=r.indexOf(t);if(i!==-1)return r.slice(i+1,i+1+(n||0))},e.remove=function(t,n){var i=r.indexOf(t);i!==-1&&r.splice(i,(n||0)+1)},e.clone=function(){var t=utils$9.args();return t(r),t},e},makeFilterStrings:function(r){return r.map(function(e){if(typeof e=="string")return e;var t="";return Array.isArray(e.inputs)?t+=e.inputs.map(function(n){return n.replace(streamRegexp,"[$1]")}).join(""):typeof e.inputs=="string"&&(t+=e.inputs.replace(streamRegexp,"[$1]")),t+=e.filter,e.options&&(typeof e.options=="string"||typeof e.options=="number"?t+="="+e.options:Array.isArray(e.options)?t+="="+e.options.map(function(n){return typeof n=="string"&&n.match(filterEscapeRegexp)?"'"+n+"'":n}).join(":"):Object.keys(e.options).length&&(t+="="+Object.keys(e.options).map(function(n){var i=e.options[n];return typeof i=="string"&&i.match(filterEscapeRegexp)&&(i="'"+i+"'"),n+"="+i}).join(":"))),Array.isArray(e.outputs)?t+=e.outputs.map(function(n){return n.replace(streamRegexp,"[$1]")}).join(""):typeof e.outputs=="string"&&(t+=e.outputs.replace(streamRegexp,"[$1]")),t})},which:function(r,e){if(r in whichCache)return e(null,whichCache[r]);which(r,function(t,n){if(t)return e(null,whichCache[r]="");e(null,whichCache[r]=n)})},timemarkToSeconds:function(r){if(typeof r=="number")return r;if(r.indexOf(":")===-1&&r.indexOf(".")>=0)return Number(r);var e=r.split(":"),t=Number(e.pop());return e.length&&(t+=Number(e.pop())*60),e.length&&(t+=Number(e.pop())*3600),t},extractCodecData:function(r,e,t){var n=/Input #[0-9]+, ([^ ]+),/,i=/Duration\: ([^,]+)/,o=/Audio\: (.*)/,a=/Video\: (.*)/;"inputStack"in t||(t.inputStack=[],t.inputIndex=-1,t.inInput=!1);var s=t.inputStack,u=t.inputIndex,l=t.inInput,f,d,c,A;if(f=e.match(n))l=t.inInput=!0,u=t.inputIndex=t.inputIndex+1,s[u]={format:f[1],audio:"",video:"",duration:""};else if(l&&(d=e.match(i)))s[u].duration=d[1];else if(l&&(c=e.match(o)))c=c[1].split(", "),s[u].audio=c[0],s[u].audio_details=c;else if(l&&(A=e.match(a)))A=A[1].split(", "),s[u].video=A[0],s[u].video_details=A;else if(/Output #\d+/.test(e))l=t.inInput=!1;else if(/Stream mapping:|Press (\[q\]|ctrl-c) to stop/.test(e))return r.emit.apply(r,["codecData"].concat(s)),!0;return!1},extractProgress:function(r,e){var t=parseProgressLine(e);if(t){var n={frames:parseInt(t.frame,10),currentFps:parseInt(t.fps,10),currentKbps:t.bitrate?parseFloat(t.bitrate.replace("kbits/s","")):0,targetSize:parseInt(t.size||t.Lsize,10),timemark:t.time};if(r._ffprobeData&&r._ffprobeData.format&&r._ffprobeData.format.duration){var i=Number(r._ffprobeData.format.duration);isNaN(i)||(n.percent=utils$9.timemarkToSeconds(n.timemark)/i*100)}r.emit("progress",n)}},extractError:function(r){return r.split(nlRegexp).reduce(function(e,t){return t.charAt(0)===" "||t.charAt(0)==="["?[]:(e.push(t),e)},[]).join(`
`)},linesRing:function(r){var e=[],t=[],n=null,i=!1,o=r-1;function a(s){e.forEach(function(u){u(s)})}return{callback:function(s){t.forEach(function(u){s(u)}),e.push(s)},append:function(s){if(!i&&(s instanceof Buffer&&(s=""+s),!(!s||s.length===0))){var u=s.split(nlRegexp);u.length===1?n!==null?n=n+u.shift():n=u.shift():(n!==null&&(n=n+u.shift(),a(n),t.push(n)),n=u.pop(),u.forEach(function(l){a(l),t.push(l)}),o>-1&&t.length>o&&t.splice(0,t.length-o))}},get:function(){return n!==null?t.concat([n]).join(`
`):t.join(`
`)},close:function(){i||(n!==null&&(a(n),t.push(n),o>-1&&t.length>o&&t.shift(),n=null),i=!0)}}}},utilsExports=utils$a.exports,inputs,hasRequiredInputs;function requireInputs(){if(hasRequiredInputs)return inputs;hasRequiredInputs=1;var r=utilsExports;return inputs=function(e){e.mergeAdd=e.addInput=e.input=function(t){var n=!1,i=!1;if(typeof t!="string"){if(!("readable"in t)||!t.readable)throw new Error("Invalid input");var o=this._inputs.some(function(s){return s.isStream});if(o)throw new Error("Only one input stream is supported");i=!0,t.pause()}else{var a=t.match(/^([a-z]{2,}):/i);n=!a||a[0]==="file"}return this._inputs.push(this._currentInput={source:t,isFile:n,isStream:i,options:r.args()}),this},e.withInputFormat=e.inputFormat=e.fromFormat=function(t){if(!this._currentInput)throw new Error("No input specified");return this._currentInput.options("-f",t),this},e.withInputFps=e.withInputFPS=e.withFpsInput=e.withFPSInput=e.inputFPS=e.inputFps=e.fpsInput=e.FPSInput=function(t){if(!this._currentInput)throw new Error("No input specified");return this._currentInput.options("-r",t),this},e.nativeFramerate=e.withNativeFramerate=e.native=function(){if(!this._currentInput)throw new Error("No input specified");return this._currentInput.options("-re"),this},e.setStartTime=e.seekInput=function(t){if(!this._currentInput)throw new Error("No input specified");return this._currentInput.options("-ss",t),this},e.loop=function(t){if(!this._currentInput)throw new Error("No input specified");return this._currentInput.options("-loop","1"),typeof t<"u"&&this.duration(t),this}},inputs}var audio,hasRequiredAudio;function requireAudio(){if(hasRequiredAudio)return audio;hasRequiredAudio=1;var r=utilsExports;return audio=function(e){e.withNoAudio=e.noAudio=function(){return this._currentOutput.audio.clear(),this._currentOutput.audioFilters.clear(),this._currentOutput.audio("-an"),this},e.withAudioCodec=e.audioCodec=function(t){return this._currentOutput.audio("-acodec",t),this},e.withAudioBitrate=e.audioBitrate=function(t){return this._currentOutput.audio("-b:a",(""+t).replace(/k?$/,"k")),this},e.withAudioChannels=e.audioChannels=function(t){return this._currentOutput.audio("-ac",t),this},e.withAudioFrequency=e.audioFrequency=function(t){return this._currentOutput.audio("-ar",t),this},e.withAudioQuality=e.audioQuality=function(t){return this._currentOutput.audio("-aq",t),this},e.withAudioFilter=e.withAudioFilters=e.audioFilter=e.audioFilters=function(t){return arguments.length>1&&(t=[].slice.call(arguments)),Array.isArray(t)||(t=[t]),this._currentOutput.audioFilters(r.makeFilterStrings(t)),this}},audio}var video,hasRequiredVideo;function requireVideo(){if(hasRequiredVideo)return video;hasRequiredVideo=1;var r=utilsExports;return video=function(e){e.withNoVideo=e.noVideo=function(){return this._currentOutput.video.clear(),this._currentOutput.videoFilters.clear(),this._currentOutput.video("-vn"),this},e.withVideoCodec=e.videoCodec=function(t){return this._currentOutput.video("-vcodec",t),this},e.withVideoBitrate=e.videoBitrate=function(t,n){return t=(""+t).replace(/k?$/,"k"),this._currentOutput.video("-b:v",t),n&&this._currentOutput.video("-maxrate",t,"-minrate",t,"-bufsize","3M"),this},e.withVideoFilter=e.withVideoFilters=e.videoFilter=e.videoFilters=function(t){return arguments.length>1&&(t=[].slice.call(arguments)),Array.isArray(t)||(t=[t]),this._currentOutput.videoFilters(r.makeFilterStrings(t)),this},e.withOutputFps=e.withOutputFPS=e.withFpsOutput=e.withFPSOutput=e.withFps=e.withFPS=e.outputFPS=e.outputFps=e.fpsOutput=e.FPSOutput=e.fps=e.FPS=function(t){return this._currentOutput.video("-r",t),this},e.takeFrames=e.withFrames=e.frames=function(t){return this._currentOutput.video("-vframes",t),this}},video}var videosize,hasRequiredVideosize;function requireVideosize(){if(hasRequiredVideosize)return videosize;hasRequiredVideosize=1;function r(t,n,i,o){return[{filter:"scale",options:{w:"if(gt(a,"+i+"),"+t+",trunc("+n+"*a/2)*2)",h:"if(lt(a,"+i+"),"+n+",trunc("+t+"/a/2)*2)"}},{filter:"pad",options:{w:t,h:n,x:"if(gt(a,"+i+"),0,("+t+"-iw)/2)",y:"if(lt(a,"+i+"),0,("+n+"-ih)/2)",color:o}}]}function e(t,n,i){var o=t.sizeData=t.sizeData||{};if(o[n]=i,!("size"in o))return[];var a=o.size.match(/([0-9]+)x([0-9]+)/),s=o.size.match(/([0-9]+)x\?/),u=o.size.match(/\?x([0-9]+)/),l=o.size.match(/\b([0-9]{1,3})%/),f,d,c;if(l){var A=Number(l[1])/100;return[{filter:"scale",options:{w:"trunc(iw*"+A+"/2)*2",h:"trunc(ih*"+A+"/2)*2"}}]}else{if(a)return f=Math.round(Number(a[1])/2)*2,d=Math.round(Number(a[2])/2)*2,c=f/d,o.pad?r(f,d,c,o.pad):[{filter:"scale",options:{w:f,h:d}}];if(s||u)return"aspect"in o?(f=s?s[1]:Math.round(Number(u[1])*o.aspect),d=u?u[1]:Math.round(Number(s[1])/o.aspect),f=Math.round(f/2)*2,d=Math.round(d/2)*2,o.pad?r(f,d,o.aspect,o.pad):[{filter:"scale",options:{w:f,h:d}}]):s?[{filter:"scale",options:{w:Math.round(Number(s[1])/2)*2,h:"trunc(ow/a/2)*2"}}]:[{filter:"scale",options:{w:"trunc(oh*a/2)*2",h:Math.round(Number(u[1])/2)*2}}];throw new Error("Invalid size specified: "+o.size)}}return videosize=function(t){t.keepPixelAspect=t.keepDisplayAspect=t.keepDisplayAspectRatio=t.keepDAR=function(){return this.videoFilters([{filter:"scale",options:{w:"if(gt(sar,1),iw*sar,iw)",h:"if(lt(sar,1),ih/sar,ih)"}},{filter:"setsar",options:"1"}])},t.withSize=t.setSize=t.size=function(n){var i=e(this._currentOutput,"size",n);return this._currentOutput.sizeFilters.clear(),this._currentOutput.sizeFilters(i),this},t.withAspect=t.withAspectRatio=t.setAspect=t.setAspectRatio=t.aspect=t.aspectRatio=function(n){var i=Number(n);if(isNaN(i)){var o=n.match(/^(\d+):(\d+)$/);if(o)i=Number(o[1])/Number(o[2]);else throw new Error("Invalid aspect ratio: "+n)}var a=e(this._currentOutput,"aspect",i);return this._currentOutput.sizeFilters.clear(),this._currentOutput.sizeFilters(a),this},t.applyAutopadding=t.applyAutoPadding=t.applyAutopad=t.applyAutoPad=t.withAutopadding=t.withAutoPadding=t.withAutopad=t.withAutoPad=t.autoPad=t.autopad=function(n,i){typeof n=="string"&&(i=n,n=!0),typeof n>"u"&&(n=!0);var o=e(this._currentOutput,"pad",n?i||"black":!1);return this._currentOutput.sizeFilters.clear(),this._currentOutput.sizeFilters(o),this}},videosize}var output,hasRequiredOutput;function requireOutput(){if(hasRequiredOutput)return output;hasRequiredOutput=1;var r=utilsExports;return output=function(e){e.addOutput=e.output=function(t,n){var i=!1;if(!t&&this._currentOutput)throw new Error("Invalid output");if(t&&typeof t!="string"){if(!("writable"in t)||!t.writable)throw new Error("Invalid output")}else if(typeof t=="string"){var o=t.match(/^([a-z]{2,}):/i);i=!o||o[0]==="file"}if(t&&!("target"in this._currentOutput))this._currentOutput.target=t,this._currentOutput.isFile=i,this._currentOutput.pipeopts=n||{};else{if(t&&typeof t!="string"){var a=this._outputs.some(function(u){return typeof u.target!="string"});if(a)throw new Error("Only one output stream is supported")}this._outputs.push(this._currentOutput={target:t,isFile:i,flags:{},pipeopts:n||{}});var s=this;["audio","audioFilters","video","videoFilters","sizeFilters","options"].forEach(function(u){s._currentOutput[u]=r.args()}),t||delete this._currentOutput.target}return this},e.seekOutput=e.seek=function(t){return this._currentOutput.options("-ss",t),this},e.withDuration=e.setDuration=e.duration=function(t){return this._currentOutput.options("-t",t),this},e.toFormat=e.withOutputFormat=e.outputFormat=e.format=function(t){return this._currentOutput.options("-f",t),this},e.map=function(t){return this._currentOutput.options("-map",t.replace(r.streamRegexp,"[$1]")),this},e.updateFlvMetadata=e.flvmeta=function(){return this._currentOutput.flags.flvmeta=!0,this}},output}var custom,hasRequiredCustom;function requireCustom(){if(hasRequiredCustom)return custom;hasRequiredCustom=1;var r=utilsExports;return custom=function(e){e.addInputOption=e.addInputOptions=e.withInputOption=e.withInputOptions=e.inputOption=e.inputOptions=function(t){if(!this._currentInput)throw new Error("No input specified");var n=!0;return arguments.length>1&&(t=[].slice.call(arguments),n=!1),Array.isArray(t)||(t=[t]),this._currentInput.options(t.reduce(function(i,o){var a=String(o).split(" ");return n&&a.length===2?i.push(a[0],a[1]):i.push(o),i},[])),this},e.addOutputOption=e.addOutputOptions=e.addOption=e.addOptions=e.withOutputOption=e.withOutputOptions=e.withOption=e.withOptions=e.outputOption=e.outputOptions=function(t){var n=!0;return arguments.length>1&&(t=[].slice.call(arguments),n=!1),Array.isArray(t)||(t=[t]),this._currentOutput.options(t.reduce(function(i,o){var a=String(o).split(" ");return n&&a.length===2?i.push(a[0],a[1]):i.push(o),i},[])),this},e.filterGraph=e.complexFilter=function(t,n){if(this._complexFilters.clear(),Array.isArray(t)||(t=[t]),this._complexFilters("-filter_complex",r.makeFilterStrings(t).join(";")),Array.isArray(n)){var i=this;n.forEach(function(o){i._complexFilters("-map",o.replace(r.streamRegexp,"[$1]"))})}else typeof n=="string"&&this._complexFilters("-map",n.replace(r.streamRegexp,"[$1]"));return this}},custom}function commonjsRequire(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var misc,hasRequiredMisc;function requireMisc(){if(hasRequiredMisc)return misc;hasRequiredMisc=1;var r=require$$0$2;return misc=function(e){e.usingPreset=e.preset=function(t){if(typeof t=="function")t(this);else try{var n=r.join(this.options.presets,t),i=commonjsRequire(n);if(typeof i.load=="function")i.load(this);else throw new Error("preset "+n+" has no load() function")}catch(o){throw new Error("preset "+n+" could not be loaded: "+o.message)}return this}},misc}var async={exports:{}},hasRequiredAsync;function requireAsync(){return hasRequiredAsync||(hasRequiredAsync=1,function(r){(function(){var e={},t,n;t=this,t!=null&&(n=t.async),e.noConflict=function(){return t.async=n,e};function i(m){var g=!1;return function(){if(g)throw new Error("Callback was already called.");g=!0,m.apply(t,arguments)}}var o=function(m,g){if(m.forEach)return m.forEach(g);for(var p=0;p<m.length;p+=1)g(m[p],p,m)},a=function(m,g){if(m.map)return m.map(g);var p=[];return o(m,function(E,v,h){p.push(g(E,v,h))}),p},s=function(m,g,p){return m.reduce?m.reduce(g,p):(o(m,function(E,v,h){p=g(p,E,v,h)}),p)},u=function(m){if(Object.keys)return Object.keys(m);var g=[];for(var p in m)m.hasOwnProperty(p)&&g.push(p);return g};typeof process>"u"||!process.nextTick?typeof setImmediate=="function"?(e.nextTick=function(m){setImmediate(m)},e.setImmediate=e.nextTick):(e.nextTick=function(m){setTimeout(m,0)},e.setImmediate=e.nextTick):(e.nextTick=process.nextTick,typeof setImmediate<"u"?e.setImmediate=function(m){setImmediate(m)}:e.setImmediate=e.nextTick),e.each=function(m,g,p){if(p=p||function(){},!m.length)return p();var E=0;o(m,function(v){g(v,i(function(h){h?(p(h),p=function(){}):(E+=1,E>=m.length&&p(null))}))})},e.forEach=e.each,e.eachSeries=function(m,g,p){if(p=p||function(){},!m.length)return p();var E=0,v=function(){g(m[E],function(h){h?(p(h),p=function(){}):(E+=1,E>=m.length?p(null):v())})};v()},e.forEachSeries=e.eachSeries,e.eachLimit=function(m,g,p,E){var v=l(g);v.apply(null,[m,p,E])},e.forEachLimit=e.eachLimit;var l=function(m){return function(g,p,E){if(E=E||function(){},!g.length||m<=0)return E();var v=0,h=0,T=0;(function O(){if(v>=g.length)return E();for(;T<m&&h<g.length;)h+=1,T+=1,p(g[h-1],function(N){N?(E(N),E=function(){}):(v+=1,T-=1,v>=g.length?E():O())})})()}},f=function(m){return function(){var g=Array.prototype.slice.call(arguments);return m.apply(null,[e.each].concat(g))}},d=function(m,g){return function(){var p=Array.prototype.slice.call(arguments);return g.apply(null,[l(m)].concat(p))}},c=function(m){return function(){var g=Array.prototype.slice.call(arguments);return m.apply(null,[e.eachSeries].concat(g))}},A=function(m,g,p,E){var v=[];g=a(g,function(h,T){return{index:T,value:h}}),m(g,function(h,T){p(h.value,function(O,N){v[h.index]=N,T(O)})},function(h){E(h,v)})};e.map=f(A),e.mapSeries=c(A),e.mapLimit=function(m,g,p,E){return y(g)(m,p,E)};var y=function(m){return d(m,A)};e.reduce=function(m,g,p,E){e.eachSeries(m,function(v,h){p(g,v,function(T,O){g=O,h(T)})},function(v){E(v,g)})},e.inject=e.reduce,e.foldl=e.reduce,e.reduceRight=function(m,g,p,E){var v=a(m,function(h){return h}).reverse();e.reduce(v,g,p,E)},e.foldr=e.reduceRight;var w=function(m,g,p,E){var v=[];g=a(g,function(h,T){return{index:T,value:h}}),m(g,function(h,T){p(h.value,function(O){O&&v.push(h),T()})},function(h){E(a(v.sort(function(T,O){return T.index-O.index}),function(T){return T.value}))})};e.filter=f(w),e.filterSeries=c(w),e.select=e.filter,e.selectSeries=e.filterSeries;var S=function(m,g,p,E){var v=[];g=a(g,function(h,T){return{index:T,value:h}}),m(g,function(h,T){p(h.value,function(O){O||v.push(h),T()})},function(h){E(a(v.sort(function(T,O){return T.index-O.index}),function(T){return T.value}))})};e.reject=f(S),e.rejectSeries=c(S);var F=function(m,g,p,E){m(g,function(v,h){p(v,function(T){T?(E(v),E=function(){}):h()})},function(v){E()})};e.detect=f(F),e.detectSeries=c(F),e.some=function(m,g,p){e.each(m,function(E,v){g(E,function(h){h&&(p(!0),p=function(){}),v()})},function(E){p(!1)})},e.any=e.some,e.every=function(m,g,p){e.each(m,function(E,v){g(E,function(h){h||(p(!1),p=function(){}),v()})},function(E){p(!0)})},e.all=e.every,e.sortBy=function(m,g,p){e.map(m,function(E,v){g(E,function(h,T){h?v(h):v(null,{value:E,criteria:T})})},function(E,v){if(E)return p(E);var h=function(T,O){var N=T.criteria,R=O.criteria;return N<R?-1:N>R?1:0};p(null,a(v.sort(h),function(T){return T.value}))})},e.auto=function(m,g){g=g||function(){};var p=u(m);if(!p.length)return g(null);var E={},v=[],h=function(N){v.unshift(N)},T=function(N){for(var R=0;R<v.length;R+=1)if(v[R]===N){v.splice(R,1);return}},O=function(){o(v.slice(0),function(N){N()})};h(function(){u(E).length===p.length&&(g(null,E),g=function(){})}),o(p,function(N){var R=m[N]instanceof Function?[m[N]]:m[N],C=function(G){var q=Array.prototype.slice.call(arguments,1);if(q.length<=1&&(q=q[0]),G){var j={};o(u(E),function(K){j[K]=E[K]}),j[N]=q,g(G,j),g=function(){}}else E[N]=q,e.setImmediate(O)},V=R.slice(0,Math.abs(R.length-1))||[],k=function(){return s(V,function(G,q){return G&&E.hasOwnProperty(q)},!0)&&!E.hasOwnProperty(N)};if(k())R[R.length-1](C,E);else{var z=function(){k()&&(T(z),R[R.length-1](C,E))};h(z)}})},e.waterfall=function(m,g){if(g=g||function(){},m.constructor!==Array){var p=new Error("First argument to waterfall must be an array of functions");return g(p)}if(!m.length)return g();var E=function(v){return function(h){if(h)g.apply(null,arguments),g=function(){};else{var T=Array.prototype.slice.call(arguments,1),O=v.next();O?T.push(E(O)):T.push(g),e.setImmediate(function(){v.apply(null,T)})}}};E(e.iterator(m))()};var x=function(m,g,p){if(p=p||function(){},g.constructor===Array)m.map(g,function(v,h){v&&v(function(T){var O=Array.prototype.slice.call(arguments,1);O.length<=1&&(O=O[0]),h.call(null,T,O)})},p);else{var E={};m.each(u(g),function(v,h){g[v](function(T){var O=Array.prototype.slice.call(arguments,1);O.length<=1&&(O=O[0]),E[v]=O,h(T)})},function(v){p(v,E)})}};e.parallel=function(m,g){x({map:e.map,each:e.each},m,g)},e.parallelLimit=function(m,g,p){x({map:y(g),each:l(g)},m,p)},e.series=function(m,g){if(g=g||function(){},m.constructor===Array)e.mapSeries(m,function(E,v){E&&E(function(h){var T=Array.prototype.slice.call(arguments,1);T.length<=1&&(T=T[0]),v.call(null,h,T)})},g);else{var p={};e.eachSeries(u(m),function(E,v){m[E](function(h){var T=Array.prototype.slice.call(arguments,1);T.length<=1&&(T=T[0]),p[E]=T,v(h)})},function(E){g(E,p)})}},e.iterator=function(m){var g=function(p){var E=function(){return m.length&&m[p].apply(null,arguments),E.next()};return E.next=function(){return p<m.length-1?g(p+1):null},E};return g(0)},e.apply=function(m){var g=Array.prototype.slice.call(arguments,1);return function(){return m.apply(null,g.concat(Array.prototype.slice.call(arguments)))}};var P=function(m,g,p,E){var v=[];m(g,function(h,T){p(h,function(O,N){v=v.concat(N||[]),T(O)})},function(h){E(h,v)})};e.concat=f(P),e.concatSeries=c(P),e.whilst=function(m,g,p){m()?g(function(E){if(E)return p(E);e.whilst(m,g,p)}):p()},e.doWhilst=function(m,g,p){m(function(E){if(E)return p(E);g()?e.doWhilst(m,g,p):p()})},e.until=function(m,g,p){m()?p():g(function(E){if(E)return p(E);e.until(m,g,p)})},e.doUntil=function(m,g,p){m(function(E){if(E)return p(E);g()?p():e.doUntil(m,g,p)})},e.queue=function(m,g){g===void 0&&(g=1);function p(h,T,O,N){T.constructor!==Array&&(T=[T]),o(T,function(R){var C={data:R,callback:typeof N=="function"?N:null};O?h.tasks.unshift(C):h.tasks.push(C),h.saturated&&h.tasks.length===g&&h.saturated(),e.setImmediate(h.process)})}var E=0,v={tasks:[],concurrency:g,saturated:null,empty:null,drain:null,push:function(h,T){p(v,h,!1,T)},unshift:function(h,T){p(v,h,!0,T)},process:function(){if(E<v.concurrency&&v.tasks.length){var h=v.tasks.shift();v.empty&&v.tasks.length===0&&v.empty(),E+=1;var T=function(){E-=1,h.callback&&h.callback.apply(h,arguments),v.drain&&v.tasks.length+E===0&&v.drain(),v.process()},O=i(T);m(h.data,O)}},length:function(){return v.tasks.length},running:function(){return E}};return v},e.cargo=function(m,g){var p=!1,E=[],v={tasks:E,payload:g,saturated:null,empty:null,drain:null,push:function(h,T){h.constructor!==Array&&(h=[h]),o(h,function(O){E.push({data:O,callback:typeof T=="function"?T:null}),v.saturated&&E.length===g&&v.saturated()}),e.setImmediate(v.process)},process:function h(){if(!p){if(E.length===0){v.drain&&v.drain();return}var T=typeof g=="number"?E.splice(0,g):E.splice(0),O=a(T,function(N){return N.data});v.empty&&v.empty(),p=!0,m(O,function(){p=!1;var N=arguments;o(T,function(R){R.callback&&R.callback.apply(null,N)}),h()})}},length:function(){return E.length},running:function(){return p}};return v};var b=function(m){return function(g){var p=Array.prototype.slice.call(arguments,1);g.apply(null,p.concat([function(E){var v=Array.prototype.slice.call(arguments,1);typeof console<"u"&&(E?console.error&&console.error(E):console[m]&&o(v,function(h){console[m](h)}))}]))}};e.log=b("log"),e.dir=b("dir"),e.memoize=function(m,g){var p={},E={};g=g||function(h){return h};var v=function(){var h=Array.prototype.slice.call(arguments),T=h.pop(),O=g.apply(null,h);O in p?T.apply(null,p[O]):O in E?E[O].push(T):(E[O]=[T],m.apply(null,h.concat([function(){p[O]=arguments;var N=E[O];delete E[O];for(var R=0,C=N.length;R<C;R++)N[R].apply(null,arguments)}])))};return v.memo=p,v.unmemoized=m,v},e.unmemoize=function(m){return function(){return(m.unmemoized||m).apply(null,arguments)}},e.times=function(m,g,p){for(var E=[],v=0;v<m;v++)E.push(v);return e.map(E,g,p)},e.timesSeries=function(m,g,p){for(var E=[],v=0;v<m;v++)E.push(v);return e.mapSeries(E,g,p)},e.compose=function(){var m=Array.prototype.reverse.call(arguments);return function(){var g=this,p=Array.prototype.slice.call(arguments),E=p.pop();e.reduce(m,p,function(v,h,T){h.apply(g,v.concat([function(){var O=arguments[0],N=Array.prototype.slice.call(arguments,1);T(O,N)}]))},function(v,h){E.apply(g,[v].concat(h))})}};var $=function(m,g){var p=function(){var v=this,h=Array.prototype.slice.call(arguments),T=h.pop();return m(g,function(O,N){O.apply(v,h.concat([N]))},T)};if(arguments.length>2){var E=Array.prototype.slice.call(arguments,2);return p.apply(this,E)}else return p};e.applyEach=f($),e.applyEachSeries=c($),e.forever=function(m,g){function p(E){if(E){if(g)return g(E);throw E}m(p)}p()},r.exports?r.exports=e:t.async=e})()}(async)),async.exports}var processor,hasRequiredProcessor;function requireProcessor(){if(hasRequiredProcessor)return processor;hasRequiredProcessor=1;var r=require$$0$3.spawn,e=requireAsync(),t=utilsExports;function n(i){i._inputs[0].isStream||i.ffprobe(0,function(a,s){i._ffprobeData=s})}return processor=function(i){i._spawnFfmpeg=function(o,a,s,u){typeof a=="function"&&(u=s,s=a,a={}),typeof u>"u"&&(u=s,s=function(){});var l="stdoutLines"in a?a.stdoutLines:this.options.stdoutLines;this._getFfmpegPath(function(f,d){if(f)return u(f);if(!d||d.length===0)return u(new Error("Cannot find ffmpeg"));a.niceness&&a.niceness!==0&&!t.isWindows&&(o.unshift("-n",a.niceness,d),d="nice");var c=t.linesRing(l),A=!1,y=t.linesRing(l),w=!1,S=r(d,o,a);S.stderr&&S.stderr.setEncoding("utf8"),S.on("error",function(b){u(b)});var F=null;function x(b){b&&(F=b),P&&(A||!a.captureStdout)&&w&&u(F,c,y)}var P=!1;S.on("exit",function(b,$){P=!0,$?x(new Error("ffmpeg was killed with signal "+$)):b?x(new Error("ffmpeg exited with code "+b)):x()}),a.captureStdout&&(S.stdout.on("data",function(b){c.append(b)}),S.stdout.on("close",function(){c.close(),A=!0,x()})),S.stderr.on("data",function(b){y.append(b)}),S.stderr.on("close",function(){y.close(),w=!0,x()}),s(S,c,y)})},i._getArguments=function(){var o=this._complexFilters.get(),a=this._outputs.some(function(s){return s.isFile});return[].concat(this._inputs.reduce(function(s,u){var l=typeof u.source=="string"?u.source:"pipe:0";return s.concat(u.options.get(),["-i",l])},[]),this._global.get(),a?["-y"]:[],o,this._outputs.reduce(function(s,u){var l=t.makeFilterStrings(u.sizeFilters.get()),f=u.audioFilters.get(),d=u.videoFilters.get().concat(l),c;return u.target?typeof u.target=="string"?c=[u.target]:c=["pipe:1"]:c=[],s.concat(u.audio.get(),f.length?["-filter:a",f.join(",")]:[],u.video.get(),d.length?["-filter:v",d.join(",")]:[],u.options.get(),c)},[]))},i._prepare=function(o,a){var s=this;e.waterfall([function(u){s._checkCapabilities(u)},function(u){if(!a)return u();s.ffprobe(0,function(l,f){l||(s._ffprobeData=f),u()})},function(u){var l=s._outputs.some(function(f){return f.flags.flvmeta&&!f.isFile&&(s.logger.warn("Updating flv metadata is only supported for files"),f.flags.flvmeta=!1),f.flags.flvmeta});l?s._getFlvtoolPath(function(f){u(f)}):u()},function(u){var l;try{l=s._getArguments()}catch(f){return u(f)}u(null,l)},function(u,l){s.availableEncoders(function(f,d){for(var c=0;c<u.length;c++)(u[c]==="-acodec"||u[c]==="-vcodec")&&(c++,u[c]in d&&d[u[c]].experimental&&(u.splice(c+1,0,"-strict","experimental"),c+=2));l(null,u)})}],o),a||(this.listeners("progress").length>0?n(this):this.once("newListener",function(u){u==="progress"&&n(this)}))},i.exec=i.execute=i.run=function(){var o=this,a=this._outputs.some(function(d){return"target"in d});if(!a)throw new Error("No output specified");var s=this._outputs.filter(function(d){return typeof d.target!="string"})[0],u=this._inputs.filter(function(d){return typeof d.source!="string"})[0],l=!1;function f(d,c,A){l||(l=!0,d?o.emit("error",d,c,A):o.emit("end",c,A))}return o._prepare(function(d,c){if(d)return f(d);o._spawnFfmpeg(c,{captureStdout:!s,niceness:o.options.niceness,cwd:o.options.cwd,windowsHide:!0},function(y,w,S){if(o.ffmpegProc=y,o.emit("start","ffmpeg "+c.join(" ")),u&&(u.source.on("error",function(P){var b=new Error("Input stream error: "+P.message);b.inputStreamError=P,f(b),y.kill()}),u.source.resume(),u.source.pipe(y.stdin),y.stdin.on("error",function(){})),o.options.timeout&&(o.processTimer=setTimeout(function(){var P="process ran into a timeout ("+o.options.timeout+"s)";f(new Error(P),w.get(),S.get()),y.kill()},o.options.timeout*1e3)),s&&(y.stdout.pipe(s.target,s.pipeopts),s.target.on("close",function(){o.logger.debug("Output stream closed, scheduling kill for ffmpeg process"),setTimeout(function(){f(new Error("Output stream closed")),y.kill()},20)}),s.target.on("error",function(P){o.logger.debug("Output stream error, killing ffmpeg process");var b=new Error("Output stream error: "+P.message);b.outputStreamError=P,f(b,w.get(),S.get()),y.kill("SIGKILL")})),S){if(o.listeners("stderr").length&&S.callback(function(P){o.emit("stderr",P)}),o.listeners("codecData").length){var F=!1,x={};S.callback(function(P){F||(F=t.extractCodecData(o,P,x))})}o.listeners("progress").length&&S.callback(function(P){t.extractProgress(o,P)})}},function(y,w,S){if(clearTimeout(o.processTimer),delete o.ffmpegProc,y)y.message.match(/ffmpeg exited with code/)&&(y.message+=": "+t.extractError(S.get())),f(y,w.get(),S.get());else{var F=o._outputs.filter(function(x){return x.flags.flvmeta});F.length?o._getFlvtoolPath(function(x,P){if(x)return f(x);e.each(F,function(b,$){r(P,["-U",b.target],{windowsHide:!0}).on("error",function(m){$(new Error("Error running "+P+" on "+b.target+": "+m.message))}).on("exit",function(m,g){m!==0||g?$(new Error(P+" "+(g?"received signal "+g:"exited with code "+m))+" when running on "+b.target):$()})},function(b){b?f(b):f(null,w.get(),S.get())})}):f(null,w.get(),S.get())}})}),this},i.renice=function(o){if(!t.isWindows&&(o=o||0,(o<-20||o>20)&&this.logger.warn("Invalid niceness value: "+o+", must be between -20 and 20"),o=Math.min(20,Math.max(-20,o)),this.options.niceness=o,this.ffmpegProc)){var a=this.logger,s=this.ffmpegProc.pid,u=r("renice",[o,"-p",s],{windowsHide:!0});u.on("error",function(l){a.warn("could not renice process "+s+": "+l.message)}),u.on("exit",function(l,f){f?a.warn("could not renice process "+s+": renice was killed by signal "+f):l?a.warn("could not renice process "+s+": renice exited with "+l):a.info("successfully reniced process "+s+" to "+o+" niceness")})}return this},i.kill=function(o){return this.ffmpegProc?this.ffmpegProc.kill(o||"SIGKILL"):this.logger.warn("No running ffmpeg process, cannot send signal"),this}},processor}var capabilities,hasRequiredCapabilities;function requireCapabilities(){if(hasRequiredCapabilities)return capabilities;hasRequiredCapabilities=1;var r=require$$0$1,e=require$$0$2,t=requireAsync(),n=utilsExports,i=/^\s*([D ])([E ])([VAS])([S ])([D ])([T ]) ([^ ]+) +(.*)$/,o=/^\s*([D\.])([E\.])([VAS])([I\.])([L\.])([S\.]) ([^ ]+) +(.*)$/,a=/\(encoders:([^\)]+)\)/,s=/\(decoders:([^\)]+)\)/,u=/^\s*([VAS\.])([F\.])([S\.])([X\.])([B\.])([D\.]) ([^ ]+) +(.*)$/,l=/^\s*([D ])([E ])\s+([^ ]+)\s+(.*)$/,f=/\r\n|\r|\n/,d=/^(?: [T\.][S\.][C\.] )?([^ ]+) +(AA?|VV?|\|)->(AA?|VV?|\|) +(.*)$/,c={};return capabilities=function(A){A.setFfmpegPath=function(y){return c.ffmpegPath=y,this},A.setFfprobePath=function(y){return c.ffprobePath=y,this},A.setFlvtoolPath=function(y){return c.flvtoolPath=y,this},A._forgetPaths=function(){delete c.ffmpegPath,delete c.ffprobePath,delete c.flvtoolPath},A._getFfmpegPath=function(y){if("ffmpegPath"in c)return y(null,c.ffmpegPath);t.waterfall([function(w){process.env.FFMPEG_PATH?r.exists(process.env.FFMPEG_PATH,function(S){S?w(null,process.env.FFMPEG_PATH):w(null,"")}):w(null,"")},function(w,S){if(w.length)return S(null,w);n.which("ffmpeg",function(F,x){S(F,x)})}],function(w,S){w?y(w):y(null,c.ffmpegPath=S||"")})},A._getFfprobePath=function(y){var w=this;if("ffprobePath"in c)return y(null,c.ffprobePath);t.waterfall([function(S){process.env.FFPROBE_PATH?r.exists(process.env.FFPROBE_PATH,function(F){S(null,F?process.env.FFPROBE_PATH:"")}):S(null,"")},function(S,F){if(S.length)return F(null,S);n.which("ffprobe",function(x,P){F(x,P)})},function(S,F){if(S.length)return F(null,S);w._getFfmpegPath(function(x,P){if(x)F(x);else if(P.length){var b=n.isWindows?"ffprobe.exe":"ffprobe",$=e.join(e.dirname(P),b);r.exists($,function(m){F(null,m?$:"")})}else F(null,"")})}],function(S,F){S?y(S):y(null,c.ffprobePath=F||"")})},A._getFlvtoolPath=function(y){if("flvtoolPath"in c)return y(null,c.flvtoolPath);t.waterfall([function(w){process.env.FLVMETA_PATH?r.exists(process.env.FLVMETA_PATH,function(S){w(null,S?process.env.FLVMETA_PATH:"")}):w(null,"")},function(w,S){if(w.length)return S(null,w);process.env.FLVTOOL2_PATH?r.exists(process.env.FLVTOOL2_PATH,function(F){S(null,F?process.env.FLVTOOL2_PATH:"")}):S(null,"")},function(w,S){if(w.length)return S(null,w);n.which("flvmeta",function(F,x){S(F,x)})},function(w,S){if(w.length)return S(null,w);n.which("flvtool2",function(F,x){S(F,x)})}],function(w,S){w?y(w):y(null,c.flvtoolPath=S||"")})},A.availableFilters=A.getAvailableFilters=function(y){if("filters"in c)return y(null,c.filters);this._spawnFfmpeg(["-filters"],{captureStdout:!0,stdoutLines:0},function(w,S){if(w)return y(w);var F=S.get(),x=F.split(`
`),P={},b={A:"audio",V:"video","|":"none"};x.forEach(function($){var m=$.match(d);m&&(P[m[1]]={description:m[4],input:b[m[2].charAt(0)],multipleInputs:m[2].length>1,output:b[m[3].charAt(0)],multipleOutputs:m[3].length>1})}),y(null,c.filters=P)})},A.availableCodecs=A.getAvailableCodecs=function(y){if("codecs"in c)return y(null,c.codecs);this._spawnFfmpeg(["-codecs"],{captureStdout:!0,stdoutLines:0},function(w,S){if(w)return y(w);var F=S.get(),x=F.split(f),P={};x.forEach(function(b){var $=b.match(i);if($&&$[7]!=="="&&(P[$[7]]={type:{V:"video",A:"audio",S:"subtitle"}[$[3]],description:$[8],canDecode:$[1]==="D",canEncode:$[2]==="E",drawHorizBand:$[4]==="S",directRendering:$[5]==="D",weirdFrameTruncation:$[6]==="T"}),$=b.match(o),$&&$[7]!=="="){var m=P[$[7]]={type:{V:"video",A:"audio",S:"subtitle"}[$[3]],description:$[8],canDecode:$[1]==="D",canEncode:$[2]==="E",intraFrameOnly:$[4]==="I",isLossy:$[5]==="L",isLossless:$[6]==="S"},g=m.description.match(a);g=g?g[1].trim().split(" "):[];var p=m.description.match(s);if(p=p?p[1].trim().split(" "):[],g.length||p.length){var E={};n.copy(m,E),delete E.canEncode,delete E.canDecode,g.forEach(function(v){P[v]={},n.copy(E,P[v]),P[v].canEncode=!0}),p.forEach(function(v){v in P||(P[v]={},n.copy(E,P[v])),P[v].canDecode=!0})}}}),y(null,c.codecs=P)})},A.availableEncoders=A.getAvailableEncoders=function(y){if("encoders"in c)return y(null,c.encoders);this._spawnFfmpeg(["-encoders"],{captureStdout:!0,stdoutLines:0},function(w,S){if(w)return y(w);var F=S.get(),x=F.split(f),P={};x.forEach(function(b){var $=b.match(u);$&&$[7]!=="="&&(P[$[7]]={type:{V:"video",A:"audio",S:"subtitle"}[$[1]],description:$[8],frameMT:$[2]==="F",sliceMT:$[3]==="S",experimental:$[4]==="X",drawHorizBand:$[5]==="B",directRendering:$[6]==="D"})}),y(null,c.encoders=P)})},A.availableFormats=A.getAvailableFormats=function(y){if("formats"in c)return y(null,c.formats);this._spawnFfmpeg(["-formats"],{captureStdout:!0,stdoutLines:0},function(w,S){if(w)return y(w);var F=S.get(),x=F.split(f),P={};x.forEach(function(b){var $=b.match(l);$&&$[3].split(",").forEach(function(m){m in P||(P[m]={description:$[4],canDemux:!1,canMux:!1}),$[1]==="D"&&(P[m].canDemux=!0),$[2]==="E"&&(P[m].canMux=!0)})}),y(null,c.formats=P)})},A._checkCapabilities=function(y){var w=this;t.waterfall([function(S){w.availableFormats(S)},function(S,F){var x;if(x=w._outputs.reduce(function(P,b){var $=b.options.find("-f",1);return $&&(!($[0]in S)||!S[$[0]].canMux)&&P.push($),P},[]),x.length===1)return F(new Error("Output format "+x[0]+" is not available"));if(x.length>1)return F(new Error("Output formats "+x.join(", ")+" are not available"));if(x=w._inputs.reduce(function(P,b){var $=b.options.find("-f",1);return $&&(!($[0]in S)||!S[$[0]].canDemux)&&P.push($[0]),P},[]),x.length===1)return F(new Error("Input format "+x[0]+" is not available"));if(x.length>1)return F(new Error("Input formats "+x.join(", ")+" are not available"));F()},function(S){w.availableEncoders(S)},function(S,F){var x;if(x=w._outputs.reduce(function(P,b){var $=b.audio.find("-acodec",1);return $&&$[0]!=="copy"&&(!($[0]in S)||S[$[0]].type!=="audio")&&P.push($[0]),P},[]),x.length===1)return F(new Error("Audio codec "+x[0]+" is not available"));if(x.length>1)return F(new Error("Audio codecs "+x.join(", ")+" are not available"));if(x=w._outputs.reduce(function(P,b){var $=b.video.find("-vcodec",1);return $&&$[0]!=="copy"&&(!($[0]in S)||S[$[0]].type!=="video")&&P.push($[0]),P},[]),x.length===1)return F(new Error("Video codec "+x[0]+" is not available"));if(x.length>1)return F(new Error("Video codecs "+x.join(", ")+" are not available"));F()}],y)}},capabilities}var ffprobe,hasRequiredFfprobe;function requireFfprobe(){if(hasRequiredFfprobe)return ffprobe;hasRequiredFfprobe=1;var r=require$$0$3.spawn;function e(i){return i.match(/^TAG:/)}function t(i){return i.match(/^DISPOSITION:/)}function n(i){var o=i.split(/\r\n|\r|\n/);o=o.filter(function(d){return d.length>0});var a={streams:[],format:{},chapters:[]};function s(d){for(var c={},A=o.shift();typeof A<"u";){if(A.toLowerCase()=="[/"+d+"]")return c;if(A.match(/^\[/)){A=o.shift();continue}var y=A.match(/^([^=]+)=(.*)$/);y&&(!y[1].match(/^TAG:/)&&y[2].match(/^[0-9]+(\.[0-9]+)?$/)?c[y[1]]=Number(y[2]):c[y[1]]=y[2]),A=o.shift()}return c}for(var u=o.shift();typeof u<"u";){if(u.match(/^\[stream/i)){var l=s("stream");a.streams.push(l)}else if(u.match(/^\[chapter/i)){var f=s("chapter");a.chapters.push(f)}else u.toLowerCase()==="[format]"&&(a.format=s("format"));u=o.shift()}return a}return ffprobe=function(i){i.ffprobe=function(){var o,a=null,s=[],u,u=arguments[arguments.length-1],l=!1;function f(d,c){l||(l=!0,u(d,c))}switch(arguments.length){case 3:a=arguments[0],s=arguments[1];break;case 2:typeof arguments[0]=="number"?a=arguments[0]:Array.isArray(arguments[0])&&(s=arguments[0]);break}if(a===null){if(!this._currentInput)return f(new Error("No input specified"));o=this._currentInput}else if(o=this._inputs[a],!o)return f(new Error("Invalid input index"));this._getFfprobePath(function(d,c){if(d)return f(d);if(!c)return f(new Error("Cannot find ffprobe"));var A="",y=!1,w="",S=!1,F=o.isStream?"pipe:0":o.source,x=r(c,["-show_streams","-show_format"].concat(s,F),{windowsHide:!0});o.isStream&&(x.stdin.on("error",function(m){["ECONNRESET","EPIPE","EOF"].indexOf(m.code)>=0||f(m)}),x.stdin.on("close",function(){o.source.pause(),o.source.unpipe(x.stdin)}),o.source.pipe(x.stdin)),x.on("error",u);var P=null;function b(m){if(m&&(P=m),$&&y&&S){if(P)return w&&(P.message+=`
`+w),f(P);var g=n(A);[g.format].concat(g.streams).forEach(function(p){if(p){var E=Object.keys(p).filter(e);E.length&&(p.tags=p.tags||{},E.forEach(function(h){p.tags[h.substr(4)]=p[h],delete p[h]}));var v=Object.keys(p).filter(t);v.length&&(p.disposition=p.disposition||{},v.forEach(function(h){p.disposition[h.substr(12)]=p[h],delete p[h]}))}}),f(null,g)}}var $=!1;x.on("exit",function(m,g){$=!0,m?b(new Error("ffprobe exited with code "+m)):g?b(new Error("ffprobe was killed with signal "+g)):b()}),x.stdout.on("data",function(m){A+=m}),x.stdout.on("close",function(){y=!0,b()}),x.stderr.on("data",function(m){w+=m}),x.stderr.on("close",function(){S=!0,b()})})}},ffprobe}var recipes,hasRequiredRecipes;function requireRecipes(){if(hasRequiredRecipes)return recipes;hasRequiredRecipes=1;var r=require$$0$1,e=require$$0$2,t=require$$2.PassThrough,n=requireAsync(),i=utilsExports;return recipes=function(a){a.saveToFile=a.save=function(s){return this.output(s).run(),this},a.writeToStream=a.pipe=a.stream=function(s,u){if(s&&!("writable"in s)&&(u=s,s=void 0),!s){if(process.version.match(/v0\.8\./))throw new Error("PassThrough stream is not supported on node v0.8");s=new t}return this.output(s,u).run(),s},a.takeScreenshots=a.thumbnail=a.thumbnails=a.screenshot=a.screenshots=function(s,u){var l=this,f=this._currentInput.source;if(s=s||{count:1},typeof s=="number"&&(s={count:s}),"folder"in s||(s.folder=u||"."),"timestamps"in s&&(s.timemarks=s.timestamps),!("timemarks"in s)){if(!s.count)throw new Error("Cannot take screenshots: neither a count nor a timemark list are specified");var d=100/(1+s.count);s.timemarks=[];for(var c=0;c<s.count;c++)s.timemarks.push(d*(c+1)+"%")}if("size"in s){var A=s.size.match(/^(\d+)x(\d+)$/),y=s.size.match(/^(\d+)x\?$/),w=s.size.match(/^\?x(\d+)$/),S=s.size.match(/^(\d+)%$/);if(!A&&!y&&!w&&!S)throw new Error("Invalid size parameter: "+s.size)}var F;function x(P){F?P(null,F):l.ffprobe(function(b,$){F=$,P(b,$)})}return n.waterfall([function(b){if(s.timemarks.some(function($){return(""+$).match(/^[\d.]+%$/)})){if(typeof f!="string")return b(new Error("Cannot compute screenshot timemarks with an input stream, please specify fixed timemarks"));x(function($,m){if($)b($);else{var g=m.streams.reduce(function(E,v){return v.codec_type==="video"&&v.width*v.height>E.width*E.height?v:E},{width:0,height:0});if(g.width===0)return b(new Error("No video stream in input, cannot take screenshots"));var p=Number(g.duration);if(isNaN(p)&&(p=Number(m.format.duration)),isNaN(p))return b(new Error("Could not get input duration, please specify fixed timemarks"));s.timemarks=s.timemarks.map(function(E){return(""+E).match(/^([\d.]+)%$/)?p*parseFloat(E)/100:E}),b()}})}else b()},function(b){s.timemarks=s.timemarks.map(function($){return i.timemarkToSeconds($)}).sort(function($,m){return $-m}),b()},function(b){var $=s.filename||"tn.png";if($.indexOf(".")===-1&&($+=".png"),s.timemarks.length>1&&!$.match(/%(s|0*i)/)){var m=e.extname($);$=e.join(e.dirname($),e.basename($,m)+"_%i"+m)}b(null,$)},function(b,$){if(b.match(/%[bf]/)){if(typeof f!="string")return $(new Error("Cannot replace %f or %b when using an input stream"));b=b.replace(/%f/g,e.basename(f)).replace(/%b/g,e.basename(f,e.extname(f)))}$(null,b)},function(b,$){if(b.match(/%[whr]/)){if(A)return $(null,b,A[1],A[2]);x(function(m,g){if(m)return $(new Error("Could not determine video resolution to replace %w, %h or %r"));var p=g.streams.reduce(function(h,T){return T.codec_type==="video"&&T.width*T.height>h.width*h.height?T:h},{width:0,height:0});if(p.width===0)return $(new Error("No video stream in input, cannot replace %w, %h or %r"));var E=p.width,v=p.height;y?(v=v*Number(y[1])/E,E=Number(y[1])):w?(E=E*Number(w[1])/v,v=Number(w[1])):S&&(E=E*Number(S[1])/100,v=v*Number(S[1])/100),$(null,b,Math.round(E/2)*2,Math.round(v/2)*2)})}else $(null,b,-1,-1)},function(b,$,m,g){b=b.replace(/%r/g,"%wx%h").replace(/%w/g,$).replace(/%h/g,m),g(null,b)},function(b,$){var m=s.timemarks.map(function(g,p){return b.replace(/%s/g,i.timemarkToSeconds(g)).replace(/%(0*)i/g,function(E,v){var h=""+(p+1);return v.substr(0,Math.max(0,v.length+1-h.length))+h})});l.emit("filenames",m),$(null,m)},function(b,$){r.exists(s.folder,function(m){m?$(null,b):r.mkdir(s.folder,function(g){g?$(g):$(null,b)})})}],function(b,$){if(b)return l.emit("error",b);var m=s.timemarks.length,g,p=[g={filter:"split",options:m,outputs:[]}];if("size"in s){l.size(s.size);var E=l._currentOutput.sizeFilters.get().map(function(O,N){return N>0&&(O.inputs="size"+(N-1)),O.outputs="size"+N,O});g.inputs="size"+(E.length-1),p=E.concat(p),l._currentOutput.sizeFilters.clear()}for(var v=0,h=0;h<m;h++){var T="screen"+h;g.outputs.push(T),h===0&&(v=s.timemarks[h],l.seekInput(v)),l.output(e.join(s.folder,$[h])).frames(1).map(T),h>0&&l.seek(s.timemarks[h]-v)}l.complexFilter(p),l.run()}),this},a.mergeToFile=a.concatenate=a.concat=function(s,u){var l=this._inputs.filter(function(d){return!d.isStream})[0],f=this;return this.ffprobe(this._inputs.indexOf(l),function(d,c){if(d)return f.emit("error",d);var A=c.streams.some(function(w){return w.codec_type==="audio"}),y=c.streams.some(function(w){return w.codec_type==="video"});f.output(s,u).complexFilter({filter:"concat",options:{n:f._inputs.length,v:y?1:0,a:A?1:0}}).run()}),this}},recipes}var path$3=require$$0$2,util$1=require$$2$2,EventEmitter$1=require$$2$1.EventEmitter,utils$8=utilsExports;function FfmpegCommand(r,e){if(!(this instanceof FfmpegCommand))return new FfmpegCommand(r,e);EventEmitter$1.call(this),typeof r=="object"&&!("readable"in r)?e=r:(e=e||{},e.source=r),this._inputs=[],e.source&&this.input(e.source),this._outputs=[],this.output();var t=this;["_global","_complexFilters"].forEach(function(n){t[n]=utils$8.args()}),e.stdoutLines="stdoutLines"in e?e.stdoutLines:100,e.presets=e.presets||e.preset||path$3.join(__dirname,"presets"),e.niceness=e.niceness||e.priority||0,this.options=e,this.logger=e.logger||{debug:function(){},info:function(){},warn:function(){},error:function(){}}}util$1.inherits(FfmpegCommand,EventEmitter$1);var fluentFfmpeg$1=FfmpegCommand;FfmpegCommand.prototype.clone=function(){var r=new FfmpegCommand,e=this;return r.options=this.options,r.logger=this.logger,r._inputs=this._inputs.map(function(t){return{source:t.source,options:t.options.clone()}}),"target"in this._outputs[0]?(r._outputs=[],r.output()):(r._outputs=[r._currentOutput={flags:{}}],["audio","audioFilters","video","videoFilters","sizeFilters","options"].forEach(function(t){r._currentOutput[t]=e._currentOutput[t].clone()}),this._currentOutput.sizeData&&(r._currentOutput.sizeData={},utils$8.copy(this._currentOutput.sizeData,r._currentOutput.sizeData)),utils$8.copy(this._currentOutput.flags,r._currentOutput.flags)),["_global","_complexFilters"].forEach(function(t){r[t]=e[t].clone()}),r};requireInputs()(FfmpegCommand.prototype);requireAudio()(FfmpegCommand.prototype);requireVideo()(FfmpegCommand.prototype);requireVideosize()(FfmpegCommand.prototype);requireOutput()(FfmpegCommand.prototype);requireCustom()(FfmpegCommand.prototype);requireMisc()(FfmpegCommand.prototype);requireProcessor()(FfmpegCommand.prototype);requireCapabilities()(FfmpegCommand.prototype);FfmpegCommand.setFfmpegPath=function(r){new FfmpegCommand().setFfmpegPath(r)};FfmpegCommand.setFfprobePath=function(r){new FfmpegCommand().setFfprobePath(r)};FfmpegCommand.setFlvtoolPath=function(r){new FfmpegCommand().setFlvtoolPath(r)};FfmpegCommand.availableFilters=FfmpegCommand.getAvailableFilters=function(r){new FfmpegCommand().availableFilters(r)};FfmpegCommand.availableCodecs=FfmpegCommand.getAvailableCodecs=function(r){new FfmpegCommand().availableCodecs(r)};FfmpegCommand.availableFormats=FfmpegCommand.getAvailableFormats=function(r){new FfmpegCommand().availableFormats(r)};FfmpegCommand.availableEncoders=FfmpegCommand.getAvailableEncoders=function(r){new FfmpegCommand().availableEncoders(r)};requireFfprobe()(FfmpegCommand.prototype);FfmpegCommand.ffprobe=function(r){var e=new FfmpegCommand(r);e.ffprobe.apply(e,Array.prototype.slice.call(arguments,1))};requireRecipes()(FfmpegCommand.prototype);var fluentFfmpeg=fluentFfmpeg$1;const ffmpeg=getDefaultExportFromCjs(fluentFfmpeg);async function permanentDelete(r){try{return require$$0$1.existsSync(r)&&(await promises.unlink(r),console.log(`[Cleanup] Permanently deleted: ${r}`)),!0}catch(e){return console.error(`[Cleanup] Failed to delete ${r}:`,e),!1}}async function cleanupOrphanedCache(r,e){const t={deletedCount:0,errors:[]};try{const n=await promises.readdir(r),i=new Set(n.filter(a=>a.endsWith(".mp4")).map(a=>require$$0$2.basename(a,require$$0$2.extname(a)).split("_")[0]));if(require$$0$1.existsSync(e)){const a=await promises.readdir(e);for(const s of a){if(!s.endsWith(".jpg"))continue;const u=require$$0$2.basename(s,".jpg");if(!i.has(u)){const l=require$$0$2.join(e,s);await permanentDelete(l)?(t.deletedCount++,console.log(`[Cleanup] Deleted orphaned thumbnail: ${s}`)):t.errors.push(`Failed to delete thumbnail: ${s}`)}}}const o=require$$0$2.join(e,"audio");if(require$$0$1.existsSync(o)){const a=await promises.readdir(o);for(const s of a){if(!s.endsWith(".m4a"))continue;const u=s.split("_")[0];if(!i.has(u)){const l=require$$0$2.join(o,s);await permanentDelete(l)?(t.deletedCount++,console.log(`[Cleanup] Deleted orphaned audio cache: ${s}`)):t.errors.push(`Failed to delete audio cache: ${s}`)}}}return console.log(`[Cleanup] Orphaned cache cleanup complete. Deleted ${t.deletedCount} files.`),t}catch(n){const i=n instanceof Error?n.message:String(n);return console.error("[Cleanup] Error during orphaned cache cleanup:",n),t.errors.push(i),t}}async function getCacheStats(r){const e={thumbnailCount:0,thumbnailSize:0,audioCount:0,audioSize:0,totalSize:0};try{if(require$$0$1.existsSync(r)){const n=await promises.readdir(r);for(const i of n)if(i.endsWith(".jpg")){const o=require$$0$2.join(r,i),a=await promises.stat(o);e.thumbnailCount++,e.thumbnailSize+=a.size}}const t=require$$0$2.join(r,"audio");if(require$$0$1.existsSync(t)){const n=await promises.readdir(t);for(const i of n)if(i.endsWith(".m4a")){const o=require$$0$2.join(t,i),a=await promises.stat(o);e.audioCount++,e.audioSize+=a.size}}return e.totalSize=e.thumbnailSize+e.audioSize,e}catch(t){return console.error("[Cleanup] Error getting cache stats:",t),e}}function formatBytes(r){if(r===0)return"0 B";const e=1024,t=["B","KB","MB","GB","TB"],n=Math.floor(Math.log(r)/Math.log(e));return parseFloat((r/Math.pow(e,n)).toFixed(2))+" "+t[n]}var chokidar={},utils$7={};const path$2=require$$0$2,WIN_SLASH="\\\\/",WIN_NO_SLASH=`[^${WIN_SLASH}]`,DOT_LITERAL="\\.",PLUS_LITERAL="\\+",QMARK_LITERAL="\\?",SLASH_LITERAL="\\/",ONE_CHAR="(?=.)",QMARK="[^/]",END_ANCHOR=`(?:${SLASH_LITERAL}|$)`,START_ANCHOR=`(?:^|${SLASH_LITERAL})`,DOTS_SLASH=`${DOT_LITERAL}{1,2}${END_ANCHOR}`,NO_DOT=`(?!${DOT_LITERAL})`,NO_DOTS=`(?!${START_ANCHOR}${DOTS_SLASH})`,NO_DOT_SLASH=`(?!${DOT_LITERAL}{0,1}${END_ANCHOR})`,NO_DOTS_SLASH=`(?!${DOTS_SLASH})`,QMARK_NO_DOT=`[^.${SLASH_LITERAL}]`,STAR$1=`${QMARK}*?`,POSIX_CHARS={DOT_LITERAL,PLUS_LITERAL,QMARK_LITERAL,SLASH_LITERAL,ONE_CHAR,QMARK,END_ANCHOR,DOTS_SLASH,NO_DOT,NO_DOTS,NO_DOT_SLASH,NO_DOTS_SLASH,QMARK_NO_DOT,STAR:STAR$1,START_ANCHOR},WINDOWS_CHARS={...POSIX_CHARS,SLASH_LITERAL:`[${WIN_SLASH}]`,QMARK:WIN_NO_SLASH,STAR:`${WIN_NO_SLASH}*?`,DOTS_SLASH:`${DOT_LITERAL}{1,2}(?:[${WIN_SLASH}]|$)`,NO_DOT:`(?!${DOT_LITERAL})`,NO_DOTS:`(?!(?:^|[${WIN_SLASH}])${DOT_LITERAL}{1,2}(?:[${WIN_SLASH}]|$))`,NO_DOT_SLASH:`(?!${DOT_LITERAL}{0,1}(?:[${WIN_SLASH}]|$))`,NO_DOTS_SLASH:`(?!${DOT_LITERAL}{1,2}(?:[${WIN_SLASH}]|$))`,QMARK_NO_DOT:`[^.${WIN_SLASH}]`,START_ANCHOR:`(?:^|[${WIN_SLASH}])`,END_ANCHOR:`(?:[${WIN_SLASH}]|$)`},POSIX_REGEX_SOURCE$1={alnum:"a-zA-Z0-9",alpha:"a-zA-Z",ascii:"\\x00-\\x7F",blank:" \\t",cntrl:"\\x00-\\x1F\\x7F",digit:"0-9",graph:"\\x21-\\x7E",lower:"a-z",print:"\\x20-\\x7E ",punct:"\\-!\"#$%&'()\\*+,./:;<=>?@[\\]^_`{|}~",space:" \\t\\r\\n\\v\\f",upper:"A-Z",word:"A-Za-z0-9_",xdigit:"A-Fa-f0-9"};var constants$4={MAX_LENGTH:1024*64,POSIX_REGEX_SOURCE:POSIX_REGEX_SOURCE$1,REGEX_BACKSLASH:/\\(?![*+?^${}(|)[\]])/g,REGEX_NON_SPECIAL_CHARS:/^[^@![\].,$*+?^{}()|\\/]+/,REGEX_SPECIAL_CHARS:/[-*+?.^${}(|)[\]]/,REGEX_SPECIAL_CHARS_BACKREF:/(\\?)((\W)(\3*))/g,REGEX_SPECIAL_CHARS_GLOBAL:/([-*+?.^${}(|)[\]])/g,REGEX_REMOVE_BACKSLASH:/(?:\[.*?[^\\]\]|\\(?=.))/g,REPLACEMENTS:{"***":"*","**/**":"**","**/**/**":"**"},CHAR_0:48,CHAR_9:57,CHAR_UPPERCASE_A:65,CHAR_LOWERCASE_A:97,CHAR_UPPERCASE_Z:90,CHAR_LOWERCASE_Z:122,CHAR_LEFT_PARENTHESES:40,CHAR_RIGHT_PARENTHESES:41,CHAR_ASTERISK:42,CHAR_AMPERSAND:38,CHAR_AT:64,CHAR_BACKWARD_SLASH:92,CHAR_CARRIAGE_RETURN:13,CHAR_CIRCUMFLEX_ACCENT:94,CHAR_COLON:58,CHAR_COMMA:44,CHAR_DOT:46,CHAR_DOUBLE_QUOTE:34,CHAR_EQUAL:61,CHAR_EXCLAMATION_MARK:33,CHAR_FORM_FEED:12,CHAR_FORWARD_SLASH:47,CHAR_GRAVE_ACCENT:96,CHAR_HASH:35,CHAR_HYPHEN_MINUS:45,CHAR_LEFT_ANGLE_BRACKET:60,CHAR_LEFT_CURLY_BRACE:123,CHAR_LEFT_SQUARE_BRACKET:91,CHAR_LINE_FEED:10,CHAR_NO_BREAK_SPACE:160,CHAR_PERCENT:37,CHAR_PLUS:43,CHAR_QUESTION_MARK:63,CHAR_RIGHT_ANGLE_BRACKET:62,CHAR_RIGHT_CURLY_BRACE:125,CHAR_RIGHT_SQUARE_BRACKET:93,CHAR_SEMICOLON:59,CHAR_SINGLE_QUOTE:39,CHAR_SPACE:32,CHAR_TAB:9,CHAR_UNDERSCORE:95,CHAR_VERTICAL_LINE:124,CHAR_ZERO_WIDTH_NOBREAK_SPACE:65279,SEP:path$2.sep,extglobChars(r){return{"!":{type:"negate",open:"(?:(?!(?:",close:`))${r.STAR})`},"?":{type:"qmark",open:"(?:",close:")?"},"+":{type:"plus",open:"(?:",close:")+"},"*":{type:"star",open:"(?:",close:")*"},"@":{type:"at",open:"(?:",close:")"}}},globChars(r){return r===!0?WINDOWS_CHARS:POSIX_CHARS}};(function(r){const e=require$$0$2,t=process.platform==="win32",{REGEX_BACKSLASH:n,REGEX_REMOVE_BACKSLASH:i,REGEX_SPECIAL_CHARS:o,REGEX_SPECIAL_CHARS_GLOBAL:a}=constants$4;r.isObject=s=>s!==null&&typeof s=="object"&&!Array.isArray(s),r.hasRegexChars=s=>o.test(s),r.isRegexChar=s=>s.length===1&&r.hasRegexChars(s),r.escapeRegex=s=>s.replace(a,"\\$1"),r.toPosixSlashes=s=>s.replace(n,"/"),r.removeBackslashes=s=>s.replace(i,u=>u==="\\"?"":u),r.supportsLookbehinds=()=>{const s=process.version.slice(1).split(".").map(Number);return s.length===3&&s[0]>=9||s[0]===8&&s[1]>=10},r.isWindows=s=>s&&typeof s.windows=="boolean"?s.windows:t===!0||e.sep==="\\",r.escapeLast=(s,u,l)=>{const f=s.lastIndexOf(u,l);return f===-1?s:s[f-1]==="\\"?r.escapeLast(s,u,f-1):`${s.slice(0,f)}\\${s.slice(f)}`},r.removePrefix=(s,u={})=>{let l=s;return l.startsWith("./")&&(l=l.slice(2),u.prefix="./"),l},r.wrapOutput=(s,u={},l={})=>{const f=l.contains?"":"^",d=l.contains?"":"$";let c=`${f}(?:${s})${d}`;return u.negated===!0&&(c=`(?:^(?!${c}).*$)`),c}})(utils$7);const utils$6=utils$7,{CHAR_ASTERISK,CHAR_AT,CHAR_BACKWARD_SLASH,CHAR_COMMA:CHAR_COMMA$1,CHAR_DOT:CHAR_DOT$1,CHAR_EXCLAMATION_MARK,CHAR_FORWARD_SLASH,CHAR_LEFT_CURLY_BRACE:CHAR_LEFT_CURLY_BRACE$1,CHAR_LEFT_PARENTHESES:CHAR_LEFT_PARENTHESES$1,CHAR_LEFT_SQUARE_BRACKET:CHAR_LEFT_SQUARE_BRACKET$1,CHAR_PLUS,CHAR_QUESTION_MARK,CHAR_RIGHT_CURLY_BRACE:CHAR_RIGHT_CURLY_BRACE$1,CHAR_RIGHT_PARENTHESES:CHAR_RIGHT_PARENTHESES$1,CHAR_RIGHT_SQUARE_BRACKET:CHAR_RIGHT_SQUARE_BRACKET$1}=constants$4,isPathSeparator=r=>r===CHAR_FORWARD_SLASH||r===CHAR_BACKWARD_SLASH,depth=r=>{r.isPrefix!==!0&&(r.depth=r.isGlobstar?1/0:1)},scan$1=(r,e)=>{const t=e||{},n=r.length-1,i=t.parts===!0||t.scanToEnd===!0,o=[],a=[],s=[];let u=r,l=-1,f=0,d=0,c=!1,A=!1,y=!1,w=!1,S=!1,F=!1,x=!1,P=!1,b=!1,$=!1,m=0,g,p,E={value:"",depth:0,isGlob:!1};const v=()=>l>=n,h=()=>u.charCodeAt(l+1),T=()=>(g=p,u.charCodeAt(++l));for(;l<n;){p=T();let V;if(p===CHAR_BACKWARD_SLASH){x=E.backslashes=!0,p=T(),p===CHAR_LEFT_CURLY_BRACE$1&&(F=!0);continue}if(F===!0||p===CHAR_LEFT_CURLY_BRACE$1){for(m++;v()!==!0&&(p=T());){if(p===CHAR_BACKWARD_SLASH){x=E.backslashes=!0,T();continue}if(p===CHAR_LEFT_CURLY_BRACE$1){m++;continue}if(F!==!0&&p===CHAR_DOT$1&&(p=T())===CHAR_DOT$1){if(c=E.isBrace=!0,y=E.isGlob=!0,$=!0,i===!0)continue;break}if(F!==!0&&p===CHAR_COMMA$1){if(c=E.isBrace=!0,y=E.isGlob=!0,$=!0,i===!0)continue;break}if(p===CHAR_RIGHT_CURLY_BRACE$1&&(m--,m===0)){F=!1,c=E.isBrace=!0,$=!0;break}}if(i===!0)continue;break}if(p===CHAR_FORWARD_SLASH){if(o.push(l),a.push(E),E={value:"",depth:0,isGlob:!1},$===!0)continue;if(g===CHAR_DOT$1&&l===f+1){f+=2;continue}d=l+1;continue}if(t.noext!==!0&&(p===CHAR_PLUS||p===CHAR_AT||p===CHAR_ASTERISK||p===CHAR_QUESTION_MARK||p===CHAR_EXCLAMATION_MARK)===!0&&h()===CHAR_LEFT_PARENTHESES$1){if(y=E.isGlob=!0,w=E.isExtglob=!0,$=!0,p===CHAR_EXCLAMATION_MARK&&l===f&&(b=!0),i===!0){for(;v()!==!0&&(p=T());){if(p===CHAR_BACKWARD_SLASH){x=E.backslashes=!0,p=T();continue}if(p===CHAR_RIGHT_PARENTHESES$1){y=E.isGlob=!0,$=!0;break}}continue}break}if(p===CHAR_ASTERISK){if(g===CHAR_ASTERISK&&(S=E.isGlobstar=!0),y=E.isGlob=!0,$=!0,i===!0)continue;break}if(p===CHAR_QUESTION_MARK){if(y=E.isGlob=!0,$=!0,i===!0)continue;break}if(p===CHAR_LEFT_SQUARE_BRACKET$1){for(;v()!==!0&&(V=T());){if(V===CHAR_BACKWARD_SLASH){x=E.backslashes=!0,T();continue}if(V===CHAR_RIGHT_SQUARE_BRACKET$1){A=E.isBracket=!0,y=E.isGlob=!0,$=!0;break}}if(i===!0)continue;break}if(t.nonegate!==!0&&p===CHAR_EXCLAMATION_MARK&&l===f){P=E.negated=!0,f++;continue}if(t.noparen!==!0&&p===CHAR_LEFT_PARENTHESES$1){if(y=E.isGlob=!0,i===!0){for(;v()!==!0&&(p=T());){if(p===CHAR_LEFT_PARENTHESES$1){x=E.backslashes=!0,p=T();continue}if(p===CHAR_RIGHT_PARENTHESES$1){$=!0;break}}continue}break}if(y===!0){if($=!0,i===!0)continue;break}}t.noext===!0&&(w=!1,y=!1);let O=u,N="",R="";f>0&&(N=u.slice(0,f),u=u.slice(f),d-=f),O&&y===!0&&d>0?(O=u.slice(0,d),R=u.slice(d)):y===!0?(O="",R=u):O=u,O&&O!==""&&O!=="/"&&O!==u&&isPathSeparator(O.charCodeAt(O.length-1))&&(O=O.slice(0,-1)),t.unescape===!0&&(R&&(R=utils$6.removeBackslashes(R)),O&&x===!0&&(O=utils$6.removeBackslashes(O)));const C={prefix:N,input:r,start:f,base:O,glob:R,isBrace:c,isBracket:A,isGlob:y,isExtglob:w,isGlobstar:S,negated:P,negatedExtglob:b};if(t.tokens===!0&&(C.maxDepth=0,isPathSeparator(p)||a.push(E),C.tokens=a),t.parts===!0||t.tokens===!0){let V;for(let k=0;k<o.length;k++){const z=V?V+1:f,G=o[k],q=r.slice(z,G);t.tokens&&(k===0&&f!==0?(a[k].isPrefix=!0,a[k].value=N):a[k].value=q,depth(a[k]),C.maxDepth+=a[k].depth),(k!==0||q!=="")&&s.push(q),V=G}if(V&&V+1<r.length){const k=r.slice(V+1);s.push(k),t.tokens&&(a[a.length-1].value=k,depth(a[a.length-1]),C.maxDepth+=a[a.length-1].depth)}C.slashes=o,C.parts=s}return C};var scan_1=scan$1;const constants$3=constants$4,utils$5=utils$7,{MAX_LENGTH:MAX_LENGTH$1,POSIX_REGEX_SOURCE,REGEX_NON_SPECIAL_CHARS,REGEX_SPECIAL_CHARS_BACKREF,REPLACEMENTS}=constants$3,expandRange=(r,e)=>{if(typeof e.expandRange=="function")return e.expandRange(...r,e);r.sort();const t=`[${r.join("-")}]`;try{new RegExp(t)}catch{return r.map(i=>utils$5.escapeRegex(i)).join("..")}return t},syntaxError=(r,e)=>`Missing ${r}: "${e}" - use "\\\\${e}" to match literal characters`,parse$3=(r,e)=>{if(typeof r!="string")throw new TypeError("Expected a string");r=REPLACEMENTS[r]||r;const t={...e},n=typeof t.maxLength=="number"?Math.min(MAX_LENGTH$1,t.maxLength):MAX_LENGTH$1;let i=r.length;if(i>n)throw new SyntaxError(`Input length: ${i}, exceeds maximum allowed length: ${n}`);const o={type:"bos",value:"",output:t.prepend||""},a=[o],s=t.capture?"":"?:",u=utils$5.isWindows(e),l=constants$3.globChars(u),f=constants$3.extglobChars(l),{DOT_LITERAL:d,PLUS_LITERAL:c,SLASH_LITERAL:A,ONE_CHAR:y,DOTS_SLASH:w,NO_DOT:S,NO_DOT_SLASH:F,NO_DOTS_SLASH:x,QMARK:P,QMARK_NO_DOT:b,STAR:$,START_ANCHOR:m}=l,g=L=>`(${s}(?:(?!${m}${L.dot?w:d}).)*?)`,p=t.dot?"":S,E=t.dot?P:b;let v=t.bash===!0?g(t):$;t.capture&&(v=`(${v})`),typeof t.noext=="boolean"&&(t.noextglob=t.noext);const h={input:r,index:-1,start:0,dot:t.dot===!0,consumed:"",output:"",prefix:"",backtrack:!1,negated:!1,brackets:0,braces:0,parens:0,quotes:0,globstar:!1,tokens:a};r=utils$5.removePrefix(r,h),i=r.length;const T=[],O=[],N=[];let R=o,C;const V=()=>h.index===i-1,k=h.peek=(L=1)=>r[h.index+L],z=h.advance=()=>r[++h.index]||"",G=()=>r.slice(h.index+1),q=(L="",M=0)=>{h.consumed+=L,h.index+=M},j=L=>{h.output+=L.output!=null?L.output:L.value,q(L.value)},K=()=>{let L=1;for(;k()==="!"&&(k(2)!=="("||k(3)==="?");)z(),h.start++,L++;return L%2===0?!1:(h.negated=!0,h.start++,!0)},Q=L=>{h[L]++,N.push(L)},Y=L=>{h[L]--,N.pop()},D=L=>{if(R.type==="globstar"){const M=h.braces>0&&(L.type==="comma"||L.type==="brace"),I=L.extglob===!0||T.length&&(L.type==="pipe"||L.type==="paren");L.type!=="slash"&&L.type!=="paren"&&!M&&!I&&(h.output=h.output.slice(0,-R.output.length),R.type="star",R.value="*",R.output=v,h.output+=R.output)}if(T.length&&L.type!=="paren"&&(T[T.length-1].inner+=L.value),(L.value||L.output)&&j(L),R&&R.type==="text"&&L.type==="text"){R.value+=L.value,R.output=(R.output||"")+L.value;return}L.prev=R,a.push(L),R=L},X=(L,M)=>{const I={...f[M],conditions:1,inner:""};I.prev=R,I.parens=h.parens,I.output=h.output;const H=(t.capture?"(":"")+I.open;Q("parens"),D({type:L,value:M,output:h.output?"":y}),D({type:"paren",extglob:!0,value:z(),output:H}),T.push(I)},ee=L=>{let M=L.close+(t.capture?")":""),I;if(L.type==="negate"){let H=v;if(L.inner&&L.inner.length>1&&L.inner.includes("/")&&(H=g(t)),(H!==v||V()||/^\)+$/.test(G()))&&(M=L.close=`)$))${H}`),L.inner.includes("*")&&(I=G())&&/^\.[^\\/.]+$/.test(I)){const W=parse$3(I,{...e,fastpaths:!1}).output;M=L.close=`)${W})${H})`}L.prev.type==="bos"&&(h.negatedExtglob=!0)}D({type:"paren",extglob:!0,value:C,output:M}),Y("parens")};if(t.fastpaths!==!1&&!/(^[*!]|[/()[\]{}"])/.test(r)){let L=!1,M=r.replace(REGEX_SPECIAL_CHARS_BACKREF,(I,H,W,U,B,J)=>U==="\\"?(L=!0,I):U==="?"?H?H+U+(B?P.repeat(B.length):""):J===0?E+(B?P.repeat(B.length):""):P.repeat(W.length):U==="."?d.repeat(W.length):U==="*"?H?H+U+(B?v:""):v:H?I:`\\${I}`);return L===!0&&(t.unescape===!0?M=M.replace(/\\/g,""):M=M.replace(/\\+/g,I=>I.length%2===0?"\\\\":I?"\\":"")),M===r&&t.contains===!0?(h.output=r,h):(h.output=utils$5.wrapOutput(M,h,e),h)}for(;!V();){if(C=z(),C==="\0")continue;if(C==="\\"){const I=k();if(I==="/"&&t.bash!==!0||I==="."||I===";")continue;if(!I){C+="\\",D({type:"text",value:C});continue}const H=/^\\+/.exec(G());let W=0;if(H&&H[0].length>2&&(W=H[0].length,h.index+=W,W%2!==0&&(C+="\\")),t.unescape===!0?C=z():C+=z(),h.brackets===0){D({type:"text",value:C});continue}}if(h.brackets>0&&(C!=="]"||R.value==="["||R.value==="[^")){if(t.posix!==!1&&C===":"){const I=R.value.slice(1);if(I.includes("[")&&(R.posix=!0,I.includes(":"))){const H=R.value.lastIndexOf("["),W=R.value.slice(0,H),U=R.value.slice(H+2),B=POSIX_REGEX_SOURCE[U];if(B){R.value=W+B,h.backtrack=!0,z(),!o.output&&a.indexOf(R)===1&&(o.output=y);continue}}}(C==="["&&k()!==":"||C==="-"&&k()==="]")&&(C=`\\${C}`),C==="]"&&(R.value==="["||R.value==="[^")&&(C=`\\${C}`),t.posix===!0&&C==="!"&&R.value==="["&&(C="^"),R.value+=C,j({value:C});continue}if(h.quotes===1&&C!=='"'){C=utils$5.escapeRegex(C),R.value+=C,j({value:C});continue}if(C==='"'){h.quotes=h.quotes===1?0:1,t.keepQuotes===!0&&D({type:"text",value:C});continue}if(C==="("){Q("parens"),D({type:"paren",value:C});continue}if(C===")"){if(h.parens===0&&t.strictBrackets===!0)throw new SyntaxError(syntaxError("opening","("));const I=T[T.length-1];if(I&&h.parens===I.parens+1){ee(T.pop());continue}D({type:"paren",value:C,output:h.parens?")":"\\)"}),Y("parens");continue}if(C==="["){if(t.nobracket===!0||!G().includes("]")){if(t.nobracket!==!0&&t.strictBrackets===!0)throw new SyntaxError(syntaxError("closing","]"));C=`\\${C}`}else Q("brackets");D({type:"bracket",value:C});continue}if(C==="]"){if(t.nobracket===!0||R&&R.type==="bracket"&&R.value.length===1){D({type:"text",value:C,output:`\\${C}`});continue}if(h.brackets===0){if(t.strictBrackets===!0)throw new SyntaxError(syntaxError("opening","["));D({type:"text",value:C,output:`\\${C}`});continue}Y("brackets");const I=R.value.slice(1);if(R.posix!==!0&&I[0]==="^"&&!I.includes("/")&&(C=`/${C}`),R.value+=C,j({value:C}),t.literalBrackets===!1||utils$5.hasRegexChars(I))continue;const H=utils$5.escapeRegex(R.value);if(h.output=h.output.slice(0,-R.value.length),t.literalBrackets===!0){h.output+=H,R.value=H;continue}R.value=`(${s}${H}|${R.value})`,h.output+=R.value;continue}if(C==="{"&&t.nobrace!==!0){Q("braces");const I={type:"brace",value:C,output:"(",outputIndex:h.output.length,tokensIndex:h.tokens.length};O.push(I),D(I);continue}if(C==="}"){const I=O[O.length-1];if(t.nobrace===!0||!I){D({type:"text",value:C,output:C});continue}let H=")";if(I.dots===!0){const W=a.slice(),U=[];for(let B=W.length-1;B>=0&&(a.pop(),W[B].type!=="brace");B--)W[B].type!=="dots"&&U.unshift(W[B].value);H=expandRange(U,t),h.backtrack=!0}if(I.comma!==!0&&I.dots!==!0){const W=h.output.slice(0,I.outputIndex),U=h.tokens.slice(I.tokensIndex);I.value=I.output="\\{",C=H="\\}",h.output=W;for(const B of U)h.output+=B.output||B.value}D({type:"brace",value:C,output:H}),Y("braces"),O.pop();continue}if(C==="|"){T.length>0&&T[T.length-1].conditions++,D({type:"text",value:C});continue}if(C===","){let I=C;const H=O[O.length-1];H&&N[N.length-1]==="braces"&&(H.comma=!0,I="|"),D({type:"comma",value:C,output:I});continue}if(C==="/"){if(R.type==="dot"&&h.index===h.start+1){h.start=h.index+1,h.consumed="",h.output="",a.pop(),R=o;continue}D({type:"slash",value:C,output:A});continue}if(C==="."){if(h.braces>0&&R.type==="dot"){R.value==="."&&(R.output=d);const I=O[O.length-1];R.type="dots",R.output+=C,R.value+=C,I.dots=!0;continue}if(h.braces+h.parens===0&&R.type!=="bos"&&R.type!=="slash"){D({type:"text",value:C,output:d});continue}D({type:"dot",value:C,output:d});continue}if(C==="?"){if(!(R&&R.value==="(")&&t.noextglob!==!0&&k()==="("&&k(2)!=="?"){X("qmark",C);continue}if(R&&R.type==="paren"){const H=k();let W=C;if(H==="<"&&!utils$5.supportsLookbehinds())throw new Error("Node.js v10 or higher is required for regex lookbehinds");(R.value==="("&&!/[!=<:]/.test(H)||H==="<"&&!/<([!=]|\w+>)/.test(G()))&&(W=`\\${C}`),D({type:"text",value:C,output:W});continue}if(t.dot!==!0&&(R.type==="slash"||R.type==="bos")){D({type:"qmark",value:C,output:b});continue}D({type:"qmark",value:C,output:P});continue}if(C==="!"){if(t.noextglob!==!0&&k()==="("&&(k(2)!=="?"||!/[!=<:]/.test(k(3)))){X("negate",C);continue}if(t.nonegate!==!0&&h.index===0){K();continue}}if(C==="+"){if(t.noextglob!==!0&&k()==="("&&k(2)!=="?"){X("plus",C);continue}if(R&&R.value==="("||t.regex===!1){D({type:"plus",value:C,output:c});continue}if(R&&(R.type==="bracket"||R.type==="paren"||R.type==="brace")||h.parens>0){D({type:"plus",value:C});continue}D({type:"plus",value:c});continue}if(C==="@"){if(t.noextglob!==!0&&k()==="("&&k(2)!=="?"){D({type:"at",extglob:!0,value:C,output:""});continue}D({type:"text",value:C});continue}if(C!=="*"){(C==="$"||C==="^")&&(C=`\\${C}`);const I=REGEX_NON_SPECIAL_CHARS.exec(G());I&&(C+=I[0],h.index+=I[0].length),D({type:"text",value:C});continue}if(R&&(R.type==="globstar"||R.star===!0)){R.type="star",R.star=!0,R.value+=C,R.output=v,h.backtrack=!0,h.globstar=!0,q(C);continue}let L=G();if(t.noextglob!==!0&&/^\([^?]/.test(L)){X("star",C);continue}if(R.type==="star"){if(t.noglobstar===!0){q(C);continue}const I=R.prev,H=I.prev,W=I.type==="slash"||I.type==="bos",U=H&&(H.type==="star"||H.type==="globstar");if(t.bash===!0&&(!W||L[0]&&L[0]!=="/")){D({type:"star",value:C,output:""});continue}const B=h.braces>0&&(I.type==="comma"||I.type==="brace"),J=T.length&&(I.type==="pipe"||I.type==="paren");if(!W&&I.type!=="paren"&&!B&&!J){D({type:"star",value:C,output:""});continue}for(;L.slice(0,3)==="/**";){const Z=r[h.index+4];if(Z&&Z!=="/")break;L=L.slice(3),q("/**",3)}if(I.type==="bos"&&V()){R.type="globstar",R.value+=C,R.output=g(t),h.output=R.output,h.globstar=!0,q(C);continue}if(I.type==="slash"&&I.prev.type!=="bos"&&!U&&V()){h.output=h.output.slice(0,-(I.output+R.output).length),I.output=`(?:${I.output}`,R.type="globstar",R.output=g(t)+(t.strictSlashes?")":"|$)"),R.value+=C,h.globstar=!0,h.output+=I.output+R.output,q(C);continue}if(I.type==="slash"&&I.prev.type!=="bos"&&L[0]==="/"){const Z=L[1]!==void 0?"|$":"";h.output=h.output.slice(0,-(I.output+R.output).length),I.output=`(?:${I.output}`,R.type="globstar",R.output=`${g(t)}${A}|${A}${Z})`,R.value+=C,h.output+=I.output+R.output,h.globstar=!0,q(C+z()),D({type:"slash",value:"/",output:""});continue}if(I.type==="bos"&&L[0]==="/"){R.type="globstar",R.value+=C,R.output=`(?:^|${A}|${g(t)}${A})`,h.output=R.output,h.globstar=!0,q(C+z()),D({type:"slash",value:"/",output:""});continue}h.output=h.output.slice(0,-R.output.length),R.type="globstar",R.output=g(t),R.value+=C,h.output+=R.output,h.globstar=!0,q(C);continue}const M={type:"star",value:C,output:v};if(t.bash===!0){M.output=".*?",(R.type==="bos"||R.type==="slash")&&(M.output=p+M.output),D(M);continue}if(R&&(R.type==="bracket"||R.type==="paren")&&t.regex===!0){M.output=C,D(M);continue}(h.index===h.start||R.type==="slash"||R.type==="dot")&&(R.type==="dot"?(h.output+=F,R.output+=F):t.dot===!0?(h.output+=x,R.output+=x):(h.output+=p,R.output+=p),k()!=="*"&&(h.output+=y,R.output+=y)),D(M)}for(;h.brackets>0;){if(t.strictBrackets===!0)throw new SyntaxError(syntaxError("closing","]"));h.output=utils$5.escapeLast(h.output,"["),Y("brackets")}for(;h.parens>0;){if(t.strictBrackets===!0)throw new SyntaxError(syntaxError("closing",")"));h.output=utils$5.escapeLast(h.output,"("),Y("parens")}for(;h.braces>0;){if(t.strictBrackets===!0)throw new SyntaxError(syntaxError("closing","}"));h.output=utils$5.escapeLast(h.output,"{"),Y("braces")}if(t.strictSlashes!==!0&&(R.type==="star"||R.type==="bracket")&&D({type:"maybe_slash",value:"",output:`${A}?`}),h.backtrack===!0){h.output="";for(const L of h.tokens)h.output+=L.output!=null?L.output:L.value,L.suffix&&(h.output+=L.suffix)}return h};parse$3.fastpaths=(r,e)=>{const t={...e},n=typeof t.maxLength=="number"?Math.min(MAX_LENGTH$1,t.maxLength):MAX_LENGTH$1,i=r.length;if(i>n)throw new SyntaxError(`Input length: ${i}, exceeds maximum allowed length: ${n}`);r=REPLACEMENTS[r]||r;const o=utils$5.isWindows(e),{DOT_LITERAL:a,SLASH_LITERAL:s,ONE_CHAR:u,DOTS_SLASH:l,NO_DOT:f,NO_DOTS:d,NO_DOTS_SLASH:c,STAR:A,START_ANCHOR:y}=constants$3.globChars(o),w=t.dot?d:f,S=t.dot?c:f,F=t.capture?"":"?:",x={negated:!1,prefix:""};let P=t.bash===!0?".*?":A;t.capture&&(P=`(${P})`);const b=p=>p.noglobstar===!0?P:`(${F}(?:(?!${y}${p.dot?l:a}).)*?)`,$=p=>{switch(p){case"*":return`${w}${u}${P}`;case".*":return`${a}${u}${P}`;case"*.*":return`${w}${P}${a}${u}${P}`;case"*/*":return`${w}${P}${s}${u}${S}${P}`;case"**":return w+b(t);case"**/*":return`(?:${w}${b(t)}${s})?${S}${u}${P}`;case"**/*.*":return`(?:${w}${b(t)}${s})?${S}${P}${a}${u}${P}`;case"**/.*":return`(?:${w}${b(t)}${s})?${a}${u}${P}`;default:{const E=/^(.*?)\.(\w+)$/.exec(p);if(!E)return;const v=$(E[1]);return v?v+a+E[2]:void 0}}},m=utils$5.removePrefix(r,x);let g=$(m);return g&&t.strictSlashes!==!0&&(g+=`${s}?`),g};var parse_1$1=parse$3;const path$1=require$$0$2,scan=scan_1,parse$2=parse_1$1,utils$4=utils$7,constants$2=constants$4,isObject$1=r=>r&&typeof r=="object"&&!Array.isArray(r),picomatch$3=(r,e,t=!1)=>{if(Array.isArray(r)){const f=r.map(c=>picomatch$3(c,e,t));return c=>{for(const A of f){const y=A(c);if(y)return y}return!1}}const n=isObject$1(r)&&r.tokens&&r.input;if(r===""||typeof r!="string"&&!n)throw new TypeError("Expected pattern to be a non-empty string");const i=e||{},o=utils$4.isWindows(e),a=n?picomatch$3.compileRe(r,e):picomatch$3.makeRe(r,e,!1,!0),s=a.state;delete a.state;let u=()=>!1;if(i.ignore){const f={...e,ignore:null,onMatch:null,onResult:null};u=picomatch$3(i.ignore,f,t)}const l=(f,d=!1)=>{const{isMatch:c,match:A,output:y}=picomatch$3.test(f,a,e,{glob:r,posix:o}),w={glob:r,state:s,regex:a,posix:o,input:f,output:y,match:A,isMatch:c};return typeof i.onResult=="function"&&i.onResult(w),c===!1?(w.isMatch=!1,d?w:!1):u(f)?(typeof i.onIgnore=="function"&&i.onIgnore(w),w.isMatch=!1,d?w:!1):(typeof i.onMatch=="function"&&i.onMatch(w),d?w:!0)};return t&&(l.state=s),l};picomatch$3.test=(r,e,t,{glob:n,posix:i}={})=>{if(typeof r!="string")throw new TypeError("Expected input to be a string");if(r==="")return{isMatch:!1,output:""};const o=t||{},a=o.format||(i?utils$4.toPosixSlashes:null);let s=r===n,u=s&&a?a(r):r;return s===!1&&(u=a?a(r):r,s=u===n),(s===!1||o.capture===!0)&&(o.matchBase===!0||o.basename===!0?s=picomatch$3.matchBase(r,e,t,i):s=e.exec(u)),{isMatch:!!s,match:s,output:u}};picomatch$3.matchBase=(r,e,t,n=utils$4.isWindows(t))=>(e instanceof RegExp?e:picomatch$3.makeRe(e,t)).test(path$1.basename(r));picomatch$3.isMatch=(r,e,t)=>picomatch$3(e,t)(r);picomatch$3.parse=(r,e)=>Array.isArray(r)?r.map(t=>picomatch$3.parse(t,e)):parse$2(r,{...e,fastpaths:!1});picomatch$3.scan=(r,e)=>scan(r,e);picomatch$3.compileRe=(r,e,t=!1,n=!1)=>{if(t===!0)return r.output;const i=e||{},o=i.contains?"":"^",a=i.contains?"":"$";let s=`${o}(?:${r.output})${a}`;r&&r.negated===!0&&(s=`^(?!${s}).*$`);const u=picomatch$3.toRegex(s,e);return n===!0&&(u.state=r),u};picomatch$3.makeRe=(r,e={},t=!1,n=!1)=>{if(!r||typeof r!="string")throw new TypeError("Expected a non-empty string");let i={negated:!1,fastpaths:!0};return e.fastpaths!==!1&&(r[0]==="."||r[0]==="*")&&(i.output=parse$2.fastpaths(r,e)),i.output||(i=parse$2(r,e)),picomatch$3.compileRe(i,e,t,n)};picomatch$3.toRegex=(r,e)=>{try{const t=e||{};return new RegExp(r,t.flags||(t.nocase?"i":""))}catch(t){if(e&&e.debug===!0)throw t;return/$^/}};picomatch$3.constants=constants$2;var picomatch_1=picomatch$3,picomatch$2=picomatch_1;const fs$3=require$$0$1,{Readable}=require$$2,sysPath$3=require$$0$2,{promisify:promisify$3}=require$$2$2,picomatch$1=picomatch$2,readdir$1=promisify$3(fs$3.readdir),stat$3=promisify$3(fs$3.stat),lstat$2=promisify$3(fs$3.lstat),realpath$1=promisify$3(fs$3.realpath),BANG$2="!",RECURSIVE_ERROR_CODE="READDIRP_RECURSIVE_ERROR",NORMAL_FLOW_ERRORS=new Set(["ENOENT","EPERM","EACCES","ELOOP",RECURSIVE_ERROR_CODE]),FILE_TYPE="files",DIR_TYPE="directories",FILE_DIR_TYPE="files_directories",EVERYTHING_TYPE="all",ALL_TYPES=[FILE_TYPE,DIR_TYPE,FILE_DIR_TYPE,EVERYTHING_TYPE],isNormalFlowError=r=>NORMAL_FLOW_ERRORS.has(r.code),[maj,min]=process.versions.node.split(".").slice(0,2).map(r=>Number.parseInt(r,10)),wantBigintFsStats=process.platform==="win32"&&(maj>10||maj===10&&min>=5),normalizeFilter=r=>{if(r!==void 0){if(typeof r=="function")return r;if(typeof r=="string"){const e=picomatch$1(r.trim());return t=>e(t.basename)}if(Array.isArray(r)){const e=[],t=[];for(const n of r){const i=n.trim();i.charAt(0)===BANG$2?t.push(picomatch$1(i.slice(1))):e.push(picomatch$1(i))}return t.length>0?e.length>0?n=>e.some(i=>i(n.basename))&&!t.some(i=>i(n.basename)):n=>!t.some(i=>i(n.basename)):n=>e.some(i=>i(n.basename))}}};class ReaddirpStream extends Readable{static get defaultOptions(){return{root:".",fileFilter:e=>!0,directoryFilter:e=>!0,type:FILE_TYPE,lstat:!1,depth:2147483648,alwaysStat:!1}}constructor(e={}){super({objectMode:!0,autoDestroy:!0,highWaterMark:e.highWaterMark||4096});const t={...ReaddirpStream.defaultOptions,...e},{root:n,type:i}=t;this._fileFilter=normalizeFilter(t.fileFilter),this._directoryFilter=normalizeFilter(t.directoryFilter);const o=t.lstat?lstat$2:stat$3;wantBigintFsStats?this._stat=a=>o(a,{bigint:!0}):this._stat=o,this._maxDepth=t.depth,this._wantsDir=[DIR_TYPE,FILE_DIR_TYPE,EVERYTHING_TYPE].includes(i),this._wantsFile=[FILE_TYPE,FILE_DIR_TYPE,EVERYTHING_TYPE].includes(i),this._wantsEverything=i===EVERYTHING_TYPE,this._root=sysPath$3.resolve(n),this._isDirent="Dirent"in fs$3&&!t.alwaysStat,this._statsProp=this._isDirent?"dirent":"stats",this._rdOptions={encoding:"utf8",withFileTypes:this._isDirent},this.parents=[this._exploreDir(n,1)],this.reading=!1,this.parent=void 0}async _read(e){if(!this.reading){this.reading=!0;try{for(;!this.destroyed&&e>0;){const{path:t,depth:n,files:i=[]}=this.parent||{};if(i.length>0){const o=i.splice(0,e).map(a=>this._formatEntry(a,t));for(const a of await Promise.all(o)){if(this.destroyed)return;const s=await this._getEntryType(a);s==="directory"&&this._directoryFilter(a)?(n<=this._maxDepth&&this.parents.push(this._exploreDir(a.fullPath,n+1)),this._wantsDir&&(this.push(a),e--)):(s==="file"||this._includeAsFile(a))&&this._fileFilter(a)&&this._wantsFile&&(this.push(a),e--)}}else{const o=this.parents.pop();if(!o){this.push(null);break}if(this.parent=await o,this.destroyed)return}}}catch(t){this.destroy(t)}finally{this.reading=!1}}}async _exploreDir(e,t){let n;try{n=await readdir$1(e,this._rdOptions)}catch(i){this._onError(i)}return{files:n,depth:t,path:e}}async _formatEntry(e,t){let n;try{const i=this._isDirent?e.name:e,o=sysPath$3.resolve(sysPath$3.join(t,i));n={path:sysPath$3.relative(this._root,o),fullPath:o,basename:i},n[this._statsProp]=this._isDirent?e:await this._stat(o)}catch(i){this._onError(i)}return n}_onError(e){isNormalFlowError(e)&&!this.destroyed?this.emit("warn",e):this.destroy(e)}async _getEntryType(e){const t=e&&e[this._statsProp];if(t){if(t.isFile())return"file";if(t.isDirectory())return"directory";if(t&&t.isSymbolicLink()){const n=e.fullPath;try{const i=await realpath$1(n),o=await lstat$2(i);if(o.isFile())return"file";if(o.isDirectory()){const a=i.length;if(n.startsWith(i)&&n.substr(a,1)===sysPath$3.sep){const s=new Error(`Circular symlink detected: "${n}" points to "${i}"`);return s.code=RECURSIVE_ERROR_CODE,this._onError(s)}return"directory"}}catch(i){this._onError(i)}}}}_includeAsFile(e){const t=e&&e[this._statsProp];return t&&this._wantsEverything&&!t.isDirectory()}}const readdirp$1=(r,e={})=>{let t=e.entryType||e.type;if(t==="both"&&(t=FILE_DIR_TYPE),t&&(e.type=t),r){if(typeof r!="string")throw new TypeError("readdirp: root argument must be a string. Usage: readdirp(root, options)");if(t&&!ALL_TYPES.includes(t))throw new Error(`readdirp: Invalid type passed. Use one of ${ALL_TYPES.join(", ")}`)}else throw new Error("readdirp: root argument is required. Usage: readdirp(root, options)");return e.root=r,new ReaddirpStream(e)},readdirpPromise=(r,e={})=>new Promise((t,n)=>{const i=[];readdirp$1(r,e).on("data",o=>i.push(o)).on("end",()=>t(i)).on("error",o=>n(o))});readdirp$1.promise=readdirpPromise;readdirp$1.ReaddirpStream=ReaddirpStream;readdirp$1.default=readdirp$1;var readdirp_1=readdirp$1,anymatch$2={exports:{}};/*!
 * normalize-path <https://github.com/jonschlinkert/normalize-path>
 *
 * Copyright (c) 2014-2018, Jon Schlinkert.
 * Released under the MIT License.
 */var normalizePath$2=function(r,e){if(typeof r!="string")throw new TypeError("expected path to be a string");if(r==="\\"||r==="/")return"/";var t=r.length;if(t<=1)return r;var n="";if(t>4&&r[3]==="\\"){var i=r[2];(i==="?"||i===".")&&r.slice(0,2)==="\\\\"&&(r=r.slice(2),n="//")}var o=r.split(/[/\\]+/);return e!==!1&&o[o.length-1]===""&&o.pop(),n+o.join("/")},anymatch_1=anymatch$2.exports;Object.defineProperty(anymatch_1,"__esModule",{value:!0});const picomatch=picomatch$2,normalizePath$1=normalizePath$2,BANG$1="!",DEFAULT_OPTIONS={returnIndex:!1},arrify$1=r=>Array.isArray(r)?r:[r],createPattern=(r,e)=>{if(typeof r=="function")return r;if(typeof r=="string"){const t=picomatch(r,e);return n=>r===n||t(n)}return r instanceof RegExp?t=>r.test(t):t=>!1},matchPatterns=(r,e,t,n)=>{const i=Array.isArray(t),o=i?t[0]:t;if(!i&&typeof o!="string")throw new TypeError("anymatch: second argument must be a string: got "+Object.prototype.toString.call(o));const a=normalizePath$1(o,!1);for(let u=0;u<e.length;u++){const l=e[u];if(l(a))return n?-1:!1}const s=i&&[a].concat(t.slice(1));for(let u=0;u<r.length;u++){const l=r[u];if(i?l(...s):l(a))return n?u:!0}return n?-1:!1},anymatch$1=(r,e,t=DEFAULT_OPTIONS)=>{if(r==null)throw new TypeError("anymatch: specify first argument");const n=typeof t=="boolean"?{returnIndex:t}:t,i=n.returnIndex||!1,o=arrify$1(r),a=o.filter(u=>typeof u=="string"&&u.charAt(0)===BANG$1).map(u=>u.slice(1)).map(u=>picomatch(u,n)),s=o.filter(u=>typeof u!="string"||typeof u=="string"&&u.charAt(0)!==BANG$1).map(u=>createPattern(u,n));return e==null?(u,l=!1)=>matchPatterns(s,a,u,typeof l=="boolean"?l:!1):matchPatterns(s,a,e,i)};anymatch$1.default=anymatch$1;anymatch$2.exports=anymatch$1;var anymatchExports=anymatch$2.exports;/*!
 * is-extglob <https://github.com/jonschlinkert/is-extglob>
 *
 * Copyright (c) 2014-2016, Jon Schlinkert.
 * Licensed under the MIT License.
 */var isExtglob$1=function(e){if(typeof e!="string"||e==="")return!1;for(var t;t=/(\\).|([@?!+*]\(.*\))/g.exec(e);){if(t[2])return!0;e=e.slice(t.index+t[0].length)}return!1};/*!
 * is-glob <https://github.com/jonschlinkert/is-glob>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var isExtglob=isExtglob$1,chars={"{":"}","(":")","[":"]"},strictCheck=function(r){if(r[0]==="!")return!0;for(var e=0,t=-2,n=-2,i=-2,o=-2,a=-2;e<r.length;){if(r[e]==="*"||r[e+1]==="?"&&/[\].+)]/.test(r[e])||n!==-1&&r[e]==="["&&r[e+1]!=="]"&&(n<e&&(n=r.indexOf("]",e)),n>e&&(a===-1||a>n||(a=r.indexOf("\\",e),a===-1||a>n)))||i!==-1&&r[e]==="{"&&r[e+1]!=="}"&&(i=r.indexOf("}",e),i>e&&(a=r.indexOf("\\",e),a===-1||a>i))||o!==-1&&r[e]==="("&&r[e+1]==="?"&&/[:!=]/.test(r[e+2])&&r[e+3]!==")"&&(o=r.indexOf(")",e),o>e&&(a=r.indexOf("\\",e),a===-1||a>o))||t!==-1&&r[e]==="("&&r[e+1]!=="|"&&(t<e&&(t=r.indexOf("|",e)),t!==-1&&r[t+1]!==")"&&(o=r.indexOf(")",t),o>t&&(a=r.indexOf("\\",t),a===-1||a>o))))return!0;if(r[e]==="\\"){var s=r[e+1];e+=2;var u=chars[s];if(u){var l=r.indexOf(u,e);l!==-1&&(e=l+1)}if(r[e]==="!")return!0}else e++}return!1},relaxedCheck=function(r){if(r[0]==="!")return!0;for(var e=0;e<r.length;){if(/[*?{}()[\]]/.test(r[e]))return!0;if(r[e]==="\\"){var t=r[e+1];e+=2;var n=chars[t];if(n){var i=r.indexOf(n,e);i!==-1&&(e=i+1)}if(r[e]==="!")return!0}else e++}return!1},isGlob$2=function(e,t){if(typeof e!="string"||e==="")return!1;if(isExtglob(e))return!0;var n=strictCheck;return t&&t.strict===!1&&(n=relaxedCheck),n(e)},isGlob$1=isGlob$2,pathPosixDirname=require$$0$2.posix.dirname,isWin32=require$$1.platform()==="win32",slash="/",backslash=/\\/g,enclosure=/[\{\[].*[\}\]]$/,globby=/(^|[^\\])([\{\[]|\([^\)]+$)/,escaped=/\\([\!\*\?\|\[\]\(\)\{\}])/g,globParent$1=function(e,t){var n=Object.assign({flipBackslashes:!0},t);n.flipBackslashes&&isWin32&&e.indexOf(slash)<0&&(e=e.replace(backslash,slash)),enclosure.test(e)&&(e+=slash),e+="a";do e=pathPosixDirname(e);while(isGlob$1(e)||globby.test(e));return e.replace(escaped,"$1")},utils$3={};(function(r){r.isInteger=e=>typeof e=="number"?Number.isInteger(e):typeof e=="string"&&e.trim()!==""?Number.isInteger(Number(e)):!1,r.find=(e,t)=>e.nodes.find(n=>n.type===t),r.exceedsLimit=(e,t,n=1,i)=>i===!1||!r.isInteger(e)||!r.isInteger(t)?!1:(Number(t)-Number(e))/Number(n)>=i,r.escapeNode=(e,t=0,n)=>{const i=e.nodes[t];i&&(n&&i.type===n||i.type==="open"||i.type==="close")&&i.escaped!==!0&&(i.value="\\"+i.value,i.escaped=!0)},r.encloseBrace=e=>e.type!=="brace"||e.commas>>0+e.ranges>>0?!1:(e.invalid=!0,!0),r.isInvalidBrace=e=>e.type!=="brace"?!1:e.invalid===!0||e.dollar?!0:!(e.commas>>0+e.ranges>>0)||e.open!==!0||e.close!==!0?(e.invalid=!0,!0):!1,r.isOpenOrClose=e=>e.type==="open"||e.type==="close"?!0:e.open===!0||e.close===!0,r.reduce=e=>e.reduce((t,n)=>(n.type==="text"&&t.push(n.value),n.type==="range"&&(n.type="text"),t),[]),r.flatten=(...e)=>{const t=[],n=i=>{for(let o=0;o<i.length;o++){const a=i[o];if(Array.isArray(a)){n(a);continue}a!==void 0&&t.push(a)}return t};return n(e),t}})(utils$3);const utils$2=utils$3;var stringify$4=(r,e={})=>{const t=(n,i={})=>{const o=e.escapeInvalid&&utils$2.isInvalidBrace(i),a=n.invalid===!0&&e.escapeInvalid===!0;let s="";if(n.value)return(o||a)&&utils$2.isOpenOrClose(n)?"\\"+n.value:n.value;if(n.value)return n.value;if(n.nodes)for(const u of n.nodes)s+=t(u);return s};return t(r)};/*!
 * is-number <https://github.com/jonschlinkert/is-number>
 *
 * Copyright (c) 2014-present, Jon Schlinkert.
 * Released under the MIT License.
 */var isNumber$2=function(r){return typeof r=="number"?r-r===0:typeof r=="string"&&r.trim()!==""?Number.isFinite?Number.isFinite(+r):isFinite(+r):!1};/*!
 * to-regex-range <https://github.com/micromatch/to-regex-range>
 *
 * Copyright (c) 2015-present, Jon Schlinkert.
 * Released under the MIT License.
 */const isNumber$1=isNumber$2,toRegexRange$1=(r,e,t)=>{if(isNumber$1(r)===!1)throw new TypeError("toRegexRange: expected the first argument to be a number");if(e===void 0||r===e)return String(r);if(isNumber$1(e)===!1)throw new TypeError("toRegexRange: expected the second argument to be a number.");let n={relaxZeros:!0,...t};typeof n.strictZeros=="boolean"&&(n.relaxZeros=n.strictZeros===!1);let i=String(n.relaxZeros),o=String(n.shorthand),a=String(n.capture),s=String(n.wrap),u=r+":"+e+"="+i+o+a+s;if(toRegexRange$1.cache.hasOwnProperty(u))return toRegexRange$1.cache[u].result;let l=Math.min(r,e),f=Math.max(r,e);if(Math.abs(l-f)===1){let w=r+"|"+e;return n.capture?`(${w})`:n.wrap===!1?w:`(?:${w})`}let d=hasPadding(r)||hasPadding(e),c={min:r,max:e,a:l,b:f},A=[],y=[];if(d&&(c.isPadded=d,c.maxLen=String(c.max).length),l<0){let w=f<0?Math.abs(f):1;y=splitToPatterns(w,Math.abs(l),c,n),l=c.a=0}return f>=0&&(A=splitToPatterns(l,f,c,n)),c.negatives=y,c.positives=A,c.result=collatePatterns(y,A),n.capture===!0?c.result=`(${c.result})`:n.wrap!==!1&&A.length+y.length>1&&(c.result=`(?:${c.result})`),toRegexRange$1.cache[u]=c,c.result};function collatePatterns(r,e,t){let n=filterPatterns(r,e,"-",!1)||[],i=filterPatterns(e,r,"",!1)||[],o=filterPatterns(r,e,"-?",!0)||[];return n.concat(o).concat(i).join("|")}function splitToRanges(r,e){let t=1,n=1,i=countNines(r,t),o=new Set([e]);for(;r<=i&&i<=e;)o.add(i),t+=1,i=countNines(r,t);for(i=countZeros(e+1,n)-1;r<i&&i<=e;)o.add(i),n+=1,i=countZeros(e+1,n)-1;return o=[...o],o.sort(compare),o}function rangeToPattern(r,e,t){if(r===e)return{pattern:r,count:[],digits:0};let n=zip(r,e),i=n.length,o="",a=0;for(let s=0;s<i;s++){let[u,l]=n[s];u===l?o+=u:u!=="0"||l!=="9"?o+=toCharacterClass(u,l):a++}return a&&(o+=t.shorthand===!0?"\\d":"[0-9]"),{pattern:o,count:[a],digits:i}}function splitToPatterns(r,e,t,n){let i=splitToRanges(r,e),o=[],a=r,s;for(let u=0;u<i.length;u++){let l=i[u],f=rangeToPattern(String(a),String(l),n),d="";if(!t.isPadded&&s&&s.pattern===f.pattern){s.count.length>1&&s.count.pop(),s.count.push(f.count[0]),s.string=s.pattern+toQuantifier(s.count),a=l+1;continue}t.isPadded&&(d=padZeros(l,t,n)),f.string=d+f.pattern+toQuantifier(f.count),o.push(f),a=l+1,s=f}return o}function filterPatterns(r,e,t,n,i){let o=[];for(let a of r){let{string:s}=a;!n&&!contains(e,"string",s)&&o.push(t+s),n&&contains(e,"string",s)&&o.push(t+s)}return o}function zip(r,e){let t=[];for(let n=0;n<r.length;n++)t.push([r[n],e[n]]);return t}function compare(r,e){return r>e?1:e>r?-1:0}function contains(r,e,t){return r.some(n=>n[e]===t)}function countNines(r,e){return Number(String(r).slice(0,-e)+"9".repeat(e))}function countZeros(r,e){return r-r%Math.pow(10,e)}function toQuantifier(r){let[e=0,t=""]=r;return t||e>1?`{${e+(t?","+t:"")}}`:""}function toCharacterClass(r,e,t){return`[${r}${e-r===1?"":"-"}${e}]`}function hasPadding(r){return/^-?(0+)\d/.test(r)}function padZeros(r,e,t){if(!e.isPadded)return r;let n=Math.abs(e.maxLen-String(r).length),i=t.relaxZeros!==!1;switch(n){case 0:return"";case 1:return i?"0?":"0";case 2:return i?"0{0,2}":"00";default:return i?`0{0,${n}}`:`0{${n}}`}}toRegexRange$1.cache={};toRegexRange$1.clearCache=()=>toRegexRange$1.cache={};var toRegexRange_1=toRegexRange$1;/*!
 * fill-range <https://github.com/jonschlinkert/fill-range>
 *
 * Copyright (c) 2014-present, Jon Schlinkert.
 * Licensed under the MIT License.
 */const util=require$$2$2,toRegexRange=toRegexRange_1,isObject=r=>r!==null&&typeof r=="object"&&!Array.isArray(r),transform=r=>e=>r===!0?Number(e):String(e),isValidValue=r=>typeof r=="number"||typeof r=="string"&&r!=="",isNumber=r=>Number.isInteger(+r),zeros=r=>{let e=`${r}`,t=-1;if(e[0]==="-"&&(e=e.slice(1)),e==="0")return!1;for(;e[++t]==="0";);return t>0},stringify$3=(r,e,t)=>typeof r=="string"||typeof e=="string"?!0:t.stringify===!0,pad=(r,e,t)=>{if(e>0){let n=r[0]==="-"?"-":"";n&&(r=r.slice(1)),r=n+r.padStart(n?e-1:e,"0")}return t===!1?String(r):r},toMaxLen=(r,e)=>{let t=r[0]==="-"?"-":"";for(t&&(r=r.slice(1),e--);r.length<e;)r="0"+r;return t?"-"+r:r},toSequence=(r,e,t)=>{r.negatives.sort((s,u)=>s<u?-1:s>u?1:0),r.positives.sort((s,u)=>s<u?-1:s>u?1:0);let n=e.capture?"":"?:",i="",o="",a;return r.positives.length&&(i=r.positives.map(s=>toMaxLen(String(s),t)).join("|")),r.negatives.length&&(o=`-(${n}${r.negatives.map(s=>toMaxLen(String(s),t)).join("|")})`),i&&o?a=`${i}|${o}`:a=i||o,e.wrap?`(${n}${a})`:a},toRange=(r,e,t,n)=>{if(t)return toRegexRange(r,e,{wrap:!1,...n});let i=String.fromCharCode(r);if(r===e)return i;let o=String.fromCharCode(e);return`[${i}-${o}]`},toRegex=(r,e,t)=>{if(Array.isArray(r)){let n=t.wrap===!0,i=t.capture?"":"?:";return n?`(${i}${r.join("|")})`:r.join("|")}return toRegexRange(r,e,t)},rangeError=(...r)=>new RangeError("Invalid range arguments: "+util.inspect(...r)),invalidRange=(r,e,t)=>{if(t.strictRanges===!0)throw rangeError([r,e]);return[]},invalidStep=(r,e)=>{if(e.strictRanges===!0)throw new TypeError(`Expected step "${r}" to be a number`);return[]},fillNumbers=(r,e,t=1,n={})=>{let i=Number(r),o=Number(e);if(!Number.isInteger(i)||!Number.isInteger(o)){if(n.strictRanges===!0)throw rangeError([r,e]);return[]}i===0&&(i=0),o===0&&(o=0);let a=i>o,s=String(r),u=String(e),l=String(t);t=Math.max(Math.abs(t),1);let f=zeros(s)||zeros(u)||zeros(l),d=f?Math.max(s.length,u.length,l.length):0,c=f===!1&&stringify$3(r,e,n)===!1,A=n.transform||transform(c);if(n.toRegex&&t===1)return toRange(toMaxLen(r,d),toMaxLen(e,d),!0,n);let y={negatives:[],positives:[]},w=x=>y[x<0?"negatives":"positives"].push(Math.abs(x)),S=[],F=0;for(;a?i>=o:i<=o;)n.toRegex===!0&&t>1?w(i):S.push(pad(A(i,F),d,c)),i=a?i-t:i+t,F++;return n.toRegex===!0?t>1?toSequence(y,n,d):toRegex(S,null,{wrap:!1,...n}):S},fillLetters=(r,e,t=1,n={})=>{if(!isNumber(r)&&r.length>1||!isNumber(e)&&e.length>1)return invalidRange(r,e,n);let i=n.transform||(c=>String.fromCharCode(c)),o=`${r}`.charCodeAt(0),a=`${e}`.charCodeAt(0),s=o>a,u=Math.min(o,a),l=Math.max(o,a);if(n.toRegex&&t===1)return toRange(u,l,!1,n);let f=[],d=0;for(;s?o>=a:o<=a;)f.push(i(o,d)),o=s?o-t:o+t,d++;return n.toRegex===!0?toRegex(f,null,{wrap:!1,options:n}):f},fill$2=(r,e,t,n={})=>{if(e==null&&isValidValue(r))return[r];if(!isValidValue(r)||!isValidValue(e))return invalidRange(r,e,n);if(typeof t=="function")return fill$2(r,e,1,{transform:t});if(isObject(t))return fill$2(r,e,0,t);let i={...n};return i.capture===!0&&(i.wrap=!0),t=t||i.step||1,isNumber(t)?isNumber(r)&&isNumber(e)?fillNumbers(r,e,t,i):fillLetters(r,e,Math.max(Math.abs(t),1),i):t!=null&&!isObject(t)?invalidStep(t,i):fill$2(r,e,1,t)};var fillRange=fill$2;const fill$1=fillRange,utils$1=utils$3,compile$1=(r,e={})=>{const t=(n,i={})=>{const o=utils$1.isInvalidBrace(i),a=n.invalid===!0&&e.escapeInvalid===!0,s=o===!0||a===!0,u=e.escapeInvalid===!0?"\\":"";let l="";if(n.isOpen===!0)return u+n.value;if(n.isClose===!0)return console.log("node.isClose",u,n.value),u+n.value;if(n.type==="open")return s?u+n.value:"(";if(n.type==="close")return s?u+n.value:")";if(n.type==="comma")return n.prev.type==="comma"?"":s?n.value:"|";if(n.value)return n.value;if(n.nodes&&n.ranges>0){const f=utils$1.reduce(n.nodes),d=fill$1(...f,{...e,wrap:!1,toRegex:!0,strictZeros:!0});if(d.length!==0)return f.length>1&&d.length>1?`(${d})`:d}if(n.nodes)for(const f of n.nodes)l+=t(f,n);return l};return t(r)};var compile_1=compile$1;const fill=fillRange,stringify$2=stringify$4,utils=utils$3,append=(r="",e="",t=!1)=>{const n=[];if(r=[].concat(r),e=[].concat(e),!e.length)return r;if(!r.length)return t?utils.flatten(e).map(i=>`{${i}}`):e;for(const i of r)if(Array.isArray(i))for(const o of i)n.push(append(o,e,t));else for(let o of e)t===!0&&typeof o=="string"&&(o=`{${o}}`),n.push(Array.isArray(o)?append(i,o,t):i+o);return utils.flatten(n)},expand$1=(r,e={})=>{const t=e.rangeLimit===void 0?1e3:e.rangeLimit,n=(i,o={})=>{i.queue=[];let a=o,s=o.queue;for(;a.type!=="brace"&&a.type!=="root"&&a.parent;)a=a.parent,s=a.queue;if(i.invalid||i.dollar){s.push(append(s.pop(),stringify$2(i,e)));return}if(i.type==="brace"&&i.invalid!==!0&&i.nodes.length===2){s.push(append(s.pop(),["{}"]));return}if(i.nodes&&i.ranges>0){const d=utils.reduce(i.nodes);if(utils.exceedsLimit(...d,e.step,t))throw new RangeError("expanded array length exceeds range limit. Use options.rangeLimit to increase or disable the limit.");let c=fill(...d,e);c.length===0&&(c=stringify$2(i,e)),s.push(append(s.pop(),c)),i.nodes=[];return}const u=utils.encloseBrace(i);let l=i.queue,f=i;for(;f.type!=="brace"&&f.type!=="root"&&f.parent;)f=f.parent,l=f.queue;for(let d=0;d<i.nodes.length;d++){const c=i.nodes[d];if(c.type==="comma"&&i.type==="brace"){d===1&&l.push(""),l.push("");continue}if(c.type==="close"){s.push(append(s.pop(),l,u));continue}if(c.value&&c.type!=="open"){l.push(append(l.pop(),c.value));continue}c.nodes&&n(c,i)}return l};return utils.flatten(n(r))};var expand_1=expand$1,constants$1={MAX_LENGTH:1e4,CHAR_LEFT_PARENTHESES:"(",CHAR_RIGHT_PARENTHESES:")",CHAR_BACKSLASH:"\\",CHAR_BACKTICK:"`",CHAR_COMMA:",",CHAR_DOT:".",CHAR_DOUBLE_QUOTE:'"',CHAR_LEFT_CURLY_BRACE:"{",CHAR_LEFT_SQUARE_BRACKET:"[",CHAR_NO_BREAK_SPACE:"",CHAR_RIGHT_CURLY_BRACE:"}",CHAR_RIGHT_SQUARE_BRACKET:"]",CHAR_SINGLE_QUOTE:"'",CHAR_ZERO_WIDTH_NOBREAK_SPACE:"\uFEFF"};const stringify$1=stringify$4,{MAX_LENGTH,CHAR_BACKSLASH,CHAR_BACKTICK,CHAR_COMMA,CHAR_DOT,CHAR_LEFT_PARENTHESES,CHAR_RIGHT_PARENTHESES,CHAR_LEFT_CURLY_BRACE,CHAR_RIGHT_CURLY_BRACE,CHAR_LEFT_SQUARE_BRACKET,CHAR_RIGHT_SQUARE_BRACKET,CHAR_DOUBLE_QUOTE,CHAR_SINGLE_QUOTE,CHAR_NO_BREAK_SPACE,CHAR_ZERO_WIDTH_NOBREAK_SPACE}=constants$1,parse$1=(r,e={})=>{if(typeof r!="string")throw new TypeError("Expected a string");const t=e||{},n=typeof t.maxLength=="number"?Math.min(MAX_LENGTH,t.maxLength):MAX_LENGTH;if(r.length>n)throw new SyntaxError(`Input length (${r.length}), exceeds max characters (${n})`);const i={type:"root",input:r,nodes:[]},o=[i];let a=i,s=i,u=0;const l=r.length;let f=0,d=0,c;const A=()=>r[f++],y=w=>{if(w.type==="text"&&s.type==="dot"&&(s.type="text"),s&&s.type==="text"&&w.type==="text"){s.value+=w.value;return}return a.nodes.push(w),w.parent=a,w.prev=s,s=w,w};for(y({type:"bos"});f<l;)if(a=o[o.length-1],c=A(),!(c===CHAR_ZERO_WIDTH_NOBREAK_SPACE||c===CHAR_NO_BREAK_SPACE)){if(c===CHAR_BACKSLASH){y({type:"text",value:(e.keepEscaping?c:"")+A()});continue}if(c===CHAR_RIGHT_SQUARE_BRACKET){y({type:"text",value:"\\"+c});continue}if(c===CHAR_LEFT_SQUARE_BRACKET){u++;let w;for(;f<l&&(w=A());){if(c+=w,w===CHAR_LEFT_SQUARE_BRACKET){u++;continue}if(w===CHAR_BACKSLASH){c+=A();continue}if(w===CHAR_RIGHT_SQUARE_BRACKET&&(u--,u===0))break}y({type:"text",value:c});continue}if(c===CHAR_LEFT_PARENTHESES){a=y({type:"paren",nodes:[]}),o.push(a),y({type:"text",value:c});continue}if(c===CHAR_RIGHT_PARENTHESES){if(a.type!=="paren"){y({type:"text",value:c});continue}a=o.pop(),y({type:"text",value:c}),a=o[o.length-1];continue}if(c===CHAR_DOUBLE_QUOTE||c===CHAR_SINGLE_QUOTE||c===CHAR_BACKTICK){const w=c;let S;for(e.keepQuotes!==!0&&(c="");f<l&&(S=A());){if(S===CHAR_BACKSLASH){c+=S+A();continue}if(S===w){e.keepQuotes===!0&&(c+=S);break}c+=S}y({type:"text",value:c});continue}if(c===CHAR_LEFT_CURLY_BRACE){d++;const S={type:"brace",open:!0,close:!1,dollar:s.value&&s.value.slice(-1)==="$"||a.dollar===!0,depth:d,commas:0,ranges:0,nodes:[]};a=y(S),o.push(a),y({type:"open",value:c});continue}if(c===CHAR_RIGHT_CURLY_BRACE){if(a.type!=="brace"){y({type:"text",value:c});continue}const w="close";a=o.pop(),a.close=!0,y({type:w,value:c}),d--,a=o[o.length-1];continue}if(c===CHAR_COMMA&&d>0){if(a.ranges>0){a.ranges=0;const w=a.nodes.shift();a.nodes=[w,{type:"text",value:stringify$1(a)}]}y({type:"comma",value:c}),a.commas++;continue}if(c===CHAR_DOT&&d>0&&a.commas===0){const w=a.nodes;if(d===0||w.length===0){y({type:"text",value:c});continue}if(s.type==="dot"){if(a.range=[],s.value+=c,s.type="range",a.nodes.length!==3&&a.nodes.length!==5){a.invalid=!0,a.ranges=0,s.type="text";continue}a.ranges++,a.args=[];continue}if(s.type==="range"){w.pop();const S=w[w.length-1];S.value+=s.value+c,s=S,a.ranges--;continue}y({type:"dot",value:c});continue}y({type:"text",value:c})}do if(a=o.pop(),a.type!=="root"){a.nodes.forEach(F=>{F.nodes||(F.type==="open"&&(F.isOpen=!0),F.type==="close"&&(F.isClose=!0),F.nodes||(F.type="text"),F.invalid=!0)});const w=o[o.length-1],S=w.nodes.indexOf(a);w.nodes.splice(S,1,...a.nodes)}while(o.length>0);return y({type:"eos"}),i};var parse_1=parse$1;const stringify=stringify$4,compile=compile_1,expand=expand_1,parse=parse_1,braces$1=(r,e={})=>{let t=[];if(Array.isArray(r))for(const n of r){const i=braces$1.create(n,e);Array.isArray(i)?t.push(...i):t.push(i)}else t=[].concat(braces$1.create(r,e));return e&&e.expand===!0&&e.nodupes===!0&&(t=[...new Set(t)]),t};braces$1.parse=(r,e={})=>parse(r,e);braces$1.stringify=(r,e={})=>stringify(typeof r=="string"?braces$1.parse(r,e):r,e);braces$1.compile=(r,e={})=>(typeof r=="string"&&(r=braces$1.parse(r,e)),compile(r,e));braces$1.expand=(r,e={})=>{typeof r=="string"&&(r=braces$1.parse(r,e));let t=expand(r,e);return e.noempty===!0&&(t=t.filter(Boolean)),e.nodupes===!0&&(t=[...new Set(t)]),t};braces$1.create=(r,e={})=>r===""||r.length<3?[r]:e.expand!==!0?braces$1.compile(r,e):braces$1.expand(r,e);var braces_1=braces$1;const require$$0=["3dm","3ds","3g2","3gp","7z","a","aac","adp","afdesign","afphoto","afpub","ai","aif","aiff","alz","ape","apk","appimage","ar","arj","asf","au","avi","bak","baml","bh","bin","bk","bmp","btif","bz2","bzip2","cab","caf","cgm","class","cmx","cpio","cr2","cur","dat","dcm","deb","dex","djvu","dll","dmg","dng","doc","docm","docx","dot","dotm","dra","DS_Store","dsk","dts","dtshd","dvb","dwg","dxf","ecelp4800","ecelp7470","ecelp9600","egg","eol","eot","epub","exe","f4v","fbs","fh","fla","flac","flatpak","fli","flv","fpx","fst","fvt","g3","gh","gif","graffle","gz","gzip","h261","h263","h264","icns","ico","ief","img","ipa","iso","jar","jpeg","jpg","jpgv","jpm","jxr","key","ktx","lha","lib","lvp","lz","lzh","lzma","lzo","m3u","m4a","m4v","mar","mdi","mht","mid","midi","mj2","mka","mkv","mmr","mng","mobi","mov","movie","mp3","mp4","mp4a","mpeg","mpg","mpga","mxu","nef","npx","numbers","nupkg","o","odp","ods","odt","oga","ogg","ogv","otf","ott","pages","pbm","pcx","pdb","pdf","pea","pgm","pic","png","pnm","pot","potm","potx","ppa","ppam","ppm","pps","ppsm","ppsx","ppt","pptm","pptx","psd","pya","pyc","pyo","pyv","qt","rar","ras","raw","resources","rgb","rip","rlc","rmf","rmvb","rpm","rtf","rz","s3m","s7z","scpt","sgi","shar","snap","sil","sketch","slk","smv","snk","so","stl","suo","sub","swf","tar","tbz","tbz2","tga","tgz","thmx","tif","tiff","tlz","ttc","ttf","txz","udf","uvh","uvi","uvm","uvp","uvs","uvu","viv","vob","war","wav","wax","wbmp","wdp","weba","webm","webp","whl","wim","wm","wma","wmv","wmx","woff","woff2","wrm","wvx","xbm","xif","xla","xlam","xls","xlsb","xlsm","xlsx","xlt","xltm","xltx","xm","xmind","xpi","xpm","xwd","xz","z","zip","zipx"];var binaryExtensions$1=require$$0;const path=require$$0$2,binaryExtensions=binaryExtensions$1,extensions=new Set(binaryExtensions);var isBinaryPath$1=r=>extensions.has(path.extname(r).slice(1).toLowerCase()),constants={};(function(r){const{sep:e}=require$$0$2,{platform:t}=process,n=require$$1;r.EV_ALL="all",r.EV_READY="ready",r.EV_ADD="add",r.EV_CHANGE="change",r.EV_ADD_DIR="addDir",r.EV_UNLINK="unlink",r.EV_UNLINK_DIR="unlinkDir",r.EV_RAW="raw",r.EV_ERROR="error",r.STR_DATA="data",r.STR_END="end",r.STR_CLOSE="close",r.FSEVENT_CREATED="created",r.FSEVENT_MODIFIED="modified",r.FSEVENT_DELETED="deleted",r.FSEVENT_MOVED="moved",r.FSEVENT_CLONED="cloned",r.FSEVENT_UNKNOWN="unknown",r.FSEVENT_FLAG_MUST_SCAN_SUBDIRS=1,r.FSEVENT_TYPE_FILE="file",r.FSEVENT_TYPE_DIRECTORY="directory",r.FSEVENT_TYPE_SYMLINK="symlink",r.KEY_LISTENERS="listeners",r.KEY_ERR="errHandlers",r.KEY_RAW="rawEmitters",r.HANDLER_KEYS=[r.KEY_LISTENERS,r.KEY_ERR,r.KEY_RAW],r.DOT_SLASH=`.${e}`,r.BACK_SLASH_RE=/\\/g,r.DOUBLE_SLASH_RE=/\/\//,r.SLASH_OR_BACK_SLASH_RE=/[/\\]/,r.DOT_RE=/\..*\.(sw[px])$|~$|\.subl.*\.tmp/,r.REPLACER_RE=/^\.[/\\]/,r.SLASH="/",r.SLASH_SLASH="//",r.BRACE_START="{",r.BANG="!",r.ONE_DOT=".",r.TWO_DOTS="..",r.STAR="*",r.GLOBSTAR="**",r.ROOT_GLOBSTAR="/**/*",r.SLASH_GLOBSTAR="/**",r.DIR_SUFFIX="Dir",r.ANYMATCH_OPTS={dot:!0},r.STRING_TYPE="string",r.FUNCTION_TYPE="function",r.EMPTY_STR="",r.EMPTY_FN=()=>{},r.IDENTITY_FN=i=>i,r.isWindows=t==="win32",r.isMacos=t==="darwin",r.isLinux=t==="linux",r.isIBMi=n.type()==="OS400"})(constants);const fs$2=require$$0$1,sysPath$2=require$$0$2,{promisify:promisify$2}=require$$2$2,isBinaryPath=isBinaryPath$1,{isWindows:isWindows$1,isLinux,EMPTY_FN:EMPTY_FN$2,EMPTY_STR:EMPTY_STR$1,KEY_LISTENERS,KEY_ERR,KEY_RAW,HANDLER_KEYS,EV_CHANGE:EV_CHANGE$2,EV_ADD:EV_ADD$2,EV_ADD_DIR:EV_ADD_DIR$2,EV_ERROR:EV_ERROR$2,STR_DATA:STR_DATA$1,STR_END:STR_END$2,BRACE_START:BRACE_START$1,STAR}=constants,THROTTLE_MODE_WATCH="watch",open=promisify$2(fs$2.open),stat$2=promisify$2(fs$2.stat),lstat$1=promisify$2(fs$2.lstat),close=promisify$2(fs$2.close),fsrealpath=promisify$2(fs$2.realpath),statMethods$1={lstat:lstat$1,stat:stat$2},foreach=(r,e)=>{r instanceof Set?r.forEach(e):e(r)},addAndConvert=(r,e,t)=>{let n=r[e];n instanceof Set||(r[e]=n=new Set([n])),n.add(t)},clearItem=r=>e=>{const t=r[e];t instanceof Set?t.clear():delete r[e]},delFromSet=(r,e,t)=>{const n=r[e];n instanceof Set?n.delete(t):n===t&&delete r[e]},isEmptySet=r=>r instanceof Set?r.size===0:!r,FsWatchInstances=new Map;function createFsWatchInstance(r,e,t,n,i){const o=(a,s)=>{t(r),i(a,s,{watchedPath:r}),s&&r!==s&&fsWatchBroadcast(sysPath$2.resolve(r,s),KEY_LISTENERS,sysPath$2.join(r,s))};try{return fs$2.watch(r,e,o)}catch(a){n(a)}}const fsWatchBroadcast=(r,e,t,n,i)=>{const o=FsWatchInstances.get(r);o&&foreach(o[e],a=>{a(t,n,i)})},setFsWatchListener=(r,e,t,n)=>{const{listener:i,errHandler:o,rawEmitter:a}=n;let s=FsWatchInstances.get(e),u;if(!t.persistent)return u=createFsWatchInstance(r,t,i,o,a),u.close.bind(u);if(s)addAndConvert(s,KEY_LISTENERS,i),addAndConvert(s,KEY_ERR,o),addAndConvert(s,KEY_RAW,a);else{if(u=createFsWatchInstance(r,t,fsWatchBroadcast.bind(null,e,KEY_LISTENERS),o,fsWatchBroadcast.bind(null,e,KEY_RAW)),!u)return;u.on(EV_ERROR$2,async l=>{const f=fsWatchBroadcast.bind(null,e,KEY_ERR);if(s.watcherUnusable=!0,isWindows$1&&l.code==="EPERM")try{const d=await open(r,"r");await close(d),f(l)}catch{}else f(l)}),s={listeners:i,errHandlers:o,rawEmitters:a,watcher:u},FsWatchInstances.set(e,s)}return()=>{delFromSet(s,KEY_LISTENERS,i),delFromSet(s,KEY_ERR,o),delFromSet(s,KEY_RAW,a),isEmptySet(s.listeners)&&(s.watcher.close(),FsWatchInstances.delete(e),HANDLER_KEYS.forEach(clearItem(s)),s.watcher=void 0,Object.freeze(s))}},FsWatchFileInstances=new Map,setFsWatchFileListener=(r,e,t,n)=>{const{listener:i,rawEmitter:o}=n;let a=FsWatchFileInstances.get(e);const s=a&&a.options;return s&&(s.persistent<t.persistent||s.interval>t.interval)&&(a.listeners,a.rawEmitters,fs$2.unwatchFile(e),a=void 0),a?(addAndConvert(a,KEY_LISTENERS,i),addAndConvert(a,KEY_RAW,o)):(a={listeners:i,rawEmitters:o,options:t,watcher:fs$2.watchFile(e,t,(u,l)=>{foreach(a.rawEmitters,d=>{d(EV_CHANGE$2,e,{curr:u,prev:l})});const f=u.mtimeMs;(u.size!==l.size||f>l.mtimeMs||f===0)&&foreach(a.listeners,d=>d(r,u))})},FsWatchFileInstances.set(e,a)),()=>{delFromSet(a,KEY_LISTENERS,i),delFromSet(a,KEY_RAW,o),isEmptySet(a.listeners)&&(FsWatchFileInstances.delete(e),fs$2.unwatchFile(e),a.options=a.watcher=void 0,Object.freeze(a))}};let NodeFsHandler$1=class{constructor(e){this.fsw=e,this._boundHandleError=t=>e._handleError(t)}_watchWithNodeFs(e,t){const n=this.fsw.options,i=sysPath$2.dirname(e),o=sysPath$2.basename(e);this.fsw._getWatchedDir(i).add(o);const s=sysPath$2.resolve(e),u={persistent:n.persistent};t||(t=EMPTY_FN$2);let l;return n.usePolling?(u.interval=n.enableBinaryInterval&&isBinaryPath(o)?n.binaryInterval:n.interval,l=setFsWatchFileListener(e,s,u,{listener:t,rawEmitter:this.fsw._emitRaw})):l=setFsWatchListener(e,s,u,{listener:t,errHandler:this._boundHandleError,rawEmitter:this.fsw._emitRaw}),l}_handleFile(e,t,n){if(this.fsw.closed)return;const i=sysPath$2.dirname(e),o=sysPath$2.basename(e),a=this.fsw._getWatchedDir(i);let s=t;if(a.has(o))return;const u=async(f,d)=>{if(this.fsw._throttle(THROTTLE_MODE_WATCH,e,5)){if(!d||d.mtimeMs===0)try{const c=await stat$2(e);if(this.fsw.closed)return;const A=c.atimeMs,y=c.mtimeMs;(!A||A<=y||y!==s.mtimeMs)&&this.fsw._emit(EV_CHANGE$2,e,c),isLinux&&s.ino!==c.ino?(this.fsw._closeFile(f),s=c,this.fsw._addPathCloser(f,this._watchWithNodeFs(e,u))):s=c}catch{this.fsw._remove(i,o)}else if(a.has(o)){const c=d.atimeMs,A=d.mtimeMs;(!c||c<=A||A!==s.mtimeMs)&&this.fsw._emit(EV_CHANGE$2,e,d),s=d}}},l=this._watchWithNodeFs(e,u);if(!(n&&this.fsw.options.ignoreInitial)&&this.fsw._isntIgnored(e)){if(!this.fsw._throttle(EV_ADD$2,e,0))return;this.fsw._emit(EV_ADD$2,e,t)}return l}async _handleSymlink(e,t,n,i){if(this.fsw.closed)return;const o=e.fullPath,a=this.fsw._getWatchedDir(t);if(!this.fsw.options.followSymlinks){this.fsw._incrReadyCount();let s;try{s=await fsrealpath(n)}catch{return this.fsw._emitReady(),!0}return this.fsw.closed?void 0:(a.has(i)?this.fsw._symlinkPaths.get(o)!==s&&(this.fsw._symlinkPaths.set(o,s),this.fsw._emit(EV_CHANGE$2,n,e.stats)):(a.add(i),this.fsw._symlinkPaths.set(o,s),this.fsw._emit(EV_ADD$2,n,e.stats)),this.fsw._emitReady(),!0)}if(this.fsw._symlinkPaths.has(o))return!0;this.fsw._symlinkPaths.set(o,!0)}_handleRead(e,t,n,i,o,a,s){if(e=sysPath$2.join(e,EMPTY_STR$1),!n.hasGlob&&(s=this.fsw._throttle("readdir",e,1e3),!s))return;const u=this.fsw._getWatchedDir(n.path),l=new Set;let f=this.fsw._readdirp(e,{fileFilter:d=>n.filterPath(d),directoryFilter:d=>n.filterDir(d),depth:0}).on(STR_DATA$1,async d=>{if(this.fsw.closed){f=void 0;return}const c=d.path;let A=sysPath$2.join(e,c);if(l.add(c),!(d.stats.isSymbolicLink()&&await this._handleSymlink(d,e,A,c))){if(this.fsw.closed){f=void 0;return}(c===i||!i&&!u.has(c))&&(this.fsw._incrReadyCount(),A=sysPath$2.join(o,sysPath$2.relative(o,A)),this._addToNodeFs(A,t,n,a+1))}}).on(EV_ERROR$2,this._boundHandleError);return new Promise(d=>f.once(STR_END$2,()=>{if(this.fsw.closed){f=void 0;return}const c=s?s.clear():!1;d(),u.getChildren().filter(A=>A!==e&&!l.has(A)&&(!n.hasGlob||n.filterPath({fullPath:sysPath$2.resolve(e,A)}))).forEach(A=>{this.fsw._remove(e,A)}),f=void 0,c&&this._handleRead(e,!1,n,i,o,a,s)}))}async _handleDir(e,t,n,i,o,a,s){const u=this.fsw._getWatchedDir(sysPath$2.dirname(e)),l=u.has(sysPath$2.basename(e));!(n&&this.fsw.options.ignoreInitial)&&!o&&!l&&(!a.hasGlob||a.globFilter(e))&&this.fsw._emit(EV_ADD_DIR$2,e,t),u.add(sysPath$2.basename(e)),this.fsw._getWatchedDir(e);let f,d;const c=this.fsw.options.depth;if((c==null||i<=c)&&!this.fsw._symlinkPaths.has(s)){if(!o&&(await this._handleRead(e,n,a,o,e,i,f),this.fsw.closed))return;d=this._watchWithNodeFs(e,(A,y)=>{y&&y.mtimeMs===0||this._handleRead(A,!1,a,o,e,i,f)})}return d}async _addToNodeFs(e,t,n,i,o){const a=this.fsw._emitReady;if(this.fsw._isIgnored(e)||this.fsw.closed)return a(),!1;const s=this.fsw._getWatchHelpers(e,i);!s.hasGlob&&n&&(s.hasGlob=n.hasGlob,s.globFilter=n.globFilter,s.filterPath=u=>n.filterPath(u),s.filterDir=u=>n.filterDir(u));try{const u=await statMethods$1[s.statMethod](s.watchPath);if(this.fsw.closed)return;if(this.fsw._isIgnored(s.watchPath,u))return a(),!1;const l=this.fsw.options.followSymlinks&&!e.includes(STAR)&&!e.includes(BRACE_START$1);let f;if(u.isDirectory()){const d=sysPath$2.resolve(e),c=l?await fsrealpath(e):e;if(this.fsw.closed||(f=await this._handleDir(s.watchPath,u,t,i,o,s,c),this.fsw.closed))return;d!==c&&c!==void 0&&this.fsw._symlinkPaths.set(d,c)}else if(u.isSymbolicLink()){const d=l?await fsrealpath(e):e;if(this.fsw.closed)return;const c=sysPath$2.dirname(s.watchPath);if(this.fsw._getWatchedDir(c).add(s.watchPath),this.fsw._emit(EV_ADD$2,s.watchPath,u),f=await this._handleDir(c,u,t,i,e,s,d),this.fsw.closed)return;d!==void 0&&this.fsw._symlinkPaths.set(sysPath$2.resolve(e),d)}else f=this._handleFile(s.watchPath,u,t);return a(),this.fsw._addPathCloser(e,f),!1}catch(u){if(this.fsw._handleError(u))return a(),e}}};var nodefsHandler=NodeFsHandler$1,fseventsHandler={exports:{}};const fs$1=require$$0$1,sysPath$1=require$$0$2,{promisify:promisify$1}=require$$2$2;let fsevents;try{fsevents=require("fsevents")}catch(r){process.env.CHOKIDAR_PRINT_FSEVENTS_REQUIRE_ERROR&&console.error(r)}if(fsevents){const r=process.version.match(/v(\d+)\.(\d+)/);if(r&&r[1]&&r[2]){const e=Number.parseInt(r[1],10),t=Number.parseInt(r[2],10);e===8&&t<16&&(fsevents=void 0)}}const{EV_ADD:EV_ADD$1,EV_CHANGE:EV_CHANGE$1,EV_ADD_DIR:EV_ADD_DIR$1,EV_UNLINK:EV_UNLINK$1,EV_ERROR:EV_ERROR$1,STR_DATA,STR_END:STR_END$1,FSEVENT_CREATED,FSEVENT_MODIFIED,FSEVENT_DELETED,FSEVENT_MOVED,FSEVENT_UNKNOWN,FSEVENT_FLAG_MUST_SCAN_SUBDIRS,FSEVENT_TYPE_FILE,FSEVENT_TYPE_DIRECTORY,FSEVENT_TYPE_SYMLINK,ROOT_GLOBSTAR,DIR_SUFFIX,DOT_SLASH,FUNCTION_TYPE:FUNCTION_TYPE$1,EMPTY_FN:EMPTY_FN$1,IDENTITY_FN}=constants,Depth=r=>isNaN(r)?{}:{depth:r},stat$1=promisify$1(fs$1.stat),lstat=promisify$1(fs$1.lstat),realpath=promisify$1(fs$1.realpath),statMethods={stat:stat$1,lstat},FSEventsWatchers=new Map,consolidateThreshhold=10,wrongEventFlags=new Set([69888,70400,71424,72704,73472,131328,131840,262912]),createFSEventsInstance=(r,e)=>({stop:fsevents.watch(r,e)});function setFSEventsListener(r,e,t,n){let i=sysPath$1.extname(e)?sysPath$1.dirname(e):e;const o=sysPath$1.dirname(i);let a=FSEventsWatchers.get(i);couldConsolidate(o)&&(i=o);const s=sysPath$1.resolve(r),u=s!==e,l=(d,c,A)=>{u&&(d=d.replace(e,s)),(d===s||!d.indexOf(s+sysPath$1.sep))&&t(d,c,A)};let f=!1;for(const d of FSEventsWatchers.keys())if(e.indexOf(sysPath$1.resolve(d)+sysPath$1.sep)===0){i=d,a=FSEventsWatchers.get(i),f=!0;break}return a||f?a.listeners.add(l):(a={listeners:new Set([l]),rawEmitter:n,watcher:createFSEventsInstance(i,(d,c)=>{if(!a.listeners.size||c&FSEVENT_FLAG_MUST_SCAN_SUBDIRS)return;const A=fsevents.getInfo(d,c);a.listeners.forEach(y=>{y(d,c,A)}),a.rawEmitter(A.event,d,A)})},FSEventsWatchers.set(i,a)),()=>{const d=a.listeners;if(d.delete(l),!d.size&&(FSEventsWatchers.delete(i),a.watcher))return a.watcher.stop().then(()=>{a.rawEmitter=a.watcher=void 0,Object.freeze(a)})}}const couldConsolidate=r=>{let e=0;for(const t of FSEventsWatchers.keys())if(t.indexOf(r)===0&&(e++,e>=consolidateThreshhold))return!0;return!1},canUse=()=>fsevents&&FSEventsWatchers.size<128,calcDepth=(r,e)=>{let t=0;for(;!r.indexOf(e)&&(r=sysPath$1.dirname(r))!==e;)t++;return t},sameTypes=(r,e)=>r.type===FSEVENT_TYPE_DIRECTORY&&e.isDirectory()||r.type===FSEVENT_TYPE_SYMLINK&&e.isSymbolicLink()||r.type===FSEVENT_TYPE_FILE&&e.isFile();let FsEventsHandler$1=class{constructor(e){this.fsw=e}checkIgnored(e,t){const n=this.fsw._ignoredPaths;if(this.fsw._isIgnored(e,t))return n.add(e),t&&t.isDirectory()&&n.add(e+ROOT_GLOBSTAR),!0;n.delete(e),n.delete(e+ROOT_GLOBSTAR)}addOrChange(e,t,n,i,o,a,s,u){const l=o.has(a)?EV_CHANGE$1:EV_ADD$1;this.handleEvent(l,e,t,n,i,o,a,s,u)}async checkExists(e,t,n,i,o,a,s,u){try{const l=await stat$1(e);if(this.fsw.closed)return;sameTypes(s,l)?this.addOrChange(e,t,n,i,o,a,s,u):this.handleEvent(EV_UNLINK$1,e,t,n,i,o,a,s,u)}catch(l){l.code==="EACCES"?this.addOrChange(e,t,n,i,o,a,s,u):this.handleEvent(EV_UNLINK$1,e,t,n,i,o,a,s,u)}}handleEvent(e,t,n,i,o,a,s,u,l){if(!(this.fsw.closed||this.checkIgnored(t)))if(e===EV_UNLINK$1){const f=u.type===FSEVENT_TYPE_DIRECTORY;(f||a.has(s))&&this.fsw._remove(o,s,f)}else{if(e===EV_ADD$1){if(u.type===FSEVENT_TYPE_DIRECTORY&&this.fsw._getWatchedDir(t),u.type===FSEVENT_TYPE_SYMLINK&&l.followSymlinks){const d=l.depth===void 0?void 0:calcDepth(n,i)+1;return this._addToFsEvents(t,!1,!0,d)}this.fsw._getWatchedDir(o).add(s)}const f=u.type===FSEVENT_TYPE_DIRECTORY?e+DIR_SUFFIX:e;this.fsw._emit(f,t),f===EV_ADD_DIR$1&&this._addToFsEvents(t,!1,!0)}}_watchWithFsEvents(e,t,n,i){if(this.fsw.closed||this.fsw._isIgnored(e))return;const o=this.fsw.options,s=setFSEventsListener(e,t,async(u,l,f)=>{if(this.fsw.closed||o.depth!==void 0&&calcDepth(u,t)>o.depth)return;const d=n(sysPath$1.join(e,sysPath$1.relative(e,u)));if(i&&!i(d))return;const c=sysPath$1.dirname(d),A=sysPath$1.basename(d),y=this.fsw._getWatchedDir(f.type===FSEVENT_TYPE_DIRECTORY?d:c);if(wrongEventFlags.has(l)||f.event===FSEVENT_UNKNOWN)if(typeof o.ignored===FUNCTION_TYPE$1){let w;try{w=await stat$1(d)}catch{}if(this.fsw.closed||this.checkIgnored(d,w))return;sameTypes(f,w)?this.addOrChange(d,u,t,c,y,A,f,o):this.handleEvent(EV_UNLINK$1,d,u,t,c,y,A,f,o)}else this.checkExists(d,u,t,c,y,A,f,o);else switch(f.event){case FSEVENT_CREATED:case FSEVENT_MODIFIED:return this.addOrChange(d,u,t,c,y,A,f,o);case FSEVENT_DELETED:case FSEVENT_MOVED:return this.checkExists(d,u,t,c,y,A,f,o)}},this.fsw._emitRaw);return this.fsw._emitReady(),s}async _handleFsEventsSymlink(e,t,n,i){if(!(this.fsw.closed||this.fsw._symlinkPaths.has(t))){this.fsw._symlinkPaths.set(t,!0),this.fsw._incrReadyCount();try{const o=await realpath(e);if(this.fsw.closed)return;if(this.fsw._isIgnored(o))return this.fsw._emitReady();this.fsw._incrReadyCount(),this._addToFsEvents(o||e,a=>{let s=e;return o&&o!==DOT_SLASH?s=a.replace(o,e):a!==DOT_SLASH&&(s=sysPath$1.join(e,a)),n(s)},!1,i)}catch(o){if(this.fsw._handleError(o))return this.fsw._emitReady()}}}emitAdd(e,t,n,i,o){const a=n(e),s=t.isDirectory(),u=this.fsw._getWatchedDir(sysPath$1.dirname(a)),l=sysPath$1.basename(a);s&&this.fsw._getWatchedDir(a),!u.has(l)&&(u.add(l),(!i.ignoreInitial||o===!0)&&this.fsw._emit(s?EV_ADD_DIR$1:EV_ADD$1,a,t))}initWatch(e,t,n,i){if(this.fsw.closed)return;const o=this._watchWithFsEvents(n.watchPath,sysPath$1.resolve(e||n.watchPath),i,n.globFilter);this.fsw._addPathCloser(t,o)}async _addToFsEvents(e,t,n,i){if(this.fsw.closed)return;const o=this.fsw.options,a=typeof t===FUNCTION_TYPE$1?t:IDENTITY_FN,s=this.fsw._getWatchHelpers(e);try{const u=await statMethods[s.statMethod](s.watchPath);if(this.fsw.closed)return;if(this.fsw._isIgnored(s.watchPath,u))throw null;if(u.isDirectory()){if(s.globFilter||this.emitAdd(a(e),u,a,o,n),i&&i>o.depth)return;this.fsw._readdirp(s.watchPath,{fileFilter:l=>s.filterPath(l),directoryFilter:l=>s.filterDir(l),...Depth(o.depth-(i||0))}).on(STR_DATA,l=>{if(this.fsw.closed||l.stats.isDirectory()&&!s.filterPath(l))return;const f=sysPath$1.join(s.watchPath,l.path),{fullPath:d}=l;if(s.followSymlinks&&l.stats.isSymbolicLink()){const c=o.depth===void 0?void 0:calcDepth(f,sysPath$1.resolve(s.watchPath))+1;this._handleFsEventsSymlink(f,d,a,c)}else this.emitAdd(f,l.stats,a,o,n)}).on(EV_ERROR$1,EMPTY_FN$1).on(STR_END$1,()=>{this.fsw._emitReady()})}else this.emitAdd(s.watchPath,u,a,o,n),this.fsw._emitReady()}catch(u){(!u||this.fsw._handleError(u))&&(this.fsw._emitReady(),this.fsw._emitReady())}if(o.persistent&&n!==!0)if(typeof t===FUNCTION_TYPE$1)this.initWatch(void 0,e,s,a);else{let u;try{u=await realpath(s.watchPath)}catch{}this.initWatch(u,e,s,a)}}};fseventsHandler.exports=FsEventsHandler$1;fseventsHandler.exports.canUse=canUse;var fseventsHandlerExports=fseventsHandler.exports;const{EventEmitter}=require$$2$1,fs=require$$0$1,sysPath=require$$0$2,{promisify}=require$$2$2,readdirp=readdirp_1,anymatch=anymatchExports.default,globParent=globParent$1,isGlob=isGlob$2,braces=braces_1,normalizePath=normalizePath$2,NodeFsHandler=nodefsHandler,FsEventsHandler=fseventsHandlerExports,{EV_ALL,EV_READY,EV_ADD,EV_CHANGE,EV_UNLINK,EV_ADD_DIR,EV_UNLINK_DIR,EV_RAW,EV_ERROR,STR_CLOSE,STR_END,BACK_SLASH_RE,DOUBLE_SLASH_RE,SLASH_OR_BACK_SLASH_RE,DOT_RE,REPLACER_RE,SLASH,SLASH_SLASH,BRACE_START,BANG,ONE_DOT,TWO_DOTS,GLOBSTAR,SLASH_GLOBSTAR,ANYMATCH_OPTS,STRING_TYPE,FUNCTION_TYPE,EMPTY_STR,EMPTY_FN,isWindows,isMacos,isIBMi}=constants,stat=promisify(fs.stat),readdir=promisify(fs.readdir),arrify=(r=[])=>Array.isArray(r)?r:[r],flatten=(r,e=[])=>(r.forEach(t=>{Array.isArray(t)?flatten(t,e):e.push(t)}),e),unifyPaths=r=>{const e=flatten(arrify(r));if(!e.every(t=>typeof t===STRING_TYPE))throw new TypeError(`Non-string provided as watch path: ${e}`);return e.map(normalizePathToUnix)},toUnix=r=>{let e=r.replace(BACK_SLASH_RE,SLASH),t=!1;for(e.startsWith(SLASH_SLASH)&&(t=!0);e.match(DOUBLE_SLASH_RE);)e=e.replace(DOUBLE_SLASH_RE,SLASH);return t&&(e=SLASH+e),e},normalizePathToUnix=r=>toUnix(sysPath.normalize(toUnix(r))),normalizeIgnored=(r=EMPTY_STR)=>e=>typeof e!==STRING_TYPE?e:normalizePathToUnix(sysPath.isAbsolute(e)?e:sysPath.join(r,e)),getAbsolutePath=(r,e)=>sysPath.isAbsolute(r)?r:r.startsWith(BANG)?BANG+sysPath.join(e,r.slice(1)):sysPath.join(e,r),undef=(r,e)=>r[e]===void 0;class DirEntry{constructor(e,t){this.path=e,this._removeWatcher=t,this.items=new Set}add(e){const{items:t}=this;t&&e!==ONE_DOT&&e!==TWO_DOTS&&t.add(e)}async remove(e){const{items:t}=this;if(!t||(t.delete(e),t.size>0))return;const n=this.path;try{await readdir(n)}catch{this._removeWatcher&&this._removeWatcher(sysPath.dirname(n),sysPath.basename(n))}}has(e){const{items:t}=this;if(t)return t.has(e)}getChildren(){const{items:e}=this;if(e)return[...e.values()]}dispose(){this.items.clear(),delete this.path,delete this._removeWatcher,delete this.items,Object.freeze(this)}}const STAT_METHOD_F="stat",STAT_METHOD_L="lstat";class WatchHelper{constructor(e,t,n,i){this.fsw=i,this.path=e=e.replace(REPLACER_RE,EMPTY_STR),this.watchPath=t,this.fullWatchPath=sysPath.resolve(t),this.hasGlob=t!==e,e===EMPTY_STR&&(this.hasGlob=!1),this.globSymlink=this.hasGlob&&n?void 0:!1,this.globFilter=this.hasGlob?anymatch(e,void 0,ANYMATCH_OPTS):!1,this.dirParts=this.getDirParts(e),this.dirParts.forEach(o=>{o.length>1&&o.pop()}),this.followSymlinks=n,this.statMethod=n?STAT_METHOD_F:STAT_METHOD_L}checkGlobSymlink(e){return this.globSymlink===void 0&&(this.globSymlink=e.fullParentDir===this.fullWatchPath?!1:{realPath:e.fullParentDir,linkPath:this.fullWatchPath}),this.globSymlink?e.fullPath.replace(this.globSymlink.realPath,this.globSymlink.linkPath):e.fullPath}entryPath(e){return sysPath.join(this.watchPath,sysPath.relative(this.watchPath,this.checkGlobSymlink(e)))}filterPath(e){const{stats:t}=e;if(t&&t.isSymbolicLink())return this.filterDir(e);const n=this.entryPath(e);return(this.hasGlob&&typeof this.globFilter===FUNCTION_TYPE?this.globFilter(n):!0)&&this.fsw._isntIgnored(n,t)&&this.fsw._hasReadPermissions(t)}getDirParts(e){if(!this.hasGlob)return[];const t=[];return(e.includes(BRACE_START)?braces.expand(e):[e]).forEach(i=>{t.push(sysPath.relative(this.watchPath,i).split(SLASH_OR_BACK_SLASH_RE))}),t}filterDir(e){if(this.hasGlob){const t=this.getDirParts(this.checkGlobSymlink(e));let n=!1;this.unmatchedGlob=!this.dirParts.some(i=>i.every((o,a)=>(o===GLOBSTAR&&(n=!0),n||!t[0][a]||anymatch(o,t[0][a],ANYMATCH_OPTS))))}return!this.unmatchedGlob&&this.fsw._isntIgnored(this.entryPath(e),e.stats)}}class FSWatcher extends EventEmitter{constructor(e){super();const t={};e&&Object.assign(t,e),this._watched=new Map,this._closers=new Map,this._ignoredPaths=new Set,this._throttled=new Map,this._symlinkPaths=new Map,this._streams=new Set,this.closed=!1,undef(t,"persistent")&&(t.persistent=!0),undef(t,"ignoreInitial")&&(t.ignoreInitial=!1),undef(t,"ignorePermissionErrors")&&(t.ignorePermissionErrors=!1),undef(t,"interval")&&(t.interval=100),undef(t,"binaryInterval")&&(t.binaryInterval=300),undef(t,"disableGlobbing")&&(t.disableGlobbing=!1),t.enableBinaryInterval=t.binaryInterval!==t.interval,undef(t,"useFsEvents")&&(t.useFsEvents=!t.usePolling),FsEventsHandler.canUse()||(t.useFsEvents=!1),undef(t,"usePolling")&&!t.useFsEvents&&(t.usePolling=isMacos),isIBMi&&(t.usePolling=!0);const i=process.env.CHOKIDAR_USEPOLLING;if(i!==void 0){const u=i.toLowerCase();u==="false"||u==="0"?t.usePolling=!1:u==="true"||u==="1"?t.usePolling=!0:t.usePolling=!!u}const o=process.env.CHOKIDAR_INTERVAL;o&&(t.interval=Number.parseInt(o,10)),undef(t,"atomic")&&(t.atomic=!t.usePolling&&!t.useFsEvents),t.atomic&&(this._pendingUnlinks=new Map),undef(t,"followSymlinks")&&(t.followSymlinks=!0),undef(t,"awaitWriteFinish")&&(t.awaitWriteFinish=!1),t.awaitWriteFinish===!0&&(t.awaitWriteFinish={});const a=t.awaitWriteFinish;a&&(a.stabilityThreshold||(a.stabilityThreshold=2e3),a.pollInterval||(a.pollInterval=100),this._pendingWrites=new Map),t.ignored&&(t.ignored=arrify(t.ignored));let s=0;this._emitReady=()=>{s++,s>=this._readyCount&&(this._emitReady=EMPTY_FN,this._readyEmitted=!0,process.nextTick(()=>this.emit(EV_READY)))},this._emitRaw=(...u)=>this.emit(EV_RAW,...u),this._readyEmitted=!1,this.options=t,t.useFsEvents?this._fsEventsHandler=new FsEventsHandler(this):this._nodeFsHandler=new NodeFsHandler(this),Object.freeze(t)}add(e,t,n){const{cwd:i,disableGlobbing:o}=this.options;this.closed=!1;let a=unifyPaths(e);return i&&(a=a.map(s=>{const u=getAbsolutePath(s,i);return o||!isGlob(s)?u:normalizePath(u)})),a=a.filter(s=>s.startsWith(BANG)?(this._ignoredPaths.add(s.slice(1)),!1):(this._ignoredPaths.delete(s),this._ignoredPaths.delete(s+SLASH_GLOBSTAR),this._userIgnored=void 0,!0)),this.options.useFsEvents&&this._fsEventsHandler?(this._readyCount||(this._readyCount=a.length),this.options.persistent&&(this._readyCount+=a.length),a.forEach(s=>this._fsEventsHandler._addToFsEvents(s))):(this._readyCount||(this._readyCount=0),this._readyCount+=a.length,Promise.all(a.map(async s=>{const u=await this._nodeFsHandler._addToNodeFs(s,!n,0,0,t);return u&&this._emitReady(),u})).then(s=>{this.closed||s.filter(u=>u).forEach(u=>{this.add(sysPath.dirname(u),sysPath.basename(t||u))})})),this}unwatch(e){if(this.closed)return this;const t=unifyPaths(e),{cwd:n}=this.options;return t.forEach(i=>{!sysPath.isAbsolute(i)&&!this._closers.has(i)&&(n&&(i=sysPath.join(n,i)),i=sysPath.resolve(i)),this._closePath(i),this._ignoredPaths.add(i),this._watched.has(i)&&this._ignoredPaths.add(i+SLASH_GLOBSTAR),this._userIgnored=void 0}),this}close(){if(this.closed)return this._closePromise;this.closed=!0,this.removeAllListeners();const e=[];return this._closers.forEach(t=>t.forEach(n=>{const i=n();i instanceof Promise&&e.push(i)})),this._streams.forEach(t=>t.destroy()),this._userIgnored=void 0,this._readyCount=0,this._readyEmitted=!1,this._watched.forEach(t=>t.dispose()),["closers","watched","streams","symlinkPaths","throttled"].forEach(t=>{this[`_${t}`].clear()}),this._closePromise=e.length?Promise.all(e).then(()=>{}):Promise.resolve(),this._closePromise}getWatched(){const e={};return this._watched.forEach((t,n)=>{const i=this.options.cwd?sysPath.relative(this.options.cwd,n):n;e[i||ONE_DOT]=t.getChildren().sort()}),e}emitWithAll(e,t){this.emit(...t),e!==EV_ERROR&&this.emit(EV_ALL,...t)}async _emit(e,t,n,i,o){if(this.closed)return;const a=this.options;isWindows&&(t=sysPath.normalize(t)),a.cwd&&(t=sysPath.relative(a.cwd,t));const s=[e,t];o!==void 0?s.push(n,i,o):i!==void 0?s.push(n,i):n!==void 0&&s.push(n);const u=a.awaitWriteFinish;let l;if(u&&(l=this._pendingWrites.get(t)))return l.lastChange=new Date,this;if(a.atomic){if(e===EV_UNLINK)return this._pendingUnlinks.set(t,s),setTimeout(()=>{this._pendingUnlinks.forEach((f,d)=>{this.emit(...f),this.emit(EV_ALL,...f),this._pendingUnlinks.delete(d)})},typeof a.atomic=="number"?a.atomic:100),this;e===EV_ADD&&this._pendingUnlinks.has(t)&&(e=s[0]=EV_CHANGE,this._pendingUnlinks.delete(t))}if(u&&(e===EV_ADD||e===EV_CHANGE)&&this._readyEmitted){const f=(d,c)=>{d?(e=s[0]=EV_ERROR,s[1]=d,this.emitWithAll(e,s)):c&&(s.length>2?s[2]=c:s.push(c),this.emitWithAll(e,s))};return this._awaitWriteFinish(t,u.stabilityThreshold,e,f),this}if(e===EV_CHANGE&&!this._throttle(EV_CHANGE,t,50))return this;if(a.alwaysStat&&n===void 0&&(e===EV_ADD||e===EV_ADD_DIR||e===EV_CHANGE)){const f=a.cwd?sysPath.join(a.cwd,t):t;let d;try{d=await stat(f)}catch{}if(!d||this.closed)return;s.push(d)}return this.emitWithAll(e,s),this}_handleError(e){const t=e&&e.code;return e&&t!=="ENOENT"&&t!=="ENOTDIR"&&(!this.options.ignorePermissionErrors||t!=="EPERM"&&t!=="EACCES")&&this.emit(EV_ERROR,e),e||this.closed}_throttle(e,t,n){this._throttled.has(e)||this._throttled.set(e,new Map);const i=this._throttled.get(e),o=i.get(t);if(o)return o.count++,!1;let a;const s=()=>{const l=i.get(t),f=l?l.count:0;return i.delete(t),clearTimeout(a),l&&clearTimeout(l.timeoutObject),f};a=setTimeout(s,n);const u={timeoutObject:a,clear:s,count:0};return i.set(t,u),u}_incrReadyCount(){return this._readyCount++}_awaitWriteFinish(e,t,n,i){let o,a=e;this.options.cwd&&!sysPath.isAbsolute(e)&&(a=sysPath.join(this.options.cwd,e));const s=new Date,u=l=>{fs.stat(a,(f,d)=>{if(f||!this._pendingWrites.has(e)){f&&f.code!=="ENOENT"&&i(f);return}const c=Number(new Date);l&&d.size!==l.size&&(this._pendingWrites.get(e).lastChange=c);const A=this._pendingWrites.get(e);c-A.lastChange>=t?(this._pendingWrites.delete(e),i(void 0,d)):o=setTimeout(u,this.options.awaitWriteFinish.pollInterval,d)})};this._pendingWrites.has(e)||(this._pendingWrites.set(e,{lastChange:s,cancelWait:()=>(this._pendingWrites.delete(e),clearTimeout(o),n)}),o=setTimeout(u,this.options.awaitWriteFinish.pollInterval))}_getGlobIgnored(){return[...this._ignoredPaths.values()]}_isIgnored(e,t){if(this.options.atomic&&DOT_RE.test(e))return!0;if(!this._userIgnored){const{cwd:n}=this.options,i=this.options.ignored,o=i&&i.map(normalizeIgnored(n)),a=arrify(o).filter(u=>typeof u===STRING_TYPE&&!isGlob(u)).map(u=>u+SLASH_GLOBSTAR),s=this._getGlobIgnored().map(normalizeIgnored(n)).concat(o,a);this._userIgnored=anymatch(s,void 0,ANYMATCH_OPTS)}return this._userIgnored([e,t])}_isntIgnored(e,t){return!this._isIgnored(e,t)}_getWatchHelpers(e,t){const n=t||this.options.disableGlobbing||!isGlob(e)?e:globParent(e),i=this.options.followSymlinks;return new WatchHelper(e,n,i,this)}_getWatchedDir(e){this._boundRemove||(this._boundRemove=this._remove.bind(this));const t=sysPath.resolve(e);return this._watched.has(t)||this._watched.set(t,new DirEntry(t,this._boundRemove)),this._watched.get(t)}_hasReadPermissions(e){if(this.options.ignorePermissionErrors)return!0;const n=(e&&Number.parseInt(e.mode,10))&511;return!!(4&Number.parseInt(n.toString(8)[0],10))}_remove(e,t,n){const i=sysPath.join(e,t),o=sysPath.resolve(i);if(n=n??(this._watched.has(i)||this._watched.has(o)),!this._throttle("remove",i,100))return;!n&&!this.options.useFsEvents&&this._watched.size===1&&this.add(e,t,!0),this._getWatchedDir(i).getChildren().forEach(c=>this._remove(i,c));const u=this._getWatchedDir(e),l=u.has(t);u.remove(t),this._symlinkPaths.has(o)&&this._symlinkPaths.delete(o);let f=i;if(this.options.cwd&&(f=sysPath.relative(this.options.cwd,i)),this.options.awaitWriteFinish&&this._pendingWrites.has(f)&&this._pendingWrites.get(f).cancelWait()===EV_ADD)return;this._watched.delete(i),this._watched.delete(o);const d=n?EV_UNLINK_DIR:EV_UNLINK;l&&!this._isIgnored(i)&&this._emit(d,i),this.options.useFsEvents||this._closePath(i)}_closePath(e){this._closeFile(e);const t=sysPath.dirname(e);this._getWatchedDir(t).remove(sysPath.basename(e))}_closeFile(e){const t=this._closers.get(e);t&&(t.forEach(n=>n()),this._closers.delete(e))}_addPathCloser(e,t){if(!t)return;let n=this._closers.get(e);n||(n=[],this._closers.set(e,n)),n.push(t)}_readdirp(e,t){if(this.closed)return;const n={type:EV_ALL,alwaysStat:!0,lstat:!0,...t};let i=readdirp(e,n);return this._streams.add(i),i.once(STR_CLOSE,()=>{i=void 0}),i.once(STR_END,()=>{i&&(this._streams.delete(i),i=void 0)}),i}}chokidar.FSWatcher=FSWatcher;const watch=(r,e)=>{const t=new FSWatcher(e);return t.add(r),t};chokidar.watch=watch;const appPath=process.argv[1]||process.cwd(),appDir=require$$0$2.dirname(appPath),dragIconPaths=[require$$0$2.join(appDir,"..","..","..","64x64.png"),require$$0$2.join(process.resourcesPath,"64x64.png"),require$$0$2.join(process.resourcesPath,"app.asar","64x64.png"),require$$0$2.join(electron.app.getAppPath(),"64x64.png")],dragIconPath=dragIconPaths.find(r=>require$$0$1.existsSync(r))||dragIconPaths[0];electron.app.disableHardwareAcceleration();process.on("uncaughtException",r=>{console.error("Uncaught Exception:",r)});process.on("unhandledRejection",(r,e)=>{console.error("Unhandled Rejection at:",e,"reason:",r)});electron.app.disableHardwareAcceleration();let mainWindow=null,tray=null,isQuitting=!1,backendProcess=null;const getBackendPaths=()=>{const r=!isDev;return{backendPath:r?require$$0$2.join(process.resourcesPath,"bin","ClipVault.exe"):require$$0$2.join(appDir,"..","..","..","bin","ClipVault.exe"),backendLogPath:r?require$$0$2.join(process.resourcesPath,"bin","clipvault.log"):require$$0$2.join(appDir,"..","..","..","bin","clipvault.log")}};function startBackend(){const{backendPath:r}=getBackendPaths();if(!require$$0$1.existsSync(r))return console.warn("Backend executable not found:",r),!1;try{console.log("Spawning backend from:",r);const e=require$$0$3.spawn(r,[],{detached:!0,stdio:["ignore","ignore","ignore"]});return e.on("error",t=>{console.error("Backend spawn error:",t)}),e.on("exit",(t,n)=>{console.log(`Backend exited with code ${t} and signal ${n}`),backendProcess===e&&(backendProcess=null)}),console.log("Backend spawned with PID:",e.pid),backendProcess=e,e.unref(),!0}catch(e){return console.error("Failed to start backend:",e),!1}}function killBackend(){if(!backendProcess)try{return require$$0$3.execSync('taskkill /F /IM ClipVault.exe /FI "WINDOWTITLE eq ClipVault"',{stdio:"ignore"}),console.log("Killed existing backend processes"),!0}catch{return!1}try{return console.log("Killing backend process with PID:",backendProcess.pid),backendProcess.kill(),backendProcess=null,!0}catch(r){return console.error("Failed to kill backend:",r),!1}}async function restartBackend(){return console.log("Restarting backend..."),killBackend(),await new Promise(r=>setTimeout(r,1e3)),startBackend()}const isDev=process.env.NODE_ENV==="development",thumbnailsPath=require$$0$2.join(electron.app.getPath("userData"),"thumbnails"),DEFAULT_CLIPS_PATH="D:\\Clips\\ClipVault";function getClipsPath(){try{const r=getSettingsPath();if(require$$0$1.existsSync(r)){const e=require$$0$1.readFileSync(r,"utf-8"),t=JSON.parse(e);if(t.output_path&&typeof t.output_path=="string")return t.output_path}}catch(r){console.error("Failed to read clips path from settings:",r)}return DEFAULT_CLIPS_PATH}const ffmpegPath=require$$0$2.join(process.resourcesPath,"ffmpeg","ffmpeg.exe"),ffprobePath=require$$0$2.join(process.resourcesPath,"ffmpeg","ffprobe.exe");require$$0$1.existsSync(ffmpegPath)&&(process.env.PATH=`${require$$0$2.dirname(ffmpegPath)}:${process.env.PATH}`,console.log("Using bundled FFmpeg:",ffmpegPath));require$$0$1.existsSync(ffprobePath)&&console.log("Using bundled FFprobe:",ffprobePath);console.log("Config:",{clipsPath:getClipsPath(),thumbnailsPath,userData:electron.app.getPath("userData")});const isStartupMode=process.argv.includes("--startup");console.log("[Main] Startup mode:",isStartupMode);const gotTheLock=electron.app.requestSingleInstanceLock();gotTheLock?electron.app.on("second-instance",(r,e)=>{console.log("Second instance detected, focusing existing window and checking backend"),!mainWindow&&!e.includes("--startup")?(console.log("Second instance: Creating window (was in startup mode)"),createWindow()):mainWindow&&(mainWindow.isMinimized()&&mainWindow.restore(),mainWindow.show(),mainWindow.focus());const n=!isDev?require$$0$2.join(process.resourcesPath,"bin","ClipVault.exe"):require$$0$2.join(appDir,"..","..","..","bin","ClipVault.exe");if(require$$0$1.existsSync(n))try{console.log("Second instance: Spawning backend from:",n);const i=require$$0$3.spawn(n,[],{detached:!0,stdio:["ignore","ignore","ignore"]});i.unref(),console.log("Second instance: Backend spawn attempted with PID:",i.pid)}catch(i){console.error("Second instance: Failed to start backend:",i)}}):(console.log("Another instance is already running. Quitting."),electron.app.quit());electron.protocol.registerSchemesAsPrivileged([{scheme:"clipvault",privileges:{secure:!0,supportFetchAPI:!0,bypassCSP:!0,corsEnabled:!0}}]);function createTray(){console.log("Creating tray icon...");let r;require$$0$1.existsSync(dragIconPath)&&(r=electron.nativeImage.createFromPath(dragIconPath),r.isEmpty()&&(r=void 0)),r||(r=electron.nativeImage.createFromPath(require$$0$2.join(appDir,"..","renderer","favicon.ico")),r!=null&&r.isEmpty()&&(r=void 0)),tray=new electron.Tray(r||electron.nativeImage.createEmpty()),tray.setToolTip("ClipVault Editor"),tray.setContextMenu(electron.Menu.buildFromTemplate([{label:"Open ClipVault",click:()=>{mainWindow&&(mainWindow.show(),mainWindow.focus())}},{label:"Open Clips Folder",click:async()=>{const e=getClipsPath();require$$0$1.existsSync(e)||await promises.mkdir(e,{recursive:!0}),await electron.shell.openPath(e)}},{type:"separator"},{label:"Exit",click:()=>{electron.app.quit()}}])),tray.on("click",()=>{mainWindow?mainWindow.isVisible()?mainWindow.hide():(mainWindow.show(),mainWindow.focus()):createWindow()}),tray.on("double-click",()=>{mainWindow&&(mainWindow.show(),mainWindow.focus())}),console.log("Tray icon created")}async function createWindow(){console.log("Creating main window..."),mainWindow=new electron.BrowserWindow({width:1400,height:900,minWidth:1e3,minHeight:600,title:"ClipVault Editor",backgroundColor:"#0f0f0f",show:!0,webPreferences:{preload:isDev?require$$0$2.join(appDir,"..","preload","index.js"):require$$0$2.join(process.resourcesPath,"app.asar","dist","preload","index.js"),contextIsolation:!0,nodeIntegration:!1,sandbox:!1,webSecurity:!1},titleBarStyle:"hiddenInset",...process.platform==="win32"?{titleBarOverlay:{color:"#0f0f0f",symbolColor:"#ffffff"}}:{}}),console.log("Main window created, loading content...");try{isDev?(await mainWindow.loadURL("http://localhost:5173"),console.log("Loaded dev URL, opening devtools..."),mainWindow.webContents.openDevTools()):(await mainWindow.loadFile(isDev?require$$0$2.join(appDir,"..","renderer","index.html"):require$$0$2.join(process.resourcesPath,"app.asar","dist","renderer","index.html")),console.log("Loaded production HTML file"))}catch(r){console.error("Error loading window content:",r)}electron.Menu.setApplicationMenu(null),mainWindow.webContents.on("crashed",(r,e)=>{console.error("Window crashed!",{killed:e}),e||mainWindow==null||mainWindow.reload()}),electron.app.on("gpu-process-crashed",(r,e)=>{console.error("GPU process crashed!",{killed:e})}),mainWindow.once("ready-to-show",()=>{console.log("Window ready to show, showing now..."),mainWindow==null||mainWindow.show(),mainWindow==null||mainWindow.focus()}),setTimeout(()=>{mainWindow&&!mainWindow.isVisible()&&(console.log("Fallback: forcing window to show after timeout"),mainWindow.show(),mainWindow.focus())},2e3),mainWindow.on("close",r=>{isQuitting||(r.preventDefault(),console.log("Minimizing to tray instead of closing"),mainWindow==null||mainWindow.hide())}),mainWindow.on("page-title-updated",r=>{r.preventDefault()}),mainWindow.on("closed",()=>{mainWindow=null}),mainWindow.webContents.on("before-input-event",(r,e)=>{e.key==="F12"&&(mainWindow==null||mainWindow.webContents.toggleDevTools(),r.preventDefault())})}const getSettingsPath=()=>{const r=process.env.APPDATA||electron.app.getPath("appData");return require$$0$2.join(r,"ClipVault","settings.json")},defaultSettings={output_path:"D:\\Clips\\ClipVault",buffer_seconds:120,video:{width:1920,height:1080,fps:60,encoder:"auto",quality:20},audio:{sample_rate:48e3,bitrate:160,system_audio_enabled:!0,microphone_enabled:!0},hotkey:{save_clip:"F9"},ui:{show_notifications:!0,minimize_to_tray:!0,start_with_windows:!1}};electron.ipcMain.handle("settings:get",async()=>{try{const r=getSettingsPath();if(console.log("Settings path:",r),!require$$0$1.existsSync(r))return console.log("Settings file not found, returning defaults"),defaultSettings;console.log("Reading settings from:",r);const e=await promises.readFile(r,"utf-8");try{return JSON.parse(e)}catch(t){return console.error("JSON parse error, returning defaults:",t),defaultSettings}}catch(r){return console.error("Failed to read settings:",r),defaultSettings}});electron.ipcMain.handle("settings:save",async(r,e)=>{try{const t=getSettingsPath(),n=require$$0$2.join(electron.app.getPath("appData"),"ClipVault");return require$$0$1.existsSync(n)||await promises.mkdir(n,{recursive:!0}),await promises.writeFile(t,JSON.stringify(e,null,2),"utf-8"),console.log("Settings saved to:",t),console.log("Settings saved, restarting backend..."),{success:!0,restarted:await restartBackend()}}catch(t){throw console.error("Failed to save settings:",t),t}});electron.ipcMain.handle("backend:restart",async()=>{try{return{success:!0,restarted:await restartBackend()}}catch(r){throw console.error("Failed to restart backend:",r),r}});electron.ipcMain.handle("settings:setStartup",async(r,e)=>{try{const t=process.execPath,n="ClipVault";if(e){const{exec:i}=require("child_process"),o=`"${t}"`,a=`reg add "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run" /v "${n}" /t REG_SZ /d "${o} --startup" /f`;i(a,s=>{s?console.error("Failed to add startup registry:",s):console.log("[Startup] Added ClipVault to Windows startup (background mode)")})}else{const{exec:i}=require("child_process"),o=`reg delete "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run" /v "${n}" /f`;i(o,a=>{a?console.error("Failed to remove startup registry:",a):console.log("[Startup] Removed ClipVault from Windows startup")})}return{success:!0}}catch(t){return console.error("Failed to set startup:",t),{success:!1,error:String(t)}}});electron.ipcMain.handle("system:getMonitors",async()=>{try{return electron.screen.getAllDisplays().map((e,t)=>({id:t,name:`Monitor ${t+1}`,width:e.bounds.width,height:e.bounds.height,x:e.bounds.x,y:e.bounds.y,primary:e.bounds.x===0&&e.bounds.y===0}))}catch(r){throw console.error("Failed to get monitors:",r),r}});electron.ipcMain.handle("clips:getList",async()=>{try{if(!require$$0$1.existsSync(getClipsPath()))return await promises.mkdir(getClipsPath(),{recursive:!0}),[];const r=await promises.readdir(getClipsPath());return(await Promise.all(r.filter(t=>t.endsWith(".mp4")).map(async t=>{const n=require$$0$2.join(getClipsPath(),t),i=await promises.stat(n),o=n.replace(".mp4",".clipvault.json");let a=null;try{if(require$$0$1.existsSync(o)){const s=await promises.readFile(o,"utf-8");a=JSON.parse(s)}}catch(s){console.error("Failed to read metadata:",s)}return{id:t.replace(".mp4",""),filename:t,path:n,size:i.size,createdAt:i.birthtime.toISOString(),modifiedAt:i.mtime.toISOString(),metadata:a}}))).sort((t,n)=>new Date(n.createdAt).getTime()-new Date(t.createdAt).getTime())}catch(r){throw console.error("Failed to get clips list:",r),r}});electron.ipcMain.handle("clips:saveMetadata",async(r,e,t)=>{try{const n=require$$0$2.join(getClipsPath(),`${e}.clipvault.json`);return await promises.writeFile(n,JSON.stringify(t,null,2),"utf-8"),!0}catch(n){throw console.error("Failed to save metadata:",n),n}});electron.ipcMain.handle("clips:getMetadata",async(r,e)=>{try{const t=require$$0$2.join(getClipsPath(),`${e}.clipvault.json`);if(!require$$0$1.existsSync(t))return null;const n=await promises.readFile(t,"utf-8");return JSON.parse(n)}catch(t){return console.error("Failed to get metadata:",t),null}});electron.ipcMain.handle("editor:saveState",async(r,e,t)=>{try{const n=require$$0$2.join(getClipsPath(),"clips-metadata");require$$0$1.existsSync(n)||await promises.mkdir(n,{recursive:!0});const i=require$$0$2.join(n,`${e}.editor.json`);return await promises.writeFile(i,JSON.stringify(t,null,2),"utf-8"),console.log(`[Editor] Saved state for clip ${e}`),!0}catch(n){throw console.error("Failed to save editor state:",n),n}});electron.ipcMain.handle("editor:loadState",async(r,e)=>{try{const t=require$$0$2.join(getClipsPath(),"clips-metadata"),n=require$$0$2.join(t,`${e}.editor.json`);if(!require$$0$1.existsSync(n))return null;const i=await promises.readFile(n,"utf-8");return console.log(`[Editor] Loaded state for clip ${e}`),JSON.parse(i)}catch(t){return console.error("Failed to load editor state:",t),null}});electron.ipcMain.handle("system:openFolder",async()=>{await electron.shell.openPath(getClipsPath())});electron.ipcMain.handle("dialog:save",async(r,e)=>mainWindow?await electron.dialog.showSaveDialog(mainWindow,e):null);electron.ipcMain.handle("clips:generateThumbnail",async(r,e,t)=>{try{require$$0$1.existsSync(thumbnailsPath)||await promises.mkdir(thumbnailsPath,{recursive:!0});const n=`${e}.jpg`,i=require$$0$2.join(thumbnailsPath,n);return require$$0$1.existsSync(i)?`clipvault://thumb/${encodeURIComponent(n)}`:new Promise((o,a)=>{ffmpeg(t).screenshots({timestamps:["10%"],filename:n,folder:thumbnailsPath,size:"480x270"}).on("end",()=>{o(`clipvault://thumb/${encodeURIComponent(n)}`)}).on("error",s=>{console.error("FFmpeg error:",s),a(s)})})}catch(n){throw console.error("Failed to generate thumbnail:",n),n}});electron.ipcMain.handle("video:getFileUrl",async(r,e)=>{try{const t=require$$0$2.join(getClipsPath(),e);if(!require$$0$1.existsSync(t))return console.error("Video file not found:",t),{success:!1,error:"File not found"};const n=`file:///${t.replace(/\\/g,"/")}`;return console.log("Returning video file URL:",n),{success:!0,url:n,path:t}}catch(t){return console.error("Error getting video file URL:",t),{success:!1,error:String(t)}}});electron.ipcMain.handle("clips:getVideoMetadata",async(_,videoPath)=>{try{return new Promise((resolve,reject)=>{ffmpeg.ffprobe(videoPath,(err,metadata)=>{if(err){reject(err);return}const videoStream=metadata.streams.find(r=>r.codec_type==="video"),audioStreams=metadata.streams.filter(r=>r.codec_type==="audio");resolve({duration:metadata.format.duration||0,width:(videoStream==null?void 0:videoStream.width)||0,height:(videoStream==null?void 0:videoStream.height)||0,fps:videoStream?eval(videoStream.r_frame_rate||"0"):0,bitrate:metadata.format.bit_rate||0,size:metadata.format.size||0,format:metadata.format.format_name||"",videoCodec:(videoStream==null?void 0:videoStream.codec_name)||"",audioTracks:audioStreams.length})})})}catch(r){throw console.error("Failed to get video metadata:",r),r}});let exportPreviewWindow=null;function createExportPreviewWindow(r){exportPreviewWindow&&!exportPreviewWindow.isDestroyed()&&exportPreviewWindow.close(),exportPreviewWindow=new electron.BrowserWindow({width:600,height:500,alwaysOnTop:!0,modal:!1,resizable:!1,title:"Export Complete",backgroundColor:"#1a1a1a",webPreferences:{contextIsolation:!1,nodeIntegration:!0,webSecurity:!1}}),exportPreviewWindow.setMenu(null),exportPreviewWindow.webContents.on("crashed",()=>{console.error("Preview window crashed"),exportPreviewWindow==null||exportPreviewWindow.close(),exportPreviewWindow=null});const e=r.split("\\").pop()||"",i=`<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    * { box-sizing: border-box; }
    body { margin: 0; padding: 20px; background: #1a1a1a; color: white; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; overflow: hidden; }
    video { width: 100%; border-radius: 8px; max-height: 320px; object-fit: contain; background: #000; }
    .drag-hint { text-align: center; padding: 15px; background: #2a2a2a; border-radius: 8px; margin-top: 10px; cursor: grab; user-select: none; }
    .drag-hint:active { cursor: grabbing; }
    .drag-hint h3 { margin: 0 0 8px 0; font-size: 16px; color: #4ade80; }
    .drag-hint p { margin: 0; font-size: 13px; color: #aaa; }
    .timer { position: absolute; top: 10px; right: 10px; font-size: 12px; color: #666; }
    .file-icon { font-size: 24px; margin-bottom: 8px; }
    .actions { display: flex; gap: 10px; margin-top: 10px; }
    .btn { flex: 1; padding: 10px; background: #3a3a3a; border: none; border-radius: 6px; color: white; cursor: pointer; font-size: 13px; }
    .btn:hover { background: #4a4a4a; }
    .btn-primary { background: #4ade80; color: #0f0f0f; }
    .btn-primary:hover { background: #22c55e; }
  </style>
</head>
<body>
  <div class="timer" id="timer">Closing in 30s</div>
  <video src="${`clipvault://${r.includes("exported-clips")?"exported":"clip"}/${encodeURIComponent(e)}`}" controls autoplay></video>
  <div class="drag-hint" id="dragHint" draggable="true">
    <div class="file-icon"></div>
    <h3>Export Complete!</h3>
    <p>Drag from here to share the file anywhere</p>
  </div>
  <div class="actions">
    <button class="btn" onclick="copyPath()">Copy Path</button>
    <button class="btn btn-primary" onclick="openFolder()">Open Folder</button>
  </div>
  <script>
    const { ipcRenderer } = require('electron');
    const filePath = '${r.replace(/\\/g,"\\\\")}';
    let timeLeft = 30;
    const timerEl = document.getElementById('timer');
    const interval = setInterval(() => {
      timeLeft--;
      timerEl.textContent = 'Closing in ' + timeLeft + 's';
      if (timeLeft <= 0) {
        clearInterval(interval);
        window.close();
      }
    }, 1000);
    
    // Handle drag start - send IPC to main process for native drag
    const dragHint = document.getElementById('dragHint');
    dragHint.addEventListener('dragstart', (e) => {
      e.preventDefault();
      // Send IPC to main process to initiate native drag
      ipcRenderer.send('export:startDrag', filePath);
    });
    
    function copyPath() {
      navigator.clipboard.writeText(filePath);
      const btn = event.target;
      const originalText = btn.textContent;
      btn.textContent = 'Copied!';
      setTimeout(() => btn.textContent = originalText, 1500);
    }
    
    function openFolder() {
      ipcRenderer.send('export:openFolder', filePath);
    }
  <\/script>
</body>
</html>`;exportPreviewWindow.loadURL("data:text/html;charset=utf-8,"+encodeURIComponent(i));const o=setTimeout(()=>{exportPreviewWindow&&!exportPreviewWindow.isDestroyed()&&exportPreviewWindow.close()},3e4);exportPreviewWindow.on("closed",()=>{clearTimeout(o),exportPreviewWindow=null}),exportPreviewWindow.webContents.on("ipc-message",(a,s,u)=>{if(s==="export:startDrag"){console.log("Starting native drag for:",u);try{let l;require$$0$1.existsSync(dragIconPath)?(l=electron.nativeImage.createFromPath(dragIconPath),console.log("Drag icon loaded from:",dragIconPath)):console.warn("Drag icon not found at:",dragIconPath),exportPreviewWindow==null||exportPreviewWindow.webContents.startDrag({file:u,icon:l||electron.nativeImage.createEmpty()})}catch(l){console.error("Error starting drag:",l)}}else if(s==="export:openFolder"){const l=require$$0$2.dirname(u);electron.shell.openPath(l)}})}electron.ipcMain.handle("export:showPreview",async(r,e)=>(createExportPreviewWindow(e),{success:!0}));electron.ipcMain.handle("audio:extractTracks",async(r,e,t)=>{try{const n=require$$0$2.join(thumbnailsPath,"audio");require$$0$1.existsSync(n)||await promises.mkdir(n,{recursive:!0});const i=require$$0$2.join(n,`${e}_track1.m4a`),o=require$$0$2.join(n,`${e}_track2.m4a`),a={},s=require$$0$1.existsSync(i),u=require$$0$1.existsSync(o);if(s&&(a.track1=`clipvault://audio/${encodeURIComponent(`${e}_track1.m4a`)}`),u&&(a.track2=`clipvault://audio/${encodeURIComponent(`${e}_track2.m4a`)}`),s&&u)return a;const f=(await new Promise((d,c)=>{ffmpeg.ffprobe(t,(A,y)=>{A?c(A):d(y)})})).streams.filter(d=>d.codec_type==="audio");return!s&&f.length>=1&&(await new Promise((d,c)=>{ffmpeg(t).outputOptions(["-map 0:a:0","-c:a aac","-b:a 128k"]).save(i).on("end",()=>d()).on("error",A=>c(A))}),a.track1=`clipvault://audio/${encodeURIComponent(`${e}_track1.m4a`)}`),!u&&f.length>=2&&(await new Promise((d,c)=>{ffmpeg(t).outputOptions(["-map 0:a:1","-c:a aac","-b:a 128k"]).save(o).on("end",()=>d()).on("error",A=>c(A))}),a.track2=`clipvault://audio/${encodeURIComponent(`${e}_track2.m4a`)}`),a}catch(n){return console.error("Failed to extract audio tracks:",n),{error:String(n)}}});electron.ipcMain.handle("editor:exportClip",async(r,e)=>{try{const{clipPath:t,exportFilename:n,trimStart:i,trimEnd:o,audioTrack1:a,audioTrack2:s,audioTrack1Volume:u,audioTrack2Volume:l,targetSizeMB:f="original"}=e,d=o-i,c=u??1,A=l??1,y=require$$0$2.join(getClipsPath(),"exported-clips");require$$0$1.existsSync(y)||await promises.mkdir(y,{recursive:!0});const w=require$$0$2.join(y,n);let S=null,F=!1;if(typeof f=="number"&&f>0&&d>0){const x=f*8192*.85,P=Math.floor(x/d);S=Math.max(P-128,500),F=!0,console.log(`Target size: ${f}MB, Duration: ${d}s, Video bitrate: ${S}kbps`)}return new Promise((x,P)=>{const b=ffmpeg(t).seekInput(i).duration(d);if(F&&S?(b.videoCodec("libx264"),b.outputOptions(["-b:v",`${S}k`,"-maxrate",`${Math.floor(S*1.5)}k`,"-bufsize",`${S*2}k`,"-preset","fast","-pix_fmt","yuv420p"])):b.videoCodec("copy"),a&&s){const $=`[0:a:0]volume=${c}[a0];[0:a:1]volume=${A}[a1];[a0][a1]amix=inputs=2:duration=first:dropout_transition=3[aout]`;b.outputOptions(["-map 0:v:0","-filter_complex",$,"-map","[aout]","-c:a aac","-b:a 128k","-ac 2"])}else a?c<1?b.outputOptions(["-map 0:v:0","-map 0:a:0","-filter:a:0",`volume=${c}`]):b.outputOptions(["-map 0:v:0","-map 0:a:0"]):s?A<1?b.outputOptions(["-map 0:v:0","-map 0:a:1","-filter:a:0",`volume=${A}`]):b.outputOptions(["-map 0:v:0","-map 0:a:1"]):b.noAudio();b.on("progress",$=>{mainWindow&&$.percent&&mainWindow.webContents.send("export:progress",{percent:$.percent})}).on("end",()=>{x({success:!0,filePath:w})}).on("error",$=>{console.error("Export error:",$),P($)}).save(w)})}catch(t){throw console.error("Failed to export clip:",t),t}});electron.ipcMain.handle("cleanup:orphans",async()=>{try{return console.log("[Main] Cleaning up orphaned cache files..."),await cleanupOrphanedCache(getClipsPath(),thumbnailsPath)}catch(r){return console.error("Failed to cleanup orphans:",r),{deletedCount:0,errors:[String(r)]}}});electron.ipcMain.handle("cleanup:stats",async()=>{try{const r=await getCacheStats(thumbnailsPath);return{...r,thumbnailSizeFormatted:formatBytes(r.thumbnailSize),audioSizeFormatted:formatBytes(r.audioSize),totalSizeFormatted:formatBytes(r.totalSize)}}catch(r){return console.error("Failed to get cache stats:",r),null}});electron.app.whenReady().then(async()=>{console.log("App is ready, creating window..."),electron.protocol.registerFileProtocol("clipvault",(e,t)=>{try{console.log("Protocol handler called:",e.url);const n=new URL(e.url),i=n.host,o=n.pathname;if(console.log("Parsed URL:",{host:i,pathname:o}),!i||!o){console.error("Invalid URL format:",{host:i,pathname:o}),t({error:-2});return}const a=i,s=o.substring(1),u=decodeURIComponent(s);console.log("Processing file:",{type:a,filename:u});let l;if(a==="clip")l=getClipsPath();else if(a==="thumb")l=thumbnailsPath;else if(a==="audio")l=require$$0$2.join(thumbnailsPath,"audio");else if(a==="exported")l=require$$0$2.join(getClipsPath(),"exported-clips");else{console.error("Unknown resource type:",a),t({error:-2});return}const f=require$$0$2.join(l,u);if(console.log("Full file path:",f),!require$$0$1.existsSync(f)){console.error("File not found:",f),t({error:-6});return}t({path:f})}catch(n){console.error("Protocol handler error:",n),t({error:-2})}}),isStartupMode&&console.log("[Main] Startup mode: Creating minimal tray icon only"),createTray(),isStartupMode?console.log("[Main] Startup mode: Skipping UI window, running in background"):await createWindow().catch(e=>{console.error("Failed to create window:",e)}),console.log("Attempting to start backend..."),startBackend(),setTimeout(async()=>{try{console.log("[Main] Running orphaned cache cleanup on startup...");const e=await cleanupOrphanedCache(getClipsPath(),thumbnailsPath);e.deletedCount>0&&console.log(`[Main] Cleaned up ${e.deletedCount} orphaned cache files`),e.errors.length>0&&console.warn("[Main] Cleanup errors:",e.errors)}catch(e){console.error("[Main] Failed to run startup cleanup:",e)}},5e3),setTimeout(()=>{try{const{backendLogPath:e}=getBackendPaths(),n=require$$0$3.execSync('tasklist /NH /FO CSV /FI "IMAGENAME eq ClipVault.exe"',{encoding:"utf-8",stdio:["pipe","pipe","ignore"]}).includes("ClipVault.exe");console.log("Backend verification after spawn:",n?"running":"not running"),require$$0$1.existsSync(e)?console.log("Backend log file exists:",e):console.warn("Backend log file not found - spawn may have failed silently")}catch(e){console.log("Could not verify backend status:",e)}},2e3);const r=chokidar.watch(getClipsPath(),{ignored:/(^|[\/\\])\../,persistent:!0,depth:0,awaitWriteFinish:{stabilityThreshold:500,pollInterval:100}});r.on("add",e=>{e.endsWith(".mp4")&&(console.log("[Watcher] New clip detected:",e),electron.BrowserWindow.getAllWindows().forEach(t=>{t.webContents.send("clips:new",{filename:require$$0$2.basename(e)})}))}),r.on("unlink",e=>{e.endsWith(".mp4")&&(console.log("[Watcher] Clip deleted:",e),electron.BrowserWindow.getAllWindows().forEach(t=>{t.webContents.send("clips:removed",{filename:require$$0$2.basename(e)})}))}),r.on("error",e=>{console.error("[Watcher] Error watching clips folder:",e)}),console.log("[Watcher] Started watching clips folder:",getClipsPath()),electron.app.on("activate",()=>{electron.BrowserWindow.getAllWindows().length===0&&createWindow()})});electron.app.on("window-all-closed",()=>{process.platform!=="darwin"&&(tray||electron.app.quit())});electron.app.on("before-quit",r=>{console.log("App is quitting..."),isQuitting=!0,tray&&(tray.destroy(),tray=null)});electron.app.on("will-quit",()=>{isQuitting=!0});
//# sourceMappingURL=main.js.map
