{"version":3,"file":"main.js","sources":["../../node_modules/isexe/windows.js","../../node_modules/isexe/mode.js","../../node_modules/isexe/index.js","../../node_modules/fluent-ffmpeg/node_modules/which/which.js","../../node_modules/fluent-ffmpeg/lib/utils.js","../../node_modules/fluent-ffmpeg/lib/options/inputs.js","../../node_modules/fluent-ffmpeg/lib/options/audio.js","../../node_modules/fluent-ffmpeg/lib/options/video.js","../../node_modules/fluent-ffmpeg/lib/options/videosize.js","../../node_modules/fluent-ffmpeg/lib/options/output.js","../../node_modules/fluent-ffmpeg/lib/options/custom.js","../../node_modules/fluent-ffmpeg/lib/options/misc.js","../../node_modules/fluent-ffmpeg/node_modules/async/lib/async.js","../../node_modules/fluent-ffmpeg/lib/processor.js","../../node_modules/fluent-ffmpeg/lib/capabilities.js","../../node_modules/fluent-ffmpeg/lib/ffprobe.js","../../node_modules/fluent-ffmpeg/lib/recipes.js","../../node_modules/fluent-ffmpeg/lib/fluent-ffmpeg.js","../../node_modules/fluent-ffmpeg/index.js","../../src/main/main.ts"],"sourcesContent":["module.exports = isexe\nisexe.sync = sync\n\nvar fs = require('fs')\n\nfunction checkPathExt (path, options) {\n  var pathext = options.pathExt !== undefined ?\n    options.pathExt : process.env.PATHEXT\n\n  if (!pathext) {\n    return true\n  }\n\n  pathext = pathext.split(';')\n  if (pathext.indexOf('') !== -1) {\n    return true\n  }\n  for (var i = 0; i < pathext.length; i++) {\n    var p = pathext[i].toLowerCase()\n    if (p && path.substr(-p.length).toLowerCase() === p) {\n      return true\n    }\n  }\n  return false\n}\n\nfunction checkStat (stat, path, options) {\n  if (!stat.isSymbolicLink() && !stat.isFile()) {\n    return false\n  }\n  return checkPathExt(path, options)\n}\n\nfunction isexe (path, options, cb) {\n  fs.stat(path, function (er, stat) {\n    cb(er, er ? false : checkStat(stat, path, options))\n  })\n}\n\nfunction sync (path, options) {\n  return checkStat(fs.statSync(path), path, options)\n}\n","module.exports = isexe\nisexe.sync = sync\n\nvar fs = require('fs')\n\nfunction isexe (path, options, cb) {\n  fs.stat(path, function (er, stat) {\n    cb(er, er ? false : checkStat(stat, options))\n  })\n}\n\nfunction sync (path, options) {\n  return checkStat(fs.statSync(path), options)\n}\n\nfunction checkStat (stat, options) {\n  return stat.isFile() && checkMode(stat, options)\n}\n\nfunction checkMode (stat, options) {\n  var mod = stat.mode\n  var uid = stat.uid\n  var gid = stat.gid\n\n  var myUid = options.uid !== undefined ?\n    options.uid : process.getuid && process.getuid()\n  var myGid = options.gid !== undefined ?\n    options.gid : process.getgid && process.getgid()\n\n  var u = parseInt('100', 8)\n  var g = parseInt('010', 8)\n  var o = parseInt('001', 8)\n  var ug = u | g\n\n  var ret = (mod & o) ||\n    (mod & g) && gid === myGid ||\n    (mod & u) && uid === myUid ||\n    (mod & ug) && myUid === 0\n\n  return ret\n}\n","var fs = require('fs')\nvar core\nif (process.platform === 'win32' || global.TESTING_WINDOWS) {\n  core = require('./windows.js')\n} else {\n  core = require('./mode.js')\n}\n\nmodule.exports = isexe\nisexe.sync = sync\n\nfunction isexe (path, options, cb) {\n  if (typeof options === 'function') {\n    cb = options\n    options = {}\n  }\n\n  if (!cb) {\n    if (typeof Promise !== 'function') {\n      throw new TypeError('callback not provided')\n    }\n\n    return new Promise(function (resolve, reject) {\n      isexe(path, options || {}, function (er, is) {\n        if (er) {\n          reject(er)\n        } else {\n          resolve(is)\n        }\n      })\n    })\n  }\n\n  core(path, options || {}, function (er, is) {\n    // ignore EACCES because that just means we aren't allowed to run it\n    if (er) {\n      if (er.code === 'EACCES' || options && options.ignoreErrors) {\n        er = null\n        is = false\n      }\n    }\n    cb(er, is)\n  })\n}\n\nfunction sync (path, options) {\n  // my kingdom for a filtered catch\n  try {\n    return core.sync(path, options || {})\n  } catch (er) {\n    if (options && options.ignoreErrors || er.code === 'EACCES') {\n      return false\n    } else {\n      throw er\n    }\n  }\n}\n","module.exports = which\nwhich.sync = whichSync\n\nvar isWindows = process.platform === 'win32' ||\n    process.env.OSTYPE === 'cygwin' ||\n    process.env.OSTYPE === 'msys'\n\nvar path = require('path')\nvar COLON = isWindows ? ';' : ':'\nvar isexe = require('isexe')\n\nfunction getNotFoundError (cmd) {\n  var er = new Error('not found: ' + cmd)\n  er.code = 'ENOENT'\n\n  return er\n}\n\nfunction getPathInfo (cmd, opt) {\n  var colon = opt.colon || COLON\n  var pathEnv = opt.path || process.env.PATH || ''\n  var pathExt = ['']\n\n  pathEnv = pathEnv.split(colon)\n\n  var pathExtExe = ''\n  if (isWindows) {\n    pathEnv.unshift(process.cwd())\n    pathExtExe = (opt.pathExt || process.env.PATHEXT || '.EXE;.CMD;.BAT;.COM')\n    pathExt = pathExtExe.split(colon)\n\n\n    // Always test the cmd itself first.  isexe will check to make sure\n    // it's found in the pathExt set.\n    if (cmd.indexOf('.') !== -1 && pathExt[0] !== '')\n      pathExt.unshift('')\n  }\n\n  // If it has a slash, then we don't bother searching the pathenv.\n  // just check the file itself, and that's it.\n  if (cmd.match(/\\//) || isWindows && cmd.match(/\\\\/))\n    pathEnv = ['']\n\n  return {\n    env: pathEnv,\n    ext: pathExt,\n    extExe: pathExtExe\n  }\n}\n\nfunction which (cmd, opt, cb) {\n  if (typeof opt === 'function') {\n    cb = opt\n    opt = {}\n  }\n\n  var info = getPathInfo(cmd, opt)\n  var pathEnv = info.env\n  var pathExt = info.ext\n  var pathExtExe = info.extExe\n  var found = []\n\n  ;(function F (i, l) {\n    if (i === l) {\n      if (opt.all && found.length)\n        return cb(null, found)\n      else\n        return cb(getNotFoundError(cmd))\n    }\n\n    var pathPart = pathEnv[i]\n    if (pathPart.charAt(0) === '\"' && pathPart.slice(-1) === '\"')\n      pathPart = pathPart.slice(1, -1)\n\n    var p = path.join(pathPart, cmd)\n    if (!pathPart && (/^\\.[\\\\\\/]/).test(cmd)) {\n      p = cmd.slice(0, 2) + p\n    }\n    ;(function E (ii, ll) {\n      if (ii === ll) return F(i + 1, l)\n      var ext = pathExt[ii]\n      isexe(p + ext, { pathExt: pathExtExe }, function (er, is) {\n        if (!er && is) {\n          if (opt.all)\n            found.push(p + ext)\n          else\n            return cb(null, p + ext)\n        }\n        return E(ii + 1, ll)\n      })\n    })(0, pathExt.length)\n  })(0, pathEnv.length)\n}\n\nfunction whichSync (cmd, opt) {\n  opt = opt || {}\n\n  var info = getPathInfo(cmd, opt)\n  var pathEnv = info.env\n  var pathExt = info.ext\n  var pathExtExe = info.extExe\n  var found = []\n\n  for (var i = 0, l = pathEnv.length; i < l; i ++) {\n    var pathPart = pathEnv[i]\n    if (pathPart.charAt(0) === '\"' && pathPart.slice(-1) === '\"')\n      pathPart = pathPart.slice(1, -1)\n\n    var p = path.join(pathPart, cmd)\n    if (!pathPart && /^\\.[\\\\\\/]/.test(cmd)) {\n      p = cmd.slice(0, 2) + p\n    }\n    for (var j = 0, ll = pathExt.length; j < ll; j ++) {\n      var cur = p + pathExt[j]\n      var is\n      try {\n        is = isexe.sync(cur, { pathExt: pathExtExe })\n        if (is) {\n          if (opt.all)\n            found.push(cur)\n          else\n            return cur\n        }\n      } catch (ex) {}\n    }\n  }\n\n  if (opt.all && found.length)\n    return found\n\n  if (opt.nothrow)\n    return null\n\n  throw getNotFoundError(cmd)\n}\n","/*jshint node:true*/\n'use strict';\n\nvar exec = require('child_process').exec;\nvar isWindows = require('os').platform().match(/win(32|64)/);\nvar which = require('which');\n\nvar nlRegexp = /\\r\\n|\\r|\\n/g;\nvar streamRegexp = /^\\[?(.*?)\\]?$/;\nvar filterEscapeRegexp = /[,]/;\nvar whichCache = {};\n\n/**\n * Parse progress line from ffmpeg stderr\n *\n * @param {String} line progress line\n * @return progress object\n * @private\n */\nfunction parseProgressLine(line) {\n  var progress = {};\n\n  // Remove all spaces after = and trim\n  line  = line.replace(/=\\s+/g, '=').trim();\n  var progressParts = line.split(' ');\n\n  // Split every progress part by \"=\" to get key and value\n  for(var i = 0; i < progressParts.length; i++) {\n    var progressSplit = progressParts[i].split('=', 2);\n    var key = progressSplit[0];\n    var value = progressSplit[1];\n\n    // This is not a progress line\n    if(typeof value === 'undefined')\n      return null;\n\n    progress[key] = value;\n  }\n\n  return progress;\n}\n\n\nvar utils = module.exports = {\n  isWindows: isWindows,\n  streamRegexp: streamRegexp,\n\n\n  /**\n   * Copy an object keys into another one\n   *\n   * @param {Object} source source object\n   * @param {Object} dest destination object\n   * @private\n   */\n  copy: function(source, dest) {\n    Object.keys(source).forEach(function(key) {\n      dest[key] = source[key];\n    });\n  },\n\n\n  /**\n   * Create an argument list\n   *\n   * Returns a function that adds new arguments to the list.\n   * It also has the following methods:\n   * - clear() empties the argument list\n   * - get() returns the argument list\n   * - find(arg, count) finds 'arg' in the list and return the following 'count' items, or undefined if not found\n   * - remove(arg, count) remove 'arg' in the list as well as the following 'count' items\n   *\n   * @private\n   */\n  args: function() {\n    var list = [];\n\n    // Append argument(s) to the list\n    var argfunc = function() {\n      if (arguments.length === 1 && Array.isArray(arguments[0])) {\n        list = list.concat(arguments[0]);\n      } else {\n        list = list.concat([].slice.call(arguments));\n      }\n    };\n\n    // Clear argument list\n    argfunc.clear = function() {\n      list = [];\n    };\n\n    // Return argument list\n    argfunc.get = function() {\n      return list;\n    };\n\n    // Find argument 'arg' in list, and if found, return an array of the 'count' items that follow it\n    argfunc.find = function(arg, count) {\n      var index = list.indexOf(arg);\n      if (index !== -1) {\n        return list.slice(index + 1, index + 1 + (count || 0));\n      }\n    };\n\n    // Find argument 'arg' in list, and if found, remove it as well as the 'count' items that follow it\n    argfunc.remove = function(arg, count) {\n      var index = list.indexOf(arg);\n      if (index !== -1) {\n        list.splice(index, (count || 0) + 1);\n      }\n    };\n\n    // Clone argument list\n    argfunc.clone = function() {\n      var cloned = utils.args();\n      cloned(list);\n      return cloned;\n    };\n\n    return argfunc;\n  },\n\n\n  /**\n   * Generate filter strings\n   *\n   * @param {String[]|Object[]} filters filter specifications. When using objects,\n   *   each must have the following properties:\n   * @param {String} filters.filter filter name\n   * @param {String|Array} [filters.inputs] (array of) input stream specifier(s) for the filter,\n   *   defaults to ffmpeg automatically choosing the first unused matching streams\n   * @param {String|Array} [filters.outputs] (array of) output stream specifier(s) for the filter,\n   *   defaults to ffmpeg automatically assigning the output to the output file\n   * @param {Object|String|Array} [filters.options] filter options, can be omitted to not set any options\n   * @return String[]\n   * @private\n   */\n  makeFilterStrings: function(filters) {\n    return filters.map(function(filterSpec) {\n      if (typeof filterSpec === 'string') {\n        return filterSpec;\n      }\n\n      var filterString = '';\n\n      // Filter string format is:\n      // [input1][input2]...filter[output1][output2]...\n      // The 'filter' part can optionaly have arguments:\n      //   filter=arg1:arg2:arg3\n      //   filter=arg1=v1:arg2=v2:arg3=v3\n\n      // Add inputs\n      if (Array.isArray(filterSpec.inputs)) {\n        filterString += filterSpec.inputs.map(function(streamSpec) {\n          return streamSpec.replace(streamRegexp, '[$1]');\n        }).join('');\n      } else if (typeof filterSpec.inputs === 'string') {\n        filterString += filterSpec.inputs.replace(streamRegexp, '[$1]');\n      }\n\n      // Add filter\n      filterString += filterSpec.filter;\n\n      // Add options\n      if (filterSpec.options) {\n        if (typeof filterSpec.options === 'string' || typeof filterSpec.options === 'number') {\n          // Option string\n          filterString += '=' + filterSpec.options;\n        } else if (Array.isArray(filterSpec.options)) {\n          // Option array (unnamed options)\n          filterString += '=' + filterSpec.options.map(function(option) {\n            if (typeof option === 'string' && option.match(filterEscapeRegexp)) {\n              return '\\'' + option + '\\'';\n            } else {\n              return option;\n            }\n          }).join(':');\n        } else if (Object.keys(filterSpec.options).length) {\n          // Option object (named options)\n          filterString += '=' + Object.keys(filterSpec.options).map(function(option) {\n            var value = filterSpec.options[option];\n\n            if (typeof value === 'string' && value.match(filterEscapeRegexp)) {\n              value = '\\'' + value + '\\'';\n            }\n\n            return option + '=' + value;\n          }).join(':');\n        }\n      }\n\n      // Add outputs\n      if (Array.isArray(filterSpec.outputs)) {\n        filterString += filterSpec.outputs.map(function(streamSpec) {\n          return streamSpec.replace(streamRegexp, '[$1]');\n        }).join('');\n      } else if (typeof filterSpec.outputs === 'string') {\n        filterString += filterSpec.outputs.replace(streamRegexp, '[$1]');\n      }\n\n      return filterString;\n    });\n  },\n\n\n  /**\n   * Search for an executable\n   *\n   * Uses 'which' or 'where' depending on platform\n   *\n   * @param {String} name executable name\n   * @param {Function} callback callback with signature (err, path)\n   * @private\n   */\n  which: function(name, callback) {\n    if (name in whichCache) {\n      return callback(null, whichCache[name]);\n    }\n\n    which(name, function(err, result){\n      if (err) {\n        // Treat errors as not found\n        return callback(null, whichCache[name] = '');\n      }\n      callback(null, whichCache[name] = result);\n    });\n  },\n\n\n  /**\n   * Convert a [[hh:]mm:]ss[.xxx] timemark into seconds\n   *\n   * @param {String} timemark timemark string\n   * @return Number\n   * @private\n   */\n  timemarkToSeconds: function(timemark) {\n    if (typeof timemark === 'number') {\n      return timemark;\n    }\n\n    if (timemark.indexOf(':') === -1 && timemark.indexOf('.') >= 0) {\n      return Number(timemark);\n    }\n\n    var parts = timemark.split(':');\n\n    // add seconds\n    var secs = Number(parts.pop());\n\n    if (parts.length) {\n      // add minutes\n      secs += Number(parts.pop()) * 60;\n    }\n\n    if (parts.length) {\n      // add hours\n      secs += Number(parts.pop()) * 3600;\n    }\n\n    return secs;\n  },\n\n\n  /**\n   * Extract codec data from ffmpeg stderr and emit 'codecData' event if appropriate\n   * Call it with an initially empty codec object once with each line of stderr output until it returns true\n   *\n   * @param {FfmpegCommand} command event emitter\n   * @param {String} stderrLine ffmpeg stderr output line\n   * @param {Object} codecObject object used to accumulate codec data between calls\n   * @return {Boolean} true if codec data is complete (and event was emitted), false otherwise\n   * @private\n   */\n  extractCodecData: function(command, stderrLine, codecsObject) {\n    var inputPattern = /Input #[0-9]+, ([^ ]+),/;\n    var durPattern = /Duration\\: ([^,]+)/;\n    var audioPattern = /Audio\\: (.*)/;\n    var videoPattern = /Video\\: (.*)/;\n\n    if (!('inputStack' in codecsObject)) {\n      codecsObject.inputStack = [];\n      codecsObject.inputIndex = -1;\n      codecsObject.inInput = false;\n    }\n\n    var inputStack = codecsObject.inputStack;\n    var inputIndex = codecsObject.inputIndex;\n    var inInput = codecsObject.inInput;\n\n    var format, dur, audio, video;\n\n    if (format = stderrLine.match(inputPattern)) {\n      inInput = codecsObject.inInput = true;\n      inputIndex = codecsObject.inputIndex = codecsObject.inputIndex + 1;\n\n      inputStack[inputIndex] = { format: format[1], audio: '', video: '', duration: '' };\n    } else if (inInput && (dur = stderrLine.match(durPattern))) {\n      inputStack[inputIndex].duration = dur[1];\n    } else if (inInput && (audio = stderrLine.match(audioPattern))) {\n      audio = audio[1].split(', ');\n      inputStack[inputIndex].audio = audio[0];\n      inputStack[inputIndex].audio_details = audio;\n    } else if (inInput && (video = stderrLine.match(videoPattern))) {\n      video = video[1].split(', ');\n      inputStack[inputIndex].video = video[0];\n      inputStack[inputIndex].video_details = video;\n    } else if (/Output #\\d+/.test(stderrLine)) {\n      inInput = codecsObject.inInput = false;\n    } else if (/Stream mapping:|Press (\\[q\\]|ctrl-c) to stop/.test(stderrLine)) {\n      command.emit.apply(command, ['codecData'].concat(inputStack));\n      return true;\n    }\n\n    return false;\n  },\n\n\n  /**\n   * Extract progress data from ffmpeg stderr and emit 'progress' event if appropriate\n   *\n   * @param {FfmpegCommand} command event emitter\n   * @param {String} stderrLine ffmpeg stderr data\n   * @private\n   */\n  extractProgress: function(command, stderrLine) {\n    var progress = parseProgressLine(stderrLine);\n\n    if (progress) {\n      // build progress report object\n      var ret = {\n        frames: parseInt(progress.frame, 10),\n        currentFps: parseInt(progress.fps, 10),\n        currentKbps: progress.bitrate ? parseFloat(progress.bitrate.replace('kbits/s', '')) : 0,\n        targetSize: parseInt(progress.size || progress.Lsize, 10),\n        timemark: progress.time\n      };\n\n      // calculate percent progress using duration\n      if (command._ffprobeData && command._ffprobeData.format && command._ffprobeData.format.duration) {\n        var duration = Number(command._ffprobeData.format.duration);\n        if (!isNaN(duration))\n          ret.percent = (utils.timemarkToSeconds(ret.timemark) / duration) * 100;\n      }\n      command.emit('progress', ret);\n    }\n  },\n\n\n  /**\n   * Extract error message(s) from ffmpeg stderr\n   *\n   * @param {String} stderr ffmpeg stderr data\n   * @return {String}\n   * @private\n   */\n  extractError: function(stderr) {\n    // Only return the last stderr lines that don't start with a space or a square bracket\n    return stderr.split(nlRegexp).reduce(function(messages, message) {\n      if (message.charAt(0) === ' ' || message.charAt(0) === '[') {\n        return [];\n      } else {\n        messages.push(message);\n        return messages;\n      }\n    }, []).join('\\n');\n  },\n\n\n  /**\n   * Creates a line ring buffer object with the following methods:\n   * - append(str) : appends a string or buffer\n   * - get() : returns the whole string\n   * - close() : prevents further append() calls and does a last call to callbacks\n   * - callback(cb) : calls cb for each line (incl. those already in the ring)\n   *\n   * @param {Number} maxLines maximum number of lines to store (<= 0 for unlimited)\n   */\n  linesRing: function(maxLines) {\n    var cbs = [];\n    var lines = [];\n    var current = null;\n    var closed = false\n    var max = maxLines - 1;\n\n    function emit(line) {\n      cbs.forEach(function(cb) { cb(line); });\n    }\n\n    return {\n      callback: function(cb) {\n        lines.forEach(function(l) { cb(l); });\n        cbs.push(cb);\n      },\n\n      append: function(str) {\n        if (closed) return;\n        if (str instanceof Buffer) str = '' + str;\n        if (!str || str.length === 0) return;\n\n        var newLines = str.split(nlRegexp);\n\n        if (newLines.length === 1) {\n          if (current !== null) {\n            current = current + newLines.shift();\n          } else {\n            current = newLines.shift();\n          }\n        } else {\n          if (current !== null) {\n            current = current + newLines.shift();\n            emit(current);\n            lines.push(current);\n          }\n\n          current = newLines.pop();\n\n          newLines.forEach(function(l) {\n            emit(l);\n            lines.push(l);\n          });\n\n          if (max > -1 && lines.length > max) {\n            lines.splice(0, lines.length - max);\n          }\n        }\n      },\n\n      get: function() {\n        if (current !== null) {\n          return lines.concat([current]).join('\\n');\n        } else {\n          return lines.join('\\n');\n        }\n      },\n\n      close: function() {\n        if (closed) return;\n\n        if (current !== null) {\n          emit(current);\n          lines.push(current);\n\n          if (max > -1 && lines.length > max) {\n            lines.shift();\n          }\n\n          current = null;\n        }\n\n        closed = true;\n      }\n    };\n  }\n};\n","/*jshint node:true*/\n'use strict';\n\nvar utils = require('../utils');\n\n/*\n *! Input-related methods\n */\n\nmodule.exports = function(proto) {\n  /**\n   * Add an input to command\n   *\n   * Also switches \"current input\", that is the input that will be affected\n   * by subsequent input-related methods.\n   *\n   * Note: only one stream input is supported for now.\n   *\n   * @method FfmpegCommand#input\n   * @category Input\n   * @aliases mergeAdd,addInput\n   *\n   * @param {String|Readable} source input file path or readable stream\n   * @return FfmpegCommand\n   */\n  proto.mergeAdd =\n  proto.addInput =\n  proto.input = function(source) {\n    var isFile = false;\n    var isStream = false;\n\n    if (typeof source !== 'string') {\n      if (!('readable' in source) || !(source.readable)) {\n        throw new Error('Invalid input');\n      }\n\n      var hasInputStream = this._inputs.some(function(input) {\n        return input.isStream;\n      });\n\n      if (hasInputStream) {\n        throw new Error('Only one input stream is supported');\n      }\n\n      isStream = true;\n      source.pause();\n    } else {\n      var protocol = source.match(/^([a-z]{2,}):/i);\n      isFile = !protocol || protocol[0] === 'file';\n    }\n\n    this._inputs.push(this._currentInput = {\n      source: source,\n      isFile: isFile,\n      isStream: isStream,\n      options: utils.args()\n    });\n\n    return this;\n  };\n\n\n  /**\n   * Specify input format for the last specified input\n   *\n   * @method FfmpegCommand#inputFormat\n   * @category Input\n   * @aliases withInputFormat,fromFormat\n   *\n   * @param {String} format input format\n   * @return FfmpegCommand\n   */\n  proto.withInputFormat =\n  proto.inputFormat =\n  proto.fromFormat = function(format) {\n    if (!this._currentInput) {\n      throw new Error('No input specified');\n    }\n\n    this._currentInput.options('-f', format);\n    return this;\n  };\n\n\n  /**\n   * Specify input FPS for the last specified input\n   * (only valid for raw video formats)\n   *\n   * @method FfmpegCommand#inputFps\n   * @category Input\n   * @aliases withInputFps,withInputFPS,withFpsInput,withFPSInput,inputFPS,inputFps,fpsInput\n   *\n   * @param {Number} fps input FPS\n   * @return FfmpegCommand\n   */\n  proto.withInputFps =\n  proto.withInputFPS =\n  proto.withFpsInput =\n  proto.withFPSInput =\n  proto.inputFPS =\n  proto.inputFps =\n  proto.fpsInput =\n  proto.FPSInput = function(fps) {\n    if (!this._currentInput) {\n      throw new Error('No input specified');\n    }\n\n    this._currentInput.options('-r', fps);\n    return this;\n  };\n\n\n  /**\n   * Use native framerate for the last specified input\n   *\n   * @method FfmpegCommand#native\n   * @category Input\n   * @aliases nativeFramerate,withNativeFramerate\n   *\n   * @return FfmmegCommand\n   */\n  proto.nativeFramerate =\n  proto.withNativeFramerate =\n  proto.native = function() {\n    if (!this._currentInput) {\n      throw new Error('No input specified');\n    }\n\n    this._currentInput.options('-re');\n    return this;\n  };\n\n\n  /**\n   * Specify input seek time for the last specified input\n   *\n   * @method FfmpegCommand#seekInput\n   * @category Input\n   * @aliases setStartTime,seekTo\n   *\n   * @param {String|Number} seek seek time in seconds or as a '[hh:[mm:]]ss[.xxx]' string\n   * @return FfmpegCommand\n   */\n  proto.setStartTime =\n  proto.seekInput = function(seek) {\n    if (!this._currentInput) {\n      throw new Error('No input specified');\n    }\n\n    this._currentInput.options('-ss', seek);\n\n    return this;\n  };\n\n\n  /**\n   * Loop over the last specified input\n   *\n   * @method FfmpegCommand#loop\n   * @category Input\n   *\n   * @param {String|Number} [duration] loop duration in seconds or as a '[[hh:]mm:]ss[.xxx]' string\n   * @return FfmpegCommand\n   */\n  proto.loop = function(duration) {\n    if (!this._currentInput) {\n      throw new Error('No input specified');\n    }\n\n    this._currentInput.options('-loop', '1');\n\n    if (typeof duration !== 'undefined') {\n      this.duration(duration);\n    }\n\n    return this;\n  };\n};\n","/*jshint node:true*/\n'use strict';\n\nvar utils = require('../utils');\n\n\n/*\n *! Audio-related methods\n */\n\nmodule.exports = function(proto) {\n  /**\n   * Disable audio in the output\n   *\n   * @method FfmpegCommand#noAudio\n   * @category Audio\n   * @aliases withNoAudio\n   * @return FfmpegCommand\n   */\n  proto.withNoAudio =\n  proto.noAudio = function() {\n    this._currentOutput.audio.clear();\n    this._currentOutput.audioFilters.clear();\n    this._currentOutput.audio('-an');\n\n    return this;\n  };\n\n\n  /**\n   * Specify audio codec\n   *\n   * @method FfmpegCommand#audioCodec\n   * @category Audio\n   * @aliases withAudioCodec\n   *\n   * @param {String} codec audio codec name\n   * @return FfmpegCommand\n   */\n  proto.withAudioCodec =\n  proto.audioCodec = function(codec) {\n    this._currentOutput.audio('-acodec', codec);\n\n    return this;\n  };\n\n\n  /**\n   * Specify audio bitrate\n   *\n   * @method FfmpegCommand#audioBitrate\n   * @category Audio\n   * @aliases withAudioBitrate\n   *\n   * @param {String|Number} bitrate audio bitrate in kbps (with an optional 'k' suffix)\n   * @return FfmpegCommand\n   */\n  proto.withAudioBitrate =\n  proto.audioBitrate = function(bitrate) {\n    this._currentOutput.audio('-b:a', ('' + bitrate).replace(/k?$/, 'k'));\n    return this;\n  };\n\n\n  /**\n   * Specify audio channel count\n   *\n   * @method FfmpegCommand#audioChannels\n   * @category Audio\n   * @aliases withAudioChannels\n   *\n   * @param {Number} channels channel count\n   * @return FfmpegCommand\n   */\n  proto.withAudioChannels =\n  proto.audioChannels = function(channels) {\n    this._currentOutput.audio('-ac', channels);\n    return this;\n  };\n\n\n  /**\n   * Specify audio frequency\n   *\n   * @method FfmpegCommand#audioFrequency\n   * @category Audio\n   * @aliases withAudioFrequency\n   *\n   * @param {Number} freq audio frequency in Hz\n   * @return FfmpegCommand\n   */\n  proto.withAudioFrequency =\n  proto.audioFrequency = function(freq) {\n    this._currentOutput.audio('-ar', freq);\n    return this;\n  };\n\n\n  /**\n   * Specify audio quality\n   *\n   * @method FfmpegCommand#audioQuality\n   * @category Audio\n   * @aliases withAudioQuality\n   *\n   * @param {Number} quality audio quality factor\n   * @return FfmpegCommand\n   */\n  proto.withAudioQuality =\n  proto.audioQuality = function(quality) {\n    this._currentOutput.audio('-aq', quality);\n    return this;\n  };\n\n\n  /**\n   * Specify custom audio filter(s)\n   *\n   * Can be called both with one or many filters, or a filter array.\n   *\n   * @example\n   * command.audioFilters('filter1');\n   *\n   * @example\n   * command.audioFilters('filter1', 'filter2=param1=value1:param2=value2');\n   *\n   * @example\n   * command.audioFilters(['filter1', 'filter2']);\n   *\n   * @example\n   * command.audioFilters([\n   *   {\n   *     filter: 'filter1'\n   *   },\n   *   {\n   *     filter: 'filter2',\n   *     options: 'param=value:param=value'\n   *   }\n   * ]);\n   *\n   * @example\n   * command.audioFilters(\n   *   {\n   *     filter: 'filter1',\n   *     options: ['value1', 'value2']\n   *   },\n   *   {\n   *     filter: 'filter2',\n   *     options: { param1: 'value1', param2: 'value2' }\n   *   }\n   * );\n   *\n   * @method FfmpegCommand#audioFilters\n   * @aliases withAudioFilter,withAudioFilters,audioFilter\n   * @category Audio\n   *\n   * @param {...String|String[]|Object[]} filters audio filter strings, string array or\n   *   filter specification array, each with the following properties:\n   * @param {String} filters.filter filter name\n   * @param {String|String[]|Object} [filters.options] filter option string, array, or object\n   * @return FfmpegCommand\n   */\n  proto.withAudioFilter =\n  proto.withAudioFilters =\n  proto.audioFilter =\n  proto.audioFilters = function(filters) {\n    if (arguments.length > 1) {\n      filters = [].slice.call(arguments);\n    }\n\n    if (!Array.isArray(filters)) {\n      filters = [filters];\n    }\n\n    this._currentOutput.audioFilters(utils.makeFilterStrings(filters));\n    return this;\n  };\n};\n","/*jshint node:true*/\n'use strict';\n\nvar utils = require('../utils');\n\n\n/*\n *! Video-related methods\n */\n\nmodule.exports = function(proto) {\n  /**\n   * Disable video in the output\n   *\n   * @method FfmpegCommand#noVideo\n   * @category Video\n   * @aliases withNoVideo\n   *\n   * @return FfmpegCommand\n   */\n  proto.withNoVideo =\n  proto.noVideo = function() {\n    this._currentOutput.video.clear();\n    this._currentOutput.videoFilters.clear();\n    this._currentOutput.video('-vn');\n\n    return this;\n  };\n\n\n  /**\n   * Specify video codec\n   *\n   * @method FfmpegCommand#videoCodec\n   * @category Video\n   * @aliases withVideoCodec\n   *\n   * @param {String} codec video codec name\n   * @return FfmpegCommand\n   */\n  proto.withVideoCodec =\n  proto.videoCodec = function(codec) {\n    this._currentOutput.video('-vcodec', codec);\n    return this;\n  };\n\n\n  /**\n   * Specify video bitrate\n   *\n   * @method FfmpegCommand#videoBitrate\n   * @category Video\n   * @aliases withVideoBitrate\n   *\n   * @param {String|Number} bitrate video bitrate in kbps (with an optional 'k' suffix)\n   * @param {Boolean} [constant=false] enforce constant bitrate\n   * @return FfmpegCommand\n   */\n  proto.withVideoBitrate =\n  proto.videoBitrate = function(bitrate, constant) {\n    bitrate = ('' + bitrate).replace(/k?$/, 'k');\n\n    this._currentOutput.video('-b:v', bitrate);\n    if (constant) {\n      this._currentOutput.video(\n        '-maxrate', bitrate,\n        '-minrate', bitrate,\n        '-bufsize', '3M'\n      );\n    }\n\n    return this;\n  };\n\n\n  /**\n   * Specify custom video filter(s)\n   *\n   * Can be called both with one or many filters, or a filter array.\n   *\n   * @example\n   * command.videoFilters('filter1');\n   *\n   * @example\n   * command.videoFilters('filter1', 'filter2=param1=value1:param2=value2');\n   *\n   * @example\n   * command.videoFilters(['filter1', 'filter2']);\n   *\n   * @example\n   * command.videoFilters([\n   *   {\n   *     filter: 'filter1'\n   *   },\n   *   {\n   *     filter: 'filter2',\n   *     options: 'param=value:param=value'\n   *   }\n   * ]);\n   *\n   * @example\n   * command.videoFilters(\n   *   {\n   *     filter: 'filter1',\n   *     options: ['value1', 'value2']\n   *   },\n   *   {\n   *     filter: 'filter2',\n   *     options: { param1: 'value1', param2: 'value2' }\n   *   }\n   * );\n   *\n   * @method FfmpegCommand#videoFilters\n   * @category Video\n   * @aliases withVideoFilter,withVideoFilters,videoFilter\n   *\n   * @param {...String|String[]|Object[]} filters video filter strings, string array or\n   *   filter specification array, each with the following properties:\n   * @param {String} filters.filter filter name\n   * @param {String|String[]|Object} [filters.options] filter option string, array, or object\n   * @return FfmpegCommand\n   */\n  proto.withVideoFilter =\n  proto.withVideoFilters =\n  proto.videoFilter =\n  proto.videoFilters = function(filters) {\n    if (arguments.length > 1) {\n      filters = [].slice.call(arguments);\n    }\n\n    if (!Array.isArray(filters)) {\n      filters = [filters];\n    }\n\n    this._currentOutput.videoFilters(utils.makeFilterStrings(filters));\n\n    return this;\n  };\n\n\n  /**\n   * Specify output FPS\n   *\n   * @method FfmpegCommand#fps\n   * @category Video\n   * @aliases withOutputFps,withOutputFPS,withFpsOutput,withFPSOutput,withFps,withFPS,outputFPS,outputFps,fpsOutput,FPSOutput,FPS\n   *\n   * @param {Number} fps output FPS\n   * @return FfmpegCommand\n   */\n  proto.withOutputFps =\n  proto.withOutputFPS =\n  proto.withFpsOutput =\n  proto.withFPSOutput =\n  proto.withFps =\n  proto.withFPS =\n  proto.outputFPS =\n  proto.outputFps =\n  proto.fpsOutput =\n  proto.FPSOutput =\n  proto.fps =\n  proto.FPS = function(fps) {\n    this._currentOutput.video('-r', fps);\n    return this;\n  };\n\n\n  /**\n   * Only transcode a certain number of frames\n   *\n   * @method FfmpegCommand#frames\n   * @category Video\n   * @aliases takeFrames,withFrames\n   *\n   * @param {Number} frames frame count\n   * @return FfmpegCommand\n   */\n  proto.takeFrames =\n  proto.withFrames =\n  proto.frames = function(frames) {\n    this._currentOutput.video('-vframes', frames);\n    return this;\n  };\n};\n","/*jshint node:true*/\n'use strict';\n\n/*\n *! Size helpers\n */\n\n\n/**\n * Return filters to pad video to width*height,\n *\n * @param {Number} width output width\n * @param {Number} height output height\n * @param {Number} aspect video aspect ratio (without padding)\n * @param {Number} color padding color\n * @return scale/pad filters\n * @private\n */\nfunction getScalePadFilters(width, height, aspect, color) {\n  /*\n    let a be the input aspect ratio, A be the requested aspect ratio\n\n    if a > A, padding is done on top and bottom\n    if a < A, padding is done on left and right\n   */\n\n  return [\n    /*\n      In both cases, we first have to scale the input to match the requested size.\n      When using computed width/height, we truncate them to multiples of 2\n     */\n    {\n      filter: 'scale',\n      options: {\n        w: 'if(gt(a,' + aspect + '),' + width + ',trunc(' + height + '*a/2)*2)',\n        h: 'if(lt(a,' + aspect + '),' + height + ',trunc(' + width + '/a/2)*2)'\n      }\n    },\n\n    /*\n      Then we pad the scaled input to match the target size\n      (here iw and ih refer to the padding input, i.e the scaled output)\n     */\n\n    {\n      filter: 'pad',\n      options: {\n        w: width,\n        h: height,\n        x: 'if(gt(a,' + aspect + '),0,(' + width + '-iw)/2)',\n        y: 'if(lt(a,' + aspect + '),0,(' + height + '-ih)/2)',\n        color: color\n      }\n    }\n  ];\n}\n\n\n/**\n * Recompute size filters\n *\n * @param {Object} output\n * @param {String} key newly-added parameter name ('size', 'aspect' or 'pad')\n * @param {String} value newly-added parameter value\n * @return filter string array\n * @private\n */\nfunction createSizeFilters(output, key, value) {\n  // Store parameters\n  var data = output.sizeData = output.sizeData || {};\n  data[key] = value;\n\n  if (!('size' in data)) {\n    // No size requested, keep original size\n    return [];\n  }\n\n  // Try to match the different size string formats\n  var fixedSize = data.size.match(/([0-9]+)x([0-9]+)/);\n  var fixedWidth = data.size.match(/([0-9]+)x\\?/);\n  var fixedHeight = data.size.match(/\\?x([0-9]+)/);\n  var percentRatio = data.size.match(/\\b([0-9]{1,3})%/);\n  var width, height, aspect;\n\n  if (percentRatio) {\n    var ratio = Number(percentRatio[1]) / 100;\n    return [{\n      filter: 'scale',\n      options: {\n        w: 'trunc(iw*' + ratio + '/2)*2',\n        h: 'trunc(ih*' + ratio + '/2)*2'\n      }\n    }];\n  } else if (fixedSize) {\n    // Round target size to multiples of 2\n    width = Math.round(Number(fixedSize[1]) / 2) * 2;\n    height = Math.round(Number(fixedSize[2]) / 2) * 2;\n\n    aspect = width / height;\n\n    if (data.pad) {\n      return getScalePadFilters(width, height, aspect, data.pad);\n    } else {\n      // No autopad requested, rescale to target size\n      return [{ filter: 'scale', options: { w: width, h: height }}];\n    }\n  } else if (fixedWidth || fixedHeight) {\n    if ('aspect' in data) {\n      // Specified aspect ratio\n      width = fixedWidth ? fixedWidth[1] : Math.round(Number(fixedHeight[1]) * data.aspect);\n      height = fixedHeight ? fixedHeight[1] : Math.round(Number(fixedWidth[1]) / data.aspect);\n\n      // Round to multiples of 2\n      width = Math.round(width / 2) * 2;\n      height = Math.round(height / 2) * 2;\n\n      if (data.pad) {\n        return getScalePadFilters(width, height, data.aspect, data.pad);\n      } else {\n        // No autopad requested, rescale to target size\n        return [{ filter: 'scale', options: { w: width, h: height }}];\n      }\n    } else {\n      // Keep input aspect ratio\n\n      if (fixedWidth) {\n        return [{\n          filter: 'scale',\n          options: {\n            w: Math.round(Number(fixedWidth[1]) / 2) * 2,\n            h: 'trunc(ow/a/2)*2'\n          }\n        }];\n      } else {\n        return [{\n          filter: 'scale',\n          options: {\n            w: 'trunc(oh*a/2)*2',\n            h: Math.round(Number(fixedHeight[1]) / 2) * 2\n          }\n        }];\n      }\n    }\n  } else {\n    throw new Error('Invalid size specified: ' + data.size);\n  }\n}\n\n\n/*\n *! Video size-related methods\n */\n\nmodule.exports = function(proto) {\n  /**\n   * Keep display aspect ratio\n   *\n   * This method is useful when converting an input with non-square pixels to an output format\n   * that does not support non-square pixels.  It rescales the input so that the display aspect\n   * ratio is the same.\n   *\n   * @method FfmpegCommand#keepDAR\n   * @category Video size\n   * @aliases keepPixelAspect,keepDisplayAspect,keepDisplayAspectRatio\n   *\n   * @return FfmpegCommand\n   */\n  proto.keepPixelAspect = // Only for compatibility, this is not about keeping _pixel_ aspect ratio\n  proto.keepDisplayAspect =\n  proto.keepDisplayAspectRatio =\n  proto.keepDAR = function() {\n    return this.videoFilters([\n      {\n        filter: 'scale',\n        options: {\n          w: 'if(gt(sar,1),iw*sar,iw)',\n          h: 'if(lt(sar,1),ih/sar,ih)'\n        }\n      },\n      {\n        filter: 'setsar',\n        options: '1'\n      }\n    ]);\n  };\n\n\n  /**\n   * Set output size\n   *\n   * The 'size' parameter can have one of 4 forms:\n   * - 'X%': rescale to xx % of the original size\n   * - 'WxH': specify width and height\n   * - 'Wx?': specify width and compute height from input aspect ratio\n   * - '?xH': specify height and compute width from input aspect ratio\n   *\n   * Note: both dimensions will be truncated to multiples of 2.\n   *\n   * @method FfmpegCommand#size\n   * @category Video size\n   * @aliases withSize,setSize\n   *\n   * @param {String} size size string, eg. '33%', '320x240', '320x?', '?x240'\n   * @return FfmpegCommand\n   */\n  proto.withSize =\n  proto.setSize =\n  proto.size = function(size) {\n    var filters = createSizeFilters(this._currentOutput, 'size', size);\n\n    this._currentOutput.sizeFilters.clear();\n    this._currentOutput.sizeFilters(filters);\n\n    return this;\n  };\n\n\n  /**\n   * Set output aspect ratio\n   *\n   * @method FfmpegCommand#aspect\n   * @category Video size\n   * @aliases withAspect,withAspectRatio,setAspect,setAspectRatio,aspectRatio\n   *\n   * @param {String|Number} aspect aspect ratio (number or 'X:Y' string)\n   * @return FfmpegCommand\n   */\n  proto.withAspect =\n  proto.withAspectRatio =\n  proto.setAspect =\n  proto.setAspectRatio =\n  proto.aspect =\n  proto.aspectRatio = function(aspect) {\n    var a = Number(aspect);\n    if (isNaN(a)) {\n      var match = aspect.match(/^(\\d+):(\\d+)$/);\n      if (match) {\n        a = Number(match[1]) / Number(match[2]);\n      } else {\n        throw new Error('Invalid aspect ratio: ' + aspect);\n      }\n    }\n\n    var filters = createSizeFilters(this._currentOutput, 'aspect', a);\n\n    this._currentOutput.sizeFilters.clear();\n    this._currentOutput.sizeFilters(filters);\n\n    return this;\n  };\n\n\n  /**\n   * Enable auto-padding the output\n   *\n   * @method FfmpegCommand#autopad\n   * @category Video size\n   * @aliases applyAutopadding,applyAutoPadding,applyAutopad,applyAutoPad,withAutopadding,withAutoPadding,withAutopad,withAutoPad,autoPad\n   *\n   * @param {Boolean} [pad=true] enable/disable auto-padding\n   * @param {String} [color='black'] pad color\n   */\n  proto.applyAutopadding =\n  proto.applyAutoPadding =\n  proto.applyAutopad =\n  proto.applyAutoPad =\n  proto.withAutopadding =\n  proto.withAutoPadding =\n  proto.withAutopad =\n  proto.withAutoPad =\n  proto.autoPad =\n  proto.autopad = function(pad, color) {\n    // Allow autopad(color)\n    if (typeof pad === 'string') {\n      color = pad;\n      pad = true;\n    }\n\n    // Allow autopad() and autopad(undefined, color)\n    if (typeof pad === 'undefined') {\n      pad = true;\n    }\n\n    var filters = createSizeFilters(this._currentOutput, 'pad', pad ? color || 'black' : false);\n\n    this._currentOutput.sizeFilters.clear();\n    this._currentOutput.sizeFilters(filters);\n\n    return this;\n  };\n};\n","/*jshint node:true*/\n'use strict';\n\nvar utils = require('../utils');\n\n\n/*\n *! Output-related methods\n */\n\nmodule.exports = function(proto) {\n  /**\n   * Add output\n   *\n   * @method FfmpegCommand#output\n   * @category Output\n   * @aliases addOutput\n   *\n   * @param {String|Writable} target target file path or writable stream\n   * @param {Object} [pipeopts={}] pipe options (only applies to streams)\n   * @return FfmpegCommand\n   */\n  proto.addOutput =\n  proto.output = function(target, pipeopts) {\n    var isFile = false;\n\n    if (!target && this._currentOutput) {\n      // No target is only allowed when called from constructor\n      throw new Error('Invalid output');\n    }\n\n    if (target && typeof target !== 'string') {\n      if (!('writable' in target) || !(target.writable)) {\n        throw new Error('Invalid output');\n      }\n    } else if (typeof target === 'string') {\n      var protocol = target.match(/^([a-z]{2,}):/i);\n      isFile = !protocol || protocol[0] === 'file';\n    }\n\n    if (target && !('target' in this._currentOutput)) {\n      // For backwards compatibility, set target for first output\n      this._currentOutput.target = target;\n      this._currentOutput.isFile = isFile;\n      this._currentOutput.pipeopts = pipeopts || {};\n    } else {\n      if (target && typeof target !== 'string') {\n        var hasOutputStream = this._outputs.some(function(output) {\n          return typeof output.target !== 'string';\n        });\n\n        if (hasOutputStream) {\n          throw new Error('Only one output stream is supported');\n        }\n      }\n\n      this._outputs.push(this._currentOutput = {\n        target: target,\n        isFile: isFile,\n        flags: {},\n        pipeopts: pipeopts || {}\n      });\n\n      var self = this;\n      ['audio', 'audioFilters', 'video', 'videoFilters', 'sizeFilters', 'options'].forEach(function(key) {\n        self._currentOutput[key] = utils.args();\n      });\n\n      if (!target) {\n        // Call from constructor: remove target key\n        delete this._currentOutput.target;\n      }\n    }\n\n    return this;\n  };\n\n\n  /**\n   * Specify output seek time\n   *\n   * @method FfmpegCommand#seek\n   * @category Input\n   * @aliases seekOutput\n   *\n   * @param {String|Number} seek seek time in seconds or as a '[hh:[mm:]]ss[.xxx]' string\n   * @return FfmpegCommand\n   */\n  proto.seekOutput =\n  proto.seek = function(seek) {\n    this._currentOutput.options('-ss', seek);\n    return this;\n  };\n\n\n  /**\n   * Set output duration\n   *\n   * @method FfmpegCommand#duration\n   * @category Output\n   * @aliases withDuration,setDuration\n   *\n   * @param {String|Number} duration duration in seconds or as a '[[hh:]mm:]ss[.xxx]' string\n   * @return FfmpegCommand\n   */\n  proto.withDuration =\n  proto.setDuration =\n  proto.duration = function(duration) {\n    this._currentOutput.options('-t', duration);\n    return this;\n  };\n\n\n  /**\n   * Set output format\n   *\n   * @method FfmpegCommand#format\n   * @category Output\n   * @aliases toFormat,withOutputFormat,outputFormat\n   *\n   * @param {String} format output format name\n   * @return FfmpegCommand\n   */\n  proto.toFormat =\n  proto.withOutputFormat =\n  proto.outputFormat =\n  proto.format = function(format) {\n    this._currentOutput.options('-f', format);\n    return this;\n  };\n\n\n  /**\n   * Add stream mapping to output\n   *\n   * @method FfmpegCommand#map\n   * @category Output\n   *\n   * @param {String} spec stream specification string, with optional square brackets\n   * @return FfmpegCommand\n   */\n  proto.map = function(spec) {\n    this._currentOutput.options('-map', spec.replace(utils.streamRegexp, '[$1]'));\n    return this;\n  };\n\n\n  /**\n   * Run flvtool2/flvmeta on output\n   *\n   * @method FfmpegCommand#flvmeta\n   * @category Output\n   * @aliases updateFlvMetadata\n   *\n   * @return FfmpegCommand\n   */\n  proto.updateFlvMetadata =\n  proto.flvmeta = function() {\n    this._currentOutput.flags.flvmeta = true;\n    return this;\n  };\n};\n","/*jshint node:true*/\n'use strict';\n\nvar utils = require('../utils');\n\n\n/*\n *! Custom options methods\n */\n\nmodule.exports = function(proto) {\n  /**\n   * Add custom input option(s)\n   *\n   * When passing a single string or an array, each string containing two\n   * words is split (eg. inputOptions('-option value') is supported) for\n   * compatibility reasons.  This is not the case when passing more than\n   * one argument.\n   *\n   * @example\n   * command.inputOptions('option1');\n   *\n   * @example\n   * command.inputOptions('option1', 'option2');\n   *\n   * @example\n   * command.inputOptions(['option1', 'option2']);\n   *\n   * @method FfmpegCommand#inputOptions\n   * @category Custom options\n   * @aliases addInputOption,addInputOptions,withInputOption,withInputOptions,inputOption\n   *\n   * @param {...String} options option string(s) or string array\n   * @return FfmpegCommand\n   */\n  proto.addInputOption =\n  proto.addInputOptions =\n  proto.withInputOption =\n  proto.withInputOptions =\n  proto.inputOption =\n  proto.inputOptions = function(options) {\n    if (!this._currentInput) {\n      throw new Error('No input specified');\n    }\n\n    var doSplit = true;\n\n    if (arguments.length > 1) {\n      options = [].slice.call(arguments);\n      doSplit = false;\n    }\n\n    if (!Array.isArray(options)) {\n      options = [options];\n    }\n\n    this._currentInput.options(options.reduce(function(options, option) {\n      var split = String(option).split(' ');\n\n      if (doSplit && split.length === 2) {\n        options.push(split[0], split[1]);\n      } else {\n        options.push(option);\n      }\n\n      return options;\n    }, []));\n    return this;\n  };\n\n\n  /**\n   * Add custom output option(s)\n   *\n   * @example\n   * command.outputOptions('option1');\n   *\n   * @example\n   * command.outputOptions('option1', 'option2');\n   *\n   * @example\n   * command.outputOptions(['option1', 'option2']);\n   *\n   * @method FfmpegCommand#outputOptions\n   * @category Custom options\n   * @aliases addOutputOption,addOutputOptions,addOption,addOptions,withOutputOption,withOutputOptions,withOption,withOptions,outputOption\n   *\n   * @param {...String} options option string(s) or string array\n   * @return FfmpegCommand\n   */\n  proto.addOutputOption =\n  proto.addOutputOptions =\n  proto.addOption =\n  proto.addOptions =\n  proto.withOutputOption =\n  proto.withOutputOptions =\n  proto.withOption =\n  proto.withOptions =\n  proto.outputOption =\n  proto.outputOptions = function(options) {\n    var doSplit = true;\n\n    if (arguments.length > 1) {\n      options = [].slice.call(arguments);\n      doSplit = false;\n    }\n\n    if (!Array.isArray(options)) {\n      options = [options];\n    }\n\n    this._currentOutput.options(options.reduce(function(options, option) {\n      var split = String(option).split(' ');\n\n      if (doSplit && split.length === 2) {\n        options.push(split[0], split[1]);\n      } else {\n        options.push(option);\n      }\n\n      return options;\n    }, []));\n    return this;\n  };\n\n\n  /**\n   * Specify a complex filtergraph\n   *\n   * Calling this method will override any previously set filtergraph, but you can set\n   * as many filters as needed in one call.\n   *\n   * @example <caption>Overlay an image over a video (using a filtergraph string)</caption>\n   *   ffmpeg()\n   *     .input('video.avi')\n   *     .input('image.png')\n   *     .complexFilter('[0:v][1:v]overlay[out]', ['out']);\n   *\n   * @example <caption>Overlay an image over a video (using a filter array)</caption>\n   *   ffmpeg()\n   *     .input('video.avi')\n   *     .input('image.png')\n   *     .complexFilter([{\n   *       filter: 'overlay',\n   *       inputs: ['0:v', '1:v'],\n   *       outputs: ['out']\n   *     }], ['out']);\n   *\n   * @example <caption>Split video into RGB channels and output a 3x1 video with channels side to side</caption>\n   *  ffmpeg()\n   *    .input('video.avi')\n   *    .complexFilter([\n   *      // Duplicate video stream 3 times into streams a, b, and c\n   *      { filter: 'split', options: '3', outputs: ['a', 'b', 'c'] },\n   *\n   *      // Create stream 'red' by cancelling green and blue channels from stream 'a'\n   *      { filter: 'lutrgb', options: { g: 0, b: 0 }, inputs: 'a', outputs: 'red' },\n   *\n   *      // Create stream 'green' by cancelling red and blue channels from stream 'b'\n   *      { filter: 'lutrgb', options: { r: 0, b: 0 }, inputs: 'b', outputs: 'green' },\n   *\n   *      // Create stream 'blue' by cancelling red and green channels from stream 'c'\n   *      { filter: 'lutrgb', options: { r: 0, g: 0 }, inputs: 'c', outputs: 'blue' },\n   *\n   *      // Pad stream 'red' to 3x width, keeping the video on the left, and name output 'padded'\n   *      { filter: 'pad', options: { w: 'iw*3', h: 'ih' }, inputs: 'red', outputs: 'padded' },\n   *\n   *      // Overlay 'green' onto 'padded', moving it to the center, and name output 'redgreen'\n   *      { filter: 'overlay', options: { x: 'w', y: 0 }, inputs: ['padded', 'green'], outputs: 'redgreen'},\n   *\n   *      // Overlay 'blue' onto 'redgreen', moving it to the right\n   *      { filter: 'overlay', options: { x: '2*w', y: 0 }, inputs: ['redgreen', 'blue']},\n   *    ]);\n   *\n   * @method FfmpegCommand#complexFilter\n   * @category Custom options\n   * @aliases filterGraph\n   *\n   * @param {String|Array} spec filtergraph string or array of filter specification\n   *   objects, each having the following properties:\n   * @param {String} spec.filter filter name\n   * @param {String|Array} [spec.inputs] (array of) input stream specifier(s) for the filter,\n   *   defaults to ffmpeg automatically choosing the first unused matching streams\n   * @param {String|Array} [spec.outputs] (array of) output stream specifier(s) for the filter,\n   *   defaults to ffmpeg automatically assigning the output to the output file\n   * @param {Object|String|Array} [spec.options] filter options, can be omitted to not set any options\n   * @param {Array} [map] (array of) stream specifier(s) from the graph to include in\n   *   ffmpeg output, defaults to ffmpeg automatically choosing the first matching streams.\n   * @return FfmpegCommand\n   */\n  proto.filterGraph =\n  proto.complexFilter = function(spec, map) {\n    this._complexFilters.clear();\n\n    if (!Array.isArray(spec)) {\n      spec = [spec];\n    }\n\n    this._complexFilters('-filter_complex', utils.makeFilterStrings(spec).join(';'));\n\n    if (Array.isArray(map)) {\n      var self = this;\n      map.forEach(function(streamSpec) {\n        self._complexFilters('-map', streamSpec.replace(utils.streamRegexp, '[$1]'));\n      });\n    } else if (typeof map === 'string') {\n      this._complexFilters('-map', map.replace(utils.streamRegexp, '[$1]'));\n    }\n\n    return this;\n  };\n};\n","/*jshint node:true*/\n'use strict';\n\nvar path = require('path');\n\n/*\n *! Miscellaneous methods\n */\n\nmodule.exports = function(proto) {\n  /**\n   * Use preset\n   *\n   * @method FfmpegCommand#preset\n   * @category Miscellaneous\n   * @aliases usingPreset\n   *\n   * @param {String|Function} preset preset name or preset function\n   */\n  proto.usingPreset =\n  proto.preset = function(preset) {\n    if (typeof preset === 'function') {\n      preset(this);\n    } else {\n      try {\n        var modulePath = path.join(this.options.presets, preset);\n        var module = require(modulePath);\n\n        if (typeof module.load === 'function') {\n          module.load(this);\n        } else {\n          throw new Error('preset ' + modulePath + ' has no load() function');\n        }\n      } catch (err) {\n        throw new Error('preset ' + modulePath + ' could not be loaded: ' + err.message);\n      }\n    }\n\n    return this;\n  };\n};\n","/*global setImmediate: false, setTimeout: false, console: false */\n(function () {\n\n    var async = {};\n\n    // global on the server, window in the browser\n    var root, previous_async;\n\n    root = this;\n    if (root != null) {\n      previous_async = root.async;\n    }\n\n    async.noConflict = function () {\n        root.async = previous_async;\n        return async;\n    };\n\n    function only_once(fn) {\n        var called = false;\n        return function() {\n            if (called) throw new Error(\"Callback was already called.\");\n            called = true;\n            fn.apply(root, arguments);\n        }\n    }\n\n    //// cross-browser compatiblity functions ////\n\n    var _each = function (arr, iterator) {\n        if (arr.forEach) {\n            return arr.forEach(iterator);\n        }\n        for (var i = 0; i < arr.length; i += 1) {\n            iterator(arr[i], i, arr);\n        }\n    };\n\n    var _map = function (arr, iterator) {\n        if (arr.map) {\n            return arr.map(iterator);\n        }\n        var results = [];\n        _each(arr, function (x, i, a) {\n            results.push(iterator(x, i, a));\n        });\n        return results;\n    };\n\n    var _reduce = function (arr, iterator, memo) {\n        if (arr.reduce) {\n            return arr.reduce(iterator, memo);\n        }\n        _each(arr, function (x, i, a) {\n            memo = iterator(memo, x, i, a);\n        });\n        return memo;\n    };\n\n    var _keys = function (obj) {\n        if (Object.keys) {\n            return Object.keys(obj);\n        }\n        var keys = [];\n        for (var k in obj) {\n            if (obj.hasOwnProperty(k)) {\n                keys.push(k);\n            }\n        }\n        return keys;\n    };\n\n    //// exported async module functions ////\n\n    //// nextTick implementation with browser-compatible fallback ////\n    if (typeof process === 'undefined' || !(process.nextTick)) {\n        if (typeof setImmediate === 'function') {\n            async.nextTick = function (fn) {\n                // not a direct alias for IE10 compatibility\n                setImmediate(fn);\n            };\n            async.setImmediate = async.nextTick;\n        }\n        else {\n            async.nextTick = function (fn) {\n                setTimeout(fn, 0);\n            };\n            async.setImmediate = async.nextTick;\n        }\n    }\n    else {\n        async.nextTick = process.nextTick;\n        if (typeof setImmediate !== 'undefined') {\n            async.setImmediate = function (fn) {\n              // not a direct alias for IE10 compatibility\n              setImmediate(fn);\n            };\n        }\n        else {\n            async.setImmediate = async.nextTick;\n        }\n    }\n\n    async.each = function (arr, iterator, callback) {\n        callback = callback || function () {};\n        if (!arr.length) {\n            return callback();\n        }\n        var completed = 0;\n        _each(arr, function (x) {\n            iterator(x, only_once(function (err) {\n                if (err) {\n                    callback(err);\n                    callback = function () {};\n                }\n                else {\n                    completed += 1;\n                    if (completed >= arr.length) {\n                        callback(null);\n                    }\n                }\n            }));\n        });\n    };\n    async.forEach = async.each;\n\n    async.eachSeries = function (arr, iterator, callback) {\n        callback = callback || function () {};\n        if (!arr.length) {\n            return callback();\n        }\n        var completed = 0;\n        var iterate = function () {\n            iterator(arr[completed], function (err) {\n                if (err) {\n                    callback(err);\n                    callback = function () {};\n                }\n                else {\n                    completed += 1;\n                    if (completed >= arr.length) {\n                        callback(null);\n                    }\n                    else {\n                        iterate();\n                    }\n                }\n            });\n        };\n        iterate();\n    };\n    async.forEachSeries = async.eachSeries;\n\n    async.eachLimit = function (arr, limit, iterator, callback) {\n        var fn = _eachLimit(limit);\n        fn.apply(null, [arr, iterator, callback]);\n    };\n    async.forEachLimit = async.eachLimit;\n\n    var _eachLimit = function (limit) {\n\n        return function (arr, iterator, callback) {\n            callback = callback || function () {};\n            if (!arr.length || limit <= 0) {\n                return callback();\n            }\n            var completed = 0;\n            var started = 0;\n            var running = 0;\n\n            (function replenish () {\n                if (completed >= arr.length) {\n                    return callback();\n                }\n\n                while (running < limit && started < arr.length) {\n                    started += 1;\n                    running += 1;\n                    iterator(arr[started - 1], function (err) {\n                        if (err) {\n                            callback(err);\n                            callback = function () {};\n                        }\n                        else {\n                            completed += 1;\n                            running -= 1;\n                            if (completed >= arr.length) {\n                                callback();\n                            }\n                            else {\n                                replenish();\n                            }\n                        }\n                    });\n                }\n            })();\n        };\n    };\n\n\n    var doParallel = function (fn) {\n        return function () {\n            var args = Array.prototype.slice.call(arguments);\n            return fn.apply(null, [async.each].concat(args));\n        };\n    };\n    var doParallelLimit = function(limit, fn) {\n        return function () {\n            var args = Array.prototype.slice.call(arguments);\n            return fn.apply(null, [_eachLimit(limit)].concat(args));\n        };\n    };\n    var doSeries = function (fn) {\n        return function () {\n            var args = Array.prototype.slice.call(arguments);\n            return fn.apply(null, [async.eachSeries].concat(args));\n        };\n    };\n\n\n    var _asyncMap = function (eachfn, arr, iterator, callback) {\n        var results = [];\n        arr = _map(arr, function (x, i) {\n            return {index: i, value: x};\n        });\n        eachfn(arr, function (x, callback) {\n            iterator(x.value, function (err, v) {\n                results[x.index] = v;\n                callback(err);\n            });\n        }, function (err) {\n            callback(err, results);\n        });\n    };\n    async.map = doParallel(_asyncMap);\n    async.mapSeries = doSeries(_asyncMap);\n    async.mapLimit = function (arr, limit, iterator, callback) {\n        return _mapLimit(limit)(arr, iterator, callback);\n    };\n\n    var _mapLimit = function(limit) {\n        return doParallelLimit(limit, _asyncMap);\n    };\n\n    // reduce only has a series version, as doing reduce in parallel won't\n    // work in many situations.\n    async.reduce = function (arr, memo, iterator, callback) {\n        async.eachSeries(arr, function (x, callback) {\n            iterator(memo, x, function (err, v) {\n                memo = v;\n                callback(err);\n            });\n        }, function (err) {\n            callback(err, memo);\n        });\n    };\n    // inject alias\n    async.inject = async.reduce;\n    // foldl alias\n    async.foldl = async.reduce;\n\n    async.reduceRight = function (arr, memo, iterator, callback) {\n        var reversed = _map(arr, function (x) {\n            return x;\n        }).reverse();\n        async.reduce(reversed, memo, iterator, callback);\n    };\n    // foldr alias\n    async.foldr = async.reduceRight;\n\n    var _filter = function (eachfn, arr, iterator, callback) {\n        var results = [];\n        arr = _map(arr, function (x, i) {\n            return {index: i, value: x};\n        });\n        eachfn(arr, function (x, callback) {\n            iterator(x.value, function (v) {\n                if (v) {\n                    results.push(x);\n                }\n                callback();\n            });\n        }, function (err) {\n            callback(_map(results.sort(function (a, b) {\n                return a.index - b.index;\n            }), function (x) {\n                return x.value;\n            }));\n        });\n    };\n    async.filter = doParallel(_filter);\n    async.filterSeries = doSeries(_filter);\n    // select alias\n    async.select = async.filter;\n    async.selectSeries = async.filterSeries;\n\n    var _reject = function (eachfn, arr, iterator, callback) {\n        var results = [];\n        arr = _map(arr, function (x, i) {\n            return {index: i, value: x};\n        });\n        eachfn(arr, function (x, callback) {\n            iterator(x.value, function (v) {\n                if (!v) {\n                    results.push(x);\n                }\n                callback();\n            });\n        }, function (err) {\n            callback(_map(results.sort(function (a, b) {\n                return a.index - b.index;\n            }), function (x) {\n                return x.value;\n            }));\n        });\n    };\n    async.reject = doParallel(_reject);\n    async.rejectSeries = doSeries(_reject);\n\n    var _detect = function (eachfn, arr, iterator, main_callback) {\n        eachfn(arr, function (x, callback) {\n            iterator(x, function (result) {\n                if (result) {\n                    main_callback(x);\n                    main_callback = function () {};\n                }\n                else {\n                    callback();\n                }\n            });\n        }, function (err) {\n            main_callback();\n        });\n    };\n    async.detect = doParallel(_detect);\n    async.detectSeries = doSeries(_detect);\n\n    async.some = function (arr, iterator, main_callback) {\n        async.each(arr, function (x, callback) {\n            iterator(x, function (v) {\n                if (v) {\n                    main_callback(true);\n                    main_callback = function () {};\n                }\n                callback();\n            });\n        }, function (err) {\n            main_callback(false);\n        });\n    };\n    // any alias\n    async.any = async.some;\n\n    async.every = function (arr, iterator, main_callback) {\n        async.each(arr, function (x, callback) {\n            iterator(x, function (v) {\n                if (!v) {\n                    main_callback(false);\n                    main_callback = function () {};\n                }\n                callback();\n            });\n        }, function (err) {\n            main_callback(true);\n        });\n    };\n    // all alias\n    async.all = async.every;\n\n    async.sortBy = function (arr, iterator, callback) {\n        async.map(arr, function (x, callback) {\n            iterator(x, function (err, criteria) {\n                if (err) {\n                    callback(err);\n                }\n                else {\n                    callback(null, {value: x, criteria: criteria});\n                }\n            });\n        }, function (err, results) {\n            if (err) {\n                return callback(err);\n            }\n            else {\n                var fn = function (left, right) {\n                    var a = left.criteria, b = right.criteria;\n                    return a < b ? -1 : a > b ? 1 : 0;\n                };\n                callback(null, _map(results.sort(fn), function (x) {\n                    return x.value;\n                }));\n            }\n        });\n    };\n\n    async.auto = function (tasks, callback) {\n        callback = callback || function () {};\n        var keys = _keys(tasks);\n        if (!keys.length) {\n            return callback(null);\n        }\n\n        var results = {};\n\n        var listeners = [];\n        var addListener = function (fn) {\n            listeners.unshift(fn);\n        };\n        var removeListener = function (fn) {\n            for (var i = 0; i < listeners.length; i += 1) {\n                if (listeners[i] === fn) {\n                    listeners.splice(i, 1);\n                    return;\n                }\n            }\n        };\n        var taskComplete = function () {\n            _each(listeners.slice(0), function (fn) {\n                fn();\n            });\n        };\n\n        addListener(function () {\n            if (_keys(results).length === keys.length) {\n                callback(null, results);\n                callback = function () {};\n            }\n        });\n\n        _each(keys, function (k) {\n            var task = (tasks[k] instanceof Function) ? [tasks[k]]: tasks[k];\n            var taskCallback = function (err) {\n                var args = Array.prototype.slice.call(arguments, 1);\n                if (args.length <= 1) {\n                    args = args[0];\n                }\n                if (err) {\n                    var safeResults = {};\n                    _each(_keys(results), function(rkey) {\n                        safeResults[rkey] = results[rkey];\n                    });\n                    safeResults[k] = args;\n                    callback(err, safeResults);\n                    // stop subsequent errors hitting callback multiple times\n                    callback = function () {};\n                }\n                else {\n                    results[k] = args;\n                    async.setImmediate(taskComplete);\n                }\n            };\n            var requires = task.slice(0, Math.abs(task.length - 1)) || [];\n            var ready = function () {\n                return _reduce(requires, function (a, x) {\n                    return (a && results.hasOwnProperty(x));\n                }, true) && !results.hasOwnProperty(k);\n            };\n            if (ready()) {\n                task[task.length - 1](taskCallback, results);\n            }\n            else {\n                var listener = function () {\n                    if (ready()) {\n                        removeListener(listener);\n                        task[task.length - 1](taskCallback, results);\n                    }\n                };\n                addListener(listener);\n            }\n        });\n    };\n\n    async.waterfall = function (tasks, callback) {\n        callback = callback || function () {};\n        if (tasks.constructor !== Array) {\n          var err = new Error('First argument to waterfall must be an array of functions');\n          return callback(err);\n        }\n        if (!tasks.length) {\n            return callback();\n        }\n        var wrapIterator = function (iterator) {\n            return function (err) {\n                if (err) {\n                    callback.apply(null, arguments);\n                    callback = function () {};\n                }\n                else {\n                    var args = Array.prototype.slice.call(arguments, 1);\n                    var next = iterator.next();\n                    if (next) {\n                        args.push(wrapIterator(next));\n                    }\n                    else {\n                        args.push(callback);\n                    }\n                    async.setImmediate(function () {\n                        iterator.apply(null, args);\n                    });\n                }\n            };\n        };\n        wrapIterator(async.iterator(tasks))();\n    };\n\n    var _parallel = function(eachfn, tasks, callback) {\n        callback = callback || function () {};\n        if (tasks.constructor === Array) {\n            eachfn.map(tasks, function (fn, callback) {\n                if (fn) {\n                    fn(function (err) {\n                        var args = Array.prototype.slice.call(arguments, 1);\n                        if (args.length <= 1) {\n                            args = args[0];\n                        }\n                        callback.call(null, err, args);\n                    });\n                }\n            }, callback);\n        }\n        else {\n            var results = {};\n            eachfn.each(_keys(tasks), function (k, callback) {\n                tasks[k](function (err) {\n                    var args = Array.prototype.slice.call(arguments, 1);\n                    if (args.length <= 1) {\n                        args = args[0];\n                    }\n                    results[k] = args;\n                    callback(err);\n                });\n            }, function (err) {\n                callback(err, results);\n            });\n        }\n    };\n\n    async.parallel = function (tasks, callback) {\n        _parallel({ map: async.map, each: async.each }, tasks, callback);\n    };\n\n    async.parallelLimit = function(tasks, limit, callback) {\n        _parallel({ map: _mapLimit(limit), each: _eachLimit(limit) }, tasks, callback);\n    };\n\n    async.series = function (tasks, callback) {\n        callback = callback || function () {};\n        if (tasks.constructor === Array) {\n            async.mapSeries(tasks, function (fn, callback) {\n                if (fn) {\n                    fn(function (err) {\n                        var args = Array.prototype.slice.call(arguments, 1);\n                        if (args.length <= 1) {\n                            args = args[0];\n                        }\n                        callback.call(null, err, args);\n                    });\n                }\n            }, callback);\n        }\n        else {\n            var results = {};\n            async.eachSeries(_keys(tasks), function (k, callback) {\n                tasks[k](function (err) {\n                    var args = Array.prototype.slice.call(arguments, 1);\n                    if (args.length <= 1) {\n                        args = args[0];\n                    }\n                    results[k] = args;\n                    callback(err);\n                });\n            }, function (err) {\n                callback(err, results);\n            });\n        }\n    };\n\n    async.iterator = function (tasks) {\n        var makeCallback = function (index) {\n            var fn = function () {\n                if (tasks.length) {\n                    tasks[index].apply(null, arguments);\n                }\n                return fn.next();\n            };\n            fn.next = function () {\n                return (index < tasks.length - 1) ? makeCallback(index + 1): null;\n            };\n            return fn;\n        };\n        return makeCallback(0);\n    };\n\n    async.apply = function (fn) {\n        var args = Array.prototype.slice.call(arguments, 1);\n        return function () {\n            return fn.apply(\n                null, args.concat(Array.prototype.slice.call(arguments))\n            );\n        };\n    };\n\n    var _concat = function (eachfn, arr, fn, callback) {\n        var r = [];\n        eachfn(arr, function (x, cb) {\n            fn(x, function (err, y) {\n                r = r.concat(y || []);\n                cb(err);\n            });\n        }, function (err) {\n            callback(err, r);\n        });\n    };\n    async.concat = doParallel(_concat);\n    async.concatSeries = doSeries(_concat);\n\n    async.whilst = function (test, iterator, callback) {\n        if (test()) {\n            iterator(function (err) {\n                if (err) {\n                    return callback(err);\n                }\n                async.whilst(test, iterator, callback);\n            });\n        }\n        else {\n            callback();\n        }\n    };\n\n    async.doWhilst = function (iterator, test, callback) {\n        iterator(function (err) {\n            if (err) {\n                return callback(err);\n            }\n            if (test()) {\n                async.doWhilst(iterator, test, callback);\n            }\n            else {\n                callback();\n            }\n        });\n    };\n\n    async.until = function (test, iterator, callback) {\n        if (!test()) {\n            iterator(function (err) {\n                if (err) {\n                    return callback(err);\n                }\n                async.until(test, iterator, callback);\n            });\n        }\n        else {\n            callback();\n        }\n    };\n\n    async.doUntil = function (iterator, test, callback) {\n        iterator(function (err) {\n            if (err) {\n                return callback(err);\n            }\n            if (!test()) {\n                async.doUntil(iterator, test, callback);\n            }\n            else {\n                callback();\n            }\n        });\n    };\n\n    async.queue = function (worker, concurrency) {\n        if (concurrency === undefined) {\n            concurrency = 1;\n        }\n        function _insert(q, data, pos, callback) {\n          if(data.constructor !== Array) {\n              data = [data];\n          }\n          _each(data, function(task) {\n              var item = {\n                  data: task,\n                  callback: typeof callback === 'function' ? callback : null\n              };\n\n              if (pos) {\n                q.tasks.unshift(item);\n              } else {\n                q.tasks.push(item);\n              }\n\n              if (q.saturated && q.tasks.length === concurrency) {\n                  q.saturated();\n              }\n              async.setImmediate(q.process);\n          });\n        }\n\n        var workers = 0;\n        var q = {\n            tasks: [],\n            concurrency: concurrency,\n            saturated: null,\n            empty: null,\n            drain: null,\n            push: function (data, callback) {\n              _insert(q, data, false, callback);\n            },\n            unshift: function (data, callback) {\n              _insert(q, data, true, callback);\n            },\n            process: function () {\n                if (workers < q.concurrency && q.tasks.length) {\n                    var task = q.tasks.shift();\n                    if (q.empty && q.tasks.length === 0) {\n                        q.empty();\n                    }\n                    workers += 1;\n                    var next = function () {\n                        workers -= 1;\n                        if (task.callback) {\n                            task.callback.apply(task, arguments);\n                        }\n                        if (q.drain && q.tasks.length + workers === 0) {\n                            q.drain();\n                        }\n                        q.process();\n                    };\n                    var cb = only_once(next);\n                    worker(task.data, cb);\n                }\n            },\n            length: function () {\n                return q.tasks.length;\n            },\n            running: function () {\n                return workers;\n            }\n        };\n        return q;\n    };\n\n    async.cargo = function (worker, payload) {\n        var working     = false,\n            tasks       = [];\n\n        var cargo = {\n            tasks: tasks,\n            payload: payload,\n            saturated: null,\n            empty: null,\n            drain: null,\n            push: function (data, callback) {\n                if(data.constructor !== Array) {\n                    data = [data];\n                }\n                _each(data, function(task) {\n                    tasks.push({\n                        data: task,\n                        callback: typeof callback === 'function' ? callback : null\n                    });\n                    if (cargo.saturated && tasks.length === payload) {\n                        cargo.saturated();\n                    }\n                });\n                async.setImmediate(cargo.process);\n            },\n            process: function process() {\n                if (working) return;\n                if (tasks.length === 0) {\n                    if(cargo.drain) cargo.drain();\n                    return;\n                }\n\n                var ts = typeof payload === 'number'\n                            ? tasks.splice(0, payload)\n                            : tasks.splice(0);\n\n                var ds = _map(ts, function (task) {\n                    return task.data;\n                });\n\n                if(cargo.empty) cargo.empty();\n                working = true;\n                worker(ds, function () {\n                    working = false;\n\n                    var args = arguments;\n                    _each(ts, function (data) {\n                        if (data.callback) {\n                            data.callback.apply(null, args);\n                        }\n                    });\n\n                    process();\n                });\n            },\n            length: function () {\n                return tasks.length;\n            },\n            running: function () {\n                return working;\n            }\n        };\n        return cargo;\n    };\n\n    var _console_fn = function (name) {\n        return function (fn) {\n            var args = Array.prototype.slice.call(arguments, 1);\n            fn.apply(null, args.concat([function (err) {\n                var args = Array.prototype.slice.call(arguments, 1);\n                if (typeof console !== 'undefined') {\n                    if (err) {\n                        if (console.error) {\n                            console.error(err);\n                        }\n                    }\n                    else if (console[name]) {\n                        _each(args, function (x) {\n                            console[name](x);\n                        });\n                    }\n                }\n            }]));\n        };\n    };\n    async.log = _console_fn('log');\n    async.dir = _console_fn('dir');\n    /*async.info = _console_fn('info');\n    async.warn = _console_fn('warn');\n    async.error = _console_fn('error');*/\n\n    async.memoize = function (fn, hasher) {\n        var memo = {};\n        var queues = {};\n        hasher = hasher || function (x) {\n            return x;\n        };\n        var memoized = function () {\n            var args = Array.prototype.slice.call(arguments);\n            var callback = args.pop();\n            var key = hasher.apply(null, args);\n            if (key in memo) {\n                callback.apply(null, memo[key]);\n            }\n            else if (key in queues) {\n                queues[key].push(callback);\n            }\n            else {\n                queues[key] = [callback];\n                fn.apply(null, args.concat([function () {\n                    memo[key] = arguments;\n                    var q = queues[key];\n                    delete queues[key];\n                    for (var i = 0, l = q.length; i < l; i++) {\n                      q[i].apply(null, arguments);\n                    }\n                }]));\n            }\n        };\n        memoized.memo = memo;\n        memoized.unmemoized = fn;\n        return memoized;\n    };\n\n    async.unmemoize = function (fn) {\n      return function () {\n        return (fn.unmemoized || fn).apply(null, arguments);\n      };\n    };\n\n    async.times = function (count, iterator, callback) {\n        var counter = [];\n        for (var i = 0; i < count; i++) {\n            counter.push(i);\n        }\n        return async.map(counter, iterator, callback);\n    };\n\n    async.timesSeries = function (count, iterator, callback) {\n        var counter = [];\n        for (var i = 0; i < count; i++) {\n            counter.push(i);\n        }\n        return async.mapSeries(counter, iterator, callback);\n    };\n\n    async.compose = function (/* functions... */) {\n        var fns = Array.prototype.reverse.call(arguments);\n        return function () {\n            var that = this;\n            var args = Array.prototype.slice.call(arguments);\n            var callback = args.pop();\n            async.reduce(fns, args, function (newargs, fn, cb) {\n                fn.apply(that, newargs.concat([function () {\n                    var err = arguments[0];\n                    var nextargs = Array.prototype.slice.call(arguments, 1);\n                    cb(err, nextargs);\n                }]))\n            },\n            function (err, results) {\n                callback.apply(that, [err].concat(results));\n            });\n        };\n    };\n\n    var _applyEach = function (eachfn, fns /*args...*/) {\n        var go = function () {\n            var that = this;\n            var args = Array.prototype.slice.call(arguments);\n            var callback = args.pop();\n            return eachfn(fns, function (fn, cb) {\n                fn.apply(that, args.concat([cb]));\n            },\n            callback);\n        };\n        if (arguments.length > 2) {\n            var args = Array.prototype.slice.call(arguments, 2);\n            return go.apply(this, args);\n        }\n        else {\n            return go;\n        }\n    };\n    async.applyEach = doParallel(_applyEach);\n    async.applyEachSeries = doSeries(_applyEach);\n\n    async.forever = function (fn, callback) {\n        function next(err) {\n            if (err) {\n                if (callback) {\n                    return callback(err);\n                }\n                throw err;\n            }\n            fn(next);\n        }\n        next();\n    };\n\n    // AMD / RequireJS\n    if (typeof define !== 'undefined' && define.amd) {\n        define([], function () {\n            return async;\n        });\n    }\n    // Node.js\n    else if (typeof module !== 'undefined' && module.exports) {\n        module.exports = async;\n    }\n    // included directly via <script> tag\n    else {\n        root.async = async;\n    }\n\n}());\n","/*jshint node:true*/\n'use strict';\n\nvar spawn = require('child_process').spawn;\nvar path = require('path');\nvar fs = require('fs');\nvar async = require('async');\nvar utils = require('./utils');\n\n/*\n *! Processor methods\n */\n\n\n/**\n * Run ffprobe asynchronously and store data in command\n *\n * @param {FfmpegCommand} command\n * @private\n */\nfunction runFfprobe(command) {\n  const inputProbeIndex = 0;\n  if (command._inputs[inputProbeIndex].isStream) {\n    // Don't probe input streams as this will consume them\n    return;\n  }\n  command.ffprobe(inputProbeIndex, function(err, data) {\n    command._ffprobeData = data;\n  });\n}\n\n\nmodule.exports = function(proto) {\n  /**\n   * Emitted just after ffmpeg has been spawned.\n   *\n   * @event FfmpegCommand#start\n   * @param {String} command ffmpeg command line\n   */\n\n  /**\n   * Emitted when ffmpeg reports progress information\n   *\n   * @event FfmpegCommand#progress\n   * @param {Object} progress progress object\n   * @param {Number} progress.frames number of frames transcoded\n   * @param {Number} progress.currentFps current processing speed in frames per second\n   * @param {Number} progress.currentKbps current output generation speed in kilobytes per second\n   * @param {Number} progress.targetSize current output file size\n   * @param {String} progress.timemark current video timemark\n   * @param {Number} [progress.percent] processing progress (may not be available depending on input)\n   */\n\n  /**\n   * Emitted when ffmpeg outputs to stderr\n   *\n   * @event FfmpegCommand#stderr\n   * @param {String} line stderr output line\n   */\n\n  /**\n   * Emitted when ffmpeg reports input codec data\n   *\n   * @event FfmpegCommand#codecData\n   * @param {Object} codecData codec data object\n   * @param {String} codecData.format input format name\n   * @param {String} codecData.audio input audio codec name\n   * @param {String} codecData.audio_details input audio codec parameters\n   * @param {String} codecData.video input video codec name\n   * @param {String} codecData.video_details input video codec parameters\n   */\n\n  /**\n   * Emitted when an error happens when preparing or running a command\n   *\n   * @event FfmpegCommand#error\n   * @param {Error} error error object, with optional properties 'inputStreamError' / 'outputStreamError' for errors on their respective streams\n   * @param {String|null} stdout ffmpeg stdout, unless outputting to a stream\n   * @param {String|null} stderr ffmpeg stderr\n   */\n\n  /**\n   * Emitted when a command finishes processing\n   *\n   * @event FfmpegCommand#end\n   * @param {Array|String|null} [filenames|stdout] generated filenames when taking screenshots, ffmpeg stdout when not outputting to a stream, null otherwise\n   * @param {String|null} stderr ffmpeg stderr\n   */\n\n\n  /**\n   * Spawn an ffmpeg process\n   *\n   * The 'options' argument may contain the following keys:\n   * - 'niceness': specify process niceness, ignored on Windows (default: 0)\n   * - `cwd`: change working directory\n   * - 'captureStdout': capture stdout and pass it to 'endCB' as its 2nd argument (default: false)\n   * - 'stdoutLines': override command limit (default: use command limit)\n   *\n   * The 'processCB' callback, if present, is called as soon as the process is created and\n   * receives a nodejs ChildProcess object.  It may not be called at all if an error happens\n   * before spawning the process.\n   *\n   * The 'endCB' callback is called either when an error occurs or when the ffmpeg process finishes.\n   *\n   * @method FfmpegCommand#_spawnFfmpeg\n   * @param {Array} args ffmpeg command line argument list\n   * @param {Object} [options] spawn options (see above)\n   * @param {Function} [processCB] callback called with process object and stdout/stderr ring buffers when process has been created\n   * @param {Function} endCB callback called with error (if applicable) and stdout/stderr ring buffers when process finished\n   * @private\n   */\n  proto._spawnFfmpeg = function(args, options, processCB, endCB) {\n    // Enable omitting options\n    if (typeof options === 'function') {\n      endCB = processCB;\n      processCB = options;\n      options = {};\n    }\n\n    // Enable omitting processCB\n    if (typeof endCB === 'undefined') {\n      endCB = processCB;\n      processCB = function() {};\n    }\n\n    var maxLines = 'stdoutLines' in options ? options.stdoutLines : this.options.stdoutLines;\n\n    // Find ffmpeg\n    this._getFfmpegPath(function(err, command) {\n      if (err) {\n        return endCB(err);\n      } else if (!command || command.length === 0) {\n        return endCB(new Error('Cannot find ffmpeg'));\n      }\n\n      // Apply niceness\n      if (options.niceness && options.niceness !== 0 && !utils.isWindows) {\n        args.unshift('-n', options.niceness, command);\n        command = 'nice';\n      }\n\n      var stdoutRing = utils.linesRing(maxLines);\n      var stdoutClosed = false;\n\n      var stderrRing = utils.linesRing(maxLines);\n      var stderrClosed = false;\n\n      // Spawn process\n      var ffmpegProc = spawn(command, args, options);\n\n      if (ffmpegProc.stderr) {\n        ffmpegProc.stderr.setEncoding('utf8');\n      }\n\n      ffmpegProc.on('error', function(err) {\n        endCB(err);\n      });\n\n      // Ensure we wait for captured streams to end before calling endCB\n      var exitError = null;\n      function handleExit(err) {\n        if (err) {\n          exitError = err;\n        }\n\n        if (processExited && (stdoutClosed || !options.captureStdout) && stderrClosed) {\n          endCB(exitError, stdoutRing, stderrRing);\n        }\n      }\n\n      // Handle process exit\n      var processExited = false;\n      ffmpegProc.on('exit', function(code, signal) {\n        processExited = true;\n\n        if (signal) {\n          handleExit(new Error('ffmpeg was killed with signal ' + signal));\n        } else if (code) {\n          handleExit(new Error('ffmpeg exited with code ' + code));\n        } else {\n          handleExit();\n        }\n      });\n\n      // Capture stdout if specified\n      if (options.captureStdout) {\n        ffmpegProc.stdout.on('data', function(data) {\n          stdoutRing.append(data);\n        });\n\n        ffmpegProc.stdout.on('close', function() {\n          stdoutRing.close();\n          stdoutClosed = true;\n          handleExit();\n        });\n      }\n\n      // Capture stderr if specified\n      ffmpegProc.stderr.on('data', function(data) {\n        stderrRing.append(data);\n      });\n\n      ffmpegProc.stderr.on('close', function() {\n        stderrRing.close();\n        stderrClosed = true;\n        handleExit();\n      });\n\n      // Call process callback\n      processCB(ffmpegProc, stdoutRing, stderrRing);\n    });\n  };\n\n\n  /**\n   * Build the argument list for an ffmpeg command\n   *\n   * @method FfmpegCommand#_getArguments\n   * @return argument list\n   * @private\n   */\n  proto._getArguments = function() {\n    var complexFilters = this._complexFilters.get();\n\n    var fileOutput = this._outputs.some(function(output) {\n      return output.isFile;\n    });\n\n    return [].concat(\n        // Inputs and input options\n        this._inputs.reduce(function(args, input) {\n          var source = (typeof input.source === 'string') ? input.source : 'pipe:0';\n\n          // For each input, add input options, then '-i <source>'\n          return args.concat(\n            input.options.get(),\n            ['-i', source]\n          );\n        }, []),\n\n        // Global options\n        this._global.get(),\n\n        // Overwrite if we have file outputs\n        fileOutput ? ['-y'] : [],\n\n        // Complex filters\n        complexFilters,\n\n        // Outputs, filters and output options\n        this._outputs.reduce(function(args, output) {\n          var sizeFilters = utils.makeFilterStrings(output.sizeFilters.get());\n          var audioFilters = output.audioFilters.get();\n          var videoFilters = output.videoFilters.get().concat(sizeFilters);\n          var outputArg;\n\n          if (!output.target) {\n            outputArg = [];\n          } else if (typeof output.target === 'string') {\n            outputArg = [output.target];\n          } else {\n            outputArg = ['pipe:1'];\n          }\n\n          return args.concat(\n            output.audio.get(),\n            audioFilters.length ? ['-filter:a', audioFilters.join(',')] : [],\n            output.video.get(),\n            videoFilters.length ? ['-filter:v', videoFilters.join(',')] : [],\n            output.options.get(),\n            outputArg\n          );\n        }, [])\n      );\n  };\n\n\n  /**\n   * Prepare execution of an ffmpeg command\n   *\n   * Checks prerequisites for the execution of the command (codec/format availability, flvtool...),\n   * then builds the argument list for ffmpeg and pass them to 'callback'.\n   *\n   * @method FfmpegCommand#_prepare\n   * @param {Function} callback callback with signature (err, args)\n   * @param {Boolean} [readMetadata=false] read metadata before processing\n   * @private\n   */\n  proto._prepare = function(callback, readMetadata) {\n    var self = this;\n\n    async.waterfall([\n      // Check codecs and formats\n      function(cb) {\n        self._checkCapabilities(cb);\n      },\n\n      // Read metadata if required\n      function(cb) {\n        if (!readMetadata) {\n          return cb();\n        }\n\n        self.ffprobe(0, function(err, data) {\n          if (!err) {\n            self._ffprobeData = data;\n          }\n\n          cb();\n        });\n      },\n\n      // Check for flvtool2/flvmeta if necessary\n      function(cb) {\n        var flvmeta = self._outputs.some(function(output) {\n          // Remove flvmeta flag on non-file output\n          if (output.flags.flvmeta && !output.isFile) {\n            self.logger.warn('Updating flv metadata is only supported for files');\n            output.flags.flvmeta = false;\n          }\n\n          return output.flags.flvmeta;\n        });\n\n        if (flvmeta) {\n          self._getFlvtoolPath(function(err) {\n            cb(err);\n          });\n        } else {\n          cb();\n        }\n      },\n\n      // Build argument list\n      function(cb) {\n        var args;\n        try {\n          args = self._getArguments();\n        } catch(e) {\n          return cb(e);\n        }\n\n        cb(null, args);\n      },\n\n      // Add \"-strict experimental\" option where needed\n      function(args, cb) {\n        self.availableEncoders(function(err, encoders) {\n          for (var i = 0; i < args.length; i++) {\n            if (args[i] === '-acodec' || args[i] === '-vcodec') {\n              i++;\n\n              if ((args[i] in encoders) && encoders[args[i]].experimental) {\n                args.splice(i + 1, 0, '-strict', 'experimental');\n                i += 2;\n              }\n            }\n          }\n\n          cb(null, args);\n        });\n      }\n    ], callback);\n\n    if (!readMetadata) {\n      // Read metadata as soon as 'progress' listeners are added\n\n      if (this.listeners('progress').length > 0) {\n        // Read metadata in parallel\n        runFfprobe(this);\n      } else {\n        // Read metadata as soon as the first 'progress' listener is added\n        this.once('newListener', function(event) {\n          if (event === 'progress') {\n            runFfprobe(this);\n          }\n        });\n      }\n    }\n  };\n\n\n  /**\n   * Run ffmpeg command\n   *\n   * @method FfmpegCommand#run\n   * @category Processing\n   * @aliases exec,execute\n   */\n  proto.exec =\n  proto.execute =\n  proto.run = function() {\n    var self = this;\n\n    // Check if at least one output is present\n    var outputPresent = this._outputs.some(function(output) {\n      return 'target' in output;\n    });\n\n    if (!outputPresent) {\n      throw new Error('No output specified');\n    }\n\n    // Get output stream if any\n    var outputStream = this._outputs.filter(function(output) {\n      return typeof output.target !== 'string';\n    })[0];\n\n    // Get input stream if any\n    var inputStream = this._inputs.filter(function(input) {\n      return typeof input.source !== 'string';\n    })[0];\n\n    // Ensure we send 'end' or 'error' only once\n    var ended = false;\n    function emitEnd(err, stdout, stderr) {\n      if (!ended) {\n        ended = true;\n\n        if (err) {\n          self.emit('error', err, stdout, stderr);\n        } else {\n          self.emit('end', stdout, stderr);\n        }\n      }\n    }\n\n    self._prepare(function(err, args) {\n      if (err) {\n        return emitEnd(err);\n      }\n\n      // Run ffmpeg\n      self._spawnFfmpeg(\n        args,\n        {\n          captureStdout: !outputStream,\n          niceness: self.options.niceness,\n          cwd: self.options.cwd,\n          windowsHide: true\n        }, \n\n        function processCB(ffmpegProc, stdoutRing, stderrRing) {\n          self.ffmpegProc = ffmpegProc;\n          self.emit('start', 'ffmpeg ' + args.join(' '));\n\n          // Pipe input stream if any\n          if (inputStream) {\n            inputStream.source.on('error', function(err) {\n              var reportingErr = new Error('Input stream error: ' + err.message);\n              reportingErr.inputStreamError = err;\n              emitEnd(reportingErr);\n              ffmpegProc.kill();\n            });\n\n            inputStream.source.resume();\n            inputStream.source.pipe(ffmpegProc.stdin);\n\n            // Set stdin error handler on ffmpeg (prevents nodejs catching the error, but\n            // ffmpeg will fail anyway, so no need to actually handle anything)\n            ffmpegProc.stdin.on('error', function() {});\n          }\n\n          // Setup timeout if requested\n          if (self.options.timeout) {\n            self.processTimer = setTimeout(function() {\n              var msg = 'process ran into a timeout (' + self.options.timeout + 's)';\n\n              emitEnd(new Error(msg), stdoutRing.get(), stderrRing.get());\n              ffmpegProc.kill();\n            }, self.options.timeout * 1000);\n          }\n\n\n          if (outputStream) {\n            // Pipe ffmpeg stdout to output stream\n            ffmpegProc.stdout.pipe(outputStream.target, outputStream.pipeopts);\n\n            // Handle output stream events\n            outputStream.target.on('close', function() {\n              self.logger.debug('Output stream closed, scheduling kill for ffmpeg process');\n\n              // Don't kill process yet, to give a chance to ffmpeg to\n              // terminate successfully first  This is necessary because\n              // under load, the process 'exit' event sometimes happens\n              // after the output stream 'close' event.\n              setTimeout(function() {\n                emitEnd(new Error('Output stream closed'));\n                ffmpegProc.kill();\n              }, 20);\n            });\n\n            outputStream.target.on('error', function(err) {\n              self.logger.debug('Output stream error, killing ffmpeg process');\n              var reportingErr = new Error('Output stream error: ' + err.message);\n              reportingErr.outputStreamError = err;\n              emitEnd(reportingErr, stdoutRing.get(), stderrRing.get());\n              ffmpegProc.kill('SIGKILL');\n            });\n          }\n\n          // Setup stderr handling\n          if (stderrRing) {\n\n            // 'stderr' event\n            if (self.listeners('stderr').length) {\n              stderrRing.callback(function(line) {\n                self.emit('stderr', line);\n              });\n            }\n\n            // 'codecData' event\n            if (self.listeners('codecData').length) {\n              var codecDataSent = false;\n              var codecObject = {};\n\n              stderrRing.callback(function(line) {\n                if (!codecDataSent)\n                  codecDataSent = utils.extractCodecData(self, line, codecObject);\n              });\n            }\n\n            // 'progress' event\n            if (self.listeners('progress').length) {\n              stderrRing.callback(function(line) {\n                utils.extractProgress(self, line);\n              });\n            }\n          }\n        },\n\n        function endCB(err, stdoutRing, stderrRing) {\n          clearTimeout(self.processTimer);\n          delete self.ffmpegProc;\n\n          if (err) {\n            if (err.message.match(/ffmpeg exited with code/)) {\n              // Add ffmpeg error message\n              err.message += ': ' + utils.extractError(stderrRing.get());\n            }\n\n            emitEnd(err, stdoutRing.get(), stderrRing.get());\n          } else {\n            // Find out which outputs need flv metadata\n            var flvmeta = self._outputs.filter(function(output) {\n              return output.flags.flvmeta;\n            });\n\n            if (flvmeta.length) {\n              self._getFlvtoolPath(function(err, flvtool) {\n                if (err) {\n                  return emitEnd(err);\n                }\n\n                async.each(\n                  flvmeta,\n                  function(output, cb) {\n                    spawn(flvtool, ['-U', output.target], {windowsHide: true})\n                      .on('error', function(err) {\n                        cb(new Error('Error running ' + flvtool + ' on ' + output.target + ': ' + err.message));\n                      })\n                      .on('exit', function(code, signal) {\n                        if (code !== 0 || signal) {\n                          cb(\n                            new Error(flvtool + ' ' +\n                              (signal ? 'received signal ' + signal\n                                      : 'exited with code ' + code)) +\n                              ' when running on ' + output.target\n                          );\n                        } else {\n                          cb();\n                        }\n                      });\n                  },\n                  function(err) {\n                    if (err) {\n                      emitEnd(err);\n                    } else {\n                      emitEnd(null, stdoutRing.get(), stderrRing.get());\n                    }\n                  }\n                );\n              });\n            } else {\n              emitEnd(null, stdoutRing.get(), stderrRing.get());\n            }\n          }\n        }\n      );\n    });\n\n    return this;\n  };\n\n\n  /**\n   * Renice current and/or future ffmpeg processes\n   *\n   * Ignored on Windows platforms.\n   *\n   * @method FfmpegCommand#renice\n   * @category Processing\n   *\n   * @param {Number} [niceness=0] niceness value between -20 (highest priority) and 20 (lowest priority)\n   * @return FfmpegCommand\n   */\n  proto.renice = function(niceness) {\n    if (!utils.isWindows) {\n      niceness = niceness || 0;\n\n      if (niceness < -20 || niceness > 20) {\n        this.logger.warn('Invalid niceness value: ' + niceness + ', must be between -20 and 20');\n      }\n\n      niceness = Math.min(20, Math.max(-20, niceness));\n      this.options.niceness = niceness;\n\n      if (this.ffmpegProc) {\n        var logger = this.logger;\n        var pid = this.ffmpegProc.pid;\n        var renice = spawn('renice', [niceness, '-p', pid], {windowsHide: true});\n\n        renice.on('error', function(err) {\n          logger.warn('could not renice process ' + pid + ': ' + err.message);\n        });\n\n        renice.on('exit', function(code, signal) {\n          if (signal) {\n            logger.warn('could not renice process ' + pid + ': renice was killed by signal ' + signal);\n          } else if (code) {\n            logger.warn('could not renice process ' + pid + ': renice exited with ' + code);\n          } else {\n            logger.info('successfully reniced process ' + pid + ' to ' + niceness + ' niceness');\n          }\n        });\n      }\n    }\n\n    return this;\n  };\n\n\n  /**\n   * Kill current ffmpeg process, if any\n   *\n   * @method FfmpegCommand#kill\n   * @category Processing\n   *\n   * @param {String} [signal=SIGKILL] signal name\n   * @return FfmpegCommand\n   */\n  proto.kill = function(signal) {\n    if (!this.ffmpegProc) {\n      this.logger.warn('No running ffmpeg process, cannot send signal');\n    } else {\n      this.ffmpegProc.kill(signal || 'SIGKILL');\n    }\n\n    return this;\n  };\n};\n","/*jshint node:true*/\n'use strict';\n\nvar fs = require('fs');\nvar path = require('path');\nvar async = require('async');\nvar utils = require('./utils');\n\n/*\n *! Capability helpers\n */\n\nvar avCodecRegexp = /^\\s*([D ])([E ])([VAS])([S ])([D ])([T ]) ([^ ]+) +(.*)$/;\nvar ffCodecRegexp = /^\\s*([D\\.])([E\\.])([VAS])([I\\.])([L\\.])([S\\.]) ([^ ]+) +(.*)$/;\nvar ffEncodersRegexp = /\\(encoders:([^\\)]+)\\)/;\nvar ffDecodersRegexp = /\\(decoders:([^\\)]+)\\)/;\nvar encodersRegexp = /^\\s*([VAS\\.])([F\\.])([S\\.])([X\\.])([B\\.])([D\\.]) ([^ ]+) +(.*)$/;\nvar formatRegexp = /^\\s*([D ])([E ])\\s+([^ ]+)\\s+(.*)$/;\nvar lineBreakRegexp = /\\r\\n|\\r|\\n/;\nvar filterRegexp = /^(?: [T\\.][S\\.][C\\.] )?([^ ]+) +(AA?|VV?|\\|)->(AA?|VV?|\\|) +(.*)$/;\n\nvar cache = {};\n\nmodule.exports = function(proto) {\n  /**\n   * Manually define the ffmpeg binary full path.\n   *\n   * @method FfmpegCommand#setFfmpegPath\n   *\n   * @param {String} ffmpegPath The full path to the ffmpeg binary.\n   * @return FfmpegCommand\n   */\n  proto.setFfmpegPath = function(ffmpegPath) {\n    cache.ffmpegPath = ffmpegPath;\n    return this;\n  };\n\n  /**\n   * Manually define the ffprobe binary full path.\n   *\n   * @method FfmpegCommand#setFfprobePath\n   *\n   * @param {String} ffprobePath The full path to the ffprobe binary.\n   * @return FfmpegCommand\n   */\n  proto.setFfprobePath = function(ffprobePath) {\n    cache.ffprobePath = ffprobePath;\n    return this;\n  };\n\n  /**\n   * Manually define the flvtool2/flvmeta binary full path.\n   *\n   * @method FfmpegCommand#setFlvtoolPath\n   *\n   * @param {String} flvtool The full path to the flvtool2 or flvmeta binary.\n   * @return FfmpegCommand\n   */\n  proto.setFlvtoolPath = function(flvtool) {\n    cache.flvtoolPath = flvtool;\n    return this;\n  };\n\n  /**\n   * Forget executable paths\n   *\n   * (only used for testing purposes)\n   *\n   * @method FfmpegCommand#_forgetPaths\n   * @private\n   */\n  proto._forgetPaths = function() {\n    delete cache.ffmpegPath;\n    delete cache.ffprobePath;\n    delete cache.flvtoolPath;\n  };\n\n  /**\n   * Check for ffmpeg availability\n   *\n   * If the FFMPEG_PATH environment variable is set, try to use it.\n   * If it is unset or incorrect, try to find ffmpeg in the PATH instead.\n   *\n   * @method FfmpegCommand#_getFfmpegPath\n   * @param {Function} callback callback with signature (err, path)\n   * @private\n   */\n  proto._getFfmpegPath = function(callback) {\n    if ('ffmpegPath' in cache) {\n      return callback(null, cache.ffmpegPath);\n    }\n\n    async.waterfall([\n      // Try FFMPEG_PATH\n      function(cb) {\n        if (process.env.FFMPEG_PATH) {\n          fs.exists(process.env.FFMPEG_PATH, function(exists) {\n            if (exists) {\n              cb(null, process.env.FFMPEG_PATH);\n            } else {\n              cb(null, '');\n            }\n          });\n        } else {\n          cb(null, '');\n        }\n      },\n\n      // Search in the PATH\n      function(ffmpeg, cb) {\n        if (ffmpeg.length) {\n          return cb(null, ffmpeg);\n        }\n\n        utils.which('ffmpeg', function(err, ffmpeg) {\n          cb(err, ffmpeg);\n        });\n      }\n    ], function(err, ffmpeg) {\n      if (err) {\n        callback(err);\n      } else {\n        callback(null, cache.ffmpegPath = (ffmpeg || ''));\n      }\n    });\n  };\n\n\n  /**\n   * Check for ffprobe availability\n   *\n   * If the FFPROBE_PATH environment variable is set, try to use it.\n   * If it is unset or incorrect, try to find ffprobe in the PATH instead.\n   * If this still fails, try to find ffprobe in the same directory as ffmpeg.\n   *\n   * @method FfmpegCommand#_getFfprobePath\n   * @param {Function} callback callback with signature (err, path)\n   * @private\n   */\n  proto._getFfprobePath = function(callback) {\n    var self = this;\n\n    if ('ffprobePath' in cache) {\n      return callback(null, cache.ffprobePath);\n    }\n\n    async.waterfall([\n      // Try FFPROBE_PATH\n      function(cb) {\n        if (process.env.FFPROBE_PATH) {\n          fs.exists(process.env.FFPROBE_PATH, function(exists) {\n            cb(null, exists ? process.env.FFPROBE_PATH : '');\n          });\n        } else {\n          cb(null, '');\n        }\n      },\n\n      // Search in the PATH\n      function(ffprobe, cb) {\n        if (ffprobe.length) {\n          return cb(null, ffprobe);\n        }\n\n        utils.which('ffprobe', function(err, ffprobe) {\n          cb(err, ffprobe);\n        });\n      },\n\n      // Search in the same directory as ffmpeg\n      function(ffprobe, cb) {\n        if (ffprobe.length) {\n          return cb(null, ffprobe);\n        }\n\n        self._getFfmpegPath(function(err, ffmpeg) {\n          if (err) {\n            cb(err);\n          } else if (ffmpeg.length) {\n            var name = utils.isWindows ? 'ffprobe.exe' : 'ffprobe';\n            var ffprobe = path.join(path.dirname(ffmpeg), name);\n            fs.exists(ffprobe, function(exists) {\n              cb(null, exists ? ffprobe : '');\n            });\n          } else {\n            cb(null, '');\n          }\n        });\n      }\n    ], function(err, ffprobe) {\n      if (err) {\n        callback(err);\n      } else {\n        callback(null, cache.ffprobePath = (ffprobe || ''));\n      }\n    });\n  };\n\n\n  /**\n   * Check for flvtool2/flvmeta availability\n   *\n   * If the FLVTOOL2_PATH or FLVMETA_PATH environment variable are set, try to use them.\n   * If both are either unset or incorrect, try to find flvtool2 or flvmeta in the PATH instead.\n   *\n   * @method FfmpegCommand#_getFlvtoolPath\n   * @param {Function} callback callback with signature (err, path)\n   * @private\n   */\n   proto._getFlvtoolPath = function(callback) {\n    if ('flvtoolPath' in cache) {\n      return callback(null, cache.flvtoolPath);\n    }\n\n    async.waterfall([\n      // Try FLVMETA_PATH\n      function(cb) {\n        if (process.env.FLVMETA_PATH) {\n          fs.exists(process.env.FLVMETA_PATH, function(exists) {\n            cb(null, exists ? process.env.FLVMETA_PATH : '');\n          });\n        } else {\n          cb(null, '');\n        }\n      },\n\n      // Try FLVTOOL2_PATH\n      function(flvtool, cb) {\n        if (flvtool.length) {\n          return cb(null, flvtool);\n        }\n\n        if (process.env.FLVTOOL2_PATH) {\n          fs.exists(process.env.FLVTOOL2_PATH, function(exists) {\n            cb(null, exists ? process.env.FLVTOOL2_PATH : '');\n          });\n        } else {\n          cb(null, '');\n        }\n      },\n\n      // Search for flvmeta in the PATH\n      function(flvtool, cb) {\n        if (flvtool.length) {\n          return cb(null, flvtool);\n        }\n\n        utils.which('flvmeta', function(err, flvmeta) {\n          cb(err, flvmeta);\n        });\n      },\n\n      // Search for flvtool2 in the PATH\n      function(flvtool, cb) {\n        if (flvtool.length) {\n          return cb(null, flvtool);\n        }\n\n        utils.which('flvtool2', function(err, flvtool2) {\n          cb(err, flvtool2);\n        });\n      },\n    ], function(err, flvtool) {\n      if (err) {\n        callback(err);\n      } else {\n        callback(null, cache.flvtoolPath = (flvtool || ''));\n      }\n    });\n  };\n\n\n  /**\n   * A callback passed to {@link FfmpegCommand#availableFilters}.\n   *\n   * @callback FfmpegCommand~filterCallback\n   * @param {Error|null} err error object or null if no error happened\n   * @param {Object} filters filter object with filter names as keys and the following\n   *   properties for each filter:\n   * @param {String} filters.description filter description\n   * @param {String} filters.input input type, one of 'audio', 'video' and 'none'\n   * @param {Boolean} filters.multipleInputs whether the filter supports multiple inputs\n   * @param {String} filters.output output type, one of 'audio', 'video' and 'none'\n   * @param {Boolean} filters.multipleOutputs whether the filter supports multiple outputs\n   */\n\n  /**\n   * Query ffmpeg for available filters\n   *\n   * @method FfmpegCommand#availableFilters\n   * @category Capabilities\n   * @aliases getAvailableFilters\n   *\n   * @param {FfmpegCommand~filterCallback} callback callback function\n   */\n  proto.availableFilters =\n  proto.getAvailableFilters = function(callback) {\n    if ('filters' in cache) {\n      return callback(null, cache.filters);\n    }\n\n    this._spawnFfmpeg(['-filters'], { captureStdout: true, stdoutLines: 0 }, function (err, stdoutRing) {\n      if (err) {\n        return callback(err);\n      }\n\n      var stdout = stdoutRing.get();\n      var lines = stdout.split('\\n');\n      var data = {};\n      var types = { A: 'audio', V: 'video', '|': 'none' };\n\n      lines.forEach(function(line) {\n        var match = line.match(filterRegexp);\n        if (match) {\n          data[match[1]] = {\n            description: match[4],\n            input: types[match[2].charAt(0)],\n            multipleInputs: match[2].length > 1,\n            output: types[match[3].charAt(0)],\n            multipleOutputs: match[3].length > 1\n          };\n        }\n      });\n\n      callback(null, cache.filters = data);\n    });\n  };\n\n\n  /**\n   * A callback passed to {@link FfmpegCommand#availableCodecs}.\n   *\n   * @callback FfmpegCommand~codecCallback\n   * @param {Error|null} err error object or null if no error happened\n   * @param {Object} codecs codec object with codec names as keys and the following\n   *   properties for each codec (more properties may be available depending on the\n   *   ffmpeg version used):\n   * @param {String} codecs.description codec description\n   * @param {Boolean} codecs.canDecode whether the codec is able to decode streams\n   * @param {Boolean} codecs.canEncode whether the codec is able to encode streams\n   */\n\n  /**\n   * Query ffmpeg for available codecs\n   *\n   * @method FfmpegCommand#availableCodecs\n   * @category Capabilities\n   * @aliases getAvailableCodecs\n   *\n   * @param {FfmpegCommand~codecCallback} callback callback function\n   */\n  proto.availableCodecs =\n  proto.getAvailableCodecs = function(callback) {\n    if ('codecs' in cache) {\n      return callback(null, cache.codecs);\n    }\n\n    this._spawnFfmpeg(['-codecs'], { captureStdout: true, stdoutLines: 0 }, function(err, stdoutRing) {\n      if (err) {\n        return callback(err);\n      }\n\n      var stdout = stdoutRing.get();\n      var lines = stdout.split(lineBreakRegexp);\n      var data = {};\n\n      lines.forEach(function(line) {\n        var match = line.match(avCodecRegexp);\n        if (match && match[7] !== '=') {\n          data[match[7]] = {\n            type: { 'V': 'video', 'A': 'audio', 'S': 'subtitle' }[match[3]],\n            description: match[8],\n            canDecode: match[1] === 'D',\n            canEncode: match[2] === 'E',\n            drawHorizBand: match[4] === 'S',\n            directRendering: match[5] === 'D',\n            weirdFrameTruncation: match[6] === 'T'\n          };\n        }\n\n        match = line.match(ffCodecRegexp);\n        if (match && match[7] !== '=') {\n          var codecData = data[match[7]] = {\n            type: { 'V': 'video', 'A': 'audio', 'S': 'subtitle' }[match[3]],\n            description: match[8],\n            canDecode: match[1] === 'D',\n            canEncode: match[2] === 'E',\n            intraFrameOnly: match[4] === 'I',\n            isLossy: match[5] === 'L',\n            isLossless: match[6] === 'S'\n          };\n\n          var encoders = codecData.description.match(ffEncodersRegexp);\n          encoders = encoders ? encoders[1].trim().split(' ') : [];\n\n          var decoders = codecData.description.match(ffDecodersRegexp);\n          decoders = decoders ? decoders[1].trim().split(' ') : [];\n\n          if (encoders.length || decoders.length) {\n            var coderData = {};\n            utils.copy(codecData, coderData);\n            delete coderData.canEncode;\n            delete coderData.canDecode;\n\n            encoders.forEach(function(name) {\n              data[name] = {};\n              utils.copy(coderData, data[name]);\n              data[name].canEncode = true;\n            });\n\n            decoders.forEach(function(name) {\n              if (name in data) {\n                data[name].canDecode = true;\n              } else {\n                data[name] = {};\n                utils.copy(coderData, data[name]);\n                data[name].canDecode = true;\n              }\n            });\n          }\n        }\n      });\n\n      callback(null, cache.codecs = data);\n    });\n  };\n\n\n  /**\n   * A callback passed to {@link FfmpegCommand#availableEncoders}.\n   *\n   * @callback FfmpegCommand~encodersCallback\n   * @param {Error|null} err error object or null if no error happened\n   * @param {Object} encoders encoders object with encoder names as keys and the following\n   *   properties for each encoder:\n   * @param {String} encoders.description codec description\n   * @param {Boolean} encoders.type \"audio\", \"video\" or \"subtitle\"\n   * @param {Boolean} encoders.frameMT whether the encoder is able to do frame-level multithreading\n   * @param {Boolean} encoders.sliceMT whether the encoder is able to do slice-level multithreading\n   * @param {Boolean} encoders.experimental whether the encoder is experimental\n   * @param {Boolean} encoders.drawHorizBand whether the encoder supports draw_horiz_band\n   * @param {Boolean} encoders.directRendering whether the encoder supports direct encoding method 1\n   */\n\n  /**\n   * Query ffmpeg for available encoders\n   *\n   * @method FfmpegCommand#availableEncoders\n   * @category Capabilities\n   * @aliases getAvailableEncoders\n   *\n   * @param {FfmpegCommand~encodersCallback} callback callback function\n   */\n  proto.availableEncoders =\n  proto.getAvailableEncoders = function(callback) {\n    if ('encoders' in cache) {\n      return callback(null, cache.encoders);\n    }\n\n    this._spawnFfmpeg(['-encoders'], { captureStdout: true, stdoutLines: 0 }, function(err, stdoutRing) {\n      if (err) {\n        return callback(err);\n      }\n\n      var stdout = stdoutRing.get();\n      var lines = stdout.split(lineBreakRegexp);\n      var data = {};\n\n      lines.forEach(function(line) {\n        var match = line.match(encodersRegexp);\n        if (match && match[7] !== '=') {\n          data[match[7]] = {\n            type: { 'V': 'video', 'A': 'audio', 'S': 'subtitle' }[match[1]],\n            description: match[8],\n            frameMT: match[2] === 'F',\n            sliceMT: match[3] === 'S',\n            experimental: match[4] === 'X',\n            drawHorizBand: match[5] === 'B',\n            directRendering: match[6] === 'D'\n          };\n        }\n      });\n\n      callback(null, cache.encoders = data);\n    });\n  };\n\n\n  /**\n   * A callback passed to {@link FfmpegCommand#availableFormats}.\n   *\n   * @callback FfmpegCommand~formatCallback\n   * @param {Error|null} err error object or null if no error happened\n   * @param {Object} formats format object with format names as keys and the following\n   *   properties for each format:\n   * @param {String} formats.description format description\n   * @param {Boolean} formats.canDemux whether the format is able to demux streams from an input file\n   * @param {Boolean} formats.canMux whether the format is able to mux streams into an output file\n   */\n\n  /**\n   * Query ffmpeg for available formats\n   *\n   * @method FfmpegCommand#availableFormats\n   * @category Capabilities\n   * @aliases getAvailableFormats\n   *\n   * @param {FfmpegCommand~formatCallback} callback callback function\n   */\n  proto.availableFormats =\n  proto.getAvailableFormats = function(callback) {\n    if ('formats' in cache) {\n      return callback(null, cache.formats);\n    }\n\n    // Run ffmpeg -formats\n    this._spawnFfmpeg(['-formats'], { captureStdout: true, stdoutLines: 0 }, function (err, stdoutRing) {\n      if (err) {\n        return callback(err);\n      }\n\n      // Parse output\n      var stdout = stdoutRing.get();\n      var lines = stdout.split(lineBreakRegexp);\n      var data = {};\n\n      lines.forEach(function(line) {\n        var match = line.match(formatRegexp);\n        if (match) {\n          match[3].split(',').forEach(function(format) {\n            if (!(format in data)) {\n              data[format] = {\n                description: match[4],\n                canDemux: false,\n                canMux: false\n              };\n            }\n\n            if (match[1] === 'D') {\n              data[format].canDemux = true;\n            }\n            if (match[2] === 'E') {\n              data[format].canMux = true;\n            }\n          });\n        }\n      });\n\n      callback(null, cache.formats = data);\n    });\n  };\n\n\n  /**\n   * Check capabilities before executing a command\n   *\n   * Checks whether all used codecs and formats are indeed available\n   *\n   * @method FfmpegCommand#_checkCapabilities\n   * @param {Function} callback callback with signature (err)\n   * @private\n   */\n  proto._checkCapabilities = function(callback) {\n    var self = this;\n    async.waterfall([\n      // Get available formats\n      function(cb) {\n        self.availableFormats(cb);\n      },\n\n      // Check whether specified formats are available\n      function(formats, cb) {\n        var unavailable;\n\n        // Output format(s)\n        unavailable = self._outputs\n          .reduce(function(fmts, output) {\n            var format = output.options.find('-f', 1);\n            if (format) {\n              if (!(format[0] in formats) || !(formats[format[0]].canMux)) {\n                fmts.push(format);\n              }\n            }\n\n            return fmts;\n          }, []);\n\n        if (unavailable.length === 1) {\n          return cb(new Error('Output format ' + unavailable[0] + ' is not available'));\n        } else if (unavailable.length > 1) {\n          return cb(new Error('Output formats ' + unavailable.join(', ') + ' are not available'));\n        }\n\n        // Input format(s)\n        unavailable = self._inputs\n          .reduce(function(fmts, input) {\n            var format = input.options.find('-f', 1);\n            if (format) {\n              if (!(format[0] in formats) || !(formats[format[0]].canDemux)) {\n                fmts.push(format[0]);\n              }\n            }\n\n            return fmts;\n          }, []);\n\n        if (unavailable.length === 1) {\n          return cb(new Error('Input format ' + unavailable[0] + ' is not available'));\n        } else if (unavailable.length > 1) {\n          return cb(new Error('Input formats ' + unavailable.join(', ') + ' are not available'));\n        }\n\n        cb();\n      },\n\n      // Get available codecs\n      function(cb) {\n        self.availableEncoders(cb);\n      },\n\n      // Check whether specified codecs are available and add strict experimental options if needed\n      function(encoders, cb) {\n        var unavailable;\n\n        // Audio codec(s)\n        unavailable = self._outputs.reduce(function(cdcs, output) {\n          var acodec = output.audio.find('-acodec', 1);\n          if (acodec && acodec[0] !== 'copy') {\n            if (!(acodec[0] in encoders) || encoders[acodec[0]].type !== 'audio') {\n              cdcs.push(acodec[0]);\n            }\n          }\n\n          return cdcs;\n        }, []);\n\n        if (unavailable.length === 1) {\n          return cb(new Error('Audio codec ' + unavailable[0] + ' is not available'));\n        } else if (unavailable.length > 1) {\n          return cb(new Error('Audio codecs ' + unavailable.join(', ') + ' are not available'));\n        }\n\n        // Video codec(s)\n        unavailable = self._outputs.reduce(function(cdcs, output) {\n          var vcodec = output.video.find('-vcodec', 1);\n          if (vcodec && vcodec[0] !== 'copy') {\n            if (!(vcodec[0] in encoders) || encoders[vcodec[0]].type !== 'video') {\n              cdcs.push(vcodec[0]);\n            }\n          }\n\n          return cdcs;\n        }, []);\n\n        if (unavailable.length === 1) {\n          return cb(new Error('Video codec ' + unavailable[0] + ' is not available'));\n        } else if (unavailable.length > 1) {\n          return cb(new Error('Video codecs ' + unavailable.join(', ') + ' are not available'));\n        }\n\n        cb();\n      }\n    ], callback);\n  };\n};\n","/*jshint node:true, laxcomma:true*/\n'use strict';\n\nvar spawn = require('child_process').spawn;\n\n\nfunction legacyTag(key) { return key.match(/^TAG:/); }\nfunction legacyDisposition(key) { return key.match(/^DISPOSITION:/); }\n\nfunction parseFfprobeOutput(out) {\n  var lines = out.split(/\\r\\n|\\r|\\n/);\n\n  lines = lines.filter(function (line) {\n    return line.length > 0;\n  });\n\n  var data = {\n    streams: [],\n    format: {},\n    chapters: []\n  };\n\n  function parseBlock(name) {\n    var data = {};\n\n    var line = lines.shift();\n    while (typeof line !== 'undefined') {\n      if (line.toLowerCase() == '[/'+name+']') {\n        return data;\n      } else if (line.match(/^\\[/)) {\n        line = lines.shift();\n        continue;\n      }\n\n      var kv = line.match(/^([^=]+)=(.*)$/);\n      if (kv) {\n        if (!(kv[1].match(/^TAG:/)) && kv[2].match(/^[0-9]+(\\.[0-9]+)?$/)) {\n          data[kv[1]] = Number(kv[2]);\n        } else {\n          data[kv[1]] = kv[2];\n        }\n      }\n\n      line = lines.shift();\n    }\n\n    return data;\n  }\n\n  var line = lines.shift();\n  while (typeof line !== 'undefined') {\n    if (line.match(/^\\[stream/i)) {\n      var stream = parseBlock('stream');\n      data.streams.push(stream);\n    } else if (line.match(/^\\[chapter/i)) {\n      var chapter = parseBlock('chapter');\n      data.chapters.push(chapter);\n    } else if (line.toLowerCase() === '[format]') {\n      data.format = parseBlock('format');\n    }\n\n    line = lines.shift();\n  }\n\n  return data;\n}\n\n\n\nmodule.exports = function(proto) {\n  /**\n   * A callback passed to the {@link FfmpegCommand#ffprobe} method.\n   *\n   * @callback FfmpegCommand~ffprobeCallback\n   *\n   * @param {Error|null} err error object or null if no error happened\n   * @param {Object} ffprobeData ffprobe output data; this object\n   *   has the same format as what the following command returns:\n   *\n   *     `ffprobe -print_format json -show_streams -show_format INPUTFILE`\n   * @param {Array} ffprobeData.streams stream information\n   * @param {Object} ffprobeData.format format information\n   */\n\n  /**\n   * Run ffprobe on last specified input\n   *\n   * @method FfmpegCommand#ffprobe\n   * @category Metadata\n   *\n   * @param {?Number} [index] 0-based index of input to probe (defaults to last input)\n   * @param {?String[]} [options] array of output options to return\n   * @param {FfmpegCommand~ffprobeCallback} callback callback function\n   *\n   */\n  proto.ffprobe = function() {\n    var input, index = null, options = [], callback;\n\n    // the last argument should be the callback\n    var callback = arguments[arguments.length - 1];\n\n    var ended = false\n    function handleCallback(err, data) {\n      if (!ended) {\n        ended = true;\n        callback(err, data);\n      }\n    };\n\n    // map the arguments to the correct variable names\n    switch (arguments.length) {\n      case 3:\n        index = arguments[0];\n        options = arguments[1];\n        break;\n      case 2:\n        if (typeof arguments[0] === 'number') {\n          index = arguments[0];\n        } else if (Array.isArray(arguments[0])) {\n          options = arguments[0];\n        }\n        break;\n    }\n\n\n    if (index === null) {\n      if (!this._currentInput) {\n        return handleCallback(new Error('No input specified'));\n      }\n\n      input = this._currentInput;\n    } else {\n      input = this._inputs[index];\n\n      if (!input) {\n        return handleCallback(new Error('Invalid input index'));\n      }\n    }\n\n    // Find ffprobe\n    this._getFfprobePath(function(err, path) {\n      if (err) {\n        return handleCallback(err);\n      } else if (!path) {\n        return handleCallback(new Error('Cannot find ffprobe'));\n      }\n\n      var stdout = '';\n      var stdoutClosed = false;\n      var stderr = '';\n      var stderrClosed = false;\n\n      // Spawn ffprobe\n      var src = input.isStream ? 'pipe:0' : input.source;\n      var ffprobe = spawn(path, ['-show_streams', '-show_format'].concat(options, src), {windowsHide: true});\n\n      if (input.isStream) {\n        // Skip errors on stdin. These get thrown when ffprobe is complete and\n        // there seems to be no way hook in and close stdin before it throws.\n        ffprobe.stdin.on('error', function(err) {\n          if (['ECONNRESET', 'EPIPE', 'EOF'].indexOf(err.code) >= 0) { return; }\n          handleCallback(err);\n        });\n\n        // Once ffprobe's input stream closes, we need no more data from the\n        // input\n        ffprobe.stdin.on('close', function() {\n            input.source.pause();\n            input.source.unpipe(ffprobe.stdin);\n        });\n\n        input.source.pipe(ffprobe.stdin);\n      }\n\n      ffprobe.on('error', callback);\n\n      // Ensure we wait for captured streams to end before calling callback\n      var exitError = null;\n      function handleExit(err) {\n        if (err) {\n          exitError = err;\n        }\n\n        if (processExited && stdoutClosed && stderrClosed) {\n          if (exitError) {\n            if (stderr) {\n              exitError.message += '\\n' + stderr;\n            }\n\n            return handleCallback(exitError);\n          }\n\n          // Process output\n          var data = parseFfprobeOutput(stdout);\n\n          // Handle legacy output with \"TAG:x\" and \"DISPOSITION:x\" keys\n          [data.format].concat(data.streams).forEach(function(target) {\n            if (target) {\n              var legacyTagKeys = Object.keys(target).filter(legacyTag);\n\n              if (legacyTagKeys.length) {\n                target.tags = target.tags || {};\n\n                legacyTagKeys.forEach(function(tagKey) {\n                  target.tags[tagKey.substr(4)] = target[tagKey];\n                  delete target[tagKey];\n                });\n              }\n\n              var legacyDispositionKeys = Object.keys(target).filter(legacyDisposition);\n\n              if (legacyDispositionKeys.length) {\n                target.disposition = target.disposition || {};\n\n                legacyDispositionKeys.forEach(function(dispositionKey) {\n                  target.disposition[dispositionKey.substr(12)] = target[dispositionKey];\n                  delete target[dispositionKey];\n                });\n              }\n            }\n          });\n\n          handleCallback(null, data);\n        }\n      }\n\n      // Handle ffprobe exit\n      var processExited = false;\n      ffprobe.on('exit', function(code, signal) {\n        processExited = true;\n\n        if (code) {\n          handleExit(new Error('ffprobe exited with code ' + code));\n        } else if (signal) {\n          handleExit(new Error('ffprobe was killed with signal ' + signal));\n        } else {\n          handleExit();\n        }\n      });\n\n      // Handle stdout/stderr streams\n      ffprobe.stdout.on('data', function(data) {\n        stdout += data;\n      });\n\n      ffprobe.stdout.on('close', function() {\n        stdoutClosed = true;\n        handleExit();\n      });\n\n      ffprobe.stderr.on('data', function(data) {\n        stderr += data;\n      });\n\n      ffprobe.stderr.on('close', function() {\n        stderrClosed = true;\n        handleExit();\n      });\n    });\n  };\n};\n","/*jshint node:true*/\n'use strict';\n\nvar fs = require('fs');\nvar path = require('path');\nvar PassThrough = require('stream').PassThrough;\nvar async = require('async');\nvar utils = require('./utils');\n\n\n/*\n * Useful recipes for commands\n */\n\nmodule.exports = function recipes(proto) {\n  /**\n   * Execute ffmpeg command and save output to a file\n   *\n   * @method FfmpegCommand#save\n   * @category Processing\n   * @aliases saveToFile\n   *\n   * @param {String} output file path\n   * @return FfmpegCommand\n   */\n  proto.saveToFile =\n  proto.save = function(output) {\n    this.output(output).run();\n    return this;\n  };\n\n\n  /**\n   * Execute ffmpeg command and save output to a stream\n   *\n   * If 'stream' is not specified, a PassThrough stream is created and returned.\n   * 'options' will be used when piping ffmpeg output to the output stream\n   * (@see http://nodejs.org/api/stream.html#stream_readable_pipe_destination_options)\n   *\n   * @method FfmpegCommand#pipe\n   * @category Processing\n   * @aliases stream,writeToStream\n   *\n   * @param {stream.Writable} [stream] output stream\n   * @param {Object} [options={}] pipe options\n   * @return Output stream\n   */\n  proto.writeToStream =\n  proto.pipe =\n  proto.stream = function(stream, options) {\n    if (stream && !('writable' in stream)) {\n      options = stream;\n      stream = undefined;\n    }\n\n    if (!stream) {\n      if (process.version.match(/v0\\.8\\./)) {\n        throw new Error('PassThrough stream is not supported on node v0.8');\n      }\n\n      stream = new PassThrough();\n    }\n\n    this.output(stream, options).run();\n    return stream;\n  };\n\n\n  /**\n   * Generate images from a video\n   *\n   * Note: this method makes the command emit a 'filenames' event with an array of\n   * the generated image filenames.\n   *\n   * @method FfmpegCommand#screenshots\n   * @category Processing\n   * @aliases takeScreenshots,thumbnail,thumbnails,screenshot\n   *\n   * @param {Number|Object} [config=1] screenshot count or configuration object with\n   *   the following keys:\n   * @param {Number} [config.count] number of screenshots to take; using this option\n   *   takes screenshots at regular intervals (eg. count=4 would take screens at 20%, 40%,\n   *   60% and 80% of the video length).\n   * @param {String} [config.folder='.'] output folder\n   * @param {String} [config.filename='tn.png'] output filename pattern, may contain the following\n   *   tokens:\n   *   - '%s': offset in seconds\n   *   - '%w': screenshot width\n   *   - '%h': screenshot height\n   *   - '%r': screenshot resolution (same as '%wx%h')\n   *   - '%f': input filename\n   *   - '%b': input basename (filename w/o extension)\n   *   - '%i': index of screenshot in timemark array (can be zero-padded by using it like `%000i`)\n   * @param {Number[]|String[]} [config.timemarks] array of timemarks to take screenshots\n   *   at; each timemark may be a number of seconds, a '[[hh:]mm:]ss[.xxx]' string or a\n   *   'XX%' string.  Overrides 'count' if present.\n   * @param {Number[]|String[]} [config.timestamps] alias for 'timemarks'\n   * @param {Boolean} [config.fastSeek] use fast seek (less accurate)\n   * @param {String} [config.size] screenshot size, with the same syntax as {@link FfmpegCommand#size}\n   * @param {String} [folder] output folder (legacy alias for 'config.folder')\n   * @return FfmpegCommand\n   */\n  proto.takeScreenshots =\n  proto.thumbnail =\n  proto.thumbnails =\n  proto.screenshot =\n  proto.screenshots = function(config, folder) {\n    var self = this;\n    var source = this._currentInput.source;\n    config = config || { count: 1 };\n\n    // Accept a number of screenshots instead of a config object\n    if (typeof config === 'number') {\n      config = {\n        count: config\n      };\n    }\n\n    // Accept a second 'folder' parameter instead of config.folder\n    if (!('folder' in config)) {\n      config.folder = folder || '.';\n    }\n\n    // Accept 'timestamps' instead of 'timemarks'\n    if ('timestamps' in config) {\n      config.timemarks = config.timestamps;\n    }\n\n    // Compute timemarks from count if not present\n    if (!('timemarks' in config)) {\n      if (!config.count) {\n        throw new Error('Cannot take screenshots: neither a count nor a timemark list are specified');\n      }\n\n      var interval = 100 / (1 + config.count);\n      config.timemarks = [];\n      for (var i = 0; i < config.count; i++) {\n        config.timemarks.push((interval * (i + 1)) + '%');\n      }\n    }\n\n    // Parse size option\n    if ('size' in config) {\n      var fixedSize = config.size.match(/^(\\d+)x(\\d+)$/);\n      var fixedWidth = config.size.match(/^(\\d+)x\\?$/);\n      var fixedHeight = config.size.match(/^\\?x(\\d+)$/);\n      var percentSize = config.size.match(/^(\\d+)%$/);\n\n      if (!fixedSize && !fixedWidth && !fixedHeight && !percentSize) {\n        throw new Error('Invalid size parameter: ' + config.size);\n      }\n    }\n\n    // Metadata helper\n    var metadata;\n    function getMetadata(cb) {\n      if (metadata) {\n        cb(null, metadata);\n      } else {\n        self.ffprobe(function(err, meta) {\n          metadata = meta;\n          cb(err, meta);\n        });\n      }\n    }\n\n    async.waterfall([\n      // Compute percent timemarks if any\n      function computeTimemarks(next) {\n        if (config.timemarks.some(function(t) { return ('' + t).match(/^[\\d.]+%$/); })) {\n          if (typeof source !== 'string') {\n            return next(new Error('Cannot compute screenshot timemarks with an input stream, please specify fixed timemarks'));\n          }\n\n          getMetadata(function(err, meta) {\n            if (err) {\n              next(err);\n            } else {\n              // Select video stream with the highest resolution\n              var vstream = meta.streams.reduce(function(biggest, stream) {\n                if (stream.codec_type === 'video' && stream.width * stream.height > biggest.width * biggest.height) {\n                  return stream;\n                } else {\n                  return biggest;\n                }\n              }, { width: 0, height: 0 });\n\n              if (vstream.width === 0) {\n                return next(new Error('No video stream in input, cannot take screenshots'));\n              }\n\n              var duration = Number(vstream.duration);\n              if (isNaN(duration)) {\n                duration = Number(meta.format.duration);\n              }\n\n              if (isNaN(duration)) {\n                return next(new Error('Could not get input duration, please specify fixed timemarks'));\n              }\n\n              config.timemarks = config.timemarks.map(function(mark) {\n                if (('' + mark).match(/^([\\d.]+)%$/)) {\n                  return duration * parseFloat(mark) / 100;\n                } else {\n                  return mark;\n                }\n              });\n\n              next();\n            }\n          });\n        } else {\n          next();\n        }\n      },\n\n      // Turn all timemarks into numbers and sort them\n      function normalizeTimemarks(next) {\n        config.timemarks = config.timemarks.map(function(mark) {\n          return utils.timemarkToSeconds(mark);\n        }).sort(function(a, b) { return a - b; });\n\n        next();\n      },\n\n      // Add '_%i' to pattern when requesting multiple screenshots and no variable token is present\n      function fixPattern(next) {\n        var pattern = config.filename || 'tn.png';\n\n        if (pattern.indexOf('.') === -1) {\n          pattern += '.png';\n        }\n\n        if (config.timemarks.length > 1 && !pattern.match(/%(s|0*i)/)) {\n          var ext = path.extname(pattern);\n          pattern = path.join(path.dirname(pattern), path.basename(pattern, ext) + '_%i' + ext);\n        }\n\n        next(null, pattern);\n      },\n\n      // Replace filename tokens (%f, %b) in pattern\n      function replaceFilenameTokens(pattern, next) {\n        if (pattern.match(/%[bf]/)) {\n          if (typeof source !== 'string') {\n            return next(new Error('Cannot replace %f or %b when using an input stream'));\n          }\n\n          pattern = pattern\n            .replace(/%f/g, path.basename(source))\n            .replace(/%b/g, path.basename(source, path.extname(source)));\n        }\n\n        next(null, pattern);\n      },\n\n      // Compute size if needed\n      function getSize(pattern, next) {\n        if (pattern.match(/%[whr]/)) {\n          if (fixedSize) {\n            return next(null, pattern, fixedSize[1], fixedSize[2]);\n          }\n\n          getMetadata(function(err, meta) {\n            if (err) {\n              return next(new Error('Could not determine video resolution to replace %w, %h or %r'));\n            }\n\n            var vstream = meta.streams.reduce(function(biggest, stream) {\n              if (stream.codec_type === 'video' && stream.width * stream.height > biggest.width * biggest.height) {\n                return stream;\n              } else {\n                return biggest;\n              }\n            }, { width: 0, height: 0 });\n\n            if (vstream.width === 0) {\n              return next(new Error('No video stream in input, cannot replace %w, %h or %r'));\n            }\n\n            var width = vstream.width;\n            var height = vstream.height;\n\n            if (fixedWidth) {\n              height = height * Number(fixedWidth[1]) / width;\n              width = Number(fixedWidth[1]);\n            } else if (fixedHeight) {\n              width = width * Number(fixedHeight[1]) / height;\n              height = Number(fixedHeight[1]);\n            } else if (percentSize) {\n              width = width * Number(percentSize[1]) / 100;\n              height = height * Number(percentSize[1]) / 100;\n            }\n\n            next(null, pattern, Math.round(width / 2) * 2, Math.round(height / 2) * 2);\n          });\n        } else {\n          next(null, pattern, -1, -1);\n        }\n      },\n\n      // Replace size tokens (%w, %h, %r) in pattern\n      function replaceSizeTokens(pattern, width, height, next) {\n        pattern = pattern\n          .replace(/%r/g, '%wx%h')\n          .replace(/%w/g, width)\n          .replace(/%h/g, height);\n\n        next(null, pattern);\n      },\n\n      // Replace variable tokens in pattern (%s, %i) and generate filename list\n      function replaceVariableTokens(pattern, next) {\n        var filenames = config.timemarks.map(function(t, i) {\n          return pattern\n            .replace(/%s/g, utils.timemarkToSeconds(t))\n            .replace(/%(0*)i/g, function(match, padding) {\n              var idx = '' + (i + 1);\n              return padding.substr(0, Math.max(0, padding.length + 1 - idx.length)) + idx;\n            });\n        });\n\n        self.emit('filenames', filenames);\n        next(null, filenames);\n      },\n\n      // Create output directory\n      function createDirectory(filenames, next) {\n        fs.exists(config.folder, function(exists) {\n          if (!exists) {\n            fs.mkdir(config.folder, function(err) {\n              if (err) {\n                next(err);\n              } else {\n                next(null, filenames);\n              }\n            });\n          } else {\n            next(null, filenames);\n          }\n        });\n      }\n    ], function runCommand(err, filenames) {\n      if (err) {\n        return self.emit('error', err);\n      }\n\n      var count = config.timemarks.length;\n      var split;\n      var filters = [split = {\n        filter: 'split',\n        options: count,\n        outputs: []\n      }];\n\n      if ('size' in config) {\n        // Set size to generate size filters\n        self.size(config.size);\n\n        // Get size filters and chain them with 'sizeN' stream names\n        var sizeFilters =  self._currentOutput.sizeFilters.get().map(function(f, i) {\n          if (i > 0) {\n            f.inputs = 'size' + (i - 1);\n          }\n\n          f.outputs = 'size' + i;\n\n          return f;\n        });\n\n        // Input last size filter output into split filter\n        split.inputs = 'size' + (sizeFilters.length - 1);\n\n        // Add size filters in front of split filter\n        filters = sizeFilters.concat(filters);\n\n        // Remove size filters\n        self._currentOutput.sizeFilters.clear();\n      }\n\n      var first = 0;\n      for (var i = 0; i < count; i++) {\n        var stream = 'screen' + i;\n        split.outputs.push(stream);\n\n        if (i === 0) {\n          first = config.timemarks[i];\n          self.seekInput(first);\n        }\n\n        self.output(path.join(config.folder, filenames[i]))\n          .frames(1)\n          .map(stream);\n\n        if (i > 0) {\n          self.seek(config.timemarks[i] - first);\n        }\n      }\n\n      self.complexFilter(filters);\n      self.run();\n    });\n\n    return this;\n  };\n\n\n  /**\n   * Merge (concatenate) inputs to a single file\n   *\n   * @method FfmpegCommand#concat\n   * @category Processing\n   * @aliases concatenate,mergeToFile\n   *\n   * @param {String|Writable} target output file or writable stream\n   * @param {Object} [options] pipe options (only used when outputting to a writable stream)\n   * @return FfmpegCommand\n   */\n  proto.mergeToFile =\n  proto.concatenate =\n  proto.concat = function(target, options) {\n    // Find out which streams are present in the first non-stream input\n    var fileInput = this._inputs.filter(function(input) {\n      return !input.isStream;\n    })[0];\n\n    var self = this;\n    this.ffprobe(this._inputs.indexOf(fileInput), function(err, data) {\n      if (err) {\n        return self.emit('error', err);\n      }\n\n      var hasAudioStreams = data.streams.some(function(stream) {\n        return stream.codec_type === 'audio';\n      });\n\n      var hasVideoStreams = data.streams.some(function(stream) {\n        return stream.codec_type === 'video';\n      });\n\n      // Setup concat filter and start processing\n      self.output(target, options)\n        .complexFilter({\n          filter: 'concat',\n          options: {\n            n: self._inputs.length,\n            v: hasVideoStreams ? 1 : 0,\n            a: hasAudioStreams ? 1 : 0\n          }\n        })\n        .run();\n    });\n\n    return this;\n  };\n};\n","/*jshint node:true*/\n'use strict';\n\nvar path = require('path');\nvar util = require('util');\nvar EventEmitter = require('events').EventEmitter;\n\nvar utils = require('./utils');\nvar ARGLISTS = ['_global', '_audio', '_audioFilters', '_video', '_videoFilters', '_sizeFilters', '_complexFilters'];\n\n\n/**\n * Create an ffmpeg command\n *\n * Can be called with or without the 'new' operator, and the 'input' parameter\n * may be specified as 'options.source' instead (or passed later with the\n * addInput method).\n *\n * @constructor\n * @param {String|ReadableStream} [input] input file path or readable stream\n * @param {Object} [options] command options\n * @param {Object} [options.logger=<no logging>] logger object with 'error', 'warning', 'info' and 'debug' methods\n * @param {Number} [options.niceness=0] ffmpeg process niceness, ignored on Windows\n * @param {Number} [options.priority=0] alias for `niceness`\n * @param {String} [options.presets=\"fluent-ffmpeg/lib/presets\"] directory to load presets from\n * @param {String} [options.preset=\"fluent-ffmpeg/lib/presets\"] alias for `presets`\n * @param {String} [options.stdoutLines=100] maximum lines of ffmpeg output to keep in memory, use 0 for unlimited\n * @param {Number} [options.timeout=<no timeout>] ffmpeg processing timeout in seconds\n * @param {String|ReadableStream} [options.source=<no input>] alias for the `input` parameter\n */\nfunction FfmpegCommand(input, options) {\n  // Make 'new' optional\n  if (!(this instanceof FfmpegCommand)) {\n    return new FfmpegCommand(input, options);\n  }\n\n  EventEmitter.call(this);\n\n  if (typeof input === 'object' && !('readable' in input)) {\n    // Options object passed directly\n    options = input;\n  } else {\n    // Input passed first\n    options = options || {};\n    options.source = input;\n  }\n\n  // Add input if present\n  this._inputs = [];\n  if (options.source) {\n    this.input(options.source);\n  }\n\n  // Add target-less output for backwards compatibility\n  this._outputs = [];\n  this.output();\n\n  // Create argument lists\n  var self = this;\n  ['_global', '_complexFilters'].forEach(function(prop) {\n    self[prop] = utils.args();\n  });\n\n  // Set default option values\n  options.stdoutLines = 'stdoutLines' in options ? options.stdoutLines : 100;\n  options.presets = options.presets || options.preset || path.join(__dirname, 'presets');\n  options.niceness = options.niceness || options.priority || 0;\n\n  // Save options\n  this.options = options;\n\n  // Setup logger\n  this.logger = options.logger || {\n    debug: function() {},\n    info: function() {},\n    warn: function() {},\n    error: function() {}\n  };\n}\nutil.inherits(FfmpegCommand, EventEmitter);\nmodule.exports = FfmpegCommand;\n\n\n/**\n * Clone an ffmpeg command\n *\n * This method is useful when you want to process the same input multiple times.\n * It returns a new FfmpegCommand instance with the exact same options.\n *\n * All options set _after_ the clone() call will only be applied to the instance\n * it has been called on.\n *\n * @example\n *   var command = ffmpeg('/path/to/source.avi')\n *     .audioCodec('libfaac')\n *     .videoCodec('libx264')\n *     .format('mp4');\n *\n *   command.clone()\n *     .size('320x200')\n *     .save('/path/to/output-small.mp4');\n *\n *   command.clone()\n *     .size('640x400')\n *     .save('/path/to/output-medium.mp4');\n *\n *   command.save('/path/to/output-original-size.mp4');\n *\n * @method FfmpegCommand#clone\n * @return FfmpegCommand\n */\nFfmpegCommand.prototype.clone = function() {\n  var clone = new FfmpegCommand();\n  var self = this;\n\n  // Clone options and logger\n  clone.options = this.options;\n  clone.logger = this.logger;\n\n  // Clone inputs\n  clone._inputs = this._inputs.map(function(input) {\n    return {\n      source: input.source,\n      options: input.options.clone()\n    };\n  });\n\n  // Create first output\n  if ('target' in this._outputs[0]) {\n    // We have outputs set, don't clone them and create first output\n    clone._outputs = [];\n    clone.output();\n  } else {\n    // No outputs set, clone first output options\n    clone._outputs = [\n      clone._currentOutput = {\n        flags: {}\n      }\n    ];\n\n    ['audio', 'audioFilters', 'video', 'videoFilters', 'sizeFilters', 'options'].forEach(function(key) {\n      clone._currentOutput[key] = self._currentOutput[key].clone();\n    });\n\n    if (this._currentOutput.sizeData) {\n      clone._currentOutput.sizeData = {};\n      utils.copy(this._currentOutput.sizeData, clone._currentOutput.sizeData);\n    }\n\n    utils.copy(this._currentOutput.flags, clone._currentOutput.flags);\n  }\n\n  // Clone argument lists\n  ['_global', '_complexFilters'].forEach(function(prop) {\n    clone[prop] = self[prop].clone();\n  });\n\n  return clone;\n};\n\n\n/* Add methods from options submodules */\n\nrequire('./options/inputs')(FfmpegCommand.prototype);\nrequire('./options/audio')(FfmpegCommand.prototype);\nrequire('./options/video')(FfmpegCommand.prototype);\nrequire('./options/videosize')(FfmpegCommand.prototype);\nrequire('./options/output')(FfmpegCommand.prototype);\nrequire('./options/custom')(FfmpegCommand.prototype);\nrequire('./options/misc')(FfmpegCommand.prototype);\n\n\n/* Add processor methods */\n\nrequire('./processor')(FfmpegCommand.prototype);\n\n\n/* Add capabilities methods */\n\nrequire('./capabilities')(FfmpegCommand.prototype);\n\nFfmpegCommand.setFfmpegPath = function(path) {\n  (new FfmpegCommand()).setFfmpegPath(path);\n};\n\nFfmpegCommand.setFfprobePath = function(path) {\n  (new FfmpegCommand()).setFfprobePath(path);\n};\n\nFfmpegCommand.setFlvtoolPath = function(path) {\n  (new FfmpegCommand()).setFlvtoolPath(path);\n};\n\nFfmpegCommand.availableFilters =\nFfmpegCommand.getAvailableFilters = function(callback) {\n  (new FfmpegCommand()).availableFilters(callback);\n};\n\nFfmpegCommand.availableCodecs =\nFfmpegCommand.getAvailableCodecs = function(callback) {\n  (new FfmpegCommand()).availableCodecs(callback);\n};\n\nFfmpegCommand.availableFormats =\nFfmpegCommand.getAvailableFormats = function(callback) {\n  (new FfmpegCommand()).availableFormats(callback);\n};\n\nFfmpegCommand.availableEncoders =\nFfmpegCommand.getAvailableEncoders = function(callback) {\n  (new FfmpegCommand()).availableEncoders(callback);\n};\n\n\n/* Add ffprobe methods */\n\nrequire('./ffprobe')(FfmpegCommand.prototype);\n\nFfmpegCommand.ffprobe = function(file) {\n  var instance = new FfmpegCommand(file);\n  instance.ffprobe.apply(instance, Array.prototype.slice.call(arguments, 1));\n};\n\n/* Add processing recipes */\n\nrequire('./recipes')(FfmpegCommand.prototype);\n","module.exports = require('./lib/fluent-ffmpeg');\n","import { app, BrowserWindow, ipcMain, dialog, shell, protocol, Menu, nativeImage, Tray, Rectangle, screen } from 'electron'\nimport { dirname, join } from 'path'\nimport { readFile, writeFile, readdir, stat, mkdir } from 'fs/promises'\nimport { existsSync, createReadStream } from 'fs'\nimport ffmpeg from 'fluent-ffmpeg'\nimport { extname } from 'path'\nimport { spawn, execSync } from 'child_process'\n\n// Get the directory containing the main script\nconst appPath = process.argv[1] || process.cwd()\nconst appDir = dirname(appPath)\n\n// Path to drag icon for file drag operations (64x64 PNG)\n// Try multiple locations for dev vs production\nconst dragIconPaths = [\n  join(appDir, '..', '..', '..', '64x64.png'), // Dev mode\n  join(process.resourcesPath, '64x64.png'),    // Production - resources folder\n  join(process.resourcesPath, 'app.asar', '64x64.png'), // Production - inside asar\n  join(app.getAppPath(), '64x64.png'),         // Alternative production path\n]\n\nconst dragIconPath = dragIconPaths.find(p => existsSync(p)) || dragIconPaths[0]\n\n// Disable hardware acceleration to prevent GPU crashes\napp.disableHardwareAcceleration()\n\n// Handle uncaught errors to prevent crashes\nprocess.on('uncaughtException', (error) => {\n  console.error('Uncaught Exception:', error)\n})\n\nprocess.on('unhandledRejection', (reason, promise) => {\n  console.error('Unhandled Rejection at:', promise, 'reason:', reason)\n})\n\n// Disable hardware acceleration BEFORE app is ready (must be called before app is ready)\napp.disableHardwareAcceleration()\n\n// Keep references to prevent garbage collection\nlet mainWindow: BrowserWindow | null = null\nlet tray: Tray | null = null\nlet isQuitting = false\nlet backendProcess: ReturnType<typeof spawn> | null = null\n\n// Backend paths\nconst getBackendPaths = () => {\n  const inProduction = !isDev\n  return {\n    backendPath: inProduction\n      ? join(process.resourcesPath, 'bin', 'ClipVault.exe')\n      : join(appDir, '..', '..', '..', 'bin', 'ClipVault.exe'),\n    backendLogPath: inProduction\n      ? join(process.resourcesPath, 'bin', 'clipvault.log')\n      : join(appDir, '..', '..', '..', 'bin', 'clipvault.log'),\n  }\n}\n\n// Start backend process\nfunction startBackend(): boolean {\n  const { backendPath } = getBackendPaths()\n  \n  if (!existsSync(backendPath)) {\n    console.warn('Backend executable not found:', backendPath)\n    return false\n  }\n\n  try {\n    console.log('Spawning backend from:', backendPath)\n    const backendProc = spawn(backendPath, [], {\n      detached: true,\n      stdio: ['ignore', 'ignore', 'ignore'],\n    })\n\n    backendProc.on('error', (error) => {\n      console.error('Backend spawn error:', error)\n    })\n\n    backendProc.on('exit', (code, signal) => {\n      console.log(`Backend exited with code ${code} and signal ${signal}`)\n      if (backendProcess === backendProc) {\n        backendProcess = null\n      }\n    })\n\n    console.log('Backend spawned with PID:', backendProc.pid)\n    backendProcess = backendProc\n\n    // Properly detach the process so it continues running after parent exits\n    backendProc.unref()\n    return true\n  } catch (error) {\n    console.error('Failed to start backend:', error)\n    return false\n  }\n}\n\n// Kill backend process\nfunction killBackend(): boolean {\n  if (!backendProcess) {\n    // Try to find and kill any existing ClipVault.exe processes (backend only)\n    try {\n      execSync('taskkill /F /IM ClipVault.exe /FI \"WINDOWTITLE eq ClipVault\"', { \n        stdio: 'ignore' \n      })\n      console.log('Killed existing backend processes')\n      return true\n    } catch {\n      // No processes found or already killed\n      return false\n    }\n  }\n\n  try {\n    console.log('Killing backend process with PID:', backendProcess.pid)\n    backendProcess.kill()\n    backendProcess = null\n    return true\n  } catch (error) {\n    console.error('Failed to kill backend:', error)\n    return false\n  }\n}\n\n// Restart backend process\nasync function restartBackend(): Promise<boolean> {\n  console.log('Restarting backend...')\n  killBackend()\n  \n  // Wait a moment for the process to fully terminate\n  await new Promise(resolve => setTimeout(resolve, 1000))\n  \n  return startBackend()\n}\n\n// App configuration\nconst isDev = process.env.NODE_ENV === 'development'\nconst clipsPath = 'D:\\\\Clips\\\\ClipVault'\nconst thumbnailsPath = join(app.getPath('userData'), 'thumbnails')\n\n// Configure FFmpeg path for bundled version\nconst ffmpegPath = join(process.resourcesPath, 'ffmpeg', 'ffmpeg.exe')\nconst ffprobePath = join(process.resourcesPath, 'ffmpeg', 'ffprobe.exe')\nif (existsSync(ffmpegPath)) {\n  process.env.PATH = `${dirname(ffmpegPath)}:${process.env.PATH}`\n  console.log('Using bundled FFmpeg:', ffmpegPath)\n}\nif (existsSync(ffprobePath)) {\n  console.log('Using bundled FFprobe:', ffprobePath)\n}\n\nconsole.log('Config:', { clipsPath, thumbnailsPath, userData: app.getPath('userData') })\n\n// Single instance lock - prevent multiple app instances\nconst gotTheLock = app.requestSingleInstanceLock()\n\nif (!gotTheLock) {\n  console.log('Another instance is already running. Quitting.')\n  app.quit()\n} else {\n  // When a second instance tries to run, focus the existing window AND ensure backend is running\n  app.on('second-instance', () => {\n    console.log('Second instance detected, focusing existing window and checking backend')\n    if (mainWindow) {\n      if (mainWindow.isMinimized()) {\n        mainWindow.restore()\n      }\n      mainWindow.show()\n      mainWindow.focus()\n    }\n    \n    // Try to start backend again (in case it was stopped)\n    const inProduction = !isDev\n    const backendPath = inProduction\n      ? join(process.resourcesPath, 'bin', 'ClipVault.exe')\n      : join(appDir, '..', '..', '..', 'bin', 'ClipVault.exe')\n    \n    if (existsSync(backendPath)) {\n      try {\n        console.log('Second instance: Spawning backend from:', backendPath)\n        const backendProc = spawn(backendPath, [], {\n          detached: true,\n          stdio: ['ignore', 'ignore', 'ignore'],\n        })\n        backendProc.unref()\n        console.log('Second instance: Backend spawn attempted with PID:', backendProc.pid)\n      } catch (error) {\n        console.error('Second instance: Failed to start backend:', error)\n      }\n    }\n  })\n}\n\n// Register custom protocol before app is ready\nprotocol.registerSchemesAsPrivileged([\n  {\n    scheme: 'clipvault',\n    privileges: {\n      secure: true,\n      supportFetchAPI: true,\n      bypassCSP: true,\n      corsEnabled: true,\n    },\n  },\n])\n\n// Backend configuration loader\n// Create system tray icon\nfunction createTray(): void {\n  console.log('Creating tray icon...')\n\n  // Try to load an icon\n  let icon: Electron.NativeImage | undefined\n  if (existsSync(dragIconPath)) {\n    icon = nativeImage.createFromPath(dragIconPath)\n    if (icon.isEmpty()) {\n      icon = undefined\n    }\n  }\n\n  // Use default icon if custom one not found\n  if (!icon) {\n    icon = nativeImage.createFromPath(join(appDir, '..', 'renderer', 'favicon.ico'))\n    if (icon?.isEmpty()) {\n      icon = undefined\n    }\n  }\n\n  tray = new Tray(icon || nativeImage.createEmpty())\n  tray.setToolTip('ClipVault Editor')\n  tray.setContextMenu(Menu.buildFromTemplate([\n    {\n      label: 'Open ClipVault',\n      click: () => {\n        if (mainWindow) {\n          mainWindow.show()\n          mainWindow.focus()\n        }\n      }\n    },\n    {\n      label: 'Open Clips Folder',\n      click: async () => {\n        const clipsFolder = clipsPath\n        if (!existsSync(clipsFolder)) {\n          await mkdir(clipsFolder, { recursive: true })\n        }\n        await shell.openPath(clipsFolder)\n      }\n    },\n    { type: 'separator' },\n    {\n      label: 'Exit',\n      click: () => {\n        app.quit()\n      }\n    }\n  ]))\n\n  tray.on('click', () => {\n    if (mainWindow) {\n      if (mainWindow.isVisible()) {\n        mainWindow.hide()\n      } else {\n        mainWindow.show()\n        mainWindow.focus()\n      }\n    }\n  })\n\n  tray.on('double-click', () => {\n    if (mainWindow) {\n      mainWindow.show()\n      mainWindow.focus()\n    }\n  })\n\n  console.log('Tray icon created')\n}\n\nasync function createWindow() {\n  console.log('Creating main window...')\n  mainWindow = new BrowserWindow({\n    width: 1400,\n    height: 900,\n    minWidth: 1000,\n    minHeight: 600,\n    title: 'ClipVault Editor',\n    backgroundColor: '#0f0f0f',\n    show: true, // Show immediately with background color\n    webPreferences: {\n      preload: isDev\n        ? join(appDir, '..', 'preload', 'index.js')\n        : join(process.resourcesPath, 'app.asar', 'dist', 'preload', 'index.js'),\n      contextIsolation: true,\n      nodeIntegration: false,\n      sandbox: false,\n      webSecurity: false,\n    },\n    titleBarStyle: 'hiddenInset', // Modern look on macOS\n    ...(process.platform === 'win32'\n      ? {\n          titleBarOverlay: {\n            color: '#0f0f0f',\n            symbolColor: '#ffffff',\n          },\n        }\n      : {}),\n  })\n  console.log('Main window created, loading content...')\n\n  // Load the app\n  try {\n    if (isDev) {\n      await mainWindow.loadURL('http://localhost:5173')\n      console.log('Loaded dev URL, opening devtools...')\n      mainWindow.webContents.openDevTools()\n    } else {\n      await mainWindow.loadFile(isDev\n        ? join(appDir, '..', 'renderer', 'index.html')\n        : join(process.resourcesPath, 'app.asar', 'dist', 'renderer', 'index.html'))\n      console.log('Loaded production HTML file')\n    }\n  } catch (error) {\n    console.error('Error loading window content:', error)\n  }\n\n  // Remove default menu bar\n  Menu.setApplicationMenu(null)\n\n  // Handle renderer crashes gracefully\n  mainWindow.webContents.on('crashed', (event, killed) => {\n    console.error('Window crashed!', { killed })\n    if (!killed) {\n      mainWindow?.reload()\n    }\n  })\n\n  // Handle GPU process crashes\n  app.on('gpu-process-crashed', (event, killed) => {\n    console.error('GPU process crashed!', { killed })\n  })\n\n  mainWindow.once('ready-to-show', () => {\n    console.log('Window ready to show, showing now...')\n    mainWindow?.show()\n    mainWindow?.focus()\n  })\n  \n  // Fallback: Show window after 2 seconds even if ready-to-show doesn't fire\n  setTimeout(() => {\n    if (mainWindow && !mainWindow.isVisible()) {\n      console.log('Fallback: forcing window to show after timeout')\n      mainWindow.show()\n      mainWindow.focus()\n    }\n  }, 2000)\n\n  // Minimize to tray instead of closing\n  mainWindow.on('close', (event) => {\n    if (!isQuitting) {\n      event.preventDefault()\n      console.log('Minimizing to tray instead of closing')\n      mainWindow?.hide()\n    }\n  })\n\n  mainWindow.on('page-title-updated', (event) => {\n    event.preventDefault()\n  })\n\n  mainWindow.on('closed', () => {\n    mainWindow = null\n  })\n\n  // F12 to toggle devtools\n  mainWindow.webContents.on('before-input-event', (event, input) => {\n    if (input.key === 'F12') {\n      mainWindow?.webContents.toggleDevTools()\n      event.preventDefault()\n    }\n  })\n}\n\n// IPC Handlers\n\n// Settings file path - use standard AppData location (same as C++ backend)\nconst getSettingsPath = () => {\n  // Use process.env.APPDATA to match C++ backend's CSIDL_APPDATA\n  // This ensures both backend and UI use exact same path\n  const appDataPath = process.env.APPDATA || app.getPath('appData')\n  return join(appDataPath, 'ClipVault', 'settings.json')\n}\n\n// Default settings object\nconst defaultSettings = {\n  output_path: 'D:\\\\Clips\\\\ClipVault',\n  buffer_seconds: 120,\n  video: {\n    width: 1920,\n    height: 1080,\n    fps: 60,\n    encoder: 'auto',\n    quality: 20,\n  },\n  audio: {\n    sample_rate: 48000,\n    bitrate: 160,\n    system_audio_enabled: true,\n    microphone_enabled: true,\n  },\n  hotkey: {\n    save_clip: 'F9',\n  },\n}\n\n// Get settings\nipcMain.handle('settings:get', async () => {\n  try {\n    const settingsPath = getSettingsPath()\n    console.log('Settings path:', settingsPath)\n    \n    if (!existsSync(settingsPath)) {\n      console.log('Settings file not found, returning defaults')\n      return defaultSettings\n    }\n    \n    console.log('Reading settings from:', settingsPath)\n    const content = await readFile(settingsPath, 'utf-8')\n    \n    try {\n      return JSON.parse(content)\n    } catch (parseError) {\n      console.error('JSON parse error, returning defaults:', parseError)\n      return defaultSettings\n    }\n  } catch (error) {\n    console.error('Failed to read settings:', error)\n    return defaultSettings\n  }\n})\n\n// Save settings and restart backend\nipcMain.handle('settings:save', async (_, settings: unknown) => {\n  try {\n    const settingsPath = getSettingsPath()\n    const configDir = join(app.getPath('appData'), 'ClipVault')\n    \n    // Ensure config directory exists\n    if (!existsSync(configDir)) {\n      await mkdir(configDir, { recursive: true })\n    }\n    \n    await writeFile(settingsPath, JSON.stringify(settings, null, 2), 'utf-8')\n    console.log('Settings saved to:', settingsPath)\n    \n    // Restart backend to apply new settings\n    console.log('Settings saved, restarting backend...')\n    const restarted = await restartBackend()\n    \n    return { success: true, restarted }\n  } catch (error) {\n    console.error('Failed to save settings:', error)\n    throw error\n  }\n})\n\n// Restart backend manually\nipcMain.handle('backend:restart', async () => {\n  try {\n    const restarted = await restartBackend()\n    return { success: true, restarted }\n  } catch (error) {\n    console.error('Failed to restart backend:', error)\n    throw error\n  }\n})\n\n// Get monitor information\nipcMain.handle('system:getMonitors', async () => {\n  try {\n    const displays = screen.getAllDisplays()\n    return displays.map((display, index) => ({\n      id: index,\n      name: `Monitor ${index + 1}`,\n      width: display.bounds.width,\n      height: display.bounds.height,\n      x: display.bounds.x,\n      y: display.bounds.y,\n      primary: display.bounds.x === 0 && display.bounds.y === 0,\n    }))\n  } catch (error) {\n    console.error('Failed to get monitors:', error)\n    throw error\n  }\n})\n\n// Get list of clips\nipcMain.handle('clips:getList', async () => {\n  try {\n    if (!existsSync(clipsPath)) {\n      await mkdir(clipsPath, { recursive: true })\n      return []\n    }\n\n    const files = await readdir(clipsPath)\n    const clips = await Promise.all(\n      files\n        .filter(file => file.endsWith('.mp4'))\n        .map(async filename => {\n          const filePath = join(clipsPath, filename)\n          const stats = await stat(filePath)\n          const metadataPath = filePath.replace('.mp4', '.clipvault.json')\n\n          let metadata = null\n          try {\n            if (existsSync(metadataPath)) {\n              const content = await readFile(metadataPath, 'utf-8')\n              metadata = JSON.parse(content)\n            }\n          } catch (e) {\n            console.error('Failed to read metadata:', e)\n          }\n\n          return {\n            id: filename.replace('.mp4', ''),\n            filename,\n            path: filePath,\n            size: stats.size,\n            createdAt: stats.birthtime.toISOString(),\n            modifiedAt: stats.mtime.toISOString(),\n            metadata,\n          }\n        })\n    )\n\n    return clips.sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime())\n  } catch (error) {\n    console.error('Failed to get clips list:', error)\n    throw error\n  }\n})\n\n// Save clip metadata\nipcMain.handle('clips:saveMetadata', async (_, clipId: string, metadata: unknown) => {\n  try {\n    const metadataPath = join(clipsPath, `${clipId}.clipvault.json`)\n    await writeFile(metadataPath, JSON.stringify(metadata, null, 2), 'utf-8')\n    return true\n  } catch (error) {\n    console.error('Failed to save metadata:', error)\n    throw error\n  }\n})\n\n// Get clip metadata\nipcMain.handle('clips:getMetadata', async (_, clipId: string) => {\n  try {\n    const metadataPath = join(clipsPath, `${clipId}.clipvault.json`)\n    if (!existsSync(metadataPath)) {\n      return null\n    }\n    const content = await readFile(metadataPath, 'utf-8')\n    return JSON.parse(content)\n  } catch (error) {\n    console.error('Failed to get metadata:', error)\n    return null\n  }\n})\n\n// Open clips folder in file explorer\nipcMain.handle('system:openFolder', async () => {\n  await shell.openPath(clipsPath)\n})\n\n// Show save dialog\nipcMain.handle('dialog:save', async (_, options) => {\n  if (!mainWindow) return null\n  const result = await dialog.showSaveDialog(mainWindow, options)\n  return result\n})\n\n// Generate thumbnail for a clip\nipcMain.handle('clips:generateThumbnail', async (_, clipId: string, videoPath: string) => {\n  try {\n    // Ensure thumbnails directory exists\n    if (!existsSync(thumbnailsPath)) {\n      await mkdir(thumbnailsPath, { recursive: true })\n    }\n\n    const thumbnailFilename = `${clipId}.jpg`\n    const thumbnailPath = join(thumbnailsPath, thumbnailFilename)\n\n    // Check if thumbnail already exists\n    if (existsSync(thumbnailPath)) {\n      return `clipvault://thumb/${encodeURIComponent(thumbnailFilename)}`\n    }\n\n    // Generate thumbnail using FFmpeg\n    return new Promise((resolve, reject) => {\n      ffmpeg(videoPath)\n        .screenshots({\n          timestamps: ['10%'], // Take screenshot at 10% into the video\n          filename: thumbnailFilename,\n          folder: thumbnailsPath,\n          size: '480x270', // 16:9 aspect ratio thumbnail\n        })\n        .on('end', () => {\n          resolve(`clipvault://thumb/${encodeURIComponent(thumbnailFilename)}`)\n        })\n        .on('error', err => {\n          console.error('FFmpeg error:', err)\n          reject(err)\n        })\n    })\n  } catch (error) {\n    console.error('Failed to generate thumbnail:', error)\n    throw error\n  }\n})\n\n// Get video file URL for loading in video element\nipcMain.handle('video:getFileUrl', async (_, filename: string) => {\n  try {\n    const filePath = join(clipsPath, filename)\n    \n    if (!existsSync(filePath)) {\n      console.error('Video file not found:', filePath)\n      return { success: false, error: 'File not found' }\n    }\n    \n    // Return the file:// URL which the renderer can use directly\n    // Note: webSecurity is disabled in the window, so file:// URLs work\n    const fileUrl = `file:///${filePath.replace(/\\\\/g, '/')}`\n    console.log('Returning video file URL:', fileUrl)\n    \n    return { success: true, url: fileUrl, path: filePath }\n  } catch (error) {\n    console.error('Error getting video file URL:', error)\n    return { success: false, error: String(error) }\n  }\n})\n\n// Get video metadata (duration, resolution, etc.)\nipcMain.handle('clips:getVideoMetadata', async (_, videoPath: string) => {\n  try {\n    return new Promise((resolve, reject) => {\n      ffmpeg.ffprobe(videoPath, (err, metadata) => {\n        if (err) {\n          reject(err)\n          return\n        }\n\n        const videoStream = metadata.streams.find(s => s.codec_type === 'video')\n        const audioStreams = metadata.streams.filter(s => s.codec_type === 'audio')\n\n        resolve({\n          duration: metadata.format.duration || 0,\n          width: videoStream?.width || 0,\n          height: videoStream?.height || 0,\n          fps: videoStream ? eval(videoStream.r_frame_rate || '0') : 0,\n          bitrate: metadata.format.bit_rate || 0,\n          size: metadata.format.size || 0,\n          format: metadata.format.format_name || '',\n          videoCodec: videoStream?.codec_name || '',\n          audioTracks: audioStreams.length,\n        })\n      })\n    })\n  } catch (error) {\n    console.error('Failed to get video metadata:', error)\n    throw error\n  }\n})\n\n // Keep reference to export preview window\nlet exportPreviewWindow: BrowserWindow | null = null\n\n// Create export preview window\nfunction createExportPreviewWindow(filePath: string) {\n  // Close existing preview window if open\n  if (exportPreviewWindow && !exportPreviewWindow.isDestroyed()) {\n    exportPreviewWindow.close()\n  }\n\n  exportPreviewWindow = new BrowserWindow({\n    width: 600,\n    height: 500,\n    alwaysOnTop: true,\n    modal: false,\n    resizable: false,\n    title: 'Export Complete',\n    backgroundColor: '#1a1a1a',\n    webPreferences: {\n      contextIsolation: false,\n      nodeIntegration: true,\n      webSecurity: false,\n    },\n  })\n\n  // Remove menu bar from popup\n  exportPreviewWindow.setMenu(null)\n\n  // Handle preview window crashes\n  exportPreviewWindow.webContents.on('crashed', () => {\n    console.error('Preview window crashed')\n    exportPreviewWindow?.close()\n    exportPreviewWindow = null\n  })\n\n  // Convert file path to clipvault protocol URL\n  const filename = filePath.split('\\\\').pop() || ''\n  // Use 'exported' protocol for files in exported-clips directory\n  const isExported = filePath.includes('exported-clips')\n  const videoUrl = `clipvault://${isExported ? 'exported' : 'clip'}/${encodeURIComponent(filename)}`\n\n  const htmlContent = `<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <style>\n    * { box-sizing: border-box; }\n    body { margin: 0; padding: 20px; background: #1a1a1a; color: white; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; overflow: hidden; }\n    video { width: 100%; border-radius: 8px; max-height: 320px; object-fit: contain; background: #000; }\n    .drag-hint { text-align: center; padding: 15px; background: #2a2a2a; border-radius: 8px; margin-top: 10px; cursor: grab; user-select: none; }\n    .drag-hint:active { cursor: grabbing; }\n    .drag-hint h3 { margin: 0 0 8px 0; font-size: 16px; color: #4ade80; }\n    .drag-hint p { margin: 0; font-size: 13px; color: #aaa; }\n    .timer { position: absolute; top: 10px; right: 10px; font-size: 12px; color: #666; }\n    .file-icon { font-size: 24px; margin-bottom: 8px; }\n    .actions { display: flex; gap: 10px; margin-top: 10px; }\n    .btn { flex: 1; padding: 10px; background: #3a3a3a; border: none; border-radius: 6px; color: white; cursor: pointer; font-size: 13px; }\n    .btn:hover { background: #4a4a4a; }\n    .btn-primary { background: #4ade80; color: #0f0f0f; }\n    .btn-primary:hover { background: #22c55e; }\n  </style>\n</head>\n<body>\n  <div class=\"timer\" id=\"timer\">Closing in 30s</div>\n  <video src=\"${videoUrl}\" controls autoplay></video>\n  <div class=\"drag-hint\" id=\"dragHint\" draggable=\"true\">\n    <div class=\"file-icon\"></div>\n    <h3>Export Complete!</h3>\n    <p>Drag from here to share the file anywhere</p>\n  </div>\n  <div class=\"actions\">\n    <button class=\"btn\" onclick=\"copyPath()\">Copy Path</button>\n    <button class=\"btn btn-primary\" onclick=\"openFolder()\">Open Folder</button>\n  </div>\n  <script>\n    const { ipcRenderer } = require('electron');\n    const filePath = '${filePath.replace(/\\\\/g, '\\\\\\\\')}';\n    let timeLeft = 30;\n    const timerEl = document.getElementById('timer');\n    const interval = setInterval(() => {\n      timeLeft--;\n      timerEl.textContent = 'Closing in ' + timeLeft + 's';\n      if (timeLeft <= 0) {\n        clearInterval(interval);\n        window.close();\n      }\n    }, 1000);\n    \n    // Handle drag start - send IPC to main process for native drag\n    const dragHint = document.getElementById('dragHint');\n    dragHint.addEventListener('dragstart', (e) => {\n      e.preventDefault();\n      // Send IPC to main process to initiate native drag\n      ipcRenderer.send('export:startDrag', filePath);\n    });\n    \n    function copyPath() {\n      navigator.clipboard.writeText(filePath);\n      const btn = event.target;\n      const originalText = btn.textContent;\n      btn.textContent = 'Copied!';\n      setTimeout(() => btn.textContent = originalText, 1500);\n    }\n    \n    function openFolder() {\n      ipcRenderer.send('export:openFolder', filePath);\n    }\n  </script>\n</body>\n</html>`\n\n  exportPreviewWindow.loadURL('data:text/html;charset=utf-8,' + encodeURIComponent(htmlContent))\n\n  // Auto-close after 30 seconds\n  const autoCloseTimeout = setTimeout(() => {\n    if (exportPreviewWindow && !exportPreviewWindow.isDestroyed()) {\n      exportPreviewWindow.close()\n    }\n  }, 30000)\n\n  exportPreviewWindow.on('closed', () => {\n    clearTimeout(autoCloseTimeout)\n    exportPreviewWindow = null\n  })\n\n  // Handle drag start - use native startDrag API for external file drops\n  exportPreviewWindow.webContents.on('ipc-message', (event, channel, data) => {\n    if (channel === 'export:startDrag') {\n      console.log('Starting native drag for:', data)\n      try {\n        // Create nativeImage from the icon file\n        let dragIcon: Electron.NativeImage | undefined\n        if (existsSync(dragIconPath)) {\n          dragIcon = nativeImage.createFromPath(dragIconPath)\n          console.log('Drag icon loaded from:', dragIconPath)\n        } else {\n          console.warn('Drag icon not found at:', dragIconPath)\n        }\n        \n        // Use webContents.startDrag for native file drag (required for external apps like Discord)\n        exportPreviewWindow?.webContents.startDrag({\n          file: data as string,\n          icon: dragIcon || nativeImage.createEmpty()\n        })\n      } catch (error) {\n        console.error('Error starting drag:', error)\n      }\n    } else if (channel === 'export:openFolder') {\n      // Open the folder containing the exported file\n      const folderPath = dirname(data as string)\n      shell.openPath(folderPath)\n    }\n  })\n}\n\n// IPC handler to show export preview\nipcMain.handle('export:showPreview', async (_, filePath: string) => {\n  createExportPreviewWindow(filePath)\n  return { success: true }\n})\n\n  // Extract audio tracks from video file\n   ipcMain.handle('audio:extractTracks', async (_, clipId: string, videoPath: string) => {\n     try {\n       // Ensure audio cache directory exists\n       const audioCachePath = join(thumbnailsPath, 'audio')\n       if (!existsSync(audioCachePath)) {\n         await mkdir(audioCachePath, { recursive: true })\n       }\n\n       const track1Path = join(audioCachePath, `${clipId}_track1.m4a`)\n       const track2Path = join(audioCachePath, `${clipId}_track2.m4a`)\n\n       const results: { track1?: string; track2?: string; error?: string } = {}\n\n       // Check if already cached\n       const track1Exists = existsSync(track1Path)\n       const track2Exists = existsSync(track2Path)\n\n       if (track1Exists) {\n         results.track1 = `clipvault://audio/${encodeURIComponent(`${clipId}_track1.m4a`)}`\n       }\n       if (track2Exists) {\n         results.track2 = `clipvault://audio/${encodeURIComponent(`${clipId}_track2.m4a`)}`\n       }\n\n       if (track1Exists && track2Exists) {\n         return results\n       }\n\n       // Get video metadata to check audio tracks\n       const metadata = await new Promise<ffmpeg.FfprobeData>((resolve, reject) => {\n         ffmpeg.ffprobe(videoPath, (err, data) => {\n           if (err) reject(err)\n           else resolve(data)\n         })\n       })\n\n       const audioStreams = metadata.streams.filter(s => s.codec_type === 'audio')\n\n       // Extract track 1 if not cached and exists\n       if (!track1Exists && audioStreams.length >= 1) {\n         await new Promise<void>((resolve, reject) => {\n           ffmpeg(videoPath)\n             .outputOptions(['-map 0:a:0', '-c:a aac', '-b:a 128k'])\n             .save(track1Path)\n             .on('end', () => resolve())\n             .on('error', err => reject(err))\n         })\n         results.track1 = `clipvault://audio/${encodeURIComponent(`${clipId}_track1.m4a`)}`\n       }\n\n       // Extract track 2 if not cached and exists\n       if (!track2Exists && audioStreams.length >= 2) {\n         await new Promise<void>((resolve, reject) => {\n           ffmpeg(videoPath)\n             .outputOptions(['-map 0:a:1', '-c:a aac', '-b:a 128k'])\n             .save(track2Path)\n             .on('end', () => resolve())\n             .on('error', err => reject(err))\n         })\n         results.track2 = `clipvault://audio/${encodeURIComponent(`${clipId}_track2.m4a`)}`\n       }\n\n       return results\n     } catch (error) {\n       console.error('Failed to extract audio tracks:', error)\n       return { error: String(error) }\n     }\n   })\n\n   // Export clip with trim and audio track selection\n   ipcMain.handle(\n      'editor:exportClip',\n      async (\n        _,\n        params: {\n          clipPath: string\n          exportFilename: string\n          trimStart: number\n          trimEnd: number\n          audioTrack1: boolean\n          audioTrack2: boolean\n          audioTrack1Volume?: number\n          audioTrack2Volume?: number\n          targetSizeMB?: number | 'original'\n        }\n      ) => {\n        try {\n          const { clipPath, exportFilename, trimStart, trimEnd, audioTrack1, audioTrack2, audioTrack1Volume, audioTrack2Volume, targetSizeMB = 'original' } = params\n          const duration = trimEnd - trimStart\n          const vol1 = audioTrack1Volume ?? 1.0\n          const vol2 = audioTrack2Volume ?? 1.0\n\n          // Create exported-clips directory if it doesn't exist\n          const exportedClipsPath = join(clipsPath, 'exported-clips')\n          if (!existsSync(exportedClipsPath)) {\n            await mkdir(exportedClipsPath, { recursive: true })\n          }\n\n          // Build full output path\n          const outputPath = join(exportedClipsPath, exportFilename)\n\n          // Calculate video bitrate if target size is specified\n          let videoBitrate: number | null = null\n          let useTargetSize = false\n          if (typeof targetSizeMB === 'number' && targetSizeMB > 0 && duration > 0) {\n            // Formula: target_size_mb * 8192 kb / duration_sec - audio_overhead\n            // Leave ~15% overhead for container and audio\n            const targetSizeKB = targetSizeMB * 8192 * 0.85\n            const totalBitrate = Math.floor(targetSizeKB / duration)\n            const audioBitrate = 128 // AAC audio bitrate\n            videoBitrate = Math.max(totalBitrate - audioBitrate, 500) // Minimum 500kbps\n            useTargetSize = true\n            console.log(`Target size: ${targetSizeMB}MB, Duration: ${duration}s, Video bitrate: ${videoBitrate}kbps`)\n          }\n\n          return new Promise((resolve, reject) => {\n            const command = ffmpeg(clipPath)\n              .seekInput(trimStart)\n              .duration(duration)\n\n            // Configure video encoding based on target size\n            if (useTargetSize && videoBitrate) {\n              // Use H.264 with target bitrate for size-constrained export\n              // Note: Don't use -crf with -b:v - they conflict (CRF overrides bitrate)\n              command.videoCodec('libx264')\n              command.outputOptions([\n                '-b:v', `${videoBitrate}k`,\n                '-maxrate', `${Math.floor(videoBitrate * 1.5)}k`,\n                '-bufsize', `${videoBitrate * 2}k`,\n                '-preset', 'fast',\n                '-pix_fmt', 'yuv420p'\n              ])\n            } else {\n              // Original quality - just copy video stream\n              command.videoCodec('copy')\n            }\n\n            // Map audio tracks based on options\n            if (audioTrack1 && audioTrack2) {\n              // Mix both tracks with volume adjustment\n              const filter = `[0:a:0]volume=${vol1}[a0];[0:a:1]volume=${vol2}[a1];[a0][a1]amix=inputs=2:duration=first:dropout_transition=3[aout]`\n              command.outputOptions([\n                '-map 0:v:0',\n                '-filter_complex', filter,\n                '-map', '[aout]',\n                '-c:a aac',\n                '-b:a 128k',\n                '-ac 2'\n              ])\n            } else if (audioTrack1) {\n              // Only track 1 with volume\n              if (vol1 < 1.0) {\n                command.outputOptions([\n                  '-map 0:v:0',\n                  '-map 0:a:0',\n                  '-filter:a:0', `volume=${vol1}`\n                ])\n              } else {\n                command.outputOptions(['-map 0:v:0', '-map 0:a:0'])\n              }\n            } else if (audioTrack2) {\n              // Only track 2 with volume\n              if (vol2 < 1.0) {\n                command.outputOptions([\n                  '-map 0:v:0',\n                  '-map 0:a:1',\n                  '-filter:a:0', `volume=${vol2}`\n                ])\n              } else {\n                command.outputOptions(['-map 0:v:0', '-map 0:a:1'])\n              }\n            } else {\n              // No audio - video only\n              command.noAudio()\n            }\n\n            command\n              .on('progress', progress => {\n                if (mainWindow && progress.percent) {\n                  mainWindow.webContents.send('export:progress', { percent: progress.percent })\n                }\n              })\n              .on('end', () => {\n                resolve({ success: true, filePath: outputPath })\n              })\n              .on('error', err => {\n                console.error('Export error:', err)\n                reject(err)\n              })\n              .save(outputPath)\n          })\n        } catch (error) {\n          console.error('Failed to export clip:', error)\n          throw error\n        }\n      }\n    )\n\n// App lifecycle\napp.whenReady().then(async () => {\n  console.log('App is ready, creating window...')\n\n  // Register protocol handler FIRST, before creating window\n  // This ensures clipvault:// URLs can be loaded immediately when the window opens\n  protocol.registerFileProtocol('clipvault', (request, callback) => {\n    try {\n      console.log('Protocol handler called:', request.url)\n      const url = new URL(request.url)\n      const host = url.host // \"clip\" or \"thumb\"\n      const pathname = url.pathname // \"/filename.mp4\"\n\n      console.log('Parsed URL:', { host, pathname })\n\n      // The URL format is: clipvault://clip/filename.mp4\n      // where host = type (clip/thumb), pathname = /filename\n      if (!host || !pathname) {\n        console.error('Invalid URL format:', { host, pathname })\n        callback({ error: -2 }) // net::FAILED\n        return\n      }\n\n      const type = host\n      const encodedFilename = pathname.substring(1) // Remove leading /\n      const filename = decodeURIComponent(encodedFilename)\n\n      console.log('Processing file:', { type, filename })\n\n      // Determine the base path based on the type\n      let basePath: string\n      if (type === 'clip') {\n        basePath = clipsPath\n      } else if (type === 'thumb') {\n        basePath = thumbnailsPath\n      } else if (type === 'audio') {\n        basePath = join(thumbnailsPath, 'audio')\n      } else if (type === 'exported') {\n        basePath = join(clipsPath, 'exported-clips')\n      } else {\n        console.error('Unknown resource type:', type)\n        callback({ error: -2 })\n        return\n      }\n\n      // Build the full file path\n      const filePath = join(basePath, filename)\n      console.log('Full file path:', filePath)\n\n      // Check if file exists\n      if (!existsSync(filePath)) {\n        console.error('File not found:', filePath)\n        callback({ error: -6 }) // net::ERR_FILE_NOT_FOUND\n        return\n      }\n\n      // registerFileProtocol automatically handles byte-range requests for video seeking\n      callback({ path: filePath })\n    } catch (error) {\n      console.error('Protocol handler error:', error)\n      callback({ error: -2 })\n    }\n  })\n\n  // Create tray icon\n  createTray()\n\n  // Create the main window\n  await createWindow().catch(err => {\n    console.error('Failed to create window:', err)\n  })\n\n  // Start the backend\n  console.log('Attempting to start backend...')\n  startBackend()\n\n  // Verify backend started after a short delay\n  setTimeout(() => {\n    try {\n      const { backendLogPath } = getBackendPaths()\n      const checkOutput = execSync(\n        'tasklist /NH /FO CSV /FI \"IMAGENAME eq ClipVault.exe\"',\n        { encoding: 'utf-8', stdio: ['pipe', 'pipe', 'ignore'] }\n      )\n      const isRunning = checkOutput.includes('ClipVault.exe')\n      console.log('Backend verification after spawn:', isRunning ? 'running' : 'not running')\n      \n      // Check if log file was created\n      if (existsSync(backendLogPath)) {\n        console.log('Backend log file exists:', backendLogPath)\n      } else {\n        console.warn('Backend log file not found - spawn may have failed silently')\n      }\n    } catch (e) {\n      console.log('Could not verify backend status:', e)\n    }\n  }, 2000)\n\n  app.on('activate', () => {\n    if (BrowserWindow.getAllWindows().length === 0) {\n      createWindow()\n    }\n  })\n})\n\napp.on('window-all-closed', () => {\n  // Don't quit on macOS when all windows are closed\n  if (process.platform !== 'darwin') {\n    // Only quit if there's no tray\n    if (!tray) {\n      app.quit()\n    }\n  }\n})\n\n// Handle app quit\napp.on('before-quit', (event) => {\n  console.log('App is quitting...')\n  isQuitting = true\n  if (tray) {\n    tray.destroy()\n    tray = null\n  }\n})\n\n// Set app as quitting when user chooses Exit from tray\napp.on('will-quit', () => {\n  isQuitting = true\n})\n"],"names":["isexe","sync","fs","checkPathExt","path","options","pathext","i","p","checkStat","stat","cb","er","checkMode","mod","uid","gid","myUid","myGid","u","g","o","ug","ret","global","require$$1","require$$2","resolve","reject","is","which","isWindows","require$$0","cmd","opt","colon","pathEnv","pathExt","pathExtExe","info","found","F","l","pathPart","E","ii","ll","ext","j","cur","line","progress","progressParts","progressSplit","key","value","utils","utilsModule","source","dest","list","argfunc","arg","count","index","cloned","filters","filterSpec","filterString","streamSpec","option","name","callback","err","result","timemark","parts","secs","command","stderrLine","codecsObject","inputPattern","durPattern","audioPattern","videoPattern","inputStack","inputIndex","inInput","format","dur","audio","video","duration","stderr","messages","message","maxLines","cbs","lines","current","closed","max","emit","str","newLines","proto","isFile","isStream","hasInputStream","input","protocol","fps","seek","codec","bitrate","channels","freq","quality","constant","frames","getScalePadFilters","width","height","aspect","color","createSizeFilters","output","data","fixedSize","fixedWidth","fixedHeight","percentRatio","ratio","size","a","match","pad","target","pipeopts","hasOutputStream","self","spec","doSplit","split","map","preset","modulePath","module","require","async","root","previous_async","only_once","fn","called","_each","arr","iterator","_map","results","x","_reduce","memo","_keys","obj","keys","k","completed","iterate","limit","_eachLimit","started","running","replenish","doParallel","args","doParallelLimit","doSeries","_asyncMap","eachfn","v","_mapLimit","reversed","_filter","b","_reject","_detect","main_callback","criteria","left","right","tasks","listeners","addListener","removeListener","taskComplete","task","taskCallback","safeResults","rkey","requires","ready","listener","wrapIterator","next","_parallel","makeCallback","_concat","r","y","test","worker","concurrency","_insert","q","pos","item","workers","payload","working","cargo","process","ts","ds","_console_fn","hasher","queues","memoized","counter","fns","that","newargs","nextargs","_applyEach","go","spawn","require$$3","require$$4","runFfprobe","processCB","endCB","stdoutRing","stdoutClosed","stderrRing","stderrClosed","ffmpegProc","exitError","handleExit","processExited","code","signal","complexFilters","fileOutput","sizeFilters","audioFilters","videoFilters","outputArg","readMetadata","flvmeta","e","encoders","event","outputPresent","outputStream","inputStream","ended","emitEnd","stdout","reportingErr","msg","codecDataSent","codecObject","flvtool","niceness","logger","pid","renice","avCodecRegexp","ffCodecRegexp","ffEncodersRegexp","ffDecodersRegexp","encodersRegexp","formatRegexp","lineBreakRegexp","filterRegexp","cache","ffmpegPath","ffprobePath","exists","ffmpeg","ffprobe","flvtool2","types","codecData","decoders","coderData","formats","unavailable","fmts","cdcs","acodec","vcodec","legacyTag","legacyDisposition","parseFfprobeOutput","out","parseBlock","kv","stream","chapter","handleCallback","src","legacyTagKeys","tagKey","legacyDispositionKeys","dispositionKey","PassThrough","config","folder","interval","percentSize","metadata","getMetadata","meta","t","vstream","biggest","mark","pattern","filenames","padding","idx","f","first","fileInput","hasAudioStreams","hasVideoStreams","prop","fluentFfmpeg","clone","require$$5","require$$6","require$$7","require$$8","require$$9","require$$10","require$$11","require$$12","require$$13","file","instance","require$$14","dirname","join","app","existsSync","error","reason","promise","inProduction","backendPath","backendProc","execSync","icon","nativeImage","Tray","Menu","clipsFolder","mkdir","shell","BrowserWindow","killed","appDataPath","ipcMain","settingsPath","content","readFile","parseError","_","settings","configDir","writeFile","screen","display","files","readdir","filename","filePath","stats","metadataPath","clipId","dialog","videoPath","thumbnailFilename","thumbnailPath","fileUrl","s","htmlContent","autoCloseTimeout","channel","dragIcon","folderPath","audioCachePath","track1Path","track2Path","track1Exists","track2Exists","audioStreams","params","clipPath","exportFilename","trimStart","trimEnd","audioTrack1","audioTrack2","audioTrack1Volume","audioTrack2Volume","targetSizeMB","vol1","vol2","exportedClipsPath","outputPath","videoBitrate","useTargetSize","targetSizeKB","totalBitrate","filter","request","url","host","pathname","type","encodedFilename","basePath","backendLogPath","isRunning"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]}