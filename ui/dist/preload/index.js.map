{"version":3,"file":"index.js","sources":["../../src/preload/index.ts"],"sourcesContent":["import { contextBridge, ipcRenderer, IpcRendererEvent } from 'electron'\n\n// Settings interface\ninterface AppSettings {\n  output_path: string\n  buffer_seconds: number\n  video: {\n    width: number\n    height: number\n    fps: number\n    encoder: 'auto' | 'nvenc' | 'x264'\n    quality: number\n  }\n  audio: {\n    sample_rate: number\n    bitrate: number\n    system_audio_enabled: boolean\n    microphone_enabled: boolean\n  }\n  hotkey: {\n    save_clip: string\n  }\n  ui?: {\n    show_notifications: boolean\n    minimize_to_tray: boolean\n    start_with_windows: boolean\n  }\n  launcher?: {\n    autostart_backend: boolean\n    backend_mode: string\n    single_instance: boolean\n  }\n}\n\n// Expose protected methods to renderer process\ncontextBridge.exposeInMainWorld('electronAPI', {\n  // Settings\n  getSettings: () => ipcRenderer.invoke('settings:get'),\n  saveSettings: (settings: AppSettings) => ipcRenderer.invoke('settings:save', settings),\n  restartBackend: () => ipcRenderer.invoke('backend:restart'),\n  setStartup: (enabled: boolean) => ipcRenderer.invoke('settings:setStartup', enabled),\n\n  // System\n  getMonitors: () => ipcRenderer.invoke('system:getMonitors'),\n  getAudioDevices: (type: 'output' | 'input') => ipcRenderer.invoke('audio:getDevices', type),\n\n  // Clips\n  getClipsList: () => ipcRenderer.invoke('clips:getList'),\n  saveClipMetadata: (clipId: string, metadata: unknown) =>\n    ipcRenderer.invoke('clips:saveMetadata', clipId, metadata),\n  getClipMetadata: (clipId: string) => ipcRenderer.invoke('clips:getMetadata', clipId),\n  deleteClip: (clipId: string) => ipcRenderer.invoke('clips:delete', clipId),\n  generateThumbnail: (clipId: string, videoPath: string) =>\n    ipcRenderer.invoke('clips:generateThumbnail', clipId, videoPath),\n  getExistingThumbnails: () => ipcRenderer.invoke('clips:getExistingThumbnails'),\n  getVideoMetadata: (videoPath: string) => ipcRenderer.invoke('clips:getVideoMetadata', videoPath),\n\n  // Audio tracks\n  extractAudioTracks: (clipId: string, videoPath: string) =>\n    ipcRenderer.invoke('audio:extractTracks', clipId, videoPath),\n\n  // Video loading\n  getVideoFileUrl: (filename: string) => ipcRenderer.invoke('video:getFileUrl', filename),\n\n  // Export preview\n  showExportPreview: (filePath: string) => ipcRenderer.invoke('export:showPreview', filePath),\n\n  // Cleanup - permanent deletion of cache files (bypasses recycle bin)\n  cleanupOrphanedCache: () => ipcRenderer.invoke('cleanup:orphans'),\n  getCacheStats: () => ipcRenderer.invoke('cleanup:stats'),\n\n  // System\n  openClipsFolder: () => ipcRenderer.invoke('system:openFolder'),\n\n  // Dialogs\n  showSaveDialog: (options: Electron.SaveDialogOptions) =>\n    ipcRenderer.invoke('dialog:save', options),\n\n  // Dialog API\n  dialog: {\n    save: (options: Electron.SaveDialogOptions) => ipcRenderer.invoke('dialog:save', options),\n    openFolder: () => ipcRenderer.invoke('dialog:openFolder'),\n  },\n\n  editor: {\n    exportClip: (params: ExportParams) => ipcRenderer.invoke('editor:exportClip', params),\n    saveState: (clipId: string, state: unknown) => ipcRenderer.invoke('editor:saveState', clipId, state),\n    loadState: (clipId: string) => ipcRenderer.invoke('editor:loadState', clipId),\n  },\n\n  // Event listener\n  on: (channel: string, callback: (data: unknown) => void) => {\n    const listener = (_event: IpcRendererEvent, data: unknown) => callback(data)\n    ipcRenderer.on(channel, listener)\n    return () => {\n      ipcRenderer.removeListener(channel, listener)\n    }\n  },\n})\n\ninterface VideoMetadata {\n  duration: number\n  width: number\n  height: number\n  fps: number\n  bitrate: number\n  size: number\n  format: string\n  videoCodec: string\n  audioTracks: number\n}\n\n// Type for clip info (matches main process)\ninterface ClipInfo {\n  id: string\n  filename: string\n  path: string\n  size: number\n  createdAt: string\n  modifiedAt: string\n  metadata: unknown | null\n}\n\ninterface ExportParams {\n  clipPath: string\n  exportFilename: string\n  trimStart: number\n  trimEnd: number\n  audioTrack1: boolean\n  audioTrack2: boolean\n  audioTrack1Volume?: number\n  audioTrack2Volume?: number\n  targetSizeMB?: number | 'original'\n}\n\ninterface ExportResult {\n  success: boolean\n  error?: string\n}\n\ninterface AudioTrackUrls {\n  track1?: string\n  track2?: string\n  error?: string\n}\n\n// Editor state for persistence\ninterface EditorState {\n  trim: {\n    start: number\n    end: number\n  }\n  playheadPosition: number\n  audio: {\n    track1: {\n      enabled: boolean\n      muted: boolean\n      volume: number\n    }\n    track2: {\n      enabled: boolean\n      muted: boolean\n      volume: number\n    }\n  }\n  lastModified: string\n}\n\ninterface AudioDeviceInfo {\n  id: string\n  name: string\n  type: 'output' | 'input'\n  is_default: boolean\n}\n\ninterface MonitorInfo {\n  id: number\n  name: string\n  width: number\n  height: number\n  x: number\n  y: number\n  primary: boolean\n}\n\n// Type declarations for TypeScript\ndeclare global {\n  interface Window {\n    electronAPI: {\n      getSettings: () => Promise<AppSettings>\n      saveSettings: (settings: AppSettings) => Promise<{ success: boolean }>\n      setStartup: (enabled: boolean) => Promise<{ success: boolean }>\n      getClipsList: () => Promise<ClipInfo[]>\n      saveClipMetadata: (clipId: string, metadata: unknown) => Promise<boolean>\n      getClipMetadata: (clipId: string) => Promise<unknown | null>\n      generateThumbnail: (clipId: string, videoPath: string) => Promise<string>\n      getExistingThumbnails: () => Promise<{ [clipId: string]: string }>\n      getVideoMetadata: (videoPath: string) => Promise<VideoMetadata>\n      extractAudioTracks: (clipId: string, videoPath: string) => Promise<AudioTrackUrls>\n      getVideoFileUrl: (filename: string) => Promise<{ success: boolean; url?: string; path?: string; error?: string }>\n      cleanupOrphanedCache: () => Promise<{ deletedCount: number; errors: string[] }>\n      getCacheStats: () => Promise<{\n        thumbnailCount: number\n        thumbnailSize: number\n        audioCount: number\n        audioSize: number\n        totalSize: number\n        thumbnailSizeFormatted: string\n        audioSizeFormatted: string\n        totalSizeFormatted: string\n      } | null>\n      getMonitors: () => Promise<MonitorInfo[]>\n      getAudioDevices: (type: 'output' | 'input') => Promise<AudioDeviceInfo[]>\n      openClipsFolder: () => Promise<void>\n      showSaveDialog: (\n        options: Electron.SaveDialogOptions\n      ) => Promise<Electron.SaveDialogReturnValue>\n      dialog: {\n        save: (options: Electron.SaveDialogOptions) => Promise<Electron.SaveDialogReturnValue>\n        openFolder: () => Promise<Electron.OpenDialogReturnValue>\n      }\n      editor: {\n        exportClip: (params: ExportParams) => Promise<ExportResult>\n        saveState: (clipId: string, state: EditorState) => Promise<boolean>\n        loadState: (clipId: string) => Promise<EditorState | null>\n      }\n      on: (channel: string, callback: (data: unknown) => void) => (() => void) | undefined\n    }\n  }\n}\n"],"names":["contextBridge","ipcRenderer","settings","enabled","type","clipId","metadata","videoPath","filename","filePath","options","params","state","channel","callback","listener","_event","data"],"mappings":"yCAmCAA,EAAAA,cAAc,kBAAkB,cAAe,CAE7C,YAAa,IAAMC,EAAAA,YAAY,OAAO,cAAc,EACpD,aAAeC,GAA0BD,EAAAA,YAAY,OAAO,gBAAiBC,CAAQ,EACrF,eAAgB,IAAMD,EAAAA,YAAY,OAAO,iBAAiB,EAC1D,WAAaE,GAAqBF,EAAAA,YAAY,OAAO,sBAAuBE,CAAO,EAGnF,YAAa,IAAMF,EAAAA,YAAY,OAAO,oBAAoB,EAC1D,gBAAkBG,GAA6BH,EAAAA,YAAY,OAAO,mBAAoBG,CAAI,EAG1F,aAAc,IAAMH,EAAAA,YAAY,OAAO,eAAe,EACtD,iBAAkB,CAACI,EAAgBC,IACjCL,EAAAA,YAAY,OAAO,qBAAsBI,EAAQC,CAAQ,EAC3D,gBAAkBD,GAAmBJ,EAAAA,YAAY,OAAO,oBAAqBI,CAAM,EACnF,WAAaA,GAAmBJ,EAAAA,YAAY,OAAO,eAAgBI,CAAM,EACzE,kBAAmB,CAACA,EAAgBE,IAClCN,EAAAA,YAAY,OAAO,0BAA2BI,EAAQE,CAAS,EACjE,sBAAuB,IAAMN,EAAAA,YAAY,OAAO,6BAA6B,EAC7E,iBAAmBM,GAAsBN,EAAAA,YAAY,OAAO,yBAA0BM,CAAS,EAG/F,mBAAoB,CAACF,EAAgBE,IACnCN,EAAAA,YAAY,OAAO,sBAAuBI,EAAQE,CAAS,EAG7D,gBAAkBC,GAAqBP,EAAAA,YAAY,OAAO,mBAAoBO,CAAQ,EAGtF,kBAAoBC,GAAqBR,EAAAA,YAAY,OAAO,qBAAsBQ,CAAQ,EAG1F,qBAAsB,IAAMR,EAAAA,YAAY,OAAO,iBAAiB,EAChE,cAAe,IAAMA,EAAAA,YAAY,OAAO,eAAe,EAGvD,gBAAiB,IAAMA,EAAAA,YAAY,OAAO,mBAAmB,EAG7D,eAAiBS,GACfT,EAAAA,YAAY,OAAO,cAAeS,CAAO,EAG3C,OAAQ,CACN,KAAOA,GAAwCT,EAAAA,YAAY,OAAO,cAAeS,CAAO,EACxF,WAAY,IAAMT,cAAY,OAAO,mBAAmB,CAAA,EAG1D,OAAQ,CACN,WAAaU,GAAyBV,EAAAA,YAAY,OAAO,oBAAqBU,CAAM,EACpF,UAAW,CAACN,EAAgBO,IAAmBX,EAAAA,YAAY,OAAO,mBAAoBI,EAAQO,CAAK,EACnG,UAAYP,GAAmBJ,EAAAA,YAAY,OAAO,mBAAoBI,CAAM,CAAA,EAI9E,GAAI,CAACQ,EAAiBC,IAAsC,CAC1D,MAAMC,EAAW,CAACC,EAA0BC,IAAkBH,EAASG,CAAI,EAC3EhB,OAAAA,cAAY,GAAGY,EAASE,CAAQ,EACzB,IAAM,CACXd,cAAY,eAAeY,EAASE,CAAQ,CAC9C,CACF,CACF,CAAC"}